"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[742],{742:(e,t,n)=>{n.r(t);var r=n(153);class o{constructor({authorId:e}){this.authorId=e}}class s{constructor(e){Object.assign(this,e)}}class i{constructor({storyId:e,title:t,authors:n}){this.storyId=e,this.title=t,this.rootDocumentId=e,this.authors=n.map((e=>new o(e)))}}class a{static getStory$(e){return a.service.getStory$(e).pipe((0,r.map)((e=>new i(e))))}static getDocument$(e,t){return a.service.getDocument$(e,t).pipe((0,r.map)((e=>new s(e))))}static putDocument$(e,t){return a.service.putDocument$(e,t).pipe((0,r.map)((e=>new s(e))))}static postDocument$(e,t,n){return a.service.postDocument$(e,t,n).pipe((0,r.map)((e=>new s(e))))}static deleteDocument$(e,t){return a.service.deleteDocument$(e,t)}static getContent$(e,t){return a.service.getContent$(e,t)}static postContent$(e,t,n){return a.service.postContent$(e,t,n)}static getChildren$(e,t){let n=t.count||1e3,o=t.fromIndex||0;return a.service.getChildren$(e,t.parentDocumentId,o,n).pipe((0,r.map)((({documents:e})=>e.map((e=>new s({documentId:e.documentId,storyId:e.storyId,title:e.title,position:e.position}))))))}}var c=n(866);class d{getStory$(e){return(0,c.createObservableFromFetch)(new Request(`${d.urlBase}/${e}`))}getChildren$(e,t,n,r){return(0,c.createObservableFromFetch)(new Request(`${d.urlBase}/${e}/documents/${t}/children?from-index=${n}&count=${r}`))}putDocument$(e,t){return(0,c.createObservableFromFetch)(new Request(`${d.urlBase}/${e}/documents`,{method:"POST",body:JSON.stringify(t)}))}postDocument$(e,t,n){return(0,c.createObservableFromFetch)(new Request(`${d.urlBase}/${e}/documents/${t}`,{method:"POST",body:JSON.stringify(n)}))}deleteDocument$(e,t){return(0,c.createObservableFromFetch)(new Request(`${d.urlBase}/${e}/documents/${t}/delete`,{method:"POST"}))}getContent$(e,t){return(0,c.createObservableFromFetch)(new Request(`${d.urlBase}/${e}/contents/${t}`))}postContent$(e,t,n){return(0,c.createObservableFromFetch)(new Request(`${d.urlBase}/${e}/contents/${t}`,{method:"POST",body:JSON.stringify(n)}))}putStory$(e){throw new Error("Method not implemented.")}postStory$(e,t){throw new Error("Method not implemented.")}getDocument$(e,t){throw new Error("Method not implemented.")}}d.urlBase="/api/assets-gateway/raw/story";var l,u=n(516),p=n(701),m=n(785),h=n(128),w=n(925),f=n(265),b=n(595);function x(e,t,n){let r=new b.TextInput.State(t);return{id:n,class:"row my-4 ",children:[{tag:"span",class:"col",innerText:e},new b.TextInput.View({state:r,class:"col"})]}}function g({rows:e,ok$:t}){let n=new w.Button.View({state:new w.Button.State,contentView:()=>({innerText:"Ok"}),class:"fv-btn fv-btn-primary fv-bg-focus mr-2"}),r=new f.Modal.State(t),o=(0,u.render)(new f.Modal.View({state:r,contentView:()=>({id:"modal-select-module",class:"border rounded fv-text-primary fv-bg-background d-flex flex-column p-5",children:[{children:e},{class:"d-flex p-2",children:[n]}]}),connectedCallback:e=>{e.ownSubscriptions(n.state.click$.subscribe((()=>r.ok$.next())),(0,p.merge)(r.cancel$,r.ok$).subscribe((()=>o.remove())))}}));return document.querySelector("body").appendChild(o),r}function $(e){let t=window["@youwol/cdn-client"],n=t.fetchStyleSheets(e.urlsCss),o=t.fetchBundles(e.bundles,window).then((n=>t.fetchJavascriptAddOn(e.urlsJsAddOn,window).then((e=>({bundles:n,jsAddOns:e})))));return(0,p.from)(Promise.all([o,n])).pipe((0,r.share)())}!function(e){e.Rename="Rename"}(l||(l={}));class y extends m.ImmutableTree.Node{constructor({id:e,name:t,children:n,story:r}){super({id:e,children:n}),this.signal$=new p.ReplaySubject,this.name=t,this.story=r}}class v extends y{constructor({story:e,rootDocument:t,children:n}){super({id:t.documentId,story:e,name:e.title,children:n||I(e,t.documentId)}),this.rootDocument=t}getDocument(){return this.rootDocument}}class S extends y{constructor({story:e,document:t,children:n}){super({id:t.documentId,story:e,name:t.title,children:n||I(e,t.documentId)}),this.document=t}getDocument(){return this.document}}function I(e,t){return a.getChildren$(e.storyId,{parentDocumentId:t}).pipe((0,r.map)((t=>t.map((t=>new S({story:e,document:t}))))))}let k={newPage:{applicable:e=>e instanceof S||e instanceof v,createNode:(e,t)=>new N({parentNode:e,explorerState:t})},deleteDocument:{applicable:e=>e instanceof S,createNode:(e,t)=>new F({deletedNode:e,explorerState:t})},renameStoryNode:{applicable:e=>e instanceof v,createNode:(e,t)=>new R({node:e,explorerState:t})},renameDocumentNode:{applicable:e=>e instanceof S,createNode:(e,t)=>new R({node:e,explorerState:t})},setFromTemplate:{applicable:e=>e instanceof v,createNode:(e,t)=>new M({parentNode:e,explorerState:t})}};class D extends m.ImmutableTree.Node{constructor({id:e,children:t,name:n,faIcon:r}){super({id:e,children:t}),this.name=n,this.faIcon=r}}class j extends D{constructor({children:e}){super({id:"root",children:e,name:"menu list",faIcon:""})}}class N extends D{constructor(e){super({id:"add-document",children:[new C(e),new T(e)],name:"new document",faIcon:"fas fa-plus"}),Object.assign(this,e)}}class C extends D{constructor(e){super({id:"add-document-empty",children:void 0,name:"empty document",faIcon:"fas fa-file"}),Object.assign(this,e)}execute(e){this.explorerState.appState.addDocument(this.parentNode.id,{content:"",title:"New document"})}}function O({factory:e,explorerState:t,parentNode:n}){let r=function(e){let t=Object.entries(e.resources).map((([e,t])=>`*    [${e}](${t})`));return`\n# Module ${e.displayName}\n\n## Abstract\n\nProvide here a short abstract of the purpose of the module.\n\n\n### Illustrative example\n\nIt is usually good to also provide an illustrative example (replace with your project id):\n\n\`\`\`youwol-view\nreturn ({youwol, documentScope}) =>{\n\n   return new youwol.FluxAppView({\n        projectId: "b6f7ae4b-c106-457c-9de1-2c94aeea5986",\n        wrapperDiv: {\n          style:{\n              aspectRatio: 2\n          },\n        },\n        modes:['runner', 'workflow', 'builder']\n    })\n }\n\`\`\`\n\n## Configuration\n\nBelow is the configuration's settings of the module, they are persisted with the workflow:\n\n\`\`\`youwol-view\nreturn ({youwol, documentScope}) =>{\n\n   return new youwol.ModuleSettingsView({\n        toolboxName: "${e.packId}",\n        brickId: "${e.id}",\n        version: "latest",\n        class:"mx-auto border rounded p-2 w-50",\n        style:{\n        \tmaxWidth:'500px'\n        }\n    })\n }\n\`\`\`\n\n## Additional examples\n\nYou can provide more examples here\n\n## Additional Resources\n\n${t}\n`}(e);t.appState.addDocument(n.id,{content:r,title:e.displayName})}class T extends D{constructor(e){super({id:"add-document-template-brick",children:void 0,name:"brick template",faIcon:"fas fa-puzzle-piece"}),Object.assign(this,e)}execute(e){(function({ok$:e}={}){let t=new p.BehaviorSubject("@youwol/flux-three"),n=new p.BehaviorSubject("ModuleSphere");return g({rows:[x("Toolbox id",t,"toolbox-id"),x("Brick id",n,"brick-id")],ok$:e}).ok$.pipe((0,r.map)((()=>({toolboxId:t.getValue(),brickId:n.getValue()}))))})().pipe((0,r.mergeMap)((({toolboxId:e,brickId:t})=>$({bundles:{[e]:"latest"},urlsCss:[],urlsJsAddOn:[]}).pipe((0,r.map)((()=>window[e][t])))))).subscribe((e=>{O({factory:e,explorerState:this.explorerState,parentNode:this.parentNode})}))}}class M extends D{constructor(e){super({id:"set-from-template",children:[new V(e)],name:"Set from template",faIcon:"fas fa-book-open"}),Object.assign(this,e)}}class V extends D{constructor(e){super({id:"set-from-template-toolbox",children:void 0,name:"Toolbox",faIcon:"fas fa-toolbox"}),Object.assign(this,e)}execute(e){(function({ok$:e}={}){let t=new p.BehaviorSubject("@youwol/flux-three");return g({rows:[x("Toolbox id",t,"toolbox-id")],ok$:e}).ok$.pipe((0,r.map)((()=>({toolboxId:t.getValue()}))))})().pipe((0,r.mergeMap)((({toolboxId:e})=>$({bundles:{[e]:"latest"},urlsCss:[],urlsJsAddOn:[]}).pipe((0,r.map)((()=>window[e].pack.modules)))))).subscribe((e=>Object.values(e).forEach((e=>O({factory:e,explorerState:this.explorerState,parentNode:this.parentNode})))))}}class R extends D{constructor(e){super({id:e.node instanceof S?"rename-document":"rename-story",children:void 0,name:e.node instanceof S?"rename document":"rename story",faIcon:"fas fa-pen"}),Object.assign(this,e)}execute(e){this.node.signal$.next({type:l.Rename})}}class F extends D{constructor(e){super({id:"delete-document",children:void 0,name:"delete document",faIcon:"fas fa-trash"}),Object.assign(this,e)}execute(e){this.explorerState.appState.deleteDocument(this.deletedNode.document)}}class B extends h.ContextMenu.State{constructor({appState:e,explorerState:t,explorerDiv:n}){super((0,p.fromEvent)(n,"contextmenu").pipe((0,r.tap)((e=>e.preventDefault())))),this.appState=e,this.explorerState=t,this.explorerDiv=n}dispatch(e){return{style:{zIndex:1},children:[(0,u.child$)(this.appState.selectedNode$,(e=>new A({state:this,selectedNode:e})))]}}}class A{constructor(e){this.id="context-menu-view",Object.assign(this,e);let t=Object.values(k).filter((e=>e.applicable(this.selectedNode))).map((e=>e.createNode(this.selectedNode,this.state.explorerState))),n=new j({children:t}),o=new m.ImmutableTree.State({rootNode:n,expandedNodes:[n.id]});o.selectedNode$.next(n),this.children=[new m.ImmutableTree.View({state:o,headerView:(e,t)=>function(e){return{class:"d-flex w-100 align-items-baseline fv-pointer fv-hover-bg-background-alt px-1",children:[{tag:"i",class:e.faIcon},{tag:"span",class:"mx-2 w-100",innerText:e.name,style:{"user-select":"none"}}]}}(t),class:"fv-bg-background fv-text-primary p-2 rounded border fv-color-primary"})],this.connectedCallback=e=>{let t=o.selectedNode$.pipe((0,r.filter)((e=>function(e){return void 0!==e.execute}(e)))).subscribe((t=>{e.remove(),t.execute(this)}));e.ownSubscriptions(t)}}}class P extends m.ImmutableTree.State{constructor({rootDocument:e,appState:t}){let n=new v({story:t.story,rootDocument:e});super({rootNode:n,selectedNode:t.selectedNode$,expandedNodes:[t.story.storyId]}),this.appState=t,t.selectNode(n),t.deletedDocument$.subscribe((e=>{this.removeNode(e.documentId),this.selectedNode$.next(this.getNode(n.id))})),t.addedDocument$.subscribe((({parentDocumentId:e,document:t})=>{let n=new S({story:this.appState.story,document:t});this.addChild(e,n)}))}}class E extends m.ImmutableTree.View{constructor({explorerState:e}){super({state:e,headerView:q}),this.style={minWidth:"300px"},this.class="p-2 border fv-color-primary",this.appState=e.appState,this.connectedCallback=e=>{let t=new B({appState:this.appState,explorerState:this.state,explorerDiv:e});return new h.ContextMenu.View({state:t,class:"fv-bg-background border fv-color-primary"})}}}function q(e,t){let n="",o="",s="";return t instanceof v&&(n="fas fa-book-open",o=t.story.storyId,s="story"),t instanceof S&&(n="fas fa-file",o=t.document.documentId,s="document"),{id:o,class:`d-flex align-items-center fv-pointer fv-hover-bg-background-alt w-100 ${s}`,children:[{class:n+" px-2"},(0,u.child$)(t.signal$.pipe((0,r.filter)((e=>e.type==l.Rename))),(()=>function(e,t){return{tag:"input",type:"text",autofocus:!0,style:{zIndex:200},class:"mx-2",data:e.name,onclick:e=>e.stopPropagation(),onkeydown:n=>{"Enter"===n.key&&t.appState.rename(e,n.target.value)}}}(t,e)),{untilFirst:{tag:"span",innerText:t.name}}),{class:(0,u.attr$)(e.appState.save$.pipe((0,r.filter)((({document:e})=>e.documentId==t.getDocument().documentId)),(0,r.map)((({status:e})=>e))),(e=>e==K.started?"fas fa-circle px-2":"")),style:{transform:"scale(0.5)"}}]}}class J{constructor(e){this.id="editor-view",this.configurationCodeMirror={value:"",mode:"markdown",lineNumbers:!1,theme:"blackboard",lineWrapping:!0},this.codeMirrorEditor$=new p.ReplaySubject(1),Object.assign(this,e),this.children=[{class:"w-100 h-100",children:[(0,u.child$)(J.codeMirror$,(()=>({id:"code-mirror-editor",class:"w-100 h-100",connectedCallback:e=>{let t={...this.configurationCodeMirror,value:""},n=window.CodeMirror(e,t);n.on("changes",((e,t)=>{1==t.length&&"setValue"==t[0].origin||this.appState.setContent(this.document,n.getValue(),Q.editor)}));let o=this.appState.page$.pipe((0,r.filter)((({document:e})=>e==this.document))).subscribe((({content:e,originId:t})=>{t!=Q.editor&&n.setValue(e)}));this.codeMirrorEditor$.next(n),e.ownSubscriptions(o)}})))]}]}}J.codeMirror$=$({bundles:{codemirror:"5.52.0"},urlsJsAddOn:["codemirror#5.52.0~mode/javascript.min.js","codemirror#5.52.0~mode/markdown.min.js","codemirror#5.52.0~mode/css.min.js","codemirror#5.52.0~mode/xml.min.js","codemirror#5.52.0~mode/htmlmixed.min.js","codemirror#5.52.0~mode/gfm.min.js"],urlsCss:["codemirror#5.52.0~codemirror.min.css","codemirror#5.52.0~theme/blackboard.min.css"]});var L,W=n(723);!function(e){e.Runner="runner",e.Workflow="workflow",e.Builder="builder"}(L||(L={}));let H={[L.Runner]:e=>`/ui/flux-runner/?id=${e}`,[L.Workflow]:e=>`/ui/flux-runner/?id=${e}`,[L.Builder]:e=>`/ui/flux-builder/?id=${e}`},z={[L.Runner]:"fas fa-play",[L.Workflow]:"fas fa-sitemap",[L.Builder]:"fas fa-tools"};function U(e){return{class:"px-2 fv-pointer "+e.class,children:[{class:e.faClasses}],onclick:()=>e.onclick()}}class Y{constructor(e){this.class="flux-app-view",this.style={},this.selectedMode$=new p.BehaviorSubject(L.Runner),this.renderedIframe$=new p.ReplaySubject(1),Object.assign(this,e);let t=e.wrapperDiv&&e.wrapperDiv.class?e.wrapperDiv.class:Y.defaultClass,n=e.wrapperDiv&&e.wrapperDiv.style?e.wrapperDiv.style:{};this.children=[this.fluxAppToolBarView(),{class:t,style:n,id:e.projectId,children:[(0,u.child$)(this.selectedMode$,(t=>({tag:"iframe",width:"100%",height:"100%",src:H[t](e.projectId),connectedCallback:e=>{this.renderedIframe$.next(e)}})))]}]}fluxAppToolBarView(){return{class:"w-100 d-flex justify-content-center my-1",children:[{class:"d-flex mx-4 align-items-center",children:this.modes.map((e=>{return t=z[e],n=e,r=this.selectedMode$,{class:(0,u.attr$)(r,(e=>e==n?"fv-text-focus":"fv-text-primary"),{wrapper:e=>e+" fv-pointer mx-2 tool-bar-mode-view "+n}),children:[{class:t}],onclick:()=>r.next(n)};var t,n,r}))},{class:"d-flex mx-4  align-items-center",children:[(0,u.child$)(this.renderedIframe$,(e=>U({class:"request-full-screen",faClasses:"fas fa-expand",onclick:()=>e.requestFullscreen()}))),U({class:"window-open-url",faClasses:"fas fa-external-link-alt",onclick:()=>{window.open(H[this.selectedMode$.getValue()](this.projectId),"_blank").focus()}})]}]}}}Y.defaultClass="w-100 overflow-auto";var _=n(484);class G{constructor(e){this.version="latest",this.bundleLoaded$=new p.ReplaySubject(1),this.class="flux-module-settings-view",this.style={},this.renderedElement$=new p.ReplaySubject(1),Object.assign(this,e),this.children=[(0,u.child$)($({bundles:{[this.toolboxName]:this.version},urlsCss:[],urlsJsAddOn:[]}).pipe((0,r.map)((()=>window[this.toolboxName][this.brickId])),(0,r.map)((e=>new e.PersistentData))),(e=>this.autoFormView(e)))]}autoFormView(e){let t=(0,c.flattenSchemaWithValue)(e),n=Object.keys(t).map((e=>({[e]:t[e][0]}))).reduce(((e,t)=>({...e,...t})),{}),r=new _.AutoForm.State(e,n,(()=>!0));return{class:"fv-bg-background fv-text-primary h-100 d-flex flex-column",children:[new _.AutoForm.View({state:r,class:"flex-grow-1 overflow-auto",style:{"min-height":"0px"}})],connectedCallback:e=>{this.renderedElement$.next(e)}}}}var K,Q,X,Z,ee=n(253),te=n.n(ee);(0,W.setOptions)({langPrefix:"hljs language-",highlight:function(e,t){return"youwol-view"==t?e:te().highlightAuto(e,[t]).value}});class ne{render(e){return e.innerHTML=(0,W.parse)(ie(e.innerHTML)),Promise.resolve(e)}}class re{constructor(){this.promise=Promise.resolve()}render(e){let t=this.promise.then((()=>(window.MathJax.typesetPromise([e]),e)));return this.promise=t,t}}class oe{constructor(e){this.class="w-100 d-flex fv-text-error",this.children=[{class:"fas fa-error youwol-view-error"},{innerText:e.message}]}}class se{render(e,t){return e.querySelectorAll(".language-youwol-view").forEach((e=>{let n;try{let r=ie(e.innerHTML);n=new Function(r)()({youwol:{FluxAppView:Y,ModuleSettingsView:G},documentScope:t})}catch(t){n=new oe({message:`An error ocurred while parsing the configuration:\n${e.innerHTML}`})}e.replaceWith((0,u.render)(n))})),Promise.resolve(e)}}function ie(e){return e.replace(/&gt;/g,">").replace(/&amp;gt;/g,">")}class ae{constructor(e){this.id="render-view",this.renderedElement$=new p.ReplaySubject(1),this.renderers=[new ne,new re,new se],Object.assign(this,e);let t=this.appState.page$.pipe((0,r.filter)((({document:e,originId:t})=>e==this.document&&t==Q.nodeLoad))),n=this.appState.page$.pipe((0,r.filter)((({document:e,originId:t})=>e==this.document&&t==Q.editor)),(0,r.skip)(1),(0,r.debounceTime)(ae.debounceTime));this.children=[{class:"w-100",connectedCallback:e=>{let r=(0,p.merge)(t,n).subscribe((({document:t,content:n})=>{e.innerHTML=n,this.render(e,t)}));e.ownSubscriptions(r)}}]}async render(e,t){await this.renderers.reduce((async(e,t)=>t.render(await e,{})),Promise.resolve(e)),this.renderedElement$.next({document:t,htmlElement:e})}}ae.debounceTime=500;class ce{constructor(e){this.class="d-flex flex-grow-1",this.style={minWidth:"0px"},this.innerClass="d-flex flex-column fv-bg-background w-50 h-100 mr-1 ml-2 p-2 overflow-auto",Object.assign(this,e);let t=this.appState.page$.pipe((0,r.map)((({document:e})=>e)),(0,r.distinctUntilChanged)());this.children=[(0,u.child$)(t,(e=>new J({document:e,appState:this.appState,class:this.innerClass}))),(0,u.child$)(t,(e=>new ae({document:e,appState:this.appState,class:this.innerClass})))]}}!function(e){e.started="Started",e.done="Done"}(K||(K={})),function(e){e.editor="editor",e.nodeLoad="loaded"}(Q||(Q={}));class de{constructor(e){this.selectedNode$=new p.ReplaySubject(1),this.page$=new p.ReplaySubject(1),this.addedDocument$=new p.ReplaySubject(1),this.deletedDocument$=new p.ReplaySubject(1),this.save$=new p.Subject,Object.assign(this,e),this.explorerState=new P({rootDocument:this.rootDocument,appState:this}),this.selectedNode$.pipe((0,r.distinctUntilChanged)(),(0,r.mergeMap)((e=>a.getContent$(e.getDocument().storyId,e.getDocument().documentId).pipe((0,r.map)((t=>({content:t,node:e}))))))).subscribe((({node:e,content:t})=>{this.page$.next({document:e.getDocument(),content:t,originId:Q.nodeLoad})})),this.page$.pipe((0,r.filter)((({originId:e})=>e==Q.editor)),(0,r.tap)((({document:e})=>{this.save$.next({document:e,status:K.started})})),(0,r.debounceTime)(de.debounceTimeSave),(0,r.mergeMap)((({document:e,content:t})=>a.postContent$(e.storyId,e.documentId,{content:t}).pipe((0,r.map)((()=>({content:t,document:e}))))))).subscribe((({document:e,content:t})=>{this.save$.next({document:e,status:K.done})}))}setContent(e,t,n){this.page$.next({document:e,content:t,originId:n})}selectNode(e){this.selectedNode$.next(e)}rename(e,t){let n=e.getDocument(),r={documentId:n.documentId,title:t};a.postDocument$(n.storyId,n.documentId,r).subscribe((n=>{e instanceof S?this.explorerState.replaceAttributes(e,{document:n}):this.explorerState.replaceAttributes(e,{story:new i({...e.story,title:t})})}))}addDocument(e,{title:t,content:n}){a.putDocument$(this.story.storyId,{parentDocumentId:e,title:t,content:n}).subscribe((t=>{this.addedDocument$.next({parentDocumentId:e,document:t})}))}deleteDocument(e){this.deletedDocument$.next(e),a.deleteDocument$(e.storyId,e.documentId).subscribe((()=>{}))}}de.debounceTimeSave=1e3;class le{constructor(e){this.class="fv-bg-background fv-text-primary d-flex flex-column w-100 h-100",Object.assign(this,e),this.children=[{class:"border fv-color-primary fv-bg-background-alt",style:{minHeight:"50px"}},{class:"d-flex flex-grow-1",style:{minHeight:"0px"},children:[new E({explorerState:this.state.explorerState}),new ce({appState:this.state})]}]}}a.service=new d,(X=new URLSearchParams(window.location.search).get("id"),Z=document.getElementById("content"),Z.innerHTML="",(0,p.forkJoin)([a.getStory$(X),a.getChildren$(X,{parentDocumentId:X,count:1}).pipe((0,r.map)((e=>e[0])))]).pipe((0,r.map)((([e,t])=>{let n=new de({story:e,rootDocument:t});return{appState:n,appView:new le({state:n})}})),(0,r.tap)((({appView:e})=>Z.appendChild((0,u.render)(e)))))).subscribe()}}]);