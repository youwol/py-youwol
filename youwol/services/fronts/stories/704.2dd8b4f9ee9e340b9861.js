"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[704],{704:(e,t,n)=>{n.r(t);var s=n(701),o=n(153);class r{constructor({authorId:e}){this.authorId=e}}class i{constructor(e){Object.assign(this,e)}}class a{constructor({storyId:e,title:t,authors:n}){this.storyId=e,this.title=t,this.rootDocumentId=e,this.authors=n.map((e=>new r(e)))}}class c{static getStory$(e){return(0,s.forkJoin)([c.service.getStory$(e),c.service.getPermissions$(e)]).pipe((0,o.map)((([e,t])=>({story:new a(e),permissions:t}))))}static getDocument$(e,t){return c.service.getDocument$(e,t).pipe((0,o.map)((e=>new i(e))))}static putDocument$(e,t){return c.service.putDocument$(e,t).pipe((0,o.map)((e=>new i(e))))}static postDocument$(e,t,n){return c.service.postDocument$(e,t,n).pipe((0,o.map)((e=>new i(e))))}static deleteDocument$(e,t){return c.service.deleteDocument$(e,t)}static getContent$(e,t){return c.service.getContent$(e,t)}static postContent$(e,t,n){return c.service.postContent$(e,t,n)}static getChildren$(e,t){let n=t.count||1e3,s=t.fromIndex||0;return c.service.getChildren$(e,t.parentDocumentId,s,n).pipe((0,o.map)((({documents:e})=>e.map((e=>new i({documentId:e.documentId,storyId:e.storyId,title:e.title,position:e.position}))))))}static getEmojis$(e){return c.service.getEmojis$(e)}}var d=n(866);class l{getStory$(e){return(0,d.createObservableFromFetch)(new Request(`${l.urlBase}/${e}`))}getPermissions$(e){return(0,d.createObservableFromFetch)(new Request(`/api/assets-gateway/assets/${btoa(e)}/access`)).pipe((0,o.map)((({consumerInfo:e})=>e.permissions)))}getChildren$(e,t,n,s){return(0,d.createObservableFromFetch)(new Request(`${l.urlBase}/${e}/documents/${t}/children?from-index=${n}&count=${s}`))}putDocument$(e,t){return(0,d.createObservableFromFetch)(new Request(`${l.urlBase}/${e}/documents`,{method:"POST",body:JSON.stringify(t)}))}postDocument$(e,t,n){return(0,d.createObservableFromFetch)(new Request(`${l.urlBase}/${e}/documents/${t}`,{method:"POST",body:JSON.stringify(n)}))}deleteDocument$(e,t){return(0,d.createObservableFromFetch)(new Request(`${l.urlBase}/${e}/documents/${t}/delete`,{method:"POST"}))}getContent$(e,t){return(0,d.createObservableFromFetch)(new Request(`${l.urlBase}/${e}/contents/${t}`))}postContent$(e,t,n){return(0,d.createObservableFromFetch)(new Request(`${l.urlBase}/${e}/contents/${t}`,{method:"POST",body:JSON.stringify(n)}))}putStory$(e){throw new Error("Method not implemented.")}postStory$(e,t){throw new Error("Method not implemented.")}getDocument$(e,t){throw new Error("Method not implemented.")}getEmojis$(e){return(0,d.createObservableFromFetch)(new Request(`/api/assets-gateway/misc/emojis/${e}`))}}l.urlBase="/api/assets-gateway/raw/story";var u,p=n(516),m=n(785),h=n(128),w=n(925),f=n(265),b=n(595);function v(e,t,n){let s=new b.TextInput.State(t);return{id:n,class:"row my-4 ",children:[{tag:"span",class:"col",innerText:e},new b.TextInput.View({state:s,class:"col"})]}}function g({rows:e,ok$:t}){let n=new w.Button.View({state:new w.Button.State,contentView:()=>({innerText:"Ok"}),class:"fv-btn fv-btn-primary fv-bg-focus mr-2"}),o=new f.Modal.State(t),r=(0,p.render)(new f.Modal.View({state:o,contentView:()=>({id:"modal-select-module",class:"border rounded fv-text-primary fv-bg-background d-flex flex-column p-5",children:[{children:e},{class:"d-flex p-2",children:[n]}]}),connectedCallback:e=>{e.ownSubscriptions(n.state.click$.subscribe((()=>o.ok$.next())),(0,s.merge)(o.cancel$,o.ok$).subscribe((()=>r.remove())))}}));return document.querySelector("body").appendChild(r),o}function y(e){let t=window["@youwol/cdn-client"],n=t.fetchStyleSheets(e.urlsCss),r=t.fetchBundles(e.bundles,window).then((n=>t.fetchJavascriptAddOn(e.urlsJsAddOn,window).then((e=>({bundles:n,jsAddOns:e})))));return(0,s.from)(Promise.all([r,n])).pipe((0,o.share)())}!function(e){e.Rename="Rename"}(u||(u={}));class x extends m.ImmutableTree.Node{constructor({id:e,name:t,children:n,story:o}){super({id:e,children:n}),this.signal$=new s.ReplaySubject,this.name=t,this.story=o}}class $ extends x{constructor({story:e,rootDocument:t,children:n}){super({id:t.documentId,story:e,name:e.title,children:n||I(e,t.documentId)}),this.rootDocument=t}getDocument(){return this.rootDocument}}class S extends x{constructor({story:e,document:t,children:n}){super({id:t.documentId,story:e,name:t.title,children:n||I(e,t.documentId)}),this.document=t}getDocument(){return this.document}}function I(e,t){return c.getChildren$(e.storyId,{parentDocumentId:t}).pipe((0,o.map)((t=>t.map((t=>new S({story:e,document:t}))))))}let k={newPage:{applicable:e=>e instanceof S||e instanceof $,createNode:(e,t)=>new C({parentNode:e,explorerState:t})},deleteDocument:{applicable:e=>e instanceof S,createNode:(e,t)=>new B({deletedNode:e,explorerState:t})},renameStoryNode:{applicable:e=>e instanceof $,createNode:(e,t)=>new F({node:e,explorerState:t})},renameDocumentNode:{applicable:e=>e instanceof S,createNode:(e,t)=>new F({node:e,explorerState:t})},setFromTemplate:{applicable:e=>e instanceof $,createNode:(e,t)=>new T({parentNode:e,explorerState:t})}};class D extends m.ImmutableTree.Node{constructor({id:e,children:t,name:n,faIcon:s}){super({id:e,children:t}),this.name=n,this.faIcon=s}}class j extends D{constructor({children:e}){super({id:"root",children:e,name:"menu list",faIcon:""})}}class C extends D{constructor(e){super({id:"add-document",children:[new O(e),new N(e)],name:"new document",faIcon:"fas fa-plus"}),Object.assign(this,e)}}class O extends D{constructor(e){super({id:"add-document-empty",children:void 0,name:"empty document",faIcon:"fas fa-file"}),Object.assign(this,e)}execute(e){this.explorerState.appState.addDocument(this.parentNode.id,{content:"",title:"New document"})}}function V({factory:e,explorerState:t,parentNode:n}){let s=function(e){let t=Object.entries(e.resources).map((([e,t])=>`*    [${e}](${t})`));return`\n# Module ${e.displayName}\n\n## Abstract\n\nProvide here a short abstract of the purpose of the module.\n\n\n### Illustrative example\n\nIt is usually good to also provide an illustrative example (replace with your project id):\n\n\`\`\`javascript\n//@story-view\nreturn ({cdn}) => {\n\n    return cdn\n        .install({ \n        modules: ['@youwol/story-views'],\n        aliases: { \n            views: "@youwol/story-views",\n            fluxView: "@youwol/flux-view"\n        }\n    })\n        .then( ({views, fluxView}) => {  \n\n        let vDOM = new views.FluxAppView({\n                projectId:"b6f7ae4b-c106-457c-9de1-2c94aeea5986",\n                modes:["runner", "workflow", "builder"]\n            })\n        return {\n            view: fluxView.render(vDOM),\n            options: {\n                wrapper: {\n                    style:{ \n                        width:'100%', \n                        'aspect-ratio': '1',\n                    }\n                }\n            }\n        }        \n    })\t\n}\n\`\`\`\n\n## Configuration\n\nBelow is the configuration's settings of the module, they are persisted with the workflow:\n\n\`\`\`javascript\n//@story-view\nreturn ({cdn}) => {\n\n    return cdn\n        .install({ \n            modules: ['@youwol/story-views'],\n            aliases: { \n                views: '@youwol/story-views',\n                fluxView: "@youwol/flux-view"\n            }\n    \t})\n        .then( ({views, fluxView}) => {  \n\n        let vDOM = new views.ModuleSettingsView({\n            toolboxName:"${e.packId}",\n            brickId:"${e.id}",\n            version: "latest",\n            class:"mx-auto border rounded p-2",\n            style:{\n                maxWidth:'500px'\n            }\n        })\n        return {\n            view: fluxView.render(vDOM), \n            options: {\n                wrapper: {\n                    style:{ \n                        width:'100%', \n                        'aspect-ratio': '1',\n                    }\n                }\n            }\n        }        \n    })\t\n}\n\`\`\`\n\n## Additional examples\n\nYou can provide more examples here\n\n## Additional Resources\n\n${t}\n`}(e);t.appState.addDocument(n.id,{content:s,title:e.displayName})}class N extends D{constructor(e){super({id:"add-document-template-brick",children:void 0,name:"brick template",faIcon:"fas fa-puzzle-piece"}),Object.assign(this,e)}execute(e){(function({ok$:e}={}){let t=new s.BehaviorSubject("@youwol/flux-three"),n=new s.BehaviorSubject("ModuleSphere");return g({rows:[v("Toolbox id",t,"toolbox-id"),v("Brick id",n,"brick-id")],ok$:e}).ok$.pipe((0,o.map)((()=>({toolboxId:t.getValue(),brickId:n.getValue()}))))})().pipe((0,o.mergeMap)((({toolboxId:e,brickId:t})=>y({bundles:{[e]:"latest"},urlsCss:[],urlsJsAddOn:[]}).pipe((0,o.map)((()=>window[e][t])))))).subscribe((e=>{V({factory:e,explorerState:this.explorerState,parentNode:this.parentNode})}))}}class T extends D{constructor(e){super({id:"set-from-template",children:[new M(e)],name:"Set from template",faIcon:"fas fa-book-open"}),Object.assign(this,e)}}class M extends D{constructor(e){super({id:"set-from-template-toolbox",children:void 0,name:"Toolbox",faIcon:"fas fa-toolbox"}),Object.assign(this,e)}execute(e){(function({ok$:e}={}){let t=new s.BehaviorSubject("@youwol/flux-three");return g({rows:[v("Toolbox id",t,"toolbox-id")],ok$:e}).ok$.pipe((0,o.map)((()=>({toolboxId:t.getValue()}))))})().pipe((0,o.mergeMap)((({toolboxId:e})=>y({bundles:{[e]:"latest"},urlsCss:[],urlsJsAddOn:[]}).pipe((0,o.map)((()=>window[e].pack.modules)))))).subscribe((e=>Object.values(e).forEach((e=>V({factory:e,explorerState:this.explorerState,parentNode:this.parentNode})))))}}class F extends D{constructor(e){super({id:e.node instanceof S?"rename-document":"rename-story",children:void 0,name:e.node instanceof S?"rename document":"rename story",faIcon:"fas fa-pen"}),Object.assign(this,e)}execute(e){this.node.signal$.next({type:u.Rename})}}class B extends D{constructor(e){super({id:"delete-document",children:void 0,name:"delete document",faIcon:"fas fa-trash"}),Object.assign(this,e)}execute(e){this.explorerState.appState.deleteDocument(this.deletedNode.document)}}class R extends h.ContextMenu.State{constructor({appState:e,explorerState:t,explorerDiv:n}){super((0,s.fromEvent)(n,"contextmenu").pipe((0,o.tap)((e=>e.preventDefault())))),this.appState=e,this.explorerState=t,this.explorerDiv=n}dispatch(e){return{style:{zIndex:1},children:[(0,p.child$)(this.appState.selectedNode$,(e=>new E({state:this,selectedNode:e})))]}}}class E{constructor(e){this.id="context-menu-view",Object.assign(this,e);let t=Object.values(k).filter((e=>e.applicable(this.selectedNode))).map((e=>e.createNode(this.selectedNode,this.state.explorerState))),n=new j({children:t}),s=new m.ImmutableTree.State({rootNode:n,expandedNodes:[n.id]});s.selectedNode$.next(n),this.children=[new m.ImmutableTree.View({state:s,headerView:(e,t)=>function(e){return{class:"d-flex w-100 align-items-baseline fv-pointer fv-hover-bg-background-alt px-1",children:[{tag:"i",class:e.faIcon},{tag:"span",class:"mx-2 w-100",innerText:e.name,style:{"user-select":"none"}}]}}(t),class:"fv-bg-background fv-text-primary p-2 rounded border fv-color-primary"})],this.connectedCallback=e=>{let t=s.selectedNode$.pipe((0,o.filter)((e=>function(e){return void 0!==e.execute}(e)))).subscribe((t=>{e.remove(),t.execute(this)}));e.ownSubscriptions(t)}}}class P extends m.ImmutableTree.State{constructor({rootDocument:e,appState:t}){let n=new $({story:t.story,rootDocument:e});super({rootNode:n,selectedNode:t.selectedNode$,expandedNodes:[t.story.storyId]}),this.appState=t,t.selectNode(n),t.deletedDocument$.subscribe((e=>{this.removeNode(e.documentId),this.selectedNode$.next(this.getNode(n.id))})),t.addedDocument$.subscribe((({parentDocumentId:e,document:t})=>{let n=new S({story:this.appState.story,document:t});this.addChild(e,n)}))}}class q extends m.ImmutableTree.View{constructor({explorerState:e}){super({state:e,headerView:A}),this.style={minWidth:"300px"},this.class="p-2 border fv-color-primary",this.appState=e.appState,this.connectedCallback=e=>{let t=new R({appState:this.appState,explorerState:this.state,explorerDiv:e});return new h.ContextMenu.View({state:t,class:"fv-bg-background border fv-color-primary"})}}}function A(e,t){let n="",s="",r="";return t instanceof $&&(n="fas fa-book-open",s=t.story.storyId,r="story"),t instanceof S&&(n="fas fa-file",s=t.document.documentId,r="document"),{id:s,class:`d-flex align-items-center fv-pointer fv-hover-bg-background-alt w-100 ${r}`,children:[{class:n+" px-2"},(0,p.child$)(t.signal$.pipe((0,o.filter)((e=>e.type==u.Rename))),(()=>function(e,t){return{tag:"input",type:"text",autofocus:!0,style:{zIndex:200},class:"mx-2",data:e.name,onclick:e=>e.stopPropagation(),onkeydown:n=>{"Enter"===n.key&&t.appState.rename(e,n.target.value)}}}(t,e)),{untilFirst:{tag:"span",innerText:t.name}}),(0,p.child$)(e.appState.save$.pipe((0,o.filter)((({document:e})=>e.documentId==t.getDocument().documentId))),(({document:t,content:n,status:s})=>{switch(s){case ee.modified:return{class:"fas fa-save p-1 ml-auto fv-pointer fv-hover-opacity-100 fv-opacity-50 fv-opacity-transition-500 explorer-save-item",onclick:()=>e.appState.save(t,n)};case ee.started:return{class:"fas fa-spinner fa-spin p-1 ml-auto "};default:return{}}}))]}}var L=n(151);class J{constructor(e){this.id="editor-view",this.emojis$=new s.Subject,this.configurationCodeMirror={value:"",mode:"markdown",lineNumbers:!1,theme:"blackboard",lineWrapping:!0,indentUnit:4},this.codeMirrorEditor$=new s.ReplaySubject(1),Object.assign(this,e);let t=(0,s.merge)(this.appState.page$.pipe((0,o.filter)((({document:e})=>e==this.document)),(0,o.take)(1)),this.appState.page$.pipe((0,o.filter)((({document:e})=>e==this.document)),(0,o.filter)((({content:e,originId:t})=>t!=te.editor))));this.children=[this.headerView(),{class:"w-100 h-100",children:[(0,p.child$)(J.codeMirror$,(()=>({id:"code-mirror-editor",class:"w-100 h-100",connectedCallback:e=>{let n={...this.configurationCodeMirror,value:"",readOnly:!this.appState.permissions.write,extraKeys:{"Ctrl-S":e=>this.appState.save(this.document,e.getValue())}},s=window.CodeMirror(e,n);s.on("changes",((e,t)=>{1==t.length&&"setValue"==t[0].origin||this.appState.setContent(this.document,s.getValue(),te.editor)})),e.ownSubscriptions(t.subscribe((({content:e,originId:t})=>{s.setValue(e)})),this.emojis$.subscribe((e=>{var t=s.getDoc(),n=t.getCursor();t.replaceRange(e,n)}))),this.codeMirrorEditor$.next(s)}})))]}]}headerView(){return{children:[{class:"d-flex w-100 align-items-center",children:[{tag:"i",class:"fv-pointer rounded m-1 fas fa-smile editor-view-header-emoji",onclick:()=>function(e){let t=new L.Tabs.State([new L.Tabs.TabData("smileys_people","😃"),new L.Tabs.TabData("animals","🐻"),new L.Tabs.TabData("foods","🍔"),new L.Tabs.TabData("activities","⚽"),new L.Tabs.TabData("travel","🌇"),new L.Tabs.TabData("objects","💡"),new L.Tabs.TabData("symbols","🔣"),new L.Tabs.TabData("flags","🎌")]),n=new L.Tabs.View({state:t,contentView:(t,n)=>({style:{aspectRatio:"2"},children:[(0,p.child$)(c.getEmojis$(n.id),(({emojis:t})=>function(e,t){return{class:"fv-bg-background-alt rounded overflow-auto w-100 h-100",children:e.map((e=>({tag:"label",innerText:e.replace(/&zwj;/g,""),class:"p-1 rounded fv-pointer fv-hover-bg-focus emojis-modal-view-item",onclick:e=>{t.next(e.srcElement.innerText)}})))}}(t,e)))]}),headerView:(e,t)=>({class:"px-2 rounded",innerText:t.name})});return function(e,t){let n=new f.Modal.State,o=new f.Modal.View({state:n,contentView:()=>({class:"p-3 rounded fv-color-primary fv-bg-background w-50",style:{minWidth:"50%"},children:[t]}),connectedCallback:t=>{t.children[0].classList.add("w-100");let o=(0,s.merge)(n.cancel$,n.ok$,e).subscribe((()=>{r.remove()}));t.ownSubscriptions(o)}}),r=(0,p.render)(o);return document.querySelector("body").appendChild(r),o}(e,n).state.ok$}(this.emojis$)}]}]}}}J.codeMirror$=y({bundles:{codemirror:"5.52.0"},urlsJsAddOn:["codemirror#5.52.0~mode/javascript.min.js","codemirror#5.52.0~mode/markdown.min.js","codemirror#5.52.0~mode/css.min.js","codemirror#5.52.0~mode/xml.min.js","codemirror#5.52.0~mode/htmlmixed.min.js","codemirror#5.52.0~mode/gfm.min.js"],urlsCss:["codemirror#5.52.0~codemirror.min.css","codemirror#5.52.0~theme/blackboard.min.css"]});var W,H=n(723),z=n(253),U=n.n(z);(0,H.setOptions)({langPrefix:"hljs language-",highlight:function(e,t){return U().highlightAuto(e,[t]).value}});class Y{render(e){return e.innerHTML=(0,H.parse)(e.innerHTML.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")),Promise.resolve(e)}}class K{constructor(){this.promise=Promise.resolve()}render(e){let t=this.promise.then((()=>(window.MathJax.typesetPromise([e]),e)));return this.promise=t,t}}!function(e){e.default="default",e.view="view",e.code="code",e.dual="dual"}(W||(W={}));let _={installFluxView:e=>e.install({modules:["@youwol/flux-view"],aliases:{fluxView:"@youwol/flux-view"}})};class G{constructor(e){this.code=e,this.style={},this.class="w-100 d-flex story-view",this.mode$=new s.BehaviorSubject(W.default),this.cdnScript=document.head.querySelector("script#cdn-client"),this.bootstrapCss=document.head.querySelector("link#bootstrap"),this.faCss=document.head.querySelector("link#fa"),this.fvCss=document.head.querySelector("link#fv"),this.children=[this.menuView(),(0,p.child$)(this.mode$,(e=>{switch(e){case W.default:case W.view:return this.iFrameView();case W.code:return this.codeView();case W.dual:return{class:"d-flex justify-content-around w-100",children:[{class:"p-2 w-100",children:[this.iFrameView()]},{class:"p-2 w-100",children:[this.codeView()]}]}}}))]}menuView(){let e=" fas p-2 border rounded fv-pointer ";return{class:"h-100 d-flex flex-column fv-bg-background-alt menu-view",children:[{class:(0,p.attr$)(this.mode$,(e=>e==W.view?"fv-text-focus":""),{wrapper:t=>t+e+"fa-eye mode-iframe"}),onclick:()=>this.mode$.next(W.view)},{class:(0,p.attr$)(this.mode$,(e=>e==W.code?"fv-text-focus":""),{wrapper:t=>t+e+"fa-code mode-code"}),onclick:()=>this.mode$.next(W.code)},{class:(0,p.attr$)(this.mode$,(e=>e==W.dual?"fv-text-focus":""),{wrapper:t=>t+e+"fa-columns mode-dual"}),onclick:()=>this.mode$.next(W.dual)}]}}codeView(){let e={value:this.code,mode:"javascript",lineNumbers:!0,theme:"blackboard",lineWrapping:!0,readOnly:!0};return{class:"w-100 h-100 code-view",style:{maxHeight:"500px"},connectedCallback:t=>{window.CodeMirror(t,e)}}}iFrameView(){return{tag:"iframe",style:{width:"100%",border:"none",height:"50px",overflow:"hidden"},class:"iframe-view",connectedCallback:e=>{let t=e.contentWindow,n=t.document,s=n.head;s.appendChild(this.bootstrapCss.cloneNode()),s.appendChild(this.faCss.cloneNode()),s.appendChild(this.fvCss.cloneNode()),s.appendChild(this.fvCss.cloneNode());let o=n.createElement("script");o.src=this.cdnScript.src,o.async=!0,o.onload=()=>{t.cdn=t["@youwol/cdn-client"],this.resolveView(t,e)},s.appendChild(o)}}}resolveView(e,t){let n;try{let t=new e.Function(Object.keys(_),this.code)(...Object.values(_));t="function"==typeof t?t:function(e){return({cdn:t})=>t.install({modules:[e.package]}).then((t=>new t[e.package][e.view](e.parameters).renderStoryView(e.options)))}(t),n=t(e)}catch(n){return void this.appendErrorView(n,e.document.body,t)}if(n instanceof e.Promise)return n.then((n=>{this.appendView(n,e.document.body,t)})).catch((n=>{this.appendErrorView(n,e.document.body,t)}));{let s=n;return Promise.resolve(this.appendView(s,e.document.body,t))}}appendView(e,t,n){let s=e.view?e.view:e,o=e.options?e.options:{},r=o.wrapper?.style||{},i=o.wrapper?.class||"";Object.entries(r).forEach((([e,n])=>{t.style.setProperty(e,n)})),""!=i&&t.classList.add(...i.split(" ").filter((e=>""!=e))),t.classList.add("fv-bg-background","fv-text-primary"),t.appendChild(s),o.defaultMode&&Object.values(W).includes(o.defaultMode)&&this.mode$.getValue()==W.default&&this.mode$.next(o.defaultMode),n.style.setProperty("height",t.scrollHeight+20+"px")}appendErrorView(e,t,n){let s=e.stack?{tag:"ul",class:"message",children:e.stack.split("\n").slice(1).map(((e,t)=>{let n=e.split("(")[0],s=e.split("<anonymous>").slice(-1)[0].split(":")[1];return{tag:"li",innerText:`${n} @line ${Number(s)-2}`}}))}:{},o={error:e,class:"w-100 fv-text-error story-view-error p-2",children:[{class:"fas fa-error"},{class:"message",innerText:e.message},s]};console.log(e),t.appendChild((0,p.render)(o)),n.style.setProperty("height",t.scrollHeight+20+"px")}}class Q{render(e,t){return Array.from(e.querySelectorAll(".language-javascript")).filter((e=>e.textContent.startsWith("//@story-view"))).forEach((e=>{let t=new G(e.textContent);e.replaceWith((0,p.render)(t))})),Promise.resolve(e)}}class X{constructor(e){this.id="render-view",this.renderedElement$=new s.ReplaySubject(1),this.renderers=[new Y,new K,new Q],Object.assign(this,e);let t=this.appState.page$.pipe((0,o.filter)((({document:e})=>e==this.document))),n=t.pipe((0,o.filter)((({originId:e})=>e==te.nodeLoad))),r=t.pipe((0,o.filter)((({originId:e})=>e==te.editor)),(0,o.debounceTime)(X.debounceTime)),i=(0,s.merge)(n,r);this.children=[{class:"w-100",connectedCallback:e=>{let t=i.subscribe((({document:t,content:n})=>{e.innerHTML=n,this.render(e,t)}));e.ownSubscriptions(t)}}]}async render(e,t){await this.renderers.reduce((async(e,t)=>t.render(await e,{})),Promise.resolve(e)),this.renderedElement$.next({document:t,htmlElement:e})}}X.debounceTime=500;var Z,ee,te,ne,se,oe=n(435);!function(e){e.renderOnly="renderOnly",e.editOnly="editOnly",e.simultaneous="simultaneous"}(Z||(Z={}));class re{constructor(e){Object.assign(this,e),this.viewMode$=new s.BehaviorSubject(this.permissions.write?Z.simultaneous:Z.renderOnly)}}class ie{constructor(e){this.class="d-flex justify-content-around my-auto custom-actions-view",Object.assign(this,e);let t=new oe.ComboTogglesView({selection$:this.state.viewMode$,state:this.state,values:[Z.simultaneous,Z.editOnly,Z.renderOnly],viewFactory:e=>new oe.FaIconToggleView({value:e,selection$:this.state.viewMode$,classes:ie.iconsFactory[e]+` ${e}`})});this.children=[t]}}ie.iconsFactory={[Z.simultaneous]:"fa-columns",[Z.editOnly]:"fa-pen",[Z.renderOnly]:"fa-eye"};class ae extends oe.YouwolBannerView{constructor(e){super({badgesView:new oe.LockerBadge({locked$:(0,s.of)(e.permissions.write)}),customActionsView:new ie({state:e}),burgerMenuView:new oe.BurgerMenu({sections:[new oe.BurgerMenuSection({items:[new oe.DashboardLink,new oe.WorkspaceLink]}),new oe.BurgerMenuSection({items:[new oe.UserSettings,new oe.Preferences]})]})})}}class ce{constructor(e){this.class="d-flex flex-grow-1",this.style={minWidth:"0px"},this.innerClass="d-flex flex-column fv-bg-background w-100 h-100 mr-1 ml-2 p-2 overflow-auto",Object.assign(this,e);let t=this.appState.page$.pipe((0,o.map)((({document:e})=>e)),(0,o.distinctUntilChanged)()),n=(0,s.combineLatest)([t,this.appState.topBannerState.viewMode$]);this.children=[(0,p.child$)(n,(([e,t])=>t==Z.editOnly||t==Z.simultaneous?new J({document:e,appState:this.appState,class:this.innerClass}):{})),(0,p.child$)(n,(([e,t])=>t==Z.renderOnly||t==Z.simultaneous?new X({document:e,appState:this.appState,class:this.innerClass}):{}))]}}!function(e){e.modified="Modified",e.started="Started",e.saved="Saved"}(ee||(ee={})),function(e){e.editor="editor",e.nodeLoad="loaded"}(te||(te={}));class de{constructor(e){this.selectedNode$=new s.ReplaySubject(1),this.page$=new s.ReplaySubject(1),this.addedDocument$=new s.ReplaySubject(1),this.deletedDocument$=new s.ReplaySubject(1),this.save$=new s.ReplaySubject(1),Object.assign(this,e),this.topBannerState=new re({permissions:this.permissions}),this.explorerState=new P({rootDocument:this.rootDocument,appState:this}),this.selectedNode$.pipe((0,o.distinctUntilChanged)(),(0,o.mergeMap)((e=>c.getContent$(e.getDocument().storyId,e.getDocument().documentId).pipe((0,o.map)((t=>({content:t,node:e}))))))).subscribe((({node:e,content:t})=>{this.page$.next({document:e.getDocument(),content:t,originId:te.nodeLoad})})),this.page$.pipe((0,o.filter)((({originId:e})=>e==te.editor))).subscribe((({document:e,content:t})=>{this.save$.next({document:e,content:t,status:ee.modified})}))}save(e,t){this.save$.next({document:e,content:t,status:ee.started}),c.postContent$(e.storyId,e.documentId,{content:t}).pipe((0,o.map)((()=>({content:t,document:e})))).subscribe((()=>{this.save$.next({document:e,content:t,status:ee.saved})}))}setContent(e,t,n){this.page$.next({document:e,content:t,originId:n})}selectNode(e){this.selectedNode$.next(e)}rename(e,t){let n=e.getDocument(),s={documentId:n.documentId,title:t};c.postDocument$(n.storyId,n.documentId,s).subscribe((n=>{e instanceof S?this.explorerState.replaceAttributes(e,{document:n}):this.explorerState.replaceAttributes(e,{story:new a({...e.story,title:t})})}))}addDocument(e,{title:t,content:n}){c.putDocument$(this.story.storyId,{parentDocumentId:e,title:t,content:n}).subscribe((t=>{this.addedDocument$.next({parentDocumentId:e,document:t})}))}deleteDocument(e){this.deletedDocument$.next(e),c.deleteDocument$(e.storyId,e.documentId).subscribe((()=>{}))}}de.debounceTimeSave=1e3;class le{constructor(e){this.class="fv-bg-background fv-text-primary d-flex flex-column w-100 h-100",Object.assign(this,e),this.children=[new ae(this.state.topBannerState),{class:"d-flex flex-grow-1",style:{minHeight:"0px"},children:[new q({explorerState:this.state.explorerState}),new ce({appState:this.state})]}]}}c.service=new l,(ne=new URLSearchParams(window.location.search).get("id"),se=document.getElementById("content"),se.innerHTML="",(0,s.forkJoin)([c.getStory$(ne),c.getChildren$(ne,{parentDocumentId:ne,count:1}).pipe((0,o.map)((e=>e[0])))]).pipe((0,o.map)((([{story:e,permissions:t},n])=>{let s=new de({story:e,rootDocument:n,permissions:t});return{appState:s,appView:new le({state:s})}})),(0,o.tap)((({appView:e})=>se.appendChild((0,p.render)(e)))))).subscribe()}}]);