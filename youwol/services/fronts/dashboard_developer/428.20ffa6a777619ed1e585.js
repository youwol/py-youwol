(self.webpackChunk=self.webpackChunk||[]).push([[428],{428:(e,t,s)=>{"use strict";s.r(t);var a,n,r,i,c=s(222),l=s(435),o=s(519);class d{static connectWs(){return d.webSocket$||(d.webSocket$=new l.ReplaySubject,new WebSocket(`ws://${window.location.host}${d.urlBase}/ws`).onmessage=e=>{d.webSocket$.next(JSON.parse(e.data))}),d.webSocket$}static status$(){let e=`${d.urlBase}/status`;return C(new Request(e,{method:"GET",headers:d.headers}))}static start$(e){let t=e?`${d.urlBase}/${e}/start`:`${d.urlBase}/start`;return C(new Request(t,{method:"POST",headers:d.headers}))}static restart$(){let e=`${d.urlBase}/restart`;return C(new Request(e,{method:"POST",headers:d.headers}))}static stop$(e){let t=`${d.urlBase}/${e}/stop`;return C(new Request(t,{method:"POST",headers:d.headers}))}static skeletons$(){let e=`${d.urlBase}/skeletons`;return C(new Request(e,{method:"GET",headers:d.headers}))}static createSkeleton$(e,t){let s=`${d.urlBase}/skeletons/${e}`;return C(new Request(s,{method:"POST",body:JSON.stringify(t),headers:d.headers}))}static install$(e){let t=`${d.urlBase}/${e}/install`;return C(new Request(t,{method:"POST",headers:d.headers}))}}d.urlBase="/admin/backends",d.headers={},function(e){e.NOT_FOUND="FluxAppStatus.NOT_FOUND",e.SYNC="FluxAppStatus.SYNC",e.MISMATCH="FluxAppStatus.MISMATCH",e.PROCESSING="FluxAppStatus.PROCESSING",e.DONE="FluxAppStatus.DONE"}(a||(a={}));class u{constructor(){}}class h extends u{constructor({fluxStatus:e,treeStatus:t,assetStatus:s}){super(),this.fluxStatus=e,this.treeStatus=t,this.assetStatus=s}}class p extends u{}class f{constructor({assetId:e,name:t,treeItems:s,status:a}){this.assetId=e,this.name=t,this.treeItems=s,this.status="string"==typeof a?new p:new h(a)}}class g{static connectWs(){return g.webSocket$||(g.webSocket$=new l.Subject,new WebSocket(`ws://${window.location.host}${g.urlBase}/ws`).onmessage=e=>{let t=JSON.parse(e.data);g.webSocket$.next(t),t.target&&"flux-app"==t.target&&g.package$.next(new f(t))},this.package$.pipe((0,o.scan)(((e,t)=>null==t?{}:{...e,[t.assetId]:t}),{})).subscribe((e=>{this.fluxApps$.next(e)}))),g.webSocket$}static status$(){this.package$.next(void 0);let e=`${g.urlBase}/status`,t=new Request(e,{method:"GET",headers:g.headers});return(0,l.combineLatest)([g.webSocket$.pipe((0,o.take)(1)),C(t)]).pipe((0,o.map)((([e,t])=>t)))}static publish$(e){let t=`${g.urlBase}/publish/${e}`;return C(new Request(t,{method:"POST",headers:g.headers}))}}g.urlBase="/admin/download/flux-apps",g.headers={},g.fluxApps$=new l.BehaviorSubject({}),g.package$=new l.ReplaySubject(1),function(e){e.PENDING="PENDING",e.SYNC="SYNC",e.OUTDATED="OUTDATED"}(n||(n={}));class w{static connectWs(){return w.webSocket$||(w.webSocket$=new l.ReplaySubject,new WebSocket(`ws://${window.location.host}${w.urlBase}/ws`).onmessage=e=>{let t=JSON.parse(e.data);var s;w.webSocket$.next(t),(s=t).configurationPath&&s.userInfo&&s.users&&s.configuration&&s.remoteGatewayInfo&&s.remotesInfo&&w.environments$.next(t),function(e){return e.status&&e.components}(t)&&w.componentsUpdates$.next(t)}),w.webSocket$}static status$(){let e=`${w.urlBase}/status`;return C(new Request(e,{method:"GET",headers:w.headers}))}static fileContent$(){let e=`${w.urlBase}/file-content`;return C(new Request(e,{method:"GET",headers:w.headers}))}static switchConfiguration$(e){let t=`${w.urlBase}/switch-configuration`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:w.headers}))}static syncUser$(e){let t=`${w.urlBase}/sync-user`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:w.headers}))}static login$(e){let t=`${w.urlBase}/login`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:w.headers}))}static selectRemoteGateway$(e){let t=`${w.urlBase}/select-remote-gateway`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:w.headers}))}static postConfigParameters$(e){let t=`${w.urlBase}/configuration/parameters`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:w.headers}))}static triggerAvailableUpdates(){let e=`${w.urlBase}/available-updates`,t=new Request(e,{method:"GET",headers:w.headers});fetch(t).then()}static triggerSyncComponent(e){let t=`${w.urlBase}/sync-component`,s=new Request(t,{method:"POST",body:JSON.stringify(e),headers:w.headers});fetch(s).then()}}w.urlBase="/admin/environment",w.environments$=new l.ReplaySubject(1),w.componentsUpdates$=new l.ReplaySubject(1),w.headers={};class b{constructor(e){Object.assign(this,e)}}class x{static connectWs(){if(x.webSocket$)return x.webSocket$;x.webSocket$=new l.ReplaySubject(1);var e=new WebSocket(`ws://${window.location.host}${x.urlBase}/ws`);return w.environments$.pipe((0,o.mergeMap)((()=>this.status$()))).subscribe(),e.onmessage=e=>{console.log("Got data",e);let t=JSON.parse(e.data);x.webSocket$.next(t),t.target&&"downloadItem"==t.target&&x.downloadItem$.next(new b(t))},this.downloadItem$.pipe((0,o.scan)(((e,t)=>null==t?{}:{...e,[`${t.name}#${t.version}`]:t}),{})).subscribe((e=>{this.downloadItems$.next(e)})),x.webSocket$}static status$(){let e=`${x.urlBase}/status`,t=new Request(e,{method:"GET",headers:x.headers});return x.webSocket$.pipe((0,o.take)(1),(0,o.mergeMap)((()=>C(t))))}static getGroups$(){let e=`${x.urlBase}/groups`;return C(new Request(e,{method:"GET",headers:x.headers}))}static getDrives$(e){let t=`${x.urlBase}/groups/${e}/drives`;return C(new Request(t,{method:"GET",headers:x.headers}))}static packageInfo$(e){let t=`${x.urlBase}/info/${e}`;return C(new Request(t,{method:"GET",headers:x.headers}))}static download$(e){let t=`${x.urlBase}/synchronize`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:x.headers}))}}x.urlBase="/admin/download/packages",x.groups$=new l.Subject,x.headers={},x.downloadItem$=new l.Subject,x.downloadItems$=new l.BehaviorSubject({});class m{static connectWs(){return m.webSocket$||(m.webSocket$=new l.ReplaySubject,new WebSocket(`ws://${window.location.host}/admin/frontends/ws`).onmessage=e=>{m.webSocket$.next(JSON.parse(e.data))}),m.webSocket$}static status$(){let e=`${m.urlBase}/status`;return C(new Request(e,{method:"GET",headers:m.headers}))}static start$(e){let t=`${m.urlBase}/${e}/start`;return C(new Request(t,{method:"POST",headers:m.headers}))}static stop$(e){let t=`${m.urlBase}/${e}/stop`;return C(new Request(t,{method:"POST",headers:m.headers}))}static skeletons$(){let e=`${m.urlBase}/skeletons`;return C(new Request(e,{method:"GET",headers:m.headers}))}static createSkeleton$(e,t){let s=`${m.urlBase}/skeletons/${e}`;return C(new Request(s,{method:"POST",body:JSON.stringify(t),headers:m.headers}))}}m.urlBase="/admin/frontends",m.headers={};class ${static connectWs(){return $.webSocket$||($.webSocket$=new l.ReplaySubject,new WebSocket(`ws://${window.location.host}/admin/local-cdn/ws`).onmessage=e=>{let t=JSON.parse(e.data);$.webSocket$.next(t),t.target&&"PackagesStatus"==t.target&&($.packagesStatus$.next(t.cdnStatus),$.packageDetails$.next(void 0)),t.target&&"PackageDetails"==t.target&&$.packageDetails$.next(t.packageDetails)}),$.webSocket$}static status$(){let e=`${$.urlBase}/status`;return C(new Request(e,{method:"GET",headers:$.headers}))}static getPackageDetails$(e){let t=`${$.urlBase}/packages/${e}`;return C(new Request(t,{method:"GET",headers:$.headers}))}static deleteVersion$(e,t){let s=`${$.urlBase}/libraries/${e}/${t}`;return C(new Request(s,{method:"DELETE",headers:$.headers}))}static deletePackage$(e){let t=`${$.urlBase}/packages/${e}`;return C(new Request(t,{method:"DELETE",headers:$.headers}))}}$.urlBase="/admin/local-cdn",$.packagesStatus$=new l.ReplaySubject(1),$.packageDetails$=new l.ReplaySubject(1),$.headers={};class v{static connectWs(){return v.webSocket$||(v.webSocket$=new l.ReplaySubject,new WebSocket(`ws://${window.location.host}${v.urlBase}/ws`).onmessage=e=>{v.webSocket$.next(JSON.parse(e.data))}),v.webSocket$}static status$(){let e=`${v.urlBase}/status`;return C(new Request(e,{method:"GET",headers:v.headers}))}static action$(e){let t=`${v.urlBase}/action`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:v.headers}))}static dependencies$(e){let t=`${v.urlBase}/${e}/dependencies`;return C(new Request(t,{method:"GET",headers:v.headers}))}static watch$(e){let t=`${v.urlBase}/watch`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:v.headers}))}static skeletons$(){let e=`${v.urlBase}/skeletons`;return C(new Request(e,{method:"GET",headers:v.headers}))}static createSkeleton$(e,t){let s=`${v.urlBase}/skeletons/${e}`;return C(new Request(s,{method:"POST",body:JSON.stringify(t),headers:v.headers}))}static install$(e){let t=`${v.urlBase}/${e}/install`;return C(new Request(t,{method:"POST",headers:v.headers}))}}v.urlBase="/admin/packages",v.headers={};class S{static connectWs(){return S.webSocket$||(S.webSocket$=new l.ReplaySubject,new WebSocket(`ws://${window.location.host}/admin/system/ws`).onmessage=e=>{S.webSocket$.next(JSON.parse(e.data))}),S.webSocket$}static folderContent$(e){let t=`${S.urlBase}/folder-content`,s={path:e};return C(new Request(t,{method:"POST",body:JSON.stringify(s),headers:S.headers}))}}S.urlBase="/admin/system",S.headers={},function(e){e.NOT_FOUND="FluxAppStatus.NOT_FOUND",e.SYNC="FluxAppStatus.SYNC",e.MISMATCH="FluxAppStatus.MISMATCH",e.PROCESSING="FluxAppStatus.PROCESSING",e.DONE="FluxAppStatus.DONE"}(r||(r={}));class k{constructor(){}}class T extends k{constructor({fluxStatus:e,treeStatus:t,assetStatus:s}){super(),this.fluxStatus=e,this.treeStatus=t,this.assetStatus=s}}class y extends k{}class N{constructor({assetId:e,name:t,treeItems:s,status:a}){this.assetId=e,this.name=t,this.treeItems=s,this.status="string"==typeof a?new y:new T(a)}}class E{static connectWs(){return E.webSocket$||(E.webSocket$=new l.Subject,new WebSocket(`ws://${window.location.host}${E.urlBase}/ws`).onmessage=e=>{let t=JSON.parse(e.data);E.webSocket$.next(t),t.target&&"flux-app"==t.target&&E.package$.next(new N(t))},this.package$.pipe((0,o.scan)(((e,t)=>null==t?{}:{...e,[t.assetId]:t}),{})).subscribe((e=>{this.fluxApps$.next(e)}))),E.webSocket$}static status$(){this.package$.next(void 0);let e=`${E.urlBase}/status`,t=new Request(e,{method:"GET",headers:E.headers});return(0,l.combineLatest)([E.webSocket$.pipe((0,o.take)(1)),C(t)]).pipe((0,o.map)((([e,t])=>t)))}static publish$(e){let t=`${E.urlBase}/publish/${e}`;return C(new Request(t,{method:"POST",headers:E.headers}))}}E.urlBase="/admin/upload/flux-apps",E.headers={},E.fluxApps$=new l.BehaviorSubject({}),E.package$=new l.ReplaySubject(1),function(e){e.NOT_FOUND="PackageStatus.NOT_FOUND",e.SYNC="PackageStatus.SYNC",e.MISMATCH="PackageStatus.MISMATCH",e.PROCESSING="PackageStatus.PROCESSING",e.DONE="PackageStatus.DONE"}(i||(i={}));class R{constructor(){}}class D extends R{constructor({cdnStatus:e,treeStatus:t,assetStatus:s}){super(),this.cdnStatus=e,this.treeStatus=t,this.assetStatus=s}}class P extends R{}class I{constructor({assetId:e,name:t,namespace:s,treeItems:a,releases:n,status:r}){this.assetId=e,this.name=t,this.namespace=s,this.treeItems=a,this.releases=n,this.status="string"==typeof r?new P:new D(r)}}class O{constructor({assetId:e,name:t,namespace:s,version:a,status:n}){this.assetId=e,this.name=t,this.namespace=s,this.version=a,this.status=n}}class A{static connectWs(){return A.webSocket$||(A.webSocket$=new l.Subject,new WebSocket(`ws://${window.location.host}${A.urlBase}/ws`).onmessage=e=>{let t=JSON.parse(e.data);A.webSocket$.next(t),t.target&&"package"==t.target&&A.package$.next(new I(t)),t.target&&"packageVersion"==t.target&&A.packageVersion$.next(new O(t))},this.package$.pipe((0,o.scan)(((e,t)=>null==t?{}:{...e,[t.assetId]:t}),{})).subscribe((e=>{this.packages$.next(e)})),this.packageVersion$.pipe((0,o.scan)(((e,t)=>null==t?{}:{...e,[`${t.name}#${t.version}`]:t}),{})).subscribe((e=>{this.packageVersions$.next(e)}))),A.webSocket$}static status$(){this.package$.next(void 0),this.packageVersion$.next(void 0);let e=`${A.urlBase}/status`,t=new Request(e,{method:"GET",headers:A.headers});return(0,l.combineLatest)([A.webSocket$.pipe((0,o.take)(1)),C(t)]).pipe((0,o.map)((([e,t])=>t)))}static path$(e){let t=`${A.urlBase}/${e}/path`;return C(new Request(t,{method:"GET",headers:A.headers}))}static remotePath$(e){let t=`${A.urlBase}/${e}/remote-path`;return C(new Request(t,{method:"GET",headers:A.headers}))}static publishLibraryVersion$(e,t){let s=`${A.urlBase}/publish/${e}/${t}`;return C(new Request(s,{method:"POST",headers:A.headers}))}static deleteLibraryVersion$(e,t){let s=`${A.urlBase}/remove/${e}/${t}`;return C(new Request(s,{method:"DELETE",headers:A.headers}))}static syncPackage$(e){let t=`${A.urlBase}/publish/${e}`;return C(new Request(t,{method:"POST",headers:A.headers}))}static syncPackages$(e){let t=`${A.urlBase}/synchronize`;return C(new Request(t,{method:"POST",body:JSON.stringify(e),headers:A.headers}))}static registerAsset(e){let t=`${A.urlBase}/register-asset/${e}`;return C(new Request(t,{method:"POST",headers:A.headers}))}}function C(e,t=(e=>e)){return new l.Observable((s=>{fetch(e).then((e=>e.json())).then((e=>{s.next(t(e)),s.complete()})).catch((e=>s.error(e)))}))}A.urlBase="/admin/upload/packages",A.headers={},A.packages$=new l.BehaviorSubject({}),A.package$=new l.ReplaySubject(1),A.packageVersions$=new l.BehaviorSubject({}),A.packageVersion$=new l.ReplaySubject(1);class V{static setHeaders(e){V.headers=e,d.headers=e,S.headers=e,m.headers=e,v.headers=e,w.headers=e,A.headers=e,x.headers=e,$.headers=e,g.headers=e}}V.urlBase="/admin",V.headers={},V.system=S,V.fronts=m,V.backs=d,V.modules=v,V.environment=w,V.uploadPackages=A,V.downloadPackages=x,V.uploadFluxApps=E,V.downloadFluxApps=g,V.localCdnPackages=$;var B=s(327);let L="p-2 fv-text-primary h-100 d-flex flex-column h-100";function G(e,t){return new B.Button.View({contentView:()=>({children:[{tag:"i",class:e},{tag:"span",class:"px-2",innerText:t}]}),class:"fv-btn fv-btn-secondary mx-2"})}function j(e,t=!1){let s=new l.BehaviorSubject(t);return{class:"d-flex align-items-top fv-bg-background-alt border rounded ",style:{"font-style":"oblique",width:"fit-content"},children:[{tag:"i",class:(0,c.attr$)(s,(e=>e?"fv-hover-text-primary fv-text-focus":"fv-hover-text-focus fv-text-primary "),{wrapper:e=>e+" fas py-2 px-3 fa-info fv-pointer fv-hover-text-focus "}),onclick:e=>{s.next(!s.getValue()),e.stopPropagation()}},{class:(0,c.attr$)(s,(e=>e?"py-3 pl-1 pr-3":"")),children:[(0,c.child$)(s,(t=>t?e:{}))]}]}}var F,U,M,_,q,W,Y,z,H,J=s(888);!function(e){e.INSTALL="INSTALL",e.BUILD="BUILD",e.TEST="TEST",e.CDN="CDN",e.SYNC="SYNC",e.SERVE="SERVE"}(F||(F={})),function(e){e.TARGET_ONLY="TARGET_ONLY",e.ALL_ABOVE="ALL_ABOVE",e.ALL_BELOW="ALL_BELOW",e.ALL="ALL"}(U||(U={})),function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR"}(M||(M={})),function(e){e.STARTED="STARTED",e.PREPARATION="PREPARATION",e.STATUS="STATUS",e.RUNNING="RUNNING",e.PACKAGING="PACKAGING",e.DONE="DONE"}(_||(_={})),function(e){e.INSTALLED="INSTALLED",e.NOT_INSTALLED="NOT_INSTALLED"}(q||(q={})),function(e){e.SYNC="SYNC",e.RED="RED",e.NEVER_BUILT="NEVER_BUILT",e.OUT_OF_DATE="OUT_OF_DATE",e.INDIRECT_OUT_OF_DATE="INDIRECT_OUT_OF_DATE"}(W||(W={})),function(e){e.GREEN="GREEN",e.OUT_OF_DATE="OUT_OF_DATE",e.INDIRECT_OUT_OF_DATE="OUT_OF_DATE",e.RED="RED",e.NO_ENTRY="NO_ENTRY"}(Y||(Y={})),function(e){e.SYNC="SYNC",e.NOT_PUBLISHED="NOT_PUBLISHED",e.OUT_OF_DATE="OUT_OF_DATE",e.CDN_ERROR="CDN_ERROR"}(z||(z={})),function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR"}(H||(H={}));class Q{constructor({action:e,step:t,target:s,content:a,level:n,json:r,contextId:i}){this.contextId=void 0,this.children=[],this.action=e,this.step=t,this.target=s,this.content=a,this.level=n,this.json=r,this.contextId=i}}class K{constructor(e){this.logs$=e,this.ongoingTasks$={}}}class X extends J.ImmutableTree.Node{constructor({name:e,data:t}){super({id:`${Math.floor(1e6*Math.random())}`,children:X.getChildren(t)}),this.name=e,this.data=t}static getChildren(e){return null!=e&&null!=e&&"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e?(0,l.of)(Object.entries(e).map((([e,t])=>new X({name:e,data:t})))):void 0}}let Z={[_.STATUS]:"fas fa-info",[_.STARTED]:"fas fa-play",[_.PREPARATION]:"fas fa-running",[_.RUNNING]:"fas fa-running",[_.PACKAGING]:"fas fa-archive",[_.DONE]:"far fa-flag"};class ee{constructor(e){this.state=e,this.class="h-25 d-flex flex-column",this.children=[this.header(),this.content()]}header(){return{tag:"hr",class:"fv-color-primary w-100"}}content(){return{class:" fv-bg-background-alt flex-grow-1 overflow-auto d-flex flex-column",children:(0,c.childrenAppendOnly$)(this.state.logs$.pipe((0,o.map)((e=>[new Q(e)])),(0,o.filter)((([e])=>e.level!=H.DEBUG&&null!=e.step))),(e=>this.messageView(e)),{sideEffects:e=>e.scrollTop=e.scrollHeight})}}messageView(e){let t=e.json?this.jsonView(e.json):{};return{class:"d-flex align-items-center my-1 "+(e.level==H.ERROR?"fv-text-error fv-bg-on-error":"fv-text-primary"),children:[{class:"px-1 "+Z[e.step],tag:"i"},{class:"px-2",tag:"i",innerText:e.action},,{class:"px-2",tag:"i",innerText:e.target},{class:"px-2 d-flex align-items-center",children:[{class:"mx-2",innerHTML:e.content},t]}]}}jsonView(e){let t=new X({name:"data",data:e}),s=new J.ImmutableTree.State({rootNode:t});return new J.ImmutableTree.View({state:s,headerView:(e,t)=>{let s={innerText:t.name};return t.children?s:{class:"d-flex align-items-baseline",children:[s,{tag:"i",class:"px-2",innerText:t.data}]}}})}}var te=s(337);class se extends te.Modal.State{constructor(e){super(),this.environment=e,this.startingFolder=e.configurationPath.slice(0,-1)}}function ae(e){console.log(e);let t=new se(e),s=new te.Modal.View({state:t,contentView:ne}),a=(0,c.render)(s);document.querySelector("body").appendChild(a),t.ok$.subscribe((()=>a.remove())),t.cancel$.subscribe((()=>a.remove()))}function ne(e){let t=new l.BehaviorSubject(e.startingFolder),s=t.pipe((0,o.mergeMap)((e=>V.system.folderContent$(e))));return{class:"fv-bg-background fv-text-primary border rounded p-4",style:{width:"50vw",height:"50vh",overflow:"auto"},children:[{class:"d-flex",children:(0,c.children$)(t,(e=>e.map((e=>function(e,t){let s=e.getValue().indexOf(t);return{class:"px-2 fv-pointer fv-hover-bg-background-alt border rounded mx-2",innerText:t,onclick:()=>e.next(e.getValue().slice(0,s+1))}}(t,e)))))},{class:"my-4",children:(0,c.children$)(s,(({configurations:s,files:a,folders:n})=>{let r=s.map((s=>function(e,t,s,a){let n=e.getValue();return{class:"fv-pointer d-flex  align-items-center fv-hover-bg-background-alt fv-text-focus",style:{"font-weight":JSON.stringify(n.concat(t))===JSON.stringify(s)?"bolder":"inherit"},children:[{class:"fas fa-file px-2"},{innerText:t}],onclick:s=>{a.next(s),be.switchConfiguration([...e.getValue(),t])}}}(t,s,e.environment.configurationPath,e.ok$))),i=a.map((e=>function(e){return{class:"d-flex  align-items-center fv-text-disabled",style:{"user-select":"none"},children:[{class:"fas fa-file px-2"},{innerText:e}]}}(e)));return[...r,...n.map((e=>function(e,t){return{class:"fv-pointer d-flex align-items-center fv-hover-bg-background-alt",children:[{class:"fas fa-folder px-2"},{innerText:t,onclick:()=>e.next(e.getValue().concat(t))}]}}(t,e))),...i]}))}]}}function re(e){return{class:"fv-text-focus fv-pointer",innerText:e.configurationPath.slice(1).join("/"),style:{"font-size":"large"},onclick:()=>ae(e)}}var ie,ce=s(313);class le extends te.ExpandableGroup.State{constructor(e){super("User info"),this.environment=e}}function oe(e){return{className:te.ExpandableGroup.defaultHeaderClass,children:[{tag:"i",className:(0,c.attr$)(e.expanded$,(e=>e?"fa-caret-down":"fa-caret-right"),{wrapper:e=>"px-2 fas "+e})},{tag:"i",class:"fas fa-users"},{innerText:"User info",class:"px-2",style:{"font-size":"large"}},{class:"fv-text-focus px-2",children:[{innerText:`Logged as ${e.environment.userInfo.name}`}]}]}}function de(){let e=new te.Modal.State,t=G("","Sign-in"),s=new l.Subject,a=new l.Subject,n=new te.Modal.View({state:e,contentView:()=>({class:"fv-text-primary fv-bg-background-alt p-4 rounded border fv-color-primary",style:{"max-width":"500px"},children:[{class:"d-flex align-items-baseline py-2 text-center mx-auto justify-content-center",children:[{tag:"h4",class:"text-center fv-text-focus",innerText:"Synchronize with remote user"}]},{tag:"hr",class:"fv-color-primary"},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-info-circle fa-2x px-3"},{tag:"div",innerHTML:"Provide the email adress and password of the user for which you want to synchronize the profile.  Please make sure your internet connection is turned on."}]},{tag:"hr",class:"fv-color-primary"},{class:"d-flex align-items-baseline w-100",children:[{tag:"i",class:"fas fa-at px-3"},{tag:"input",type:"text",class:"flex-grow-1",onchange:e=>s.next(e.target.value)}]},{class:"d-flex align-items-baseline w-100 my-2",children:[{tag:"i",class:"fas fa-key px-3"},{tag:"input",type:"password",class:"flex-grow-1",onchange:e=>a.next(e.target.value)}]},{class:"pt-3",children:[t]}]})}),r=(0,c.render)(n);document.body.appendChild(r),e.cancel$.subscribe((()=>r.remove())),t.state.click$.pipe((0,o.withLatestFrom)((0,l.combineLatest)([s,a])),(0,o.mergeMap)((([e,[t,s]])=>V.environment.syncUser$({email:t,password:s,remoteEnvironment:"dev.platform.youwol.com"})))).subscribe((e=>{console.log(e),r.remove()}),(e=>r.remove()))}class ue extends te.ExpandableGroup.State{constructor(e){super("User info"),this.environment=e}}function he(e){return{className:te.ExpandableGroup.defaultHeaderClass,children:[{tag:"i",className:(0,c.attr$)(e.expanded$,(e=>e?"fa-caret-down":"fa-caret-right"),{wrapper:e=>"px-2 fas "+e})},{tag:"i",class:"fas fa-cog"},{innerText:"Configuration parameters",class:"px-2",style:{"font-size":"large"}}]}}class pe extends te.ExpandableGroup.State{constructor(e){super("Remote info"),this.gatewayInfo=e}}function fe(e){return{className:te.ExpandableGroup.defaultHeaderClass,children:[{tag:"i",className:(0,c.attr$)(e.expanded$,(e=>e?"fa-caret-down":"fa-caret-right"),{wrapper:e=>"px-2 fas "+e})},{tag:"i",class:"fas fa-wifi "+(e.gatewayInfo.connected?"fv-text-success":"fv-text-error")},{innerText:"Remote info",class:"px-2",style:{"font-size":"large"}},{class:"fv-text-focus px-2",children:[{innerText:e.gatewayInfo.name}]}]}}class ge extends te.ExpandableGroup.State{constructor(e){super("YouWol updates",ge.isExpanded(e)),this.availableUpdates=e}static isExpanded(e){return e.status!=n.PENDING&&!e.components.reduce(((e,t)=>e&&t.latestVersion==t.localVersion),!0)}}function we(e){let t={[n.PENDING]:{class:"fas fa-spinner fa-spin"},[n.OUTDATED]:{class:"fas fa-exclamation fv-text-focus"},[n.SYNC]:{class:"fas fa-check fv-text-success"}};return{className:te.ExpandableGroup.defaultHeaderClass,children:[{tag:"i",className:(0,c.attr$)(e.expanded$,(e=>e?"fa-caret-down":"fa-caret-right"),{wrapper:e=>"px-2 fas "+e})},t[e.availableUpdates.status],{innerText:e.name,class:"px-2",style:{"font-size":"large"}}]}}class be{constructor(){}static subscribe(){return be.webSocket$.pipe((0,o.take)(1),(0,o.mergeMap)((()=>V.environment.status$()))).subscribe((e=>be.cacheConfigurationPath(e.configurationPath)))}static switchConfiguration(e){V.environment.switchConfiguration$({path:e}).subscribe()}static getCachedConfigurationPaths(){return JSON.parse(localStorage.getItem("youwol-local-dashboard")||"{}").configurationPaths||[]}static cacheConfigurationPath(e){let t=be.getCachedConfigurationPaths();if(t.includes(e))return;t=t.filter((t=>t!=e)).concat([e]);let s={configurationPaths:t};localStorage.setItem("youwol-local-dashboard",JSON.stringify(s)),be.configurationPaths$.next(t)}syncComponent(e){V.environment.triggerSyncComponent({name:e.name,version:e.latestVersion})}}be.webSocket$=V.environment.connectWs(),be.environment$=be.webSocket$.pipe((0,o.filter)((e=>"Environment"==e.type))),be.loadingStatus$=be.webSocket$.pipe((0,o.filter)((e=>"LoadingStatus"==e.type))),be.configurationUpdated$=be.webSocket$.pipe((0,o.filter)((e=>"ConfigurationUpdated"==e.type))),be.componentsUpdates$=V.environment.componentsUpdates$,be.configurationPaths$=new l.BehaviorSubject(be.getCachedConfigurationPaths());class xe{constructor(e){this.tag="div",this.class=L,this.state=e;let t=new K(be.webSocket$.pipe((0,o.map)((e=>e))));V.environment.triggerAvailableUpdates(),this.children=[{class:"flex-grow-1",children:[(0,c.child$)(be.environment$,(e=>{return{class:"flex-grow-1",children:[{class:"d-flex align-items-center",children:[{class:"p-2",style:{"font-size":"large"},innerText:"configuration:"},re(t=e),{class:"fv-pointer mx-3 fas fa-folder-open border rounded p-2 fv-hover-bg-background-alt",onclick:()=>ae(t)}]}]};var t})),(0,c.child$)(be.environment$,(e=>{return t=e,new te.ExpandableGroup.View({state:new ue(t),headerView:he,contentView:e=>{return{class:"border rounded fv-color-primary p-2",children:[j({innerText:"These parameters are those declared in your configuration file. They can control behaviors of the different pipelines.\n                Refer to the configuration file for more information on the meaning of these parameters.\n                "}),(s=t.configurationParameters.parameters,{class:"my-2",children:Object.entries(s).map((([e,t])=>{let s={};return"ENUM"==t.meta.type&&(s=function(e,t){let s=t.meta.values.map((e=>new ce.Select.ItemData(e,e))),a=new ce.Select.State(s,t.value);return a.selectionId$.pipe((0,o.filter)((e=>e!=t.value)),(0,o.mergeMap)((t=>V.environment.postConfigParameters$({values:{[e]:t}})))).subscribe((()=>{})),new ce.Select.View({state:a})}(e,t)),{class:"border rounded p-2",children:[{class:"d-flex align-items-center",children:[{class:"px-2 fv-text-focus",innerText:t.name+":"},s]},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-info-circle px-3"},{innerText:t.description}]}]}}))})]};var s},className:"my-2"});var t})),(0,c.child$)(be.environment$,(e=>function(e){let t=e.users.map((e=>new ce.Select.ItemData(e,e))),s=new l.BehaviorSubject(e.userInfo.email),a=new ce.Select.State(t,s);a.selectionId$.pipe((0,o.skip)(1),(0,o.distinctUntilChanged)(),(0,o.mergeMap)((e=>V.environment.login$({email:e})))).subscribe((()=>{}));let n=G("fas fa-plus","sync. user");return n.state.click$.subscribe((()=>de())),new te.ExpandableGroup.View({state:new le(e),headerView:oe,contentView:t=>({class:"border rounded fv-color-primary p-2",children:[j({tag:"ul",innerText:"To better work with local YouWol it is preferable to sync your user info with your remotes account.\n                It is required when:\n                ",children:[{tag:"li",innerText:"When pushing or pulling data"}]}),{class:"d-flex align-items-center",children:[{innerText:"Current user:"},new ce.Select.View({state:a,class:"mx-2"}),n]},{children:[{tag:"ul",innerText:"Member of:",children:e.userInfo.memberOf.map((e=>({tag:"li",class:"",innerText:e})))}]}]}),className:"my-2"})}(e))),(0,c.child$)(be.environment$,(e=>function(e){let t=e.remotesInfo.map((({host:e})=>new ce.Select.ItemData(e,e))),s=new l.BehaviorSubject(e.remoteGatewayInfo.host),a=new ce.Select.State(t,s);return a.selectionId$.pipe((0,o.skip)(1),(0,o.distinctUntilChanged)(),(0,o.mergeMap)((e=>V.environment.selectRemoteGateway$({name:e})))).subscribe((()=>{})),new te.ExpandableGroup.View({state:new pe(e.remoteGatewayInfo),headerView:fe,contentView:t=>({class:"border rounded fv-color-primary p-2",children:[j({innerText:"The remote environment with which you want to synchronize your work."}),{class:"d-flex align-items-center",children:[{innerText:"Current environment:"},new ce.Select.View({state:a,class:"mx-2"})]},{tag:"ul",innerText:"Info",children:[{tag:"li",innerText:"name: "+e.remoteGatewayInfo.name},{tag:"li",innerText:"host: "+e.remoteGatewayInfo.host},{tag:"li",innerText:"connected: "+e.remoteGatewayInfo.connected}]}]}),className:"my-2"})}(e))),(0,c.child$)(be.componentsUpdates$,(t=>function(e,t){let s={tag:"table",class:"fv-color-primary  w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:"Local version"},{tag:"td",innerText:"Latest version"},{tag:"td",innerText:""}]}]},{tag:"tbody",children:t.components.map((t=>({tag:"tr",class:"fv-hover-bg-background-alt",children:[{tag:"td",innerText:t.name},{tag:"td",innerText:t.localVersion},{tag:"td",innerText:t.latestVersion},{tag:"td",children:[t.localVersion==t.latestVersion?{}:{class:"fas fa-sync fv-text-focus fv-pointer",onclick:()=>{e.syncComponent(t)}}]}]})))}]};return new te.ExpandableGroup.View({state:new ge(t),headerView:we,contentView:e=>({class:"border rounded fv-color-primary p-2",children:[j({innerText:"The updates available."}),t.status==n.PENDING?{class:"fas fa-spinner fa-spin"}:s]}),className:"my-2"})}(e,t)))]},new ee(t)],this.connectedCallback=e=>{e.subscriptions.push(be.subscribe())}}}!function(e){e.ConfigurationGeneral="conf.general",e.ConfigurationRawFile="conf.raw-file",e.LocalEnvPackage="local.packages",e.LocalEnvFronts="local.fronts",e.LocalEnvBacks="local.backs",e.LocalEnvCDN="local.cdn",e.AssetsUploadPackages="upload.packages",e.AssetsUploadFluxApps="upload.fluxapps",e.AssetsDownloadFluxApps="download.fluxapps",e.AssetsUploadData="upload.fluxdata",e.AssetsUploadPackage="upload.AssetsUploadPackage",e.AssetsDownloadPackages="download.packages"}(ie||(ie={}));let me={[ie.ConfigurationGeneral]:{title:"General",enabled:!0},[ie.ConfigurationRawFile]:{title:"Raw file",enabled:!0},[ie.LocalEnvPackage]:{title:"Packages",enabled:!0},[ie.LocalEnvFronts]:{title:"Front Ends",enabled:!0},[ie.LocalEnvBacks]:{title:"Back Ends",enabled:!0},[ie.LocalEnvCDN]:{title:"CDN",enabled:!0},[ie.AssetsUploadPackages]:{title:"Packages",enabled:!0},[ie.AssetsUploadFluxApps]:{title:"Flux apps",enabled:!0},[ie.AssetsDownloadFluxApps]:{title:"Flux apps",enabled:!0},[ie.AssetsUploadData]:{title:"Data",enabled:!1},[ie.AssetsDownloadPackages]:{title:"Packages",enabled:!0}};function $e(e,t,s,a=!0){return{class:(0,c.attr$)(s,(e=>e?"fv-text-focus":""),{wrapper:e=>e+"  d-flex align-items-center fa-2x "+(a?"fv-pointer":"")}),children:[{tag:"i",class:t+" pr-3"},{tag:"h4",innerText:e,style:{"user-select":"none"}}]}}function ve(e,t){return{tag:"ul",children:(0,c.children$)(e,(e=>e.map((e=>function(e,t){let s=me[e].enabled;return{tag:"li",innerText:me[e].title,class:(0,c.attr$)(t,(t=>t==e?"fv-text-focus":s?"fv-pointer":"fv-text-background-alt")),style:{"user-select":"none"},onclick:a=>{s&&t.next(e),a.stopPropagation()}}}(e,t)))))}}function Se(e,t,s,a,n=!0){return{class:"my-2 "+(n?"":"fv-text-disabled"),children:[$e(e,t,a.pipe((0,o.mergeMap)((e=>s.pipe((0,o.map)((t=>t.includes(e))))))),n),ve(s,a)]}}class ke extends te.Modal.State{constructor(e){super(),this.error=e}}function Te(e){let t=new te.ExpandableGroup.State("trace"),s=new te.ExpandableGroup.View({state:t,headerView:te.ExpandableGroup.defaultHeaderView,contentView:()=>({children:e.error.trace.map((e=>({innerText:e})))})});return{class:"fv-color-focus rounded fv-bg-background fv-text-primary d-flex flex-column p-4",children:[{tag:"h2",class:"text-center w-100 py-2 fv-text-error",innerText:"System error"},{class:"text-center w-100 py-2",innerText:"Details: "+e.error.details},s]}}var ye=s(690),Ne=s(444),Ee=s(71);class Re extends Ee.ModuleExplorer.Node{constructor({id:e,name:t,basePath:s}){super({id:e,name:t,children:Re.groups$(s),events$:Re.events$}),this.basePath=s}static groups$(e){return new Ne.AssetsGatewayClient({basePath:e}).getGroups(Re.events$).pipe((0,o.map)((({groups:t})=>t.map((t=>new De({group:t,basePath:e}))))))}}Re.events$=new l.ReplaySubject;class De extends Ee.ModuleExplorer.Node{constructor({group:e,basePath:t}){super({id:e.id,name:e.path,children:De.drives$(e.id,t),events$:De.events$.pipe((0,o.filter)((t=>t.targetId==e.id)))}),this.group=e,this.name=e.path,this.basePath=t}static drives$(e,t){let s=new Ne.AssetsGatewayClient({basePath:t});return s.getDrives(e,De.events$).pipe((0,o.map)((({drives:e})=>e.map((({driveId:e,name:t})=>{let a=new Ne.Drive(e,t,s);return new Ee.ModuleExplorer.DriveNode({drive:a})})))))}}De.events$=new l.ReplaySubject;let Pe={"PackageStatus.NOT_FOUND":"far fa-circle fv-text-disabled","PackageStatus.MISMATCH":"fas fa-exclamation fv-text-focus","PackageStatus.SYNC":"fas fa-check fv-text-success","PackageStatus.PROCESSING":"fas fa-spinner fa-spin"};class Ie{constructor(){this.fetchDependenciesLatest$=new l.BehaviorSubject(!0),this.options$=(0,l.combineLatest)([this.fetchDependenciesLatest$]).pipe((0,o.map)((([e])=>({fetchDependenciesLatest:e})))),this.webSocket$=V.downloadPackages.connectWs(),this.logsState=new K(this.webSocket$.pipe((0,o.map)((e=>e)))),this.selectedNode$=new l.ReplaySubject,this.queuedToDownload$=V.downloadPackages.downloadItems$.pipe((0,o.map)((e=>Object.values(e)))),this.toggled$=new l.BehaviorSubject([]),this.selectedNode$.pipe((0,o.filter)((e=>e instanceof Ee.ModuleExplorer.FileNode&&e.file instanceof Ne.File&&"package"==e.file.metadata.kind)),(0,o.map)((e=>e.file)),(0,o.mergeMap)((e=>V.downloadPackages.packageInfo$(e.metadata.rawId)))).subscribe()}subscribe(){return V.uploadPackages.status$().subscribe(),[V.downloadPackages.downloadItems$.subscribe((e=>{let t=Object.values(e).filter((e=>e.status!=i.SYNC)).map((e=>e.name));this.toggled$.next(t)}))]}toggle(e){let t=this.toggled$.getValue().includes(e)?this.toggled$.getValue().filter((t=>t!=e)):this.toggled$.getValue().concat([e]);this.toggled$.next(t)}synchronize(){(0,l.combineLatest)([this.queuedToDownload$,this.toggled$]).pipe((0,o.take)(1),(0,o.mergeMap)((([e,t])=>{let s=e.filter((e=>t.includes(e.name)));return V.downloadPackages.download$({packages:s})}))).subscribe()}}class Oe{constructor(e){this.tag="div",this.class="fv-text-primary h-100 d-flex flex-column h-100 fv-bg-background-alt",this.state=e,this.children=[{class:"h-75 d-flex flex-column w-100 fv-bg-background py-3",children:[this.headerView(),this.contentView()]},new ee(e.logsState)],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}headerView(){let e=new te.ExpandableGroup.State("options",!1),t=(e,t)=>{let s=new B.Switch.State(e);return{class:"d-flex align-items-center ",children:[{innerText:t,class:(0,c.attr$)(s.value$,(e=>e?"fv-text-focus":""),{wrapper:e=>e+" px-2"})},new B.Switch.View({state:s})]}};return new te.ExpandableGroup.View({state:e,class:"mx-3 mb-3",headerView:te.ExpandableGroup.defaultHeaderView,contentView:()=>({class:"d-flex w-100 justify-content-around align-items-center border rounded ",children:[t(this.state.fetchDependenciesLatest$,"fetch dependencies @ latest")]})})}contentView(){return{class:"h-100 flex-grow-1",style:{"min-height":"0px"},children:[{class:"d-flex w-100 h-100 justify-content-around",children:[(0,c.child$)(V.downloadPackages.status$(),(()=>function(e){let t=new J.ImmutableTree.State({rootNode:new Re({id:"root",name:"groups",basePath:"/remote/api/assets-gateway"}),selectedNode:e.selectedNode$});return{class:"d-flex h-100 flex-column",children:[{innerText:"Remote workspace"},new J.ImmutableTree.View({state:t,headerView:Ae,connectedCallback:t=>{t.subscriptions.push(e.selectedNode$.subscribe((e=>{console.log("Node selected",e)})))},class:"fv-bg-background fv-text-primary flex-grow-1 overflow-auto",style:{"min-height":"0"}})]}}(this.state)),{untilFirst:{class:"fas fa-spinner fa-spin m-auto"}}),(e=this.state,{class:"d-flex h-100 flex-column",children:[{innerText:"Download queue"},{tag:"table",class:"w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name",class:"px-3"},{tag:"td",innerText:"Version",class:"px-3"},{tag:"td",innerText:"Status",class:"px-3"},{tag:"td",innerText:"Queued?",class:"px-3"}]}]},{tag:"tbody",children:(0,c.childrenWithReplace$)(e.queuedToDownload$,(t=>(t=>({tag:"tr",class:"fv-pointer fv-hover-bg-background-alt ",children:[{tag:"td",innerText:t.name},{tag:"td",innerText:t.version},{tag:"td",children:[{class:Pe[t.status]}]},{tag:"input",type:"checkbox",checked:(0,c.attr$)(e.toggled$,(e=>e.includes(t.name))),onclick:()=>e.toggle(t.name)}]}))(t)),{})}]},(0,c.child$)(e.toggled$,(t=>(t=>{let s={};if(0==t.length)s={innerText:"No items selected for synchronization",class:"fv-text-focus"};else{let a=G("fas fa-sync",`Sync. (${t.length})`);a.state.click$.subscribe((t=>e.synchronize())),s=a}return{class:"w-100",children:[{class:" border fv-color-primary"},{class:"m-3",children:[s]}]}})(t)))]})]}]};var e}}function Ae(e,t){let s=[{target:e=>e instanceof Ee.ModuleExplorer.FileNode&&"package"==e.file.metadata.kind,classes:"d-flex align-items-center fv-pointer",icon:"fas fa-cloud-download-alt"},{target:e=>e instanceof Ee.ModuleExplorer.FileNode,classes:"d-flex align-items-center fv-pointer fv-text-disabled"},{target:e=>e instanceof De&&e.id.includes("private"),icon:"fas fa-user"},{target:e=>e instanceof Re||e instanceof De&&!e.id.includes("private"),icon:"fas fa-users"}];return Ee.ModuleExplorer.headerView(e,t,s)}class Ce{constructor(e){this.appState=e,this.webSocket$=V.downloadFluxApps.connectWs(),this.logsState=new K(this.webSocket$.pipe((0,o.map)((e=>e))))}subscribe(){return[]}}class Ve{constructor(e){this.tag="div",this.class="fv-text-primary h-100 d-flex flex-column h-100 fv-bg-background-alt",this.selected$=new l.ReplaySubject,this.state=e,this.children=[{class:"h-75 d-flex flex-column w-100 fv-bg-background py-3",children:[this.contentView()]},new ee(e.logsState)]}contentView(){return{class:"h-100 flex-grow-1",style:{"min-height":"0px"},children:[{class:"d-flex w-100 h-100 justify-content-around",children:[Le(this.state)]}]}}}class Be extends J.ImmutableTree.State{constructor({rootNode:e,status$:t,expandedNodes:s}){super({rootNode:e,expandedNodes:s}),this.status$=t}}function Le(e){let t=new Be({rootNode:new Re({id:"root",name:"groups",basePath:"/remote/api/assets-gateway"}),status$:e.webSocket$.pipe((0,o.filter)((e=>e.assetId&&e.status))),expandedNodes:["root"]});return{class:"d-flex h-100 flex-column",children:[{innerText:"Remote workspace:"},new J.ImmutableTree.View({state:t,headerView:Ge,class:"fv-bg-background fv-text-primary flex-grow-1 overflow-auto",style:{"min-height":"0"}})]}}function Ge(e,t){let s=[{target:e=>e instanceof Ee.ModuleExplorer.FileNode&&"package"==e.file.metadata.kind,classes:"d-flex align-items-center fv-pointer",icon:"fas fa-cloud-download-alt"},{target:e=>e instanceof Ee.ModuleExplorer.FileNode,classes:"d-flex align-items-center fv-pointer fv-text-disabled"},{target:e=>e instanceof De&&e.id.includes("private"),icon:"fas fa-user"},{target:e=>e instanceof Re||e instanceof De&&!e.id.includes("private"),icon:"fas fa-users"}];return t instanceof Ee.ModuleExplorer.FileNode&&t.file.metadata&&"flux-project"==t.file.metadata.kind?{class:"d-flex align-items-center",children:[{innerText:t.name},{onclick:()=>V.downloadFluxApps.publish$(t.id).subscribe(),class:"fas fa-cloud-download-alt fv-hover-text-focus mx-2 fv-pointer"},(0,c.child$)(e.status$.pipe((0,o.filter)((e=>e.assetId==t.id))),(({status:e})=>e==r.PROCESSING?{class:"fas fa-spinner fa-spin fv-text-focus"}:{}))]}:Ee.ModuleExplorer.headerView(e,t,s)}class je extends ye.Tabs.TabData{constructor(){super(ie.AssetsDownloadPackages,me[ie.AssetsDownloadPackages].title),this.packagesState=new Ie}view(){return new Oe(this.packagesState)}}class Fe extends ye.Tabs.TabData{constructor(e){super(ie.AssetsDownloadFluxApps,me[ie.AssetsDownloadFluxApps].title),this.state=e}view(){return new Ve(this.state)}}class Ue extends ye.Tabs.State{constructor(e){super([new je,new Fe(new Ce(e))],e.selectedPanel$)}}class Me{constructor(e){this.selectedPanel$=e}}class _e{constructor(e){this.tag="div",this.class="p-2 h-100 flex-grow-1";let t=new Ue(e);this.children=[new ye.Tabs.View({class:"d-flex flex-column h-100",state:t,headerView:qe,contentView:(e,t)=>t.view()})],this.connectedCallback=e=>{}}}function qe(e,t){return{innerText:t.name,class:"px-2"}}function We(e){let t=new te.ExpandableGroup.State("Explorer",!1);return new te.ExpandableGroup.View({state:t,headerView:ze,contentView:t=>({class:"my-2 h-100 w-100",style:{"white-space":"nowrap"},children:[{class:"d-flex justify-content-around",children:[{innerText:"Local reference"},{innerText:"Remote reference"}]},{class:"d-flex justify-content-around",children:[{class:"w-50 d-flex justify-content-center",children:[(0,c.child$)(V.uploadPackages.path$(e.treeItems[0].itemId),(e=>Je(e)))]},{class:"w-50  d-flex justify-content-center",children:[(0,c.child$)(V.environment.environments$.pipe((0,o.mergeMap)((()=>V.uploadPackages.remotePath$(e.assetId)))),(e=>e.group&&e.drive&&e.folders?Je(e):{class:"fas fa-times fv-text-error"}),{untilFirst:{class:"fas fa-spinner fa-spin fv-text-primary mx-auto my-auto"}})]}]}]}),class:"mb-3"})}function Ye(e){let t=new te.ExpandableGroup.State("CDN versions",!0);return new te.ExpandableGroup.View({state:t,headerView:ze,contentView:()=>({class:"d-flex justify-content-center",children:[Qe(e)]}),class:"mb-3"})}function ze(e){return te.ExpandableGroup.defaultHeaderView(e)}function He(e){return{class:"d-flex justify-content-center align-items-center ",children:[{tag:"h3",class:"text-center my-2",innerText:e.name}]}}function Je({group:e,drive:t,folders:s}){return{class:"border rounded fv-color-primary p-2 mx-2",style:{width:"fit-content"},children:[{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-users px-2"},{innerText:e}]},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-hdd px-2"},{innerText:t.name}]},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-folder px-2"},{innerText:s.reduce(((e,t)=>e+" / "+t.name),"")}]}]}}function Qe(e){let t=V.uploadPackages.packageVersions$.pipe((0,o.map)((e=>Object.values(e))),(0,o.map)((t=>t.filter((({name:t})=>t==e.name)))));return{tag:"table",class:"fv-color-primary text-center my-3",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Local versions",class:"px-3"},{tag:"td",innerText:"Published versions",class:"px-3"},{tag:"td",innerText:"",class:"px-3"},{tag:"td",innerText:"",class:"px-3"}]}]},(0,c.child$)(t,(t=>({tag:"tbody",children:t.map((({assetId:t,name:s,version:a,status:n})=>({tag:"tr",class:"fv-hover-bg-background-alt",children:[{tag:"td",innerText:a,class:"px-3"},{tag:"td",class:"px-3",children:[{tag:"i",class:Pe[n]}]},Xe(e,a),Ze(e,a)]})))})))]}}function Ke(e,t){return{tag:"td",class:"mx-2",children:[{tag:"i",class:`fas ${t} fv-hover-text-focus p-2 fv-pointer`,onclick:e},{}]}}function Xe(e,t){return Ke((()=>V.uploadPackages.publishLibraryVersion$(e.assetId,t).subscribe()),"fa-cloud-upload-alt")}function Ze(e,t){return Ke((()=>{confirm(`Are you sure you want to remove ${e.name}/${t} from local & deployed CDN`)&&V.uploadPackages.deleteLibraryVersion$(e.assetId,t).pipe((0,o.mergeMap)((()=>V.uploadPackages.status$()))).subscribe()}),"fa-trash fv-text-error ml-4")}function et(e,t,s){return{tag:"table",class:"w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name",class:"px-3"},{tag:"td",innerText:"Version",class:"px-3"},{tag:"td",innerText:"Status",class:"px-3"},{tag:"td",innerText:"Queued?",class:"px-3"}]}]},{tag:"tbody",children:e.map((({assetId:e,name:a,version:n,status:r})=>{let l="fv-pointer fv-hover-bg-background-alt ";return(!t.showSynced&&r==i.SYNC||!t.showNext&&n.includes("-next"))&&(l+="d-none"),{tag:"tr",class:l,children:[{tag:"td",innerText:a},{tag:"td",innerText:n},{tag:"td",children:[{class:Pe[r]}]},{tag:"input",type:"checkbox",checked:(0,c.attr$)(s.isToggled$(e,n),(e=>e)),onclick:()=>s.toggleSync(e,n)}]}}))}]}}function tt(e,t){let s="";return e.status instanceof P&&(s="fas fa-spinner fa-spin"),e.status instanceof D&&(s=Pe[e.status.cdnStatus]),{tag:"td",children:[{class:s}]}}function st(e,t){let s="",a={};return e.status instanceof P&&(s="fas fa-spinner fa-spin"),e.status instanceof D&&(s=Pe[e.status.treeStatus],e.status.treeStatus!=i.SYNC&&(a={class:"fas fa-cloud-upload-alt fv-hover-text-focus fv-pointer",onclick:t=>{V.uploadPackages.registerAsset(e.assetId).subscribe(),t.stopPropagation()}})),{tag:"td",class:"d-flex align-items-center justify-content-around my-auto",children:[{class:s},a]}}class at{constructor(e){this.appState=e,this.showSynced$=new l.BehaviorSubject(!1),this.showNext$=new l.BehaviorSubject(!1),this.options$=(0,l.combineLatest)([this.showSynced$,this.showNext$]).pipe((0,o.map)((([e,t])=>({showSynced:e,showNext:t})))),this.webSocket$=V.uploadPackages.connectWs(),this.syncQueued$=new l.BehaviorSubject(new Set),this.underSynchronization$=new l.BehaviorSubject(new Set),this.logsState=new K(this.webSocket$.pipe((0,o.map)((e=>e))))}subscribe(){return V.uploadPackages.status$().subscribe(),[]}toggleSync(e,t){let s=e+"#"+t,a=this.syncQueued$.getValue();a.has(s)?a.delete(s):a.add(s),this.syncQueued$.next(a)}isToggled$(e,t){let s=e+"#"+t;return this.syncQueued$.pipe((0,o.map)((e=>e.has(s))))}synchronize(){let e={assetIds:Array.from(this.syncQueued$.getValue()).map((e=>({assetId:e.split("#")[0],version:e.split("#")[1]})))};V.uploadPackages.syncPackages$(e).subscribe()}}class nt{constructor(e){this.tag="div",this.class="fv-text-primary h-100 d-flex flex-column h-100 fv-bg-background-alt",this.selected$=new l.ReplaySubject,this.state=e,this.children=[{class:"h-75 d-flex flex-column w-100 fv-bg-background py-3",children:[this.headerView(),this.contentView()]},new ee(e.logsState)],this.selected$.subscribe((e=>{console.log(e),this.state.appState.addTabUpload(e)}))}headerView(){let e=new te.ExpandableGroup.State("options",!1),t=(e,t)=>{let s=new B.Switch.State(e);return{class:"d-flex align-items-center ",children:[{innerText:t,class:(0,c.attr$)(s.value$,(e=>e?"fv-text-focus":""),{wrapper:e=>e+" px-2"})},new B.Switch.View({state:s})]}};return new te.ExpandableGroup.View({state:e,class:"mx-3 mb-3",headerView:te.ExpandableGroup.defaultHeaderView,contentView:()=>({class:"d-flex w-100 justify-content-around align-items-center border rounded ",children:[t(this.state.showSynced$,"display synced items"),t(this.state.showNext$,"display '-next' items")]})})}contentView(){return{class:"h-100 flex-grow-1",style:{"min-height":"0px"},children:[{class:"d-flex w-100 h-100 justify-content-around",children:[(0,c.child$)((0,l.combineLatest)([V.uploadPackages.packages$,this.state.options$]),(([e,t])=>function(e,t,s,a){return{class:"h-100 d-flex flex-column",children:[{class:"overflow-auto fv-color-primary border",children:[{tag:"table",class:" w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name",class:"px-3"},{tag:"td",innerText:"CDN",class:"px-3"},{tag:"td",innerText:"Asset",class:"px-3"}]}]},{tag:"tbody",children:e.map((e=>{let a="fv-pointer fv-hover-bg-background-alt ";return e.status instanceof D&&!t.showSynced&&e.status.cdnStatus==i.SYNC&&e.status.treeStatus==i.SYNC&&(a+="d-none"),{tag:"tr",class:a,children:[{tag:"td",innerText:e.name,class:"px-3"},tt(e),st(e)],onclick:()=>s.next(e)}}))}]}]}]}}(Object.values(e),t,this.selected$,this.state))),(0,c.child$)((0,l.combineLatest)([V.uploadPackages.packageVersions$,this.state.options$]),(([e,t])=>function(e,t,s){return{class:"d-flex flex-column border fv-color-primary",style:{height:"fit-content","max-height":"100%"},children:[{class:"overflow-auto",children:[et(e,t,s)]},{class:"d-flex align-items-baseline",children:[(0,c.child$)(s.syncQueued$,(e=>function(e,t){let s={};if(0==e.size)s={innerText:"No items selected for synchronization",class:"fv-text-focus"};else{let a=G("fas fa-sync",`Sync. (${e.size})`);a.state.click$.subscribe((e=>t.synchronize())),s=a}return{class:"w-100",children:[{class:" border fv-color-primary"},{class:"m-3",children:[s]}]}}(e,s)))]}]}}(Object.values(e),t,this.state)))]}]}}}class rt{constructor(e){this.appState=e,this.webSocket$=V.uploadFluxApps.connectWs(),this.logsState=new K(this.webSocket$.pipe((0,o.map)((e=>e))))}subscribe(){return[]}}class it{constructor(e){this.tag="div",this.class="fv-text-primary h-100 d-flex flex-column h-100 fv-bg-background-alt",this.selected$=new l.ReplaySubject,this.state=e,this.children=[{class:"h-75 d-flex flex-column w-100 fv-bg-background py-3",children:[this.contentView()]},new ee(e.logsState)],this.selected$.subscribe((e=>{console.log(e),this.state.appState.addTabUpload(e)}))}contentView(){return{class:"h-100 flex-grow-1",style:{"min-height":"0px"},children:[{class:"d-flex w-100 h-100 justify-content-around",children:[lt(this.state)]}]}}}class ct extends J.ImmutableTree.State{constructor({rootNode:e,status$:t,expandedNodes:s}){super({rootNode:e,expandedNodes:s}),this.status$=t}}function lt(e){let t=new ct({rootNode:new Re({id:"root",name:"groups",basePath:"/api/assets-gateway"}),status$:e.webSocket$.pipe((0,o.filter)((e=>e.assetId&&e.status))),expandedNodes:["root"]});return{class:"d-flex h-100 flex-column",children:[{innerText:"Local workspace:"},new J.ImmutableTree.View({state:t,headerView:ot,class:"fv-bg-background fv-text-primary flex-grow-1 overflow-auto",style:{"min-height":"0"}})]}}function ot(e,t){let s=[{target:e=>e instanceof Ee.ModuleExplorer.FileNode&&"package"==e.file.metadata.kind,classes:"d-flex align-items-center fv-pointer",icon:"fas fa-cloud-download-alt"},{target:e=>e instanceof Ee.ModuleExplorer.FileNode,classes:"d-flex align-items-center fv-pointer fv-text-disabled"},{target:e=>e instanceof De&&e.id.includes("private"),icon:"fas fa-user"},{target:e=>e instanceof Re||e instanceof De&&!e.id.includes("private"),icon:"fas fa-users"}];return t instanceof Ee.ModuleExplorer.FileNode&&t.file.metadata&&"flux-project"==t.file.metadata.kind?{class:"d-flex align-items-center",children:[{innerText:t.name},{onclick:()=>V.uploadFluxApps.publish$(t.id).subscribe(),class:"fas fa-cloud-upload-alt fv-hover-text-focus mx-2 fv-pointer"},(0,c.child$)(e.status$.pipe((0,o.filter)((e=>e.assetId==t.id))),(({status:e})=>e==r.PROCESSING?{class:"fas fa-spinner fa-spin fv-text-focus"}:{}))]}:Ee.ModuleExplorer.headerView(e,t,s)}class dt extends ye.Tabs.TabData{constructor(e){super(ie.AssetsUploadPackages,"Packages"),this.packagesState=e}view(){return new nt(this.packagesState)}}class ut extends ye.Tabs.TabData{constructor(e,t){super(e.name,e.name),this.library=e,this.packagesState=t}view(){return e=this.library,t=this.packagesState,{class:"h-100 d-flex flex-column w-100 fv-bg-background-alt fv-color-primary",children:[{class:"h-100 d-flex flex-column fv-bg-background p-3  overflow-auto",children:[He(e),{tag:"hr",class:"w-100 fv-color-primary"},We(e),Ye(e)]},new ee(t.logsState)]};var e,t}}class ht extends ye.Tabs.TabData{constructor(e){super(ie.AssetsUploadFluxApps,"Flux Apps"),this.state=e}view(){return new it(this.state)}}class pt{constructor(e){this.selectedPanel$=e,this.selectedTab$=new l.BehaviorSubject("packages"),this.packagesState=new at(this),this.fluxAppsState=new rt(this),e.subscribe((e=>{this.selectedTab$.next(e)})),this.tabsData$=new l.BehaviorSubject([new dt(this.packagesState),new ht(this.fluxAppsState)])}addTabUpload(e){this.tabsData$.getValue().find((t=>t instanceof ut&&t.id==e.name))||(this.tabsData$.next([...this.tabsData$.getValue(),new ut(e,this.packagesState)]),this.selectedTab$.next(e.name))}removeTabUpload(e){this.selectedTab$.getValue()==e&&this.selectedTab$.next(this.tabsData$.getValue()[0].id),this.tabsData$.next(this.tabsData$.getValue().filter((t=>t.name!=e)))}}class ft extends ye.Tabs.State{constructor(e){super(e.tabsData$,e.selectedTab$),this.assetsState=e}}class gt{constructor(e){this.tag="div",this.class="p-2 h-100 flex-grow-1";let t=new ft(e);this.children=[new ye.Tabs.View({class:"d-flex flex-column h-100",state:t,headerView:wt,contentView:(e,t)=>t.view()})],this.connectedCallback=t=>{t.ownSubscriptions(...e.packagesState.subscribe())}}}function wt(e,t){return t instanceof dt||t instanceof ht?{innerText:t.name,class:"px-2"}:t instanceof ut?{class:"d-flex align-items-center px-2",children:[{innerText:t.name,class:"px-2"},{class:"fas fa-times fv-pointer p-1 ",onclick:s=>{e.assetsState.removeTabUpload(t.name),s.stopPropagation()}}]}:void 0}class bt{constructor(){}}class xt{constructor(){this.tag="div",this.class=L;let e=new K(be.webSocket$);this.children=[{class:"d-flex flex-column flex-grow-1 w-100 overflow-auto",style:{height:"0"},children:[j({innerHTML:"This is a readonly preview of your current configuration file.\nYou can get arguments completion, type checkings, and more when editing this file with <a href='https://www.jetbrains.com/fr-fr/pycharm/'>pycharm</a> and the plugin <a href='https://pydantic-docs.helpmanual.io/pycharm_plugin/'> pydantic </a>."}),(0,c.child$)(V.environment.fileContent$(),(({content:e})=>({id:"codeMirror",class:"flex-grow-1 w-100 py-1",style:{height:"0"},connectedCallback:t=>{let s=document.getElementById("codeMirror"),a={value:e,mode:"python",theme:"blackboard",lineNumbers:!0};window.CodeMirror(s,a).setSize("100%","100%")}})))]},new ee(e)],this.connectedCallback=e=>{}}}let mt={[ie.ConfigurationGeneral]:"General",[ie.ConfigurationRawFile]:"Raw file"};class $t{constructor(e){this.selectedPanel$=e,this.logMessages$=new l.Subject,this.generalState=new be,this.packageState=new bt}}class vt extends ye.Tabs.TabData{constructor(e){super(ie.ConfigurationGeneral,mt[ie.ConfigurationGeneral]),this.generalState=e}view(){return new xe(this.generalState)}}class St extends ye.Tabs.TabData{constructor(e){super(ie.ConfigurationRawFile,mt[ie.ConfigurationRawFile]),this.generalState=e}view(){return new xt}}class kt{constructor(e){this.tag="div",this.class="p-2 h-100 flex-grow-1 w-25";let t=[new vt(e.generalState),new St(e.generalState)];this.children=[new ye.Tabs.View({class:"d-flex flex-column h-100",state:new ye.Tabs.State(t,e.selectedPanel$),headerView:(e,t)=>({innerText:t.name,class:"px-2"}),contentView:(e,t)=>t.view()})]}}class Tt extends ce.Select.ItemData{constructor(e){super(e.name,e.name),this.data=e}}function yt(e,t,s){let a=t.map((e=>new Tt(e))),n=new ce.Select.State(a,a[0].id),r=new te.Modal.State,i=G("","Create"),d=new l.ReplaySubject(1),u=new te.Modal.View({state:r,contentView:()=>({class:"fv-text-primary fv-bg-background-alt p-4 rounded border fv-color-primary",style:{"max-width":"75%"},children:[{class:"d-flex align-items-baseline py-2 text-center mx-auto justify-content-center",children:[{tag:"h3",class:"text-center fv-text-focus",innerText:e},new ce.Select.View({state:n,class:"mx-2",style:{"font-size":"x-large"}})]},(0,c.child$)(n.selection$,(e=>function(e,t){let s=e.data.parameters.map((e=>{let t=new l.ReplaySubject(1);return null!=e.defaultValue&&t.next({id:e.id,value:e.defaultValue}),t}));return{children:[(a=e.data.description,{children:[{tag:"hr",class:"fv-color-primary"},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-info-circle fa-2x px-3"},{tag:"div",innerHTML:a}]},{tag:"hr",class:"fv-color-primary"}]}),{children:e.data.parameters.map(((e,t)=>function(e,t){let s=new l.BehaviorSubject(!1),a={string:{class:"ml-2",tag:"input",placeholder:e.placeholder,oninput:s=>t.next({id:e.id,value:s.target.value})},text:{tag:"textarea",class:"ml-2 w-100 flex-grow-1",placeholder:e.placeholder,oninput:s=>t.next({id:e.id,value:s.target.value})}};return{children:[{class:"d-flex align-items-center my-3",children:[{class:e.required?"fv-text-focus":"",innerText:e.displayName},{class:"fv-text-focus",innerText:e.required?"*":""},{class:(0,c.attr$)(s,(e=>e?"fv-text-focus":""),{wrapper:e=>"i fas fa-info fv-pointer mx-2 fv-hover-text-focus "+e}),onclick:()=>s.next(!s.getValue())},{...a[e.type],...e.defaultValue?{value:e.defaultValue}:{}}]},{class:(0,c.attr$)(s,(e=>e?"d-block":"d-none")),innerText:e.description}]}}(e,s[t])))}],connectedCallback:e=>{0!=s.length?e.subscriptions.push((0,l.combineLatest)(s).pipe((0,o.map)((e=>e.reduce(((e,t)=>({...e,[t.id]:t.value})),{})))).subscribe((e=>{t.next(e)}))):t.next({parameters:{}})}};var a}(e,d))),{tag:"hr",class:"fv-color-primary"},(0,c.child$)(d,(e=>i))]})}),h=(0,c.render)(u);document.body.appendChild(h),r.cancel$.subscribe((()=>h.remove())),i.state.click$.pipe((0,o.mergeMap)((()=>d)),(0,o.mergeMap)((e=>s.createSkeleton$(n.selectionId$.getValue(),{parameters:e})))).subscribe((e=>{h.remove()}))}class Nt{constructor(){this.status$=new l.ReplaySubject(1),this.webSocket$=V.fronts.connectWs()}subscribe(){return[this.webSocket$.pipe((0,o.filter)((({type:e})=>"Status"==e))).subscribe((({status:e})=>{this.status$.next(e)})),(0,l.combineLatest)([this.webSocket$.pipe((0,o.take)(1)),be.configurationUpdated$]).pipe((0,o.mergeMap)((()=>V.fronts.status$()))).subscribe((e=>{this.status$.next(e.status)}))]}}class Et{constructor(e){this.tag="div",this.class=L,this.state=e;let t=new K(this.state.webSocket$);this.children=[{tag:"h3",class:"d-flex",children:[(0,c.child$)(e.status$,(()=>({children:[this.newFrontBttn()]})),{untilFirst:{class:"px-2 fas fa-spinner fa-spin"}})]},(0,c.child$)(e.status$,(e=>this.contentView(e))),new ee(t)],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}newFrontBttn(){let e=G("fas fa-plus","new front-end");return e.state.click$.pipe((0,o.mergeMap)((()=>V.fronts.skeletons$()))).subscribe((({skeletons:e})=>{yt("New frontend",e,V.fronts)})),e}contentView(e){return{class:"flex-grow-1 h-25 overflow-auto",children:[this.tableView(e)]}}tableView(e){return{tag:"table",class:"fv-color-primary  w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:"url"},{tag:"td",innerText:"Dev server"},{tag:"td",innerText:"Health"}]}]},{tag:"tbody",children:e.map((e=>{return{tag:"tr",class:"fv-hover-bg-background-alt",children:[(t=e,{tag:"td",innerText:t.name,style:{"font-family":"cursive","font-size":"large"}}),Rt(e),Pt(this.state,e),Dt(e)]};var t}))}]}}}function Rt(e){return{tag:"td",children:[{tag:"a",href:e.url,innerText:e.url}]}}function Dt(e){return{tag:"td",class:e?"fv-text-success":"fv-text-error",children:[{tag:"i",class:e?"fas fa-check px-2":"fas fa-times px-2",onclick}]}}function Pt(e,t){if(null==t.devServer)return{};let s=e.webSocket$.pipe((0,o.filter)((e=>e.target==t.name&&e.action==F.SERVE)),(0,o.filter)((({step:e})=>[_.STARTED,_.DONE].includes(e)))),a=new l.ReplaySubject;return s.subscribe((e=>{a.next(e)})),a.next(t.devServer?{step:_.STARTED}:{step:_.DONE}),{tag:"td",children:[{children:[(0,c.child$)(a,(({step:e})=>({tag:"i",class:"fv-pointer p-2 fv-hover-bg-primary fv-hover-text-focus"+(e==_.STARTED?" fas fa-stop ":" fas fa-play "),onclick:()=>e==_.STARTED?V.fronts.stop$(t.name).subscribe((()=>{})):V.fronts.start$(t.name).subscribe((()=>{}))})))]}]}}class It{constructor(){this.highlighted$=new l.ReplaySubject(1),this.autoWatched$=new l.BehaviorSubject([]),this.dependenciesRequest$=new l.Subject,this.webSocket$=V.modules.connectWs()}subscribe(){return[(0,l.combineLatest)([this.webSocket$.pipe((0,o.take)(1)),be.configurationUpdated$]).pipe((0,o.mergeMap)((()=>V.modules.status$()))).subscribe((e=>{It.status$.next(e)})),this.dependenciesRequest$.pipe((0,o.debounceTime)(250),(0,o.switchMap)((({assetId:e,direction:t})=>V.modules.dependencies$(e).pipe((0,o.map)((e=>({deps:e,direction:t}))))))).subscribe((({deps:e,direction:t})=>{"up"==t?this.highlighted$.next(e.belowDependencies):this.highlighted$.next(e.aboveDependencies)}))]}toggleWatch(e){let t=this.autoWatched$.getValue();t=t.includes(e)?t.filter((t=>t!=e)):t.concat([e]),this.autoWatched$.next(t),V.modules.watch$({libraries:t}).subscribe()}}It.status$=new l.ReplaySubject(1);class Ot{constructor(e){this.tag="div",this.class=L,this.state=e;let t=new K(this.state.webSocket$.pipe((0,o.map)((e=>e))));this.children=[{tag:"h3",class:"d-flex",children:[(0,c.child$)(It.status$,(()=>({children:[this.syncAllBttn(),this.newPackageBttn()]})),{untilFirst:{class:"px-2 fas fa-spinner fa-spin"}})]},(0,c.child$)(It.status$.pipe((0,o.map)((e=>e.status))),(e=>this.contentView(e))),new ee(t)],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}syncAllBttn(){let e=G("fas fa-sync","Sync. all");return e.state.click$.pipe((0,o.mergeMap)((()=>V.modules.action$({action:"SYNC",targetName:"",scope:"ALL"})))).subscribe((e=>{It.status$.next(e)})),e}newPackageBttn(){let e=G("fas fa-plus","new package");return e.state.click$.pipe((0,o.mergeMap)((()=>V.modules.skeletons$()))).subscribe((({skeletons:e})=>{yt("New package",e,V.modules)})),e}contentView(e){return{class:"flex-grow-1 h-25 overflow-auto",children:[this.installQueueView(e),this.pipelinesTableView(e)]}}installQueueView(e){return 0==e.filter((e=>"NOT_INSTALLED"==e.installStatus)).length?{}:{class:"overflow-auto",children:[{tag:"h3",innerText:"List of packages to install"},j({innerText:"Following packages have not been installed yet. \n                    Installation step usually install required dependencies and initialize the asset properly. \n                    Internet connection is usually required here."}),{tag:"table",class:"fv-color-primary mx-auto text-center my-2",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:""}]}]},{tag:"tbody",children:e.filter((e=>"NOT_INSTALLED"==e.installStatus)).map((e=>({tag:"tr",children:[Vt(e),Lt(this.state,e)]})))}]}]}}pipelinesTableView(e){return e.filter((e=>"INSTALLED"==e.installStatus)),{class:"overflow-auto",children:[{tag:"h3",innerText:"Pipelines status"},{tag:"table",class:"fv-color-primary  w-100 text-center",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:"Version"},{tag:"td",innerText:"Watch"},{tag:"td",innerText:"Actions"},{tag:"td",innerText:"Build Status"},{tag:"td",innerText:"Test Status"},{tag:"td",innerText:"CDN Status"}]}]},{tag:"tbody",children:e.filter((e=>"INSTALLED"==e.installStatus)).map((e=>({tag:"tr",class:(0,c.attr$)(this.state.highlighted$,(t=>t.includes(e.name)?"fv-bg-background-alt":""),{wrapper:e=>e+" fv-hover-bg-background-alt",untilFirst:"fv-hover-bg-background-alt"}),children:[Vt(e),Bt(e),Gt(this.state,e),jt(this.state,e),Mt(this.state,e),_t(this.state,e),qt(this.state,e)]})))}]}]}}}let At="fv-pointer p-2 fv-hover-bg-primary fv-hover-text-focus",Ct={NEVER_BUILT:{color:"fv-text-focus ",icon:"fas fa-sync "+At,text:"never built"},NOT_PUBLISHED:{color:"fv-text-focus ",icon:"fas fa-sync "+At,text:""},GREEN:{color:"fv-text-success ",icon:"fas fa-check ",text:""},RED:{color:"fv-text-error ",icon:"fas fa-sync "+At,text:""},CDN_ERROR:{color:"fv-text-error ",icon:"fas fa-times ",text:""},OUT_OF_DATE:{color:"fv-text-focus ",icon:"fas fa-sync "+At,text:""},INDIRECT_OUT_OF_DATE:{color:"fv-text-focus ",icon:"fas fa-sync "+At,text:"(indirect)"},NO_ENTRY:{color:"fv-text-focus ",icon:"fas fa-sync "+At,text:""},SYNC:{color:"fv-text-success ",icon:"fas fa-check "+At,text:""}};function Vt(e){return e.documentation?{tag:"td",style:{"font-family":"cursive","font-size":"large"},children:[{tag:"a",href:e.documentation,innerText:e.name}]}:{tag:"td",innerText:e.name,style:{"font-family":"cursive","font-size":"large"}}}function Bt(e){return{tag:"td",innerText:e.version}}function Lt(e,t){let s=e.webSocket$.pipe((0,o.filter)((e=>e.target==t.name&&e.action==F.INSTALL))),a=G("","Install");return a.state.click$.pipe((0,o.mergeMap)((()=>V.modules.install$(t.assetId)))).subscribe((()=>console.log("install done"))),{class:"d-flex align-items-center",children:[(0,c.child$)(a.state.click$,(()=>({})),{untilFirst:a}),{tag:"i",class:(0,c.attr$)(s.pipe((0,o.filter)((({step:e})=>[_.STARTED,_.DONE].includes(e)))),(e=>e.step==_.STARTED?"fas fa-spinner fa-spin p-3":""))}]}}function Gt(e,t){return{tag:"td",class:(0,c.attr$)(e.autoWatched$,(e=>e.includes(t.name)?"fas fa-satellite-dish fv-text-focus ":"fas fa-satellite-dish "),{wrapper:e=>e+At}),onclick:()=>e.toggleWatch(t.name)}}function jt(e,t){return{tag:"td",children:[{tag:"i",class:"far fa-arrow-alt-circle-right "+At,onclick:()=>Ft(0,{action:F.SYNC,targetName:t.name,scope:U.TARGET_ONLY})},{tag:"i",class:"far fa-arrow-alt-circle-up "+At,onclick:()=>Ft(0,{action:F.SYNC,targetName:t.name,scope:U.ALL_ABOVE}),onmouseover:()=>{e.dependenciesRequest$.next({assetId:t.assetId,direction:"up"})},onmouseout:()=>e.highlighted$.next([])},{tag:"i",class:"far fa-arrow-alt-circle-down "+At,onclick:()=>Ft(0,{action:F.SYNC,targetName:t.name,scope:U.ALL_BELOW}),onmouseover:s=>{e.dependenciesRequest$.next({assetId:t.assetId,direction:"down"})},onmouseout:()=>e.highlighted$.next([])}]}}function Ft(e,t){V.modules.action$(t).subscribe((e=>{}))}function Ut(e,t,s){let a=e.webSocket$.pipe((0,o.filter)((e=>e.target==t&&e.action==s))),n=new l.ReplaySubject;return{tag:"td",class:(0,c.attr$)(n,(({color:e})=>e)),children:[{tag:"i",innerText:(0,c.attr$)(n,(({text:e})=>e))},{tag:"i",class:(0,c.attr$)(n,(({icon:e})=>e)),onclick:()=>Ft(0,{action:s,targetName:t,scope:U.TARGET_ONLY})},{tag:"i",class:(0,c.attr$)(a.pipe((0,o.filter)((({step:e})=>[_.STARTED,_.DONE].includes(e)))),(e=>e.step==_.STARTED?"fas fa-spinner fa-spin":""))}],connectedCallback:e=>{e.subscriptions.push(a.pipe((0,o.filter)((({step:e,content:t})=>e==_.STATUS&&null!=Ct[t])),(0,o.map)((({content:e})=>Ct[e]))).subscribe((e=>{n.next(e)})))}}}function Mt(e,t){return Ut(e,t.name,F.BUILD)}function _t(e,t){return Ut(e,t.name,F.TEST)}function qt(e,t){return Ut(e,t.name,F.CDN)}function Wt(e,t,s){let a=e.pipe((0,o.filter)((e=>e.target==t.name&&e.action==F.INSTALL))),n=G("","Install");return n.state.click$.pipe((0,o.mergeMap)((()=>s.install$(t.assetId)))).subscribe((()=>console.log("install done"))),{class:"d-flex align-items-center",children:[(0,c.child$)(n.state.click$,(()=>({})),{untilFirst:n}),{tag:"i",class:(0,c.attr$)(a.pipe((0,o.filter)((({step:e})=>[_.STARTED,_.DONE].includes(e)))),(e=>e.step==_.STARTED?"fas fa-spinner fa-spin p-3":""))}]}}class Yt{constructor(){this.status$=new l.ReplaySubject(1),this.environments$=new l.BehaviorSubject([]),this.currentEnvironment$=new l.BehaviorSubject(""),this.selectedEnvId$=new l.BehaviorSubject(""),this.envSelectionState=new ce.Select.State(this.environments$,this.selectedEnvId$),this.selectedUserId$=new l.BehaviorSubject(localStorage.getItem("user-name")||"greinisch@youwol.com"),this.webSocket$=V.backs.connectWs()}subscribe(){return[this.webSocket$.pipe((0,o.filter)((({type:e})=>"Status"==e))).subscribe((({status:e})=>{this.status$.next(e)})),(0,l.combineLatest)([this.webSocket$.pipe((0,o.take)(1)),be.configurationUpdated$]).pipe((0,o.mergeMap)((()=>V.backs.status$()))).subscribe((e=>{this.status$.next(e.status)}))]}}class zt{constructor(e){this.tag="div",this.class=L,this.state=e;let t=new K(this.state.webSocket$);this.children=[{tag:"h3",class:"d-flex",children:[this.newBackBttn(),(0,c.child$)(e.status$,(()=>({children:[this.startBttn(),this.restartBttn()]})),{untilFirst:{class:"px-2 fas fa-spinner fa-spin"}})]},(0,c.child$)(e.status$,(e=>{return t=this.state.webSocket$,s=e,"",a=V.backs,0==s.filter((e=>"NOT_INSTALLED"==e.installStatus)).length?{}:{class:"overflow-auto",children:[{tag:"h4",innerText:"Assets to install"},j({innerText:""}),{tag:"table",class:"fv-color-primary mx-auto text-center my-2",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:""}]}]},{tag:"tbody",children:s.filter((e=>"NOT_INSTALLED"==e.installStatus)).map((e=>({tag:"tr",children:[{tag:"td",innerText:e.name,style:{"font-family":"cursive","font-size":"large"}},Wt(t,e,a)]})))}]}]};var t,s,a})),(0,c.child$)(e.status$,(e=>this.contentView(e))),new ee(t)],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}newBackBttn(){let e=G("fas fa-plus","new backend-end");return e.state.click$.pipe((0,o.mergeMap)((()=>V.backs.skeletons$()))).subscribe((({skeletons:e})=>{yt("New backend",e,V.backs)})),e}startBttn(){let e=G("fas fa-play","Start");return e.state.click$.pipe((0,o.mergeMap)((()=>V.backs.start$()))).subscribe((()=>{})),e}restartBttn(){let e=G("fas fa-play","Re-start");return e.state.click$.pipe((0,o.mergeMap)((()=>V.backs.restart$()))).subscribe((()=>{})),e}contentView(e){return{class:"flex-grow-1 h-25 overflow-auto",children:[this.tableView(e)]}}tableView(e){return{tag:"table",class:"fv-color-primary  w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:""},{tag:"td",innerText:"Actions"},{tag:"td",innerText:"Health"}]}]},{tag:"tbody",children:e.filter((e=>"INSTALLED"==e.installStatus)).map((e=>{return{tag:"tr",class:"fv-hover-bg-background-alt",children:[Jt(this.state,e),Qt(this.state,e),Kt(this.state,e),(t=this.state,s=e,function(e,t,s){let a=e.webSocket$.pipe((0,o.filter)((e=>e.target==t.name&&"serve"==e.action)),(0,o.filter)((e=>["started","serving","done"].includes(e.step)))),n=new l.BehaviorSubject(t.health?s.serving:s.error);return{tag:"td",children:[(0,c.child$)(n,(e=>({tag:"i",class:e.class,onclick:e.onclick?e.onclick:()=>{}})))],connectedCallback:e=>{e.subscriptions.push(a.pipe((0,o.map)((e=>s[e.step]))).subscribe((e=>n.next(e))))}}}(t,s,{started:{class:"fas fa-spinner fa-spin fv-text-primary",onclick:void 0},serving:{class:"fv-text-success fas fa-check px-2",onclick:void 0},error:{class:"fv-text-error fas fa-times px-2",onclick:void 0},done:{class:"fv-text-error fas fa-times px-2",onclick:void 0}}))]};var t,s}))}]}}}let Ht="fv-pointer p-2 fv-hover-bg-primary fv-hover-text-focus";function Jt(e,t){return{tag:"td",innerText:t.name,style:{"font-family":"cursive","font-size":"large"}}}function Qt(e,t){return t.openApi?{tag:"td",innerHTML:`<a href='${t.openApi}'> doc </a> `}:{tag:"td"}}function Kt(e,t){return{tag:"td",children:[{tag:"i",class:t.devServer?`fas fa-stop fv-text-primary ${Ht}`:`fas fa-play fv-text-primary ${Ht}`,onclick:()=>{t.devServer?V.backs.stop$(t.assetId).subscribe():V.backs.start$(t.assetId).subscribe()}}]}}class Xt{constructor(){this.packagesStatus$=V.localCdnPackages.packagesStatus$,this.packageDetails$=V.localCdnPackages.packageDetails$,this.webSocket$=V.localCdnPackages.connectWs()}subscribe(){let e=this.packagesStatus$.subscribe((e=>console.log("packagesStatus",e))),t=this.packageDetails$.subscribe((e=>console.log("packageDetails",e)));return V.localCdnPackages.status$().subscribe(),[e,t]}getPackageDetails(e){V.localCdnPackages.getPackageDetails$(e).subscribe()}}class Zt{constructor(e){this.tag="div",this.class=L,this.state=e,this.children=[{class:"d-flex h-100",children:[(0,c.child$)(this.state.packagesStatus$,(e=>this.packagesTable(e))),(0,c.child$)(this.state.packageDetails$,(e=>e?this.packageDetails(e):{}))]}],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}packagesTable(e){return{class:"overflow-auto h-100",children:[{tag:"table",class:"fv-color-primary  w-100 text-center",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name",class:"px-2"},{tag:"td",innerText:"Version count",class:"px-2"},{tag:"td",innerText:"Latest version",class:"px-2"},{tag:"td",innerText:"",class:"px-2"}]}]},{tag:"tbody",children:e.packages.map((e=>{return{tag:"tr",class:"fv-hover-bg-background-alt fv-pointer",children:[es(e),ts(e),ss(e),(t=e.name,{tag:"td",children:[{class:"fas fa-trash fv-text-error px-2 fv-pointer",onclick:()=>{confirm(`Are you sure you want to remove ${t} (all versions) from local CDN`)&&V.localCdnPackages.deletePackage$(t).subscribe()}}]})],onclick:()=>this.state.getPackageDetails(e.name)};var t}))}]}]}}packageDetails(e){return{class:"overflow-auto h-100 mx-auto",children:[{tag:"h4",class:"fv-text-focus",innerText:e.name},{tag:"table",class:"fv-color-primary  w-100 text-center",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Version",class:"px-2"},{tag:"td",innerText:"files count",class:"px-2"},{tag:"td",innerText:"bundle size (Ko)",class:"px-2"},{tag:"td",innerText:"",class:"px-2"}]}]},{tag:"tbody",children:e.versions.map((t=>{return{tag:"tr",class:"fv-hover-bg-background-alt",children:[{tag:"td",innerText:t.version,class:"px-2"},{tag:"td",innerText:t.filesCount,class:"px-2"},{tag:"td",innerText:Math.floor(t.bundleSize/100)/10,class:"px-2"},(s=e.name,a=t.version,{tag:"td",children:[{class:"fas fa-trash fv-text-error px-2 fv-pointer",onclick:()=>{confirm(`Are you sure you want to remove ${s}@${a} from local CDN`)&&V.localCdnPackages.deleteVersion$(s,a).subscribe()}}]})]};var s,a}))}]}]}}}function es(e){return{tag:"td",innerText:e.name,class:"px-2"}}function ts(e){return{tag:"td",innerText:e.versions.length,class:"px-2"}}function ss(e){return{tag:"td",innerText:e.versions[0].version,class:"px-2"}}let as={[ie.LocalEnvPackage]:"Packages",[ie.LocalEnvFronts]:"Front Ends",[ie.LocalEnvBacks]:"Back Ends",[ie.LocalEnvCDN]:"CDN"};class ns{constructor(e){this.selectedPanel$=e,this.logMessages$=new l.Subject,this.modulesState=new It,this.frontendsState=new Nt,this.backendsState=new Yt,this.cdnState=new Xt}}class rs extends ye.Tabs.TabData{constructor(e){super(ie.LocalEnvPackage,as[ie.LocalEnvPackage]),this.modulesState=e}view(){return new Ot(this.modulesState)}}class is extends ye.Tabs.TabData{constructor(e){super(ie.LocalEnvFronts,as[ie.LocalEnvFronts]),this.frontEndsState=e}view(){return new Et(this.frontEndsState)}}class cs extends ye.Tabs.TabData{constructor(e){super(ie.LocalEnvBacks,as[ie.LocalEnvBacks]),this.backendsState=e}view(){return new zt(this.backendsState)}}class ls extends ye.Tabs.TabData{constructor(e){super(ie.LocalEnvCDN,as[ie.LocalEnvCDN]),this.cdnState=e}view(){return new Zt(this.cdnState)}}class os{constructor(e){this.tag="div",this.class="p-2 h-100 flex-grow-1";let t=[new rs(e.modulesState),new is(e.frontendsState),new cs(e.backendsState),new ls(e.cdnState)];this.children=[new ye.Tabs.View({class:"d-flex flex-column h-100",state:new ye.Tabs.State(t,e.selectedPanel$),headerView:(e,t)=>({innerText:t.name,class:"px-2"}),contentView:(e,t)=>t.view()})]}}s(897);let ds=new class{constructor(){this.environmentChildren$=new l.BehaviorSubject([ie.ConfigurationGeneral,ie.ConfigurationRawFile]),this.localChildren$=new l.BehaviorSubject([ie.LocalEnvPackage,ie.LocalEnvFronts,ie.LocalEnvBacks,ie.LocalEnvCDN]),this.uploadChildren$=new l.BehaviorSubject([ie.AssetsUploadPackages,ie.AssetsUploadFluxApps]),this.downloadChildren$=new l.BehaviorSubject([ie.AssetsDownloadPackages,ie.AssetsDownloadFluxApps]),this.selected$=new l.BehaviorSubject(ie.ConfigurationGeneral),this.localState=new ns(this.selected$),this.assetsUploadState=new pt(this.selected$),this.assetsDownloadState=new Me(this.selected$),this.configurationState=new $t(this.selected$),this.panelViewFactory$=this.selected$.pipe((0,o.map)((e=>[ie.LocalEnvPackage,ie.LocalEnvFronts,ie.LocalEnvBacks,ie.LocalEnvCDN].includes(e)?new os(this.localState):[ie.AssetsUploadPackages,ie.AssetsUploadFluxApps].includes(e)?new gt(this.assetsUploadState):[ie.ConfigurationGeneral,ie.ConfigurationRawFile].includes(e)?new kt(this.configurationState):[ie.AssetsDownloadPackages,ie.AssetsDownloadFluxApps].includes(e)?new _e(this.assetsDownloadState):void 0)))}addTabUpload(e){let t=this.uploadChildren$.getValue();me[ie.AssetsUploadPackage]={title:e,enabled:!0},this.uploadChildren$.next([...t,ie.AssetsUploadPackage])}},us={class:"d-flex fv-text-primary h-100",children:[new class{constructor(e){this.state=e,this.tag="div",this.class="d-flex justify-content-center py-5 px-2 border h-100 ",this.style={"min-width":"300px"},this.children=[{class:"h-100 mx-auto d-flex flex-column pl-3",children:[{tag:"a",href:"/ui/workspace-explorer",class:"w-100 mb-2 d-flex justify-content-center",children:[{tag:"img",class:"mx-auto text-center fv-pointer",style:{width:"75%"},href:"/ui/workspace-explorer",src:"/api/assets-gateway/raw/package/QHlvdXdvbC9mbHV4LXlvdXdvbC1lc3NlbnRpYWxz/latest/assets/images/logo_YouWol_Platform_white.png"}]},(0,c.child$)(V.environment.environments$,(e=>{return{class:"mb-5",children:[{class:"d-flex align-items-center fv-hover-text-focus fv-pointer  justify-content-center",onclick:()=>de(),children:[{class:"fas fa-user"},{class:"fv-hover-text-focus fv-pointer mx-2",innerText:(t=e).userInfo.email}]},{class:"d-flex align-items-center justify-content-center",children:[{class:"fas fa-wifi px-2 "+(t.remoteGatewayInfo.connected?"fv-text-success":"fv-text-error")},{innerText:t.remoteGatewayInfo.host}]}]};var t})),Se("Environment","fas fa-users-cog my-2",this.state.environmentChildren$,this.state.selected$),Se("My computer","fas fa-laptop-code my-2",this.state.localChildren$,this.state.selected$),Se("Upload assets","fas fa-cloud-upload-alt my-2",this.state.uploadChildren$,this.state.selected$),Se("Download assets","fas fa-cloud-download-alt my-2",this.state.downloadChildren$,this.state.selected$),{class:"my-2 ",children:[$e("Resources","fas fa-book",new l.BehaviorSubject(!1)),(0,c.child$)(be.environment$,(e=>({tag:"ul",class:"d-flex flex-column",children:Object.entries(e.configuration.general.resources).map((([e,t])=>({tag:"li",children:[{tag:"a",href:t,innerText:e}]})))})))]}]}]}}(ds),(0,c.child$)(ds.panelViewFactory$,(e=>e))]},hs=V.system.connectWs();hs.pipe((0,o.filter)((e=>"SystemError"==e.type))).subscribe((e=>{let t=new ke(e),s=new te.Modal.View({state:t,contentView:Te}),a=(0,c.render)(s);document.querySelector("body").appendChild(a),t.ok$.subscribe((()=>a.remove())),t.cancel$.subscribe((()=>a.remove()))})),hs.pipe((0,o.take)(1)).subscribe((e=>{document.body.appendChild((0,c.render)(us))}))}}]);
//# sourceMappingURL=428.20ffa6a777619ed1e585.js.map