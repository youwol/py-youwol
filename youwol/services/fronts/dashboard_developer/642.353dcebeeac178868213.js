(self.webpackChunk=self.webpackChunk||[]).push([[642],{642:(e,t,s)=>{"use strict";s.r(t);var a,n,r,i=s(222),c=s(435),l=s(519);class o{static connectWs(){return o.webSocket$||(o.webSocket$=new c.ReplaySubject,new WebSocket(`ws://${window.location.host}${o.urlBase}/ws`).onmessage=e=>{o.webSocket$.next(JSON.parse(e.data))}),o.webSocket$}static status$(){let e=`${o.urlBase}/status`;return R(new Request(e,{method:"GET",headers:o.headers}))}static start$(e){let t=e?`${o.urlBase}/${e}/start`:`${o.urlBase}/start`;return R(new Request(t,{method:"POST",headers:o.headers}))}static restart$(){let e=`${o.urlBase}/restart`;return R(new Request(e,{method:"POST",headers:o.headers}))}static stop$(e){let t=`${o.urlBase}/${e}/stop`;return R(new Request(t,{method:"POST",headers:o.headers}))}static skeletons$(){let e=`${o.urlBase}/skeletons`;return R(new Request(e,{method:"GET",headers:o.headers}))}static createSkeleton$(e,t){let s=`${o.urlBase}/skeletons/${e}`;return R(new Request(s,{method:"POST",body:JSON.stringify(t),headers:o.headers}))}static install$(e){let t=`${o.urlBase}/${e}/install`;return R(new Request(t,{method:"POST",headers:o.headers}))}}o.urlBase="/admin/backends",o.headers={},function(e){e.PENDING="PENDING",e.SYNC="SYNC",e.OUTDATED="OUTDATED"}(a||(a={}));class d{static connectWs(){return d.webSocket$||(d.webSocket$=new c.ReplaySubject,new WebSocket(`ws://${window.location.host}${d.urlBase}/ws`).onmessage=e=>{let t=JSON.parse(e.data);var s;d.webSocket$.next(t),(s=t).configurationPath&&s.userInfo&&s.users&&s.configuration&&s.remoteGatewayInfo&&s.remotesInfo&&d.environments$.next(t),function(e){return e.status&&e.components}(t)&&d.componentsUpdates$.next(t)}),d.webSocket$}static status$(){let e=`${d.urlBase}/status`;return R(new Request(e,{method:"GET",headers:d.headers}))}static fileContent$(){let e=`${d.urlBase}/file-content`;return R(new Request(e,{method:"GET",headers:d.headers}))}static switchConfiguration$(e){let t=`${d.urlBase}/switch-configuration`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:d.headers}))}static syncUser$(e){let t=`${d.urlBase}/sync-user`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:d.headers}))}static login$(e){let t=`${d.urlBase}/login`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:d.headers}))}static selectRemoteGateway$(e){let t=`${d.urlBase}/select-remote-gateway`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:d.headers}))}static postConfigParameters$(e){let t=`${d.urlBase}/configuration/parameters`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:d.headers}))}static triggerAvailableUpdates(){let e=`${d.urlBase}/available-updates`,t=new Request(e,{method:"GET",headers:d.headers});fetch(t).then()}static triggerSyncComponent(e){let t=`${d.urlBase}/sync-component`,s=new Request(t,{method:"POST",body:JSON.stringify(e),headers:d.headers});fetch(s).then()}}d.urlBase="/admin/environment",d.environments$=new c.ReplaySubject(1),d.componentsUpdates$=new c.ReplaySubject(1),d.headers={};class u{constructor(e){Object.assign(this,e)}}class h{static connectWs(){if(h.webSocket$)return h.webSocket$;h.webSocket$=new c.Subject;var e=new WebSocket(`ws://${window.location.host}${h.urlBase}/ws`);return d.environments$.pipe((0,l.mergeMap)((()=>this.status$()))).subscribe(),e.onmessage=e=>{let t=JSON.parse(e.data);h.webSocket$.next(t),t.target&&"downloadItem"==t.target&&h.downloadItem$.next(new u(t))},this.downloadItem$.pipe((0,l.scan)(((e,t)=>null==t?{}:{...e,[`${t.name}#${t.version}`]:t}),{})).subscribe((e=>{this.downloadItems$.next(e)})),h.webSocket$}static status$(){let e=`${h.urlBase}/status`;return R(new Request(e,{method:"GET",headers:h.headers}))}static getGroups$(){let e=`${h.urlBase}/groups`;return R(new Request(e,{method:"GET",headers:h.headers}))}static getDrives$(e){let t=`${h.urlBase}/groups/${e}/drives`;return R(new Request(t,{method:"GET",headers:h.headers}))}static packageInfo$(e){let t=`${h.urlBase}/info/${e}`;return R(new Request(t,{method:"GET",headers:h.headers}))}static download$(e){let t=`${h.urlBase}/synchronize`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:h.headers}))}}h.urlBase="/admin/download/packages",h.groups$=new c.Subject,h.headers={},h.downloadItem$=new c.Subject,h.downloadItems$=new c.BehaviorSubject({});class p{static connectWs(){return p.webSocket$||(p.webSocket$=new c.ReplaySubject,new WebSocket(`ws://${window.location.host}/admin/frontends/ws`).onmessage=e=>{p.webSocket$.next(JSON.parse(e.data))}),p.webSocket$}static status$(){let e=`${p.urlBase}/status`;return R(new Request(e,{method:"GET",headers:p.headers}))}static start$(e){let t=`${p.urlBase}/${e}/start`;return R(new Request(t,{method:"POST",headers:p.headers}))}static stop$(e){let t=`${p.urlBase}/${e}/stop`;return R(new Request(t,{method:"POST",headers:p.headers}))}static skeletons$(){let e=`${p.urlBase}/skeletons`;return R(new Request(e,{method:"GET",headers:p.headers}))}static createSkeleton$(e,t){let s=`${p.urlBase}/skeletons/${e}`;return R(new Request(s,{method:"POST",body:JSON.stringify(t),headers:p.headers}))}}p.urlBase="/admin/frontends",p.headers={};class f{static connectWs(){return f.webSocket$||(f.webSocket$=new c.ReplaySubject,new WebSocket(`ws://${window.location.host}/admin/local-cdn/ws`).onmessage=e=>{let t=JSON.parse(e.data);f.webSocket$.next(t),t.target&&"PackagesStatus"==t.target&&(f.packagesStatus$.next(t.cdnStatus),f.packageDetails$.next(void 0)),t.target&&"PackageDetails"==t.target&&f.packageDetails$.next(t.packageDetails)}),f.webSocket$}static status$(){let e=`${f.urlBase}/status`;return R(new Request(e,{method:"GET",headers:f.headers}))}static getPackageDetails$(e){let t=`${f.urlBase}/packages/${e}`;return R(new Request(t,{method:"GET",headers:f.headers}))}static deleteVersion$(e,t){let s=`${f.urlBase}/libraries/${e}/${t}`;return R(new Request(s,{method:"DELETE",headers:f.headers}))}static deletePackage$(e){let t=`${f.urlBase}/packages/${e}`;return R(new Request(t,{method:"DELETE",headers:f.headers}))}}f.urlBase="/admin/local-cdn",f.packagesStatus$=new c.ReplaySubject(1),f.packageDetails$=new c.ReplaySubject(1),f.headers={};class g{static connectWs(){return g.webSocket$||(g.webSocket$=new c.ReplaySubject,new WebSocket(`ws://${window.location.host}${g.urlBase}/ws`).onmessage=e=>{g.webSocket$.next(JSON.parse(e.data))}),g.webSocket$}static status$(){let e=`${g.urlBase}/status`;return R(new Request(e,{method:"GET",headers:g.headers}))}static action$(e){let t=`${g.urlBase}/action`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:g.headers}))}static dependencies$(e){let t=`${g.urlBase}/${e}/dependencies`;return R(new Request(t,{method:"GET",headers:g.headers}))}static watch$(e){let t=`${g.urlBase}/watch`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:g.headers}))}static skeletons$(){let e=`${g.urlBase}/skeletons`;return R(new Request(e,{method:"GET",headers:g.headers}))}static createSkeleton$(e,t){let s=`${g.urlBase}/skeletons/${e}`;return R(new Request(s,{method:"POST",body:JSON.stringify(t),headers:g.headers}))}static install$(e){let t=`${g.urlBase}/${e}/install`;return R(new Request(t,{method:"POST",headers:g.headers}))}}g.urlBase="/admin/packages",g.headers={};class w{static connectWs(){return w.webSocket$||(w.webSocket$=new c.ReplaySubject,new WebSocket(`ws://${window.location.host}/admin/system/ws`).onmessage=e=>{w.webSocket$.next(JSON.parse(e.data))}),w.webSocket$}static folderContent$(e){let t=`${w.urlBase}/folder-content`,s={path:e};return R(new Request(t,{method:"POST",body:JSON.stringify(s),headers:w.headers}))}}w.urlBase="/admin/system",w.headers={},function(e){e.NOT_FOUND="FluxAppStatus.NOT_FOUND",e.SYNC="FluxAppStatus.SYNC",e.MISMATCH="FluxAppStatus.MISMATCH",e.PROCESSING="FluxAppStatus.PROCESSING",e.DONE="FluxAppStatus.DONE"}(n||(n={}));class b{constructor(){}}class m extends b{constructor({fluxStatus:e,treeStatus:t,assetStatus:s}){super(),this.fluxStatus=e,this.treeStatus=t,this.assetStatus=s}}class x extends b{}class ${constructor({assetId:e,name:t,treeItems:s,status:a}){this.assetId=e,this.name=t,this.treeItems=s,this.status="string"==typeof a?new x:new m(a)}}class v{static connectWs(){return v.webSocket$||(v.webSocket$=new c.Subject,new WebSocket(`ws://${window.location.host}${v.urlBase}/ws`).onmessage=e=>{let t=JSON.parse(e.data);v.webSocket$.next(t),t.target&&"flux-app"==t.target&&v.package$.next(new $(t))},this.package$.pipe((0,l.scan)(((e,t)=>null==t?{}:{...e,[t.assetId]:t}),{})).subscribe((e=>{this.fluxApps$.next(e)}))),v.webSocket$}static status$(){this.package$.next(void 0);let e=`${v.urlBase}/status`,t=new Request(e,{method:"GET",headers:v.headers});return(0,c.combineLatest)([v.webSocket$.pipe((0,l.take)(1)),R(t)]).pipe((0,l.map)((([e,t])=>t)))}static publish$(e){let t=`${v.urlBase}/publish/${e}`;return R(new Request(t,{method:"POST",headers:v.headers}))}}v.urlBase="/admin/upload/flux-apps",v.headers={},v.fluxApps$=new c.BehaviorSubject({}),v.package$=new c.ReplaySubject(1),function(e){e.NOT_FOUND="PackageStatus.NOT_FOUND",e.SYNC="PackageStatus.SYNC",e.MISMATCH="PackageStatus.MISMATCH",e.PROCESSING="PackageStatus.PROCESSING",e.DONE="PackageStatus.DONE"}(r||(r={}));class S{constructor(){}}class k extends S{constructor({cdnStatus:e,treeStatus:t,assetStatus:s}){super(),this.cdnStatus=e,this.treeStatus=t,this.assetStatus=s}}class T extends S{}class y{constructor({assetId:e,name:t,namespace:s,treeItems:a,releases:n,status:r}){this.assetId=e,this.name=t,this.namespace=s,this.treeItems=a,this.releases=n,this.status="string"==typeof r?new T:new k(r)}}class N{constructor({assetId:e,name:t,namespace:s,version:a,status:n}){this.assetId=e,this.name=t,this.namespace=s,this.version=a,this.status=n}}class E{static connectWs(){return E.webSocket$||(E.webSocket$=new c.Subject,new WebSocket(`ws://${window.location.host}${E.urlBase}/ws`).onmessage=e=>{let t=JSON.parse(e.data);E.webSocket$.next(t),t.target&&"package"==t.target&&E.package$.next(new y(t)),t.target&&"packageVersion"==t.target&&E.packageVersion$.next(new N(t))},this.package$.pipe((0,l.scan)(((e,t)=>null==t?{}:{...e,[t.assetId]:t}),{})).subscribe((e=>{this.packages$.next(e)})),this.packageVersion$.pipe((0,l.scan)(((e,t)=>null==t?{}:{...e,[`${t.name}#${t.version}`]:t}),{})).subscribe((e=>{this.packageVersions$.next(e)}))),E.webSocket$}static status$(){this.package$.next(void 0),this.packageVersion$.next(void 0);let e=`${E.urlBase}/status`,t=new Request(e,{method:"GET",headers:E.headers});return(0,c.combineLatest)([E.webSocket$.pipe((0,l.take)(1)),R(t)]).pipe((0,l.map)((([e,t])=>t)))}static path$(e){let t=`${E.urlBase}/${e}/path`;return R(new Request(t,{method:"GET",headers:E.headers}))}static remotePath$(e){let t=`${E.urlBase}/${e}/remote-path`;return R(new Request(t,{method:"GET",headers:E.headers}))}static publishLibraryVersion$(e,t){let s=`${E.urlBase}/publish/${e}/${t}`;return R(new Request(s,{method:"POST",headers:E.headers}))}static deleteLibraryVersion$(e,t){let s=`${E.urlBase}/remove/${e}/${t}`;return R(new Request(s,{method:"DELETE",headers:E.headers}))}static syncPackage$(e){let t=`${E.urlBase}/publish/${e}`;return R(new Request(t,{method:"POST",headers:E.headers}))}static syncPackages$(e){let t=`${E.urlBase}/synchronize`;return R(new Request(t,{method:"POST",body:JSON.stringify(e),headers:E.headers}))}static registerAsset(e){let t=`${E.urlBase}/register-asset/${e}`;return R(new Request(t,{method:"POST",headers:E.headers}))}}function R(e,t=(e=>e)){return new c.Observable((s=>{fetch(e).then((e=>e.json())).then((e=>{s.next(t(e)),s.complete()})).catch((e=>s.error(e)))}))}E.urlBase="/admin/upload/packages",E.headers={},E.packages$=new c.BehaviorSubject({}),E.package$=new c.ReplaySubject(1),E.packageVersions$=new c.BehaviorSubject({}),E.packageVersion$=new c.ReplaySubject(1);class D{static setHeaders(e){D.headers=e,o.headers=e,w.headers=e,p.headers=e,g.headers=e,d.headers=e,E.headers=e,h.headers=e,f.headers=e}}D.urlBase="/admin",D.headers={},D.system=w,D.fronts=p,D.backs=o,D.modules=g,D.environment=d,D.uploadPackages=E,D.downloadPackages=h,D.uploadFluxApps=v,D.localCdnPackages=f;var P=s(327);let I="p-2 fv-text-primary h-100 d-flex flex-column h-100";function C(e,t){return new P.Button.View({contentView:()=>({children:[{tag:"i",class:e},{tag:"span",class:"px-2",innerText:t}]}),class:"fv-btn fv-btn-secondary mx-2"})}function V(e,t=!1){let s=new c.BehaviorSubject(t);return{class:"d-flex align-items-top fv-bg-background-alt border rounded ",style:{"font-style":"oblique",width:"fit-content"},children:[{tag:"i",class:(0,i.attr$)(s,(e=>e?"fv-hover-text-primary fv-text-focus":"fv-hover-text-focus fv-text-primary "),{wrapper:e=>e+" fas py-2 px-3 fa-info fv-pointer fv-hover-text-focus "}),onclick:e=>{s.next(!s.getValue()),e.stopPropagation()}},{class:(0,i.attr$)(s,(e=>e?"py-3 pl-1 pr-3":"")),children:[(0,i.child$)(s,(t=>t?e:{}))]}]}}var O,B,A,L,G,j,U,F,M,_=s(888);!function(e){e.INSTALL="INSTALL",e.BUILD="BUILD",e.TEST="TEST",e.CDN="CDN",e.SYNC="SYNC",e.SERVE="SERVE"}(O||(O={})),function(e){e.TARGET_ONLY="TARGET_ONLY",e.ALL_ABOVE="ALL_ABOVE",e.ALL_BELOW="ALL_BELOW",e.ALL="ALL"}(B||(B={})),function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR"}(A||(A={})),function(e){e.STARTED="STARTED",e.PREPARATION="PREPARATION",e.STATUS="STATUS",e.RUNNING="RUNNING",e.PACKAGING="PACKAGING",e.DONE="DONE"}(L||(L={})),function(e){e.INSTALLED="INSTALLED",e.NOT_INSTALLED="NOT_INSTALLED"}(G||(G={})),function(e){e.SYNC="SYNC",e.RED="RED",e.NEVER_BUILT="NEVER_BUILT",e.OUT_OF_DATE="OUT_OF_DATE",e.INDIRECT_OUT_OF_DATE="INDIRECT_OUT_OF_DATE"}(j||(j={})),function(e){e.GREEN="GREEN",e.OUT_OF_DATE="OUT_OF_DATE",e.INDIRECT_OUT_OF_DATE="OUT_OF_DATE",e.RED="RED",e.NO_ENTRY="NO_ENTRY"}(U||(U={})),function(e){e.SYNC="SYNC",e.NOT_PUBLISHED="NOT_PUBLISHED",e.OUT_OF_DATE="OUT_OF_DATE",e.CDN_ERROR="CDN_ERROR"}(F||(F={})),function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR"}(M||(M={}));class q{constructor({action:e,step:t,target:s,content:a,level:n,json:r,contextId:i}){this.contextId=void 0,this.children=[],this.action=e,this.step=t,this.target=s,this.content=a,this.level=n,this.json=r,this.contextId=i}}class W{constructor(e){this.logs$=e,this.ongoingTasks$={}}}class Y extends _.ImmutableTree.Node{constructor({name:e,data:t}){super({id:`${Math.floor(1e6*Math.random())}`,children:Y.getChildren(t)}),this.name=e,this.data=t}static getChildren(e){return null!=e&&null!=e&&"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e?(0,c.of)(Object.entries(e).map((([e,t])=>new Y({name:e,data:t})))):void 0}}let z={[L.STATUS]:"fas fa-info",[L.STARTED]:"fas fa-play",[L.PREPARATION]:"fas fa-running",[L.RUNNING]:"fas fa-running",[L.PACKAGING]:"fas fa-archive",[L.DONE]:"far fa-flag"};class H{constructor(e){this.state=e,this.class="h-25 d-flex flex-column",this.children=[this.header(),this.content()]}header(){return{tag:"hr",class:"fv-color-primary w-100"}}content(){return{class:" fv-bg-background-alt flex-grow-1 overflow-auto d-flex flex-column",children:(0,i.childrenAppendOnly$)(this.state.logs$.pipe((0,l.map)((e=>[new q(e)])),(0,l.filter)((([e])=>e.level!=M.DEBUG&&null!=e.step))),(e=>this.messageView(e)),{sideEffects:e=>e.scrollTop=e.scrollHeight})}}messageView(e){let t=e.json?this.jsonView(e.json):{};return{class:"d-flex align-items-center my-1 "+(e.level==M.ERROR?"fv-text-error fv-bg-on-error":"fv-text-primary"),children:[{class:"px-1 "+z[e.step],tag:"i"},{class:"px-2",tag:"i",innerText:e.action},,{class:"px-2",tag:"i",innerText:e.target},{class:"px-2 d-flex align-items-center",children:[{class:"mx-2",innerHTML:e.content},t]}]}}jsonView(e){let t=new Y({name:"data",data:e}),s=new _.ImmutableTree.State({rootNode:t});return new _.ImmutableTree.View({state:s,headerView:(e,t)=>{let s={innerText:t.name};return t.children?s:{class:"d-flex align-items-baseline",children:[s,{tag:"i",class:"px-2",innerText:t.data}]}}})}}var J=s(337);class Q extends J.Modal.State{constructor(e){super(),this.environment=e,this.startingFolder=e.configurationPath.slice(0,-1)}}function K(e){console.log(e);let t=new Q(e),s=new J.Modal.View({state:t,contentView:X}),a=(0,i.render)(s);document.querySelector("body").appendChild(a),t.ok$.subscribe((()=>a.remove())),t.cancel$.subscribe((()=>a.remove()))}function X(e){let t=new c.BehaviorSubject(e.startingFolder),s=t.pipe((0,l.mergeMap)((e=>D.system.folderContent$(e))));return{class:"fv-bg-background fv-text-primary border rounded p-4",style:{width:"50vw",height:"50vh",overflow:"auto"},children:[{class:"d-flex",children:(0,i.children$)(t,(e=>e.map((e=>function(e,t){let s=e.getValue().indexOf(t);return{class:"px-2 fv-pointer fv-hover-bg-background-alt border rounded mx-2",innerText:t,onclick:()=>e.next(e.getValue().slice(0,s+1))}}(t,e)))))},{class:"my-4",children:(0,i.children$)(s,(({configurations:s,files:a,folders:n})=>{let r=s.map((s=>function(e,t,s,a){let n=e.getValue();return{class:"fv-pointer d-flex  align-items-center fv-hover-bg-background-alt fv-text-focus",style:{"font-weight":JSON.stringify(n.concat(t))===JSON.stringify(s)?"bolder":"inherit"},children:[{class:"fas fa-file px-2"},{innerText:t}],onclick:s=>{a.next(s),ue.switchConfiguration([...e.getValue(),t])}}}(t,s,e.environment.configurationPath,e.ok$))),i=a.map((e=>function(e){return{class:"d-flex  align-items-center fv-text-disabled",style:{"user-select":"none"},children:[{class:"fas fa-file px-2"},{innerText:e}]}}(e)));return[...r,...n.map((e=>function(e,t){return{class:"fv-pointer d-flex align-items-center fv-hover-bg-background-alt",children:[{class:"fas fa-folder px-2"},{innerText:t,onclick:()=>e.next(e.getValue().concat(t))}]}}(t,e))),...i]}))}]}}function Z(e){return{class:"fv-text-focus fv-pointer",innerText:e.configurationPath.slice(1).join("/"),style:{"font-size":"large"},onclick:()=>K(e)}}var ee,te=s(313);class se extends J.ExpandableGroup.State{constructor(e){super("User info"),this.environment=e}}function ae(e){return{className:J.ExpandableGroup.defaultHeaderClass,children:[{tag:"i",className:(0,i.attr$)(e.expanded$,(e=>e?"fa-caret-down":"fa-caret-right"),{wrapper:e=>"px-2 fas "+e})},{tag:"i",class:"fas fa-users"},{innerText:"User info",class:"px-2",style:{"font-size":"large"}},{class:"fv-text-focus px-2",children:[{innerText:`Logged as ${e.environment.userInfo.name}`}]}]}}function ne(){let e=new J.Modal.State,t=C("","Sign-in"),s=new c.Subject,a=new c.Subject,n=new J.Modal.View({state:e,contentView:()=>({class:"fv-text-primary fv-bg-background-alt p-4 rounded border fv-color-primary",style:{"max-width":"500px"},children:[{class:"d-flex align-items-baseline py-2 text-center mx-auto justify-content-center",children:[{tag:"h4",class:"text-center fv-text-focus",innerText:"Synchronize with remote user"}]},{tag:"hr",class:"fv-color-primary"},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-info-circle fa-2x px-3"},{tag:"div",innerHTML:"Provide the email adress and password of the user for which you want to synchronize the profile.  Please make sure your internet connection is turned on."}]},{tag:"hr",class:"fv-color-primary"},{class:"d-flex align-items-baseline w-100",children:[{tag:"i",class:"fas fa-at px-3"},{tag:"input",type:"text",class:"flex-grow-1",onchange:e=>s.next(e.target.value)}]},{class:"d-flex align-items-baseline w-100 my-2",children:[{tag:"i",class:"fas fa-key px-3"},{tag:"input",type:"password",class:"flex-grow-1",onchange:e=>a.next(e.target.value)}]},{class:"pt-3",children:[t]}]})}),r=(0,i.render)(n);document.body.appendChild(r),e.cancel$.subscribe((()=>r.remove())),t.state.click$.pipe((0,l.withLatestFrom)((0,c.combineLatest)([s,a])),(0,l.mergeMap)((([e,[t,s]])=>D.environment.syncUser$({email:t,password:s,remoteEnvironment:"dev.platform.youwol.com"})))).subscribe((e=>{console.log(e),r.remove()}),(e=>r.remove()))}class re extends J.ExpandableGroup.State{constructor(e){super("User info"),this.environment=e}}function ie(e){return{className:J.ExpandableGroup.defaultHeaderClass,children:[{tag:"i",className:(0,i.attr$)(e.expanded$,(e=>e?"fa-caret-down":"fa-caret-right"),{wrapper:e=>"px-2 fas "+e})},{tag:"i",class:"fas fa-cog"},{innerText:"Configuration parameters",class:"px-2",style:{"font-size":"large"}}]}}class ce extends J.ExpandableGroup.State{constructor(e){super("Remote info"),this.gatewayInfo=e}}function le(e){return{className:J.ExpandableGroup.defaultHeaderClass,children:[{tag:"i",className:(0,i.attr$)(e.expanded$,(e=>e?"fa-caret-down":"fa-caret-right"),{wrapper:e=>"px-2 fas "+e})},{tag:"i",class:"fas fa-wifi "+(e.gatewayInfo.connected?"fv-text-success":"fv-text-error")},{innerText:"Remote info",class:"px-2",style:{"font-size":"large"}},{class:"fv-text-focus px-2",children:[{innerText:e.gatewayInfo.name}]}]}}class oe extends J.ExpandableGroup.State{constructor(e){super("YouWol updates",oe.isExpanded(e)),this.availableUpdates=e}static isExpanded(e){return e.status!=a.PENDING&&!e.components.reduce(((e,t)=>e&&t.latestVersion==t.localVersion),!0)}}function de(e){let t={[a.PENDING]:{class:"fas fa-spinner fa-spin"},[a.OUTDATED]:{class:"fas fa-exclamation fv-text-focus"},[a.SYNC]:{class:"fas fa-check fv-text-success"}};return{className:J.ExpandableGroup.defaultHeaderClass,children:[{tag:"i",className:(0,i.attr$)(e.expanded$,(e=>e?"fa-caret-down":"fa-caret-right"),{wrapper:e=>"px-2 fas "+e})},t[e.availableUpdates.status],{innerText:e.name,class:"px-2",style:{"font-size":"large"}}]}}class ue{constructor(){}static subscribe(){return ue.webSocket$.pipe((0,l.take)(1),(0,l.mergeMap)((()=>D.environment.status$()))).subscribe((e=>ue.cacheConfigurationPath(e.configurationPath)))}static switchConfiguration(e){D.environment.switchConfiguration$({path:e}).subscribe()}static getCachedConfigurationPaths(){return JSON.parse(localStorage.getItem("youwol-local-dashboard")||"{}").configurationPaths||[]}static cacheConfigurationPath(e){let t=ue.getCachedConfigurationPaths();if(t.includes(e))return;t=t.filter((t=>t!=e)).concat([e]);let s={configurationPaths:t};localStorage.setItem("youwol-local-dashboard",JSON.stringify(s)),ue.configurationPaths$.next(t)}syncComponent(e){D.environment.triggerSyncComponent({name:e.name,version:e.latestVersion})}}ue.webSocket$=D.environment.connectWs(),ue.environment$=ue.webSocket$.pipe((0,l.filter)((e=>"Environment"==e.type))),ue.loadingStatus$=ue.webSocket$.pipe((0,l.filter)((e=>"LoadingStatus"==e.type))),ue.configurationUpdated$=ue.webSocket$.pipe((0,l.filter)((e=>"ConfigurationUpdated"==e.type))),ue.componentsUpdates$=D.environment.componentsUpdates$,ue.configurationPaths$=new c.BehaviorSubject(ue.getCachedConfigurationPaths());class he{constructor(e){this.tag="div",this.class=I,this.state=e;let t=new W(ue.webSocket$.pipe((0,l.map)((e=>e))));D.environment.triggerAvailableUpdates(),this.children=[{class:"flex-grow-1",children:[(0,i.child$)(ue.environment$,(e=>{return{class:"flex-grow-1",children:[{class:"d-flex align-items-center",children:[{class:"p-2",style:{"font-size":"large"},innerText:"configuration:"},Z(t=e),{class:"fv-pointer mx-3 fas fa-folder-open border rounded p-2 fv-hover-bg-background-alt",onclick:()=>K(t)}]}]};var t})),(0,i.child$)(ue.environment$,(e=>{return t=e,new J.ExpandableGroup.View({state:new re(t),headerView:ie,contentView:e=>{return{class:"border rounded fv-color-primary p-2",children:[V({innerText:"These parameters are those declared in your configuration file. They can control behaviors of the different pipelines.\n                Refer to the configuration file for more information on the meaning of these parameters.\n                "}),(s=t.configurationParameters.parameters,{class:"my-2",children:Object.entries(s).map((([e,t])=>{let s={};return"ENUM"==t.meta.type&&(s=function(e,t){let s=t.meta.values.map((e=>new te.Select.ItemData(e,e))),a=new te.Select.State(s,t.value);return a.selectionId$.pipe((0,l.filter)((e=>e!=t.value)),(0,l.mergeMap)((t=>D.environment.postConfigParameters$({values:{[e]:t}})))).subscribe((()=>{})),new te.Select.View({state:a})}(e,t)),{class:"border rounded p-2",children:[{class:"d-flex align-items-center",children:[{class:"px-2 fv-text-focus",innerText:t.name+":"},s]},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-info-circle px-3"},{innerText:t.description}]}]}}))})]};var s},className:"my-2"});var t})),(0,i.child$)(ue.environment$,(e=>function(e){let t=e.users.map((e=>new te.Select.ItemData(e,e))),s=new c.BehaviorSubject(e.userInfo.email),a=new te.Select.State(t,s);a.selectionId$.pipe((0,l.skip)(1),(0,l.distinctUntilChanged)(),(0,l.mergeMap)((e=>D.environment.login$({email:e})))).subscribe((()=>{}));let n=C("fas fa-plus","sync. user");return n.state.click$.subscribe((()=>ne())),new J.ExpandableGroup.View({state:new se(e),headerView:ae,contentView:t=>({class:"border rounded fv-color-primary p-2",children:[V({tag:"ul",innerText:"To better work with local YouWol it is preferable to sync your user info with your remotes account.\n                It is required when:\n                ",children:[{tag:"li",innerText:"When pushing or pulling data"}]}),{class:"d-flex align-items-center",children:[{innerText:"Current user:"},new te.Select.View({state:a,class:"mx-2"}),n]},{children:[{tag:"ul",innerText:"Member of:",children:e.userInfo.memberOf.map((e=>({tag:"li",class:"",innerText:e})))}]}]}),className:"my-2"})}(e))),(0,i.child$)(ue.environment$,(e=>function(e){let t=e.remotesInfo.map((({host:e})=>new te.Select.ItemData(e,e))),s=new c.BehaviorSubject(e.remoteGatewayInfo.host),a=new te.Select.State(t,s);return a.selectionId$.pipe((0,l.skip)(1),(0,l.distinctUntilChanged)(),(0,l.mergeMap)((e=>D.environment.selectRemoteGateway$({name:e})))).subscribe((()=>{})),new J.ExpandableGroup.View({state:new ce(e.remoteGatewayInfo),headerView:le,contentView:t=>({class:"border rounded fv-color-primary p-2",children:[V({innerText:"The remote environment with which you want to synchronize your work."}),{class:"d-flex align-items-center",children:[{innerText:"Current environment:"},new te.Select.View({state:a,class:"mx-2"})]},{tag:"ul",innerText:"Info",children:[{tag:"li",innerText:"name: "+e.remoteGatewayInfo.name},{tag:"li",innerText:"host: "+e.remoteGatewayInfo.host},{tag:"li",innerText:"connected: "+e.remoteGatewayInfo.connected}]}]}),className:"my-2"})}(e))),(0,i.child$)(ue.componentsUpdates$,(t=>function(e,t){let s={tag:"table",class:"fv-color-primary  w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:"Local version"},{tag:"td",innerText:"Latest version"},{tag:"td",innerText:""}]}]},{tag:"tbody",children:t.components.map((t=>({tag:"tr",class:"fv-hover-bg-background-alt",children:[{tag:"td",innerText:t.name},{tag:"td",innerText:t.localVersion},{tag:"td",innerText:t.latestVersion},{tag:"td",children:[t.localVersion==t.latestVersion?{}:{class:"fas fa-sync fv-text-focus fv-pointer",onclick:()=>{e.syncComponent(t)}}]}]})))}]};return new J.ExpandableGroup.View({state:new oe(t),headerView:de,contentView:e=>({class:"border rounded fv-color-primary p-2",children:[V({innerText:"The updates available."}),t.status==a.PENDING?{class:"fas fa-spinner fa-spin"}:s]}),className:"my-2"})}(e,t)))]},new H(t)],this.connectedCallback=e=>{e.subscriptions.push(ue.subscribe())}}}!function(e){e.ConfigurationGeneral="conf.general",e.ConfigurationRawFile="conf.raw-file",e.LocalEnvPackage="local.packages",e.LocalEnvFronts="local.fronts",e.LocalEnvBacks="local.backs",e.LocalEnvCDN="local.cdn",e.AssetsUploadPackages="upload.packages",e.AssetsUploadFluxApps="upload.fluxapps",e.AssetsUploadData="upload.fluxdata",e.AssetsUploadPackage="upload.AssetsUploadPackage",e.AssetsDownloadPackages="download.packages"}(ee||(ee={}));let pe={[ee.ConfigurationGeneral]:{title:"General",enabled:!0},[ee.ConfigurationRawFile]:{title:"Raw file",enabled:!0},[ee.LocalEnvPackage]:{title:"Packages",enabled:!0},[ee.LocalEnvFronts]:{title:"Front Ends",enabled:!0},[ee.LocalEnvBacks]:{title:"Back Ends",enabled:!0},[ee.LocalEnvCDN]:{title:"CDN",enabled:!0},[ee.AssetsUploadPackages]:{title:"Packages",enabled:!0},[ee.AssetsUploadFluxApps]:{title:"Flux app",enabled:!0},[ee.AssetsUploadData]:{title:"Data",enabled:!1},[ee.AssetsDownloadPackages]:{title:"Packages",enabled:!0}};function fe(e,t,s,a=!0){return{class:(0,i.attr$)(s,(e=>e?"fv-text-focus":""),{wrapper:e=>e+"  d-flex align-items-center fa-2x "+(a?"fv-pointer":"")}),children:[{tag:"i",class:t+" pr-3"},{tag:"h4",innerText:e,style:{"user-select":"none"}}]}}function ge(e,t){return{tag:"ul",children:(0,i.children$)(e,(e=>e.map((e=>function(e,t){let s=pe[e].enabled;return{tag:"li",innerText:pe[e].title,class:(0,i.attr$)(t,(t=>t==e?"fv-text-focus":s?"fv-pointer":"fv-text-background-alt")),style:{"user-select":"none"},onclick:a=>{s&&t.next(e),a.stopPropagation()}}}(e,t)))))}}function we(e,t,s,a,n=!0){return{class:"my-2 "+(n?"":"fv-text-disabled"),children:[fe(e,t,a.pipe((0,l.mergeMap)((e=>s.pipe((0,l.map)((t=>t.includes(e))))))),n),ge(s,a)]}}class be extends J.Modal.State{constructor(e){super(),this.error=e}}function me(e){let t=new J.ExpandableGroup.State("trace"),s=new J.ExpandableGroup.View({state:t,headerView:J.ExpandableGroup.defaultHeaderView,contentView:()=>({children:e.error.trace.map((e=>({innerText:e})))})});return{class:"fv-color-focus rounded fv-bg-background fv-text-primary d-flex flex-column p-4",children:[{tag:"h2",class:"text-center w-100 py-2 fv-text-error",innerText:"System error"},{class:"text-center w-100 py-2",innerText:"Details: "+e.error.details},s]}}var xe=s(690),$e=s(444),ve=s(71);class Se extends ve.ModuleExplorer.Node{constructor({id:e,name:t,basePath:s}){super({id:e,name:t,children:Se.groups$(s),events$:Se.events$}),this.basePath=s}static groups$(e){return new $e.AssetsGatewayClient({basePath:e}).getGroups(Se.events$).pipe((0,l.map)((({groups:t})=>t.map((t=>new ke({group:t,basePath:e}))))))}}Se.events$=new c.ReplaySubject;class ke extends ve.ModuleExplorer.Node{constructor({group:e,basePath:t}){super({id:e.id,name:e.path,children:ke.drives$(e.id,t),events$:ke.events$.pipe((0,l.filter)((t=>t.targetId==e.id)))}),this.group=e,this.name=e.path,this.basePath=t}static drives$(e,t){let s=new $e.AssetsGatewayClient({basePath:t});return s.getDrives(e,ke.events$).pipe((0,l.map)((({drives:e})=>e.map((({driveId:e,name:t})=>{let a=new $e.Drive(e,t,s);return new ve.ModuleExplorer.DriveNode({drive:a})})))))}}ke.events$=new c.ReplaySubject;let Te={"PackageStatus.NOT_FOUND":"far fa-circle fv-text-disabled","PackageStatus.MISMATCH":"fas fa-exclamation fv-text-focus","PackageStatus.SYNC":"fas fa-check fv-text-success","PackageStatus.PROCESSING":"fas fa-spinner fa-spin"};class ye{constructor(){this.fetchDependenciesLatest$=new c.BehaviorSubject(!0),this.options$=(0,c.combineLatest)([this.fetchDependenciesLatest$]).pipe((0,l.map)((([e])=>({fetchDependenciesLatest:e})))),this.webSocket$=D.downloadPackages.connectWs(),this.logsState=new W(this.webSocket$.pipe((0,l.map)((e=>e)))),this.selectedNode$=new c.ReplaySubject,this.queuedToDownload$=D.downloadPackages.downloadItems$.pipe((0,l.map)((e=>Object.values(e)))),this.toggled$=new c.BehaviorSubject([]),this.selectedNode$.pipe((0,l.filter)((e=>e instanceof ve.ModuleExplorer.FileNode&&e.file instanceof $e.File&&"package"==e.file.metadata.kind)),(0,l.map)((e=>e.file)),(0,l.mergeMap)((e=>D.downloadPackages.packageInfo$(e.metadata.rawId)))).subscribe()}subscribe(){return D.uploadPackages.status$().subscribe(),[D.downloadPackages.downloadItems$.subscribe((e=>{let t=Object.values(e).filter((e=>e.status!=r.SYNC)).map((e=>e.name));this.toggled$.next(t)}))]}toggle(e){let t=this.toggled$.getValue().includes(e)?this.toggled$.getValue().filter((t=>t!=e)):this.toggled$.getValue().concat([e]);this.toggled$.next(t)}synchronize(){(0,c.combineLatest)([this.queuedToDownload$,this.toggled$]).pipe((0,l.take)(1),(0,l.mergeMap)((([e,t])=>{let s=e.filter((e=>t.includes(e.name)));return D.downloadPackages.download$({packages:s})}))).subscribe()}}class Ne{constructor(e){this.tag="div",this.class="fv-text-primary h-100 d-flex flex-column h-100 fv-bg-background-alt",this.state=e,this.children=[{class:"h-75 d-flex flex-column w-100 fv-bg-background py-3",children:[this.headerView(),this.contentView()]},new H(e.logsState)],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}headerView(){let e=new J.ExpandableGroup.State("options",!1),t=(e,t)=>{let s=new P.Switch.State(e);return{class:"d-flex align-items-center ",children:[{innerText:t,class:(0,i.attr$)(s.value$,(e=>e?"fv-text-focus":""),{wrapper:e=>e+" px-2"})},new P.Switch.View({state:s})]}};return new J.ExpandableGroup.View({state:e,class:"mx-3 mb-3",headerView:J.ExpandableGroup.defaultHeaderView,contentView:()=>({class:"d-flex w-100 justify-content-around align-items-center border rounded ",children:[t(this.state.fetchDependenciesLatest$,"fetch dependencies @ latest")]})})}contentView(){return{class:"h-100 flex-grow-1",style:{"min-height":"0px"},children:[{class:"d-flex w-100 h-100 justify-content-around",children:[(0,i.child$)(D.downloadPackages.status$(),(()=>function(e){let t=new _.ImmutableTree.State({rootNode:new Se({id:"root",name:"groups",basePath:"/remote/api/assets-gateway"}),selectedNode:e.selectedNode$});return{class:"d-flex h-100 flex-column",children:[{innerText:"Remote workspace"},new _.ImmutableTree.View({state:t,headerView:Ee,connectedCallback:t=>{t.subscriptions.push(e.selectedNode$.subscribe((e=>{console.log("Node selected",e)})))},class:"fv-bg-background fv-text-primary flex-grow-1 overflow-auto",style:{"min-height":"0"}})]}}(this.state)),{untilFirst:{class:"fas fa-spinner fa-spin"}}),(e=this.state,{class:"d-flex h-100 flex-column",children:[{innerText:"Download queue"},{tag:"table",class:"w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name",class:"px-3"},{tag:"td",innerText:"Version",class:"px-3"},{tag:"td",innerText:"Status",class:"px-3"},{tag:"td",innerText:"Queued?",class:"px-3"}]}]},{tag:"tbody",children:(0,i.childrenWithReplace$)(e.queuedToDownload$,(t=>(t=>({tag:"tr",class:"fv-pointer fv-hover-bg-background-alt ",children:[{tag:"td",innerText:t.name},{tag:"td",innerText:t.version},{tag:"td",children:[{class:Te[t.status]}]},{tag:"input",type:"checkbox",checked:(0,i.attr$)(e.toggled$,(e=>e.includes(t.name))),onclick:()=>e.toggle(t.name)}]}))(t)),{})}]},(0,i.child$)(e.toggled$,(t=>(t=>{let s={};if(0==t.length)s={innerText:"No items selected for synchronization",class:"fv-text-focus"};else{let a=C("fas fa-sync",`Sync. (${t.length})`);a.state.click$.subscribe((t=>e.synchronize())),s=a}return{class:"w-100",children:[{class:" border fv-color-primary"},{class:"m-3",children:[s]}]}})(t)))]})]}]};var e}}function Ee(e,t){let s=[{target:e=>e instanceof ve.ModuleExplorer.FileNode&&"package"==e.file.metadata.kind,classes:"d-flex align-items-center fv-pointer",icon:"fas fa-cloud-download-alt"},{target:e=>e instanceof ve.ModuleExplorer.FileNode,classes:"d-flex align-items-center fv-pointer fv-text-disabled"},{target:e=>e instanceof ke&&e.id.includes("private"),icon:"fas fa-user"},{target:e=>e instanceof Se||e instanceof ke&&!e.id.includes("private"),icon:"fas fa-users"}];return ve.ModuleExplorer.headerView(e,t,s)}class Re extends xe.Tabs.TabData{constructor(){super("Packages","Packages"),this.packagesState=new ye}view(){return new Ne(this.packagesState)}}class De extends xe.Tabs.State{constructor(e){super([new Re])}}class Pe{constructor(e){this.selectedPanel$=e}}class Ie{constructor(e){this.tag="div",this.class="p-2 h-100 flex-grow-1";let t=new De(e);this.children=[new xe.Tabs.View({class:"d-flex flex-column h-100",state:t,headerView:Ce,contentView:(e,t)=>t.view()})],this.connectedCallback=e=>{}}}function Ce(e,t){return{innerText:t.name,class:"px-2"}}function Ve(e){let t=new J.ExpandableGroup.State("Explorer",!1);return new J.ExpandableGroup.View({state:t,headerView:Be,contentView:t=>({class:"my-2 h-100 w-100",style:{"white-space":"nowrap"},children:[{class:"d-flex justify-content-around",children:[{innerText:"Local reference"},{innerText:"Remote reference"}]},{class:"d-flex justify-content-around",children:[{class:"w-50 d-flex justify-content-center",children:[(0,i.child$)(D.uploadPackages.path$(e.treeItems[0].itemId),(e=>Le(e)))]},{class:"w-50  d-flex justify-content-center",children:[(0,i.child$)(D.environment.environments$.pipe((0,l.mergeMap)((()=>D.uploadPackages.remotePath$(e.assetId)))),(e=>e.group&&e.drive&&e.folders?Le(e):{class:"fas fa-times fv-text-error"}),{untilFirst:{class:"fas fa-spinner fa-spin fv-text-primary mx-auto my-auto"}})]}]}]}),class:"mb-3"})}function Oe(e){let t=new J.ExpandableGroup.State("CDN versions",!0);return new J.ExpandableGroup.View({state:t,headerView:Be,contentView:()=>({class:"d-flex justify-content-center",children:[Ge(e)]}),class:"mb-3"})}function Be(e){return J.ExpandableGroup.defaultHeaderView(e)}function Ae(e){return{class:"d-flex justify-content-center align-items-center ",children:[{tag:"h3",class:"text-center my-2",innerText:e.name}]}}function Le({group:e,drive:t,folders:s}){return{class:"border rounded fv-color-primary p-2 mx-2",style:{width:"fit-content"},children:[{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-users px-2"},{innerText:e}]},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-hdd px-2"},{innerText:t.name}]},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-folder px-2"},{innerText:s.reduce(((e,t)=>e+" / "+t.name),"")}]}]}}function Ge(e){let t=D.uploadPackages.packageVersions$.pipe((0,l.map)((e=>Object.values(e))),(0,l.map)((t=>t.filter((({name:t})=>t==e.name)))));return{tag:"table",class:"fv-color-primary text-center my-3",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Local versions",class:"px-3"},{tag:"td",innerText:"Published versions",class:"px-3"},{tag:"td",innerText:"",class:"px-3"},{tag:"td",innerText:"",class:"px-3"}]}]},(0,i.child$)(t,(t=>({tag:"tbody",children:t.map((({assetId:t,name:s,version:a,status:n})=>({tag:"tr",class:"fv-hover-bg-background-alt",children:[{tag:"td",innerText:a,class:"px-3"},{tag:"td",class:"px-3",children:[{tag:"i",class:Te[n]}]},Ue(e,a),Fe(e,a)]})))})))]}}function je(e,t){return{tag:"td",class:"mx-2",children:[{tag:"i",class:`fas ${t} fv-hover-text-focus p-2 fv-pointer`,onclick:e},{}]}}function Ue(e,t){return je((()=>D.uploadPackages.publishLibraryVersion$(e.assetId,t).subscribe()),"fa-cloud-upload-alt")}function Fe(e,t){return je((()=>{confirm(`Are you sure you want to remove ${e.name}/${t} from local & deployed CDN`)&&D.uploadPackages.deleteLibraryVersion$(e.assetId,t).pipe((0,l.mergeMap)((()=>D.uploadPackages.status$()))).subscribe()}),"fa-trash fv-text-error ml-4")}function Me(e,t,s){return{tag:"table",class:"w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name",class:"px-3"},{tag:"td",innerText:"Version",class:"px-3"},{tag:"td",innerText:"Status",class:"px-3"},{tag:"td",innerText:"Queued?",class:"px-3"}]}]},{tag:"tbody",children:e.map((({assetId:e,name:a,version:n,status:c})=>{let l="fv-pointer fv-hover-bg-background-alt ";return(!t.showSynced&&c==r.SYNC||!t.showNext&&n.includes("-next"))&&(l+="d-none"),{tag:"tr",class:l,children:[{tag:"td",innerText:a},{tag:"td",innerText:n},{tag:"td",children:[{class:Te[c]}]},{tag:"input",type:"checkbox",checked:(0,i.attr$)(s.isToggled$(e,n),(e=>e)),onclick:()=>s.toggleSync(e,n)}]}}))}]}}function _e(e,t){let s="";return e.status instanceof T&&(s="fas fa-spinner fa-spin"),e.status instanceof k&&(s=Te[e.status.cdnStatus]),{tag:"td",children:[{class:s}]}}function qe(e,t){let s="",a={};return e.status instanceof T&&(s="fas fa-spinner fa-spin"),e.status instanceof k&&(s=Te[e.status.treeStatus],e.status.treeStatus!=r.SYNC&&(a={class:"fas fa-cloud-upload-alt fv-hover-text-focus fv-pointer",onclick:t=>{D.uploadPackages.registerAsset(e.assetId).subscribe(),t.stopPropagation()}})),{tag:"td",class:"d-flex align-items-center justify-content-around my-auto",children:[{class:s},a]}}class We{constructor(e){this.appState=e,this.showSynced$=new c.BehaviorSubject(!1),this.showNext$=new c.BehaviorSubject(!1),this.options$=(0,c.combineLatest)([this.showSynced$,this.showNext$]).pipe((0,l.map)((([e,t])=>({showSynced:e,showNext:t})))),this.webSocket$=D.uploadPackages.connectWs(),this.syncQueued$=new c.BehaviorSubject(new Set),this.underSynchronization$=new c.BehaviorSubject(new Set),this.logsState=new W(this.webSocket$.pipe((0,l.map)((e=>e))))}subscribe(){return D.uploadPackages.status$().subscribe(),[]}toggleSync(e,t){let s=e+"#"+t,a=this.syncQueued$.getValue();a.has(s)?a.delete(s):a.add(s),this.syncQueued$.next(a)}isToggled$(e,t){let s=e+"#"+t;return this.syncQueued$.pipe((0,l.map)((e=>e.has(s))))}synchronize(){let e={assetIds:Array.from(this.syncQueued$.getValue()).map((e=>({assetId:e.split("#")[0],version:e.split("#")[1]})))};D.uploadPackages.syncPackages$(e).subscribe()}}class Ye{constructor(e){this.tag="div",this.class="fv-text-primary h-100 d-flex flex-column h-100 fv-bg-background-alt",this.selected$=new c.ReplaySubject,this.state=e,this.children=[{class:"h-75 d-flex flex-column w-100 fv-bg-background py-3",children:[this.headerView(),this.contentView()]},new H(e.logsState)],this.selected$.subscribe((e=>{console.log(e),this.state.appState.addTabUpload(e)}))}headerView(){let e=new J.ExpandableGroup.State("options",!1),t=(e,t)=>{let s=new P.Switch.State(e);return{class:"d-flex align-items-center ",children:[{innerText:t,class:(0,i.attr$)(s.value$,(e=>e?"fv-text-focus":""),{wrapper:e=>e+" px-2"})},new P.Switch.View({state:s})]}};return new J.ExpandableGroup.View({state:e,class:"mx-3 mb-3",headerView:J.ExpandableGroup.defaultHeaderView,contentView:()=>({class:"d-flex w-100 justify-content-around align-items-center border rounded ",children:[t(this.state.showSynced$,"display synced items"),t(this.state.showNext$,"display '-next' items")]})})}contentView(){return{class:"h-100 flex-grow-1",style:{"min-height":"0px"},children:[{class:"d-flex w-100 h-100 justify-content-around",children:[(0,i.child$)((0,c.combineLatest)([D.uploadPackages.packages$,this.state.options$]),(([e,t])=>function(e,t,s,a){return{class:"h-100 d-flex flex-column",children:[{class:"overflow-auto fv-color-primary border",children:[{tag:"table",class:" w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name",class:"px-3"},{tag:"td",innerText:"CDN",class:"px-3"},{tag:"td",innerText:"Asset",class:"px-3"}]}]},{tag:"tbody",children:e.map((e=>{let a="fv-pointer fv-hover-bg-background-alt ";return e.status instanceof k&&!t.showSynced&&e.status.cdnStatus==r.SYNC&&e.status.treeStatus==r.SYNC&&(a+="d-none"),{tag:"tr",class:a,children:[{tag:"td",innerText:e.name,class:"px-3"},_e(e),qe(e)],onclick:()=>s.next(e)}}))}]}]}]}}(Object.values(e),t,this.selected$,this.state))),(0,i.child$)((0,c.combineLatest)([D.uploadPackages.packageVersions$,this.state.options$]),(([e,t])=>function(e,t,s){return{class:"d-flex flex-column border fv-color-primary",style:{height:"fit-content","max-height":"100%"},children:[{class:"overflow-auto",children:[Me(e,t,s)]},{class:"d-flex align-items-baseline",children:[(0,i.child$)(s.syncQueued$,(e=>function(e,t){let s={};if(0==e.size)s={innerText:"No items selected for synchronization",class:"fv-text-focus"};else{let a=C("fas fa-sync",`Sync. (${e.size})`);a.state.click$.subscribe((e=>t.synchronize())),s=a}return{class:"w-100",children:[{class:" border fv-color-primary"},{class:"m-3",children:[s]}]}}(e,s)))]}]}}(Object.values(e),t,this.state)))]}]}}}class ze{constructor(e){this.appState=e,this.webSocket$=D.uploadFluxApps.connectWs(),this.syncQueued$=new c.BehaviorSubject(new Set),this.underSynchronization$=new c.BehaviorSubject(new Set),this.logsState=new W(this.webSocket$.pipe((0,l.map)((e=>e))))}subscribe(){return[]}}class He{constructor(e){this.tag="div",this.class="fv-text-primary h-100 d-flex flex-column h-100 fv-bg-background-alt",this.selected$=new c.ReplaySubject,this.state=e,this.children=[{class:"h-75 d-flex flex-column w-100 fv-bg-background py-3",children:[this.contentView()]},new H(e.logsState)],this.selected$.subscribe((e=>{console.log(e),this.state.appState.addTabUpload(e)}))}contentView(){return{class:"h-100 flex-grow-1",style:{"min-height":"0px"},children:[{class:"d-flex w-100 h-100 justify-content-around",children:[Qe(this.state)]}]}}}class Je extends _.ImmutableTree.State{constructor({rootNode:e,status$:t,expandedNodes:s}){super({rootNode:e,expandedNodes:s}),this.status$=t}}function Qe(e){let t=new Je({rootNode:new Se({id:"root",name:"groups",basePath:"/api/assets-gateway"}),status$:e.webSocket$.pipe((0,l.filter)((e=>e.assetId&&e.status))),expandedNodes:["root"]});return{class:"d-flex h-100 flex-column",children:[{innerText:"Remote workspace"},new _.ImmutableTree.View({state:t,headerView:Ke,class:"fv-bg-background fv-text-primary flex-grow-1 overflow-auto",style:{"min-height":"0"}})]}}function Ke(e,t){let s=[{target:e=>e instanceof ve.ModuleExplorer.FileNode&&"package"==e.file.metadata.kind,classes:"d-flex align-items-center fv-pointer",icon:"fas fa-cloud-download-alt"},{target:e=>e instanceof ve.ModuleExplorer.FileNode,classes:"d-flex align-items-center fv-pointer fv-text-disabled"},{target:e=>e instanceof ke&&e.id.includes("private"),icon:"fas fa-user"},{target:e=>e instanceof Se||e instanceof ke&&!e.id.includes("private"),icon:"fas fa-users"}];return t instanceof ve.ModuleExplorer.FileNode&&t.file.metadata&&"flux-project"==t.file.metadata.kind?{class:"d-flex align-items-center",children:[{innerText:t.name},{onclick:()=>D.uploadFluxApps.publish$(t.id).subscribe(),class:"fas fa-cloud-upload-alt fv-hover-text-focus mx-2 fv-pointer"},(0,i.child$)(e.status$.pipe((0,l.filter)((e=>e.assetId==t.id))),(({status:e})=>e==n.PROCESSING?{class:"fas fa-spinner fa-spin fv-text-focus"}:{}))]}:ve.ModuleExplorer.headerView(e,t,s)}class Xe extends xe.Tabs.TabData{constructor(e){super(ee.AssetsUploadPackages,"Packages"),this.packagesState=e}view(){return new Ye(this.packagesState)}}class Ze extends xe.Tabs.TabData{constructor(e,t){super(e.name,e.name),this.library=e,this.packagesState=t}view(){return e=this.library,t=this.packagesState,{class:"h-100 d-flex flex-column w-100 fv-bg-background-alt fv-color-primary",children:[{class:"h-100 d-flex flex-column fv-bg-background p-3  overflow-auto",children:[Ae(e),{tag:"hr",class:"w-100 fv-color-primary"},Ve(e),Oe(e)]},new H(t.logsState)]};var e,t}}class et extends xe.Tabs.TabData{constructor(e){super(ee.AssetsUploadFluxApps,"Flux Apps"),this.state=e}view(){return new He(this.state)}}class tt{constructor(e){this.selectedPanel$=e,this.selectedTab$=new c.BehaviorSubject("packages"),this.packagesState=new We(this),this.fluxAppsState=new ze(this),e.subscribe((e=>{this.selectedTab$.next(e)})),this.tabsData$=new c.BehaviorSubject([new Xe(this.packagesState),new et(this.fluxAppsState)])}addTabUpload(e){this.tabsData$.getValue().find((t=>t instanceof Ze&&t.id==e.name))||(this.tabsData$.next([...this.tabsData$.getValue(),new Ze(e,this.packagesState)]),this.selectedTab$.next(e.name))}removeTabUpload(e){this.selectedTab$.getValue()==e&&this.selectedTab$.next(this.tabsData$.getValue()[0].id),this.tabsData$.next(this.tabsData$.getValue().filter((t=>t.name!=e)))}}class st extends xe.Tabs.State{constructor(e){super(e.tabsData$,e.selectedTab$),this.assetsState=e}}class at{constructor(e){this.tag="div",this.class="p-2 h-100 flex-grow-1";let t=new st(e);this.children=[new xe.Tabs.View({class:"d-flex flex-column h-100",state:t,headerView:nt,contentView:(e,t)=>t.view()})],this.connectedCallback=t=>{t.ownSubscriptions(...e.packagesState.subscribe())}}}function nt(e,t){return t instanceof Xe||t instanceof et?{innerText:t.name,class:"px-2"}:t instanceof Ze?{class:"d-flex align-items-center px-2",children:[{innerText:t.name,class:"px-2"},{class:"fas fa-times fv-pointer p-1 ",onclick:s=>{e.assetsState.removeTabUpload(t.name),s.stopPropagation()}}]}:void 0}class rt{constructor(){}}class it{constructor(){this.tag="div",this.class=I;let e=new W(ue.webSocket$);this.children=[{class:"d-flex flex-column flex-grow-1 w-100 overflow-auto",style:{height:"0"},children:[V({innerHTML:"This is a readonly preview of your current configuration file.\nYou can get arguments completion, type checkings, and more when editing this file with <a href='https://www.jetbrains.com/fr-fr/pycharm/'>pycharm</a> and the plugin <a href='https://pydantic-docs.helpmanual.io/pycharm_plugin/'> pydantic </a>."}),(0,i.child$)(D.environment.fileContent$(),(({content:e})=>({id:"codeMirror",class:"flex-grow-1 w-100 py-1",style:{height:"0"},connectedCallback:t=>{let s=document.getElementById("codeMirror"),a={value:e,mode:"python",theme:"blackboard",lineNumbers:!0};window.CodeMirror(s,a).setSize("100%","100%")}})))]},new H(e)],this.connectedCallback=e=>{}}}let ct={[ee.ConfigurationGeneral]:"General",[ee.ConfigurationRawFile]:"Raw file"};class lt{constructor(e){this.selectedPanel$=e,this.logMessages$=new c.Subject,this.generalState=new ue,this.packageState=new rt}}class ot extends xe.Tabs.TabData{constructor(e){super(ee.ConfigurationGeneral,ct[ee.ConfigurationGeneral]),this.generalState=e}view(){return new he(this.generalState)}}class dt extends xe.Tabs.TabData{constructor(e){super(ee.ConfigurationRawFile,ct[ee.ConfigurationRawFile]),this.generalState=e}view(){return new it}}class ut{constructor(e){this.tag="div",this.class="p-2 h-100 flex-grow-1 w-25";let t=[new ot(e.generalState),new dt(e.generalState)];this.children=[new xe.Tabs.View({class:"d-flex flex-column h-100",state:new xe.Tabs.State(t,e.selectedPanel$),headerView:(e,t)=>({innerText:t.name,class:"px-2"}),contentView:(e,t)=>t.view()})]}}class ht extends te.Select.ItemData{constructor(e){super(e.name,e.name),this.data=e}}function pt(e,t,s){let a=t.map((e=>new ht(e))),n=new te.Select.State(a,a[0].id),r=new J.Modal.State,o=C("","Create"),d=new c.ReplaySubject(1),u=new J.Modal.View({state:r,contentView:()=>({class:"fv-text-primary fv-bg-background-alt p-4 rounded border fv-color-primary",style:{"max-width":"75%"},children:[{class:"d-flex align-items-baseline py-2 text-center mx-auto justify-content-center",children:[{tag:"h3",class:"text-center fv-text-focus",innerText:e},new te.Select.View({state:n,class:"mx-2",style:{"font-size":"x-large"}})]},(0,i.child$)(n.selection$,(e=>function(e,t){let s=e.data.parameters.map((e=>{let t=new c.ReplaySubject(1);return null!=e.defaultValue&&t.next({id:e.id,value:e.defaultValue}),t}));return{children:[(a=e.data.description,{children:[{tag:"hr",class:"fv-color-primary"},{class:"d-flex align-items-center",children:[{tag:"i",class:"fas fa-info-circle fa-2x px-3"},{tag:"div",innerHTML:a}]},{tag:"hr",class:"fv-color-primary"}]}),{children:e.data.parameters.map(((e,t)=>function(e,t){let s=new c.BehaviorSubject(!1),a={string:{class:"ml-2",tag:"input",placeholder:e.placeholder,oninput:s=>t.next({id:e.id,value:s.target.value})},text:{tag:"textarea",class:"ml-2 w-100 flex-grow-1",placeholder:e.placeholder,oninput:s=>t.next({id:e.id,value:s.target.value})}};return{children:[{class:"d-flex align-items-center my-3",children:[{class:e.required?"fv-text-focus":"",innerText:e.displayName},{class:"fv-text-focus",innerText:e.required?"*":""},{class:(0,i.attr$)(s,(e=>e?"fv-text-focus":""),{wrapper:e=>"i fas fa-info fv-pointer mx-2 fv-hover-text-focus "+e}),onclick:()=>s.next(!s.getValue())},{...a[e.type],...e.defaultValue?{value:e.defaultValue}:{}}]},{class:(0,i.attr$)(s,(e=>e?"d-block":"d-none")),innerText:e.description}]}}(e,s[t])))}],connectedCallback:e=>{0!=s.length?e.subscriptions.push((0,c.combineLatest)(s).pipe((0,l.map)((e=>e.reduce(((e,t)=>({...e,[t.id]:t.value})),{})))).subscribe((e=>{t.next(e)}))):t.next({parameters:{}})}};var a}(e,d))),{tag:"hr",class:"fv-color-primary"},(0,i.child$)(d,(e=>o))]})}),h=(0,i.render)(u);document.body.appendChild(h),r.cancel$.subscribe((()=>h.remove())),o.state.click$.pipe((0,l.mergeMap)((()=>d)),(0,l.mergeMap)((e=>s.createSkeleton$(n.selectionId$.getValue(),{parameters:e})))).subscribe((e=>{h.remove()}))}class ft{constructor(){this.status$=new c.ReplaySubject(1),this.webSocket$=D.fronts.connectWs()}subscribe(){return[this.webSocket$.pipe((0,l.filter)((({type:e})=>"Status"==e))).subscribe((({status:e})=>{this.status$.next(e)})),(0,c.combineLatest)([this.webSocket$.pipe((0,l.take)(1)),ue.configurationUpdated$]).pipe((0,l.mergeMap)((()=>D.fronts.status$()))).subscribe((e=>{this.status$.next(e.status)}))]}}class gt{constructor(e){this.tag="div",this.class=I,this.state=e;let t=new W(this.state.webSocket$);this.children=[{tag:"h3",class:"d-flex",children:[(0,i.child$)(e.status$,(()=>({children:[this.newFrontBttn()]})),{untilFirst:{class:"px-2 fas fa-spinner fa-spin"}})]},(0,i.child$)(e.status$,(e=>this.contentView(e))),new H(t)],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}newFrontBttn(){let e=C("fas fa-plus","new front-end");return e.state.click$.pipe((0,l.mergeMap)((()=>D.fronts.skeletons$()))).subscribe((({skeletons:e})=>{pt("New frontend",e,D.fronts)})),e}contentView(e){return{class:"flex-grow-1 h-25 overflow-auto",children:[this.tableView(e)]}}tableView(e){return{tag:"table",class:"fv-color-primary  w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:"url"},{tag:"td",innerText:"Dev server"},{tag:"td",innerText:"Health"}]}]},{tag:"tbody",children:e.map((e=>{return{tag:"tr",class:"fv-hover-bg-background-alt",children:[(t=e,{tag:"td",innerText:t.name,style:{"font-family":"cursive","font-size":"large"}}),wt(e),mt(this.state,e),bt(e)]};var t}))}]}}}function wt(e){return{tag:"td",children:[{tag:"a",href:e.url,innerText:e.url}]}}function bt(e){return{tag:"td",class:e?"fv-text-success":"fv-text-error",children:[{tag:"i",class:e?"fas fa-check px-2":"fas fa-times px-2",onclick}]}}function mt(e,t){if(null==t.devServer)return{};let s=e.webSocket$.pipe((0,l.filter)((e=>e.target==t.name&&e.action==O.SERVE)),(0,l.filter)((({step:e})=>[L.STARTED,L.DONE].includes(e)))),a=new c.ReplaySubject;return s.subscribe((e=>{a.next(e)})),a.next(t.devServer?{step:L.STARTED}:{step:L.DONE}),{tag:"td",children:[{children:[(0,i.child$)(a,(({step:e})=>({tag:"i",class:"fv-pointer p-2 fv-hover-bg-primary fv-hover-text-focus"+(e==L.STARTED?" fas fa-stop ":" fas fa-play "),onclick:()=>e==L.STARTED?D.fronts.stop$(t.name).subscribe((()=>{})):D.fronts.start$(t.name).subscribe((()=>{}))})))]}]}}class xt{constructor(){this.highlighted$=new c.ReplaySubject(1),this.autoWatched$=new c.BehaviorSubject([]),this.dependenciesRequest$=new c.Subject,this.webSocket$=D.modules.connectWs()}subscribe(){return[(0,c.combineLatest)([this.webSocket$.pipe((0,l.take)(1)),ue.configurationUpdated$]).pipe((0,l.mergeMap)((()=>D.modules.status$()))).subscribe((e=>{xt.status$.next(e)})),this.dependenciesRequest$.pipe((0,l.debounceTime)(250),(0,l.switchMap)((({assetId:e,direction:t})=>D.modules.dependencies$(e).pipe((0,l.map)((e=>({deps:e,direction:t}))))))).subscribe((({deps:e,direction:t})=>{"up"==t?this.highlighted$.next(e.belowDependencies):this.highlighted$.next(e.aboveDependencies)}))]}toggleWatch(e){let t=this.autoWatched$.getValue();t=t.includes(e)?t.filter((t=>t!=e)):t.concat([e]),this.autoWatched$.next(t),D.modules.watch$({libraries:t}).subscribe()}}xt.status$=new c.ReplaySubject(1);class $t{constructor(e){this.tag="div",this.class=I,this.state=e;let t=new W(this.state.webSocket$.pipe((0,l.map)((e=>e))));this.children=[{tag:"h3",class:"d-flex",children:[(0,i.child$)(xt.status$,(()=>({children:[this.syncAllBttn(),this.newPackageBttn()]})),{untilFirst:{class:"px-2 fas fa-spinner fa-spin"}})]},(0,i.child$)(xt.status$.pipe((0,l.map)((e=>e.status))),(e=>this.contentView(e))),new H(t)],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}syncAllBttn(){let e=C("fas fa-sync","Sync. all");return e.state.click$.pipe((0,l.mergeMap)((()=>D.modules.action$({action:"SYNC",targetName:"",scope:"ALL"})))).subscribe((e=>{xt.status$.next(e)})),e}newPackageBttn(){let e=C("fas fa-plus","new package");return e.state.click$.pipe((0,l.mergeMap)((()=>D.modules.skeletons$()))).subscribe((({skeletons:e})=>{pt("New package",e,D.modules)})),e}contentView(e){return{class:"flex-grow-1 h-25 overflow-auto",children:[this.installQueueView(e),this.pipelinesTableView(e)]}}installQueueView(e){return 0==e.filter((e=>"NOT_INSTALLED"==e.installStatus)).length?{}:{class:"overflow-auto",children:[{tag:"h3",innerText:"List of packages to install"},V({innerText:"Following packages have not been installed yet. \n                    Installation step usually install required dependencies and initialize the asset properly. \n                    Internet connection is usually required here."}),{tag:"table",class:"fv-color-primary mx-auto text-center my-2",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:""}]}]},{tag:"tbody",children:e.filter((e=>"NOT_INSTALLED"==e.installStatus)).map((e=>({tag:"tr",children:[kt(e),yt(this.state,e)]})))}]}]}}pipelinesTableView(e){return e.filter((e=>"INSTALLED"==e.installStatus)),{class:"overflow-auto",children:[{tag:"h3",innerText:"Pipelines status"},{tag:"table",class:"fv-color-primary  w-100 text-center",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:"Version"},{tag:"td",innerText:"Watch"},{tag:"td",innerText:"Actions"},{tag:"td",innerText:"Build Status"},{tag:"td",innerText:"Test Status"},{tag:"td",innerText:"CDN Status"}]}]},{tag:"tbody",children:e.filter((e=>"INSTALLED"==e.installStatus)).map((e=>({tag:"tr",class:(0,i.attr$)(this.state.highlighted$,(t=>t.includes(e.name)?"fv-bg-background-alt":""),{wrapper:e=>e+" fv-hover-bg-background-alt",untilFirst:"fv-hover-bg-background-alt"}),children:[kt(e),Tt(e),Nt(this.state,e),Et(this.state,e),Pt(this.state,e),It(this.state,e),Ct(this.state,e)]})))}]}]}}}let vt="fv-pointer p-2 fv-hover-bg-primary fv-hover-text-focus",St={NEVER_BUILT:{color:"fv-text-focus ",icon:"fas fa-sync "+vt,text:"never built"},NOT_PUBLISHED:{color:"fv-text-focus ",icon:"fas fa-sync "+vt,text:""},GREEN:{color:"fv-text-success ",icon:"fas fa-check ",text:""},RED:{color:"fv-text-error ",icon:"fas fa-sync "+vt,text:""},CDN_ERROR:{color:"fv-text-error ",icon:"fas fa-times ",text:""},OUT_OF_DATE:{color:"fv-text-focus ",icon:"fas fa-sync "+vt,text:""},INDIRECT_OUT_OF_DATE:{color:"fv-text-focus ",icon:"fas fa-sync "+vt,text:"(indirect)"},NO_ENTRY:{color:"fv-text-focus ",icon:"fas fa-sync "+vt,text:""},SYNC:{color:"fv-text-success ",icon:"fas fa-check "+vt,text:""}};function kt(e){return e.documentation?{tag:"td",style:{"font-family":"cursive","font-size":"large"},children:[{tag:"a",href:e.documentation,innerText:e.name}]}:{tag:"td",innerText:e.name,style:{"font-family":"cursive","font-size":"large"}}}function Tt(e){return{tag:"td",innerText:e.version}}function yt(e,t){let s=e.webSocket$.pipe((0,l.filter)((e=>e.target==t.name&&e.action==O.INSTALL))),a=C("","Install");return a.state.click$.pipe((0,l.mergeMap)((()=>D.modules.install$(t.assetId)))).subscribe((()=>console.log("install done"))),{class:"d-flex align-items-center",children:[(0,i.child$)(a.state.click$,(()=>({})),{untilFirst:a}),{tag:"i",class:(0,i.attr$)(s.pipe((0,l.filter)((({step:e})=>[L.STARTED,L.DONE].includes(e)))),(e=>e.step==L.STARTED?"fas fa-spinner fa-spin p-3":""))}]}}function Nt(e,t){return{tag:"td",class:(0,i.attr$)(e.autoWatched$,(e=>e.includes(t.name)?"fas fa-satellite-dish fv-text-focus ":"fas fa-satellite-dish "),{wrapper:e=>e+vt}),onclick:()=>e.toggleWatch(t.name)}}function Et(e,t){return{tag:"td",children:[{tag:"i",class:"far fa-arrow-alt-circle-right "+vt,onclick:()=>Rt(0,{action:O.SYNC,targetName:t.name,scope:B.TARGET_ONLY})},{tag:"i",class:"far fa-arrow-alt-circle-up "+vt,onclick:()=>Rt(0,{action:O.SYNC,targetName:t.name,scope:B.ALL_ABOVE}),onmouseover:()=>{e.dependenciesRequest$.next({assetId:t.assetId,direction:"up"})},onmouseout:()=>e.highlighted$.next([])},{tag:"i",class:"far fa-arrow-alt-circle-down "+vt,onclick:()=>Rt(0,{action:O.SYNC,targetName:t.name,scope:B.ALL_BELOW}),onmouseover:s=>{e.dependenciesRequest$.next({assetId:t.assetId,direction:"down"})},onmouseout:()=>e.highlighted$.next([])}]}}function Rt(e,t){D.modules.action$(t).subscribe((e=>{}))}function Dt(e,t,s){let a=e.webSocket$.pipe((0,l.filter)((e=>e.target==t&&e.action==s))),n=new c.ReplaySubject;return{tag:"td",class:(0,i.attr$)(n,(({color:e})=>e)),children:[{tag:"i",innerText:(0,i.attr$)(n,(({text:e})=>e))},{tag:"i",class:(0,i.attr$)(n,(({icon:e})=>e)),onclick:()=>Rt(0,{action:s,targetName:t,scope:B.TARGET_ONLY})},{tag:"i",class:(0,i.attr$)(a.pipe((0,l.filter)((({step:e})=>[L.STARTED,L.DONE].includes(e)))),(e=>e.step==L.STARTED?"fas fa-spinner fa-spin":""))}],connectedCallback:e=>{e.subscriptions.push(a.pipe((0,l.filter)((({step:e,content:t})=>e==L.STATUS&&null!=St[t])),(0,l.map)((({content:e})=>St[e]))).subscribe((e=>{n.next(e)})))}}}function Pt(e,t){return Dt(e,t.name,O.BUILD)}function It(e,t){return Dt(e,t.name,O.TEST)}function Ct(e,t){return Dt(e,t.name,O.CDN)}function Vt(e,t,s){let a=e.pipe((0,l.filter)((e=>e.target==t.name&&e.action==O.INSTALL))),n=C("","Install");return n.state.click$.pipe((0,l.mergeMap)((()=>s.install$(t.assetId)))).subscribe((()=>console.log("install done"))),{class:"d-flex align-items-center",children:[(0,i.child$)(n.state.click$,(()=>({})),{untilFirst:n}),{tag:"i",class:(0,i.attr$)(a.pipe((0,l.filter)((({step:e})=>[L.STARTED,L.DONE].includes(e)))),(e=>e.step==L.STARTED?"fas fa-spinner fa-spin p-3":""))}]}}class Ot{constructor(){this.status$=new c.ReplaySubject(1),this.environments$=new c.BehaviorSubject([]),this.currentEnvironment$=new c.BehaviorSubject(""),this.selectedEnvId$=new c.BehaviorSubject(""),this.envSelectionState=new te.Select.State(this.environments$,this.selectedEnvId$),this.selectedUserId$=new c.BehaviorSubject(localStorage.getItem("user-name")||"greinisch@youwol.com"),this.webSocket$=D.backs.connectWs()}subscribe(){return[this.webSocket$.pipe((0,l.filter)((({type:e})=>"Status"==e))).subscribe((({status:e})=>{this.status$.next(e)})),(0,c.combineLatest)([this.webSocket$.pipe((0,l.take)(1)),ue.configurationUpdated$]).pipe((0,l.mergeMap)((()=>D.backs.status$()))).subscribe((e=>{this.status$.next(e.status)}))]}}class Bt{constructor(e){this.tag="div",this.class=I,this.state=e;let t=new W(this.state.webSocket$);this.children=[{tag:"h3",class:"d-flex",children:[this.newBackBttn(),(0,i.child$)(e.status$,(()=>({children:[this.startBttn(),this.restartBttn()]})),{untilFirst:{class:"px-2 fas fa-spinner fa-spin"}})]},(0,i.child$)(e.status$,(e=>{return t=this.state.webSocket$,s=e,"",a=D.backs,0==s.filter((e=>"NOT_INSTALLED"==e.installStatus)).length?{}:{class:"overflow-auto",children:[{tag:"h4",innerText:"Assets to install"},V({innerText:""}),{tag:"table",class:"fv-color-primary mx-auto text-center my-2",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:""}]}]},{tag:"tbody",children:s.filter((e=>"NOT_INSTALLED"==e.installStatus)).map((e=>({tag:"tr",children:[{tag:"td",innerText:e.name,style:{"font-family":"cursive","font-size":"large"}},Vt(t,e,a)]})))}]}]};var t,s,a})),(0,i.child$)(e.status$,(e=>this.contentView(e))),new H(t)],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}newBackBttn(){let e=C("fas fa-plus","new backend-end");return e.state.click$.pipe((0,l.mergeMap)((()=>D.backs.skeletons$()))).subscribe((({skeletons:e})=>{pt("New backend",e,D.backs)})),e}startBttn(){let e=C("fas fa-play","Start");return e.state.click$.pipe((0,l.mergeMap)((()=>D.backs.start$()))).subscribe((()=>{})),e}restartBttn(){let e=C("fas fa-play","Re-start");return e.state.click$.pipe((0,l.mergeMap)((()=>D.backs.restart$()))).subscribe((()=>{})),e}contentView(e){return{class:"flex-grow-1 h-25 overflow-auto",children:[this.tableView(e)]}}tableView(e){return{tag:"table",class:"fv-color-primary  w-100 text-center",children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name"},{tag:"td",innerText:""},{tag:"td",innerText:"Actions"},{tag:"td",innerText:"Health"}]}]},{tag:"tbody",children:e.filter((e=>"INSTALLED"==e.installStatus)).map((e=>{return{tag:"tr",class:"fv-hover-bg-background-alt",children:[Lt(this.state,e),Gt(this.state,e),jt(this.state,e),(t=this.state,s=e,function(e,t,s){let a=e.webSocket$.pipe((0,l.filter)((e=>e.target==t.name&&"serve"==e.action)),(0,l.filter)((e=>["started","serving","done"].includes(e.step)))),n=new c.BehaviorSubject(t.health?s.serving:s.error);return{tag:"td",children:[(0,i.child$)(n,(e=>({tag:"i",class:e.class,onclick:e.onclick?e.onclick:()=>{}})))],connectedCallback:e=>{e.subscriptions.push(a.pipe((0,l.map)((e=>s[e.step]))).subscribe((e=>n.next(e))))}}}(t,s,{started:{class:"fas fa-spinner fa-spin fv-text-primary",onclick:void 0},serving:{class:"fv-text-success fas fa-check px-2",onclick:void 0},error:{class:"fv-text-error fas fa-times px-2",onclick:void 0},done:{class:"fv-text-error fas fa-times px-2",onclick:void 0}}))]};var t,s}))}]}}}let At="fv-pointer p-2 fv-hover-bg-primary fv-hover-text-focus";function Lt(e,t){return{tag:"td",innerText:t.name,style:{"font-family":"cursive","font-size":"large"}}}function Gt(e,t){return t.openApi?{tag:"td",innerHTML:`<a href='${t.openApi}'> doc </a> `}:{tag:"td"}}function jt(e,t){return{tag:"td",children:[{tag:"i",class:t.devServer?`fas fa-stop fv-text-primary ${At}`:`fas fa-play fv-text-primary ${At}`,onclick:()=>{t.devServer?D.backs.stop$(t.assetId).subscribe():D.backs.start$(t.assetId).subscribe()}}]}}class Ut{constructor(){this.packagesStatus$=D.localCdnPackages.packagesStatus$,this.packageDetails$=D.localCdnPackages.packageDetails$,this.webSocket$=D.localCdnPackages.connectWs()}subscribe(){let e=this.packagesStatus$.subscribe((e=>console.log("packagesStatus",e))),t=this.packageDetails$.subscribe((e=>console.log("packageDetails",e)));return D.localCdnPackages.status$().subscribe(),[e,t]}getPackageDetails(e){D.localCdnPackages.getPackageDetails$(e).subscribe()}}class Ft{constructor(e){this.tag="div",this.class=I,this.state=e,this.children=[{class:"d-flex h-100",children:[(0,i.child$)(this.state.packagesStatus$,(e=>this.packagesTable(e))),(0,i.child$)(this.state.packageDetails$,(e=>e?this.packageDetails(e):{}))]}],this.connectedCallback=e=>{e.ownSubscriptions(...this.state.subscribe())}}packagesTable(e){return{class:"overflow-auto h-100",children:[{tag:"table",class:"fv-color-primary  w-100 text-center",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Name",class:"px-2"},{tag:"td",innerText:"Version count",class:"px-2"},{tag:"td",innerText:"Latest version",class:"px-2"},{tag:"td",innerText:"",class:"px-2"}]}]},{tag:"tbody",children:e.packages.map((e=>{return{tag:"tr",class:"fv-hover-bg-background-alt fv-pointer",children:[Mt(e),_t(e),qt(e),(t=e.name,{tag:"td",children:[{class:"fas fa-trash fv-text-error px-2 fv-pointer",onclick:()=>{confirm(`Are you sure you want to remove ${t} (all versions) from local CDN`)&&D.localCdnPackages.deletePackage$(t).subscribe()}}]})],onclick:()=>this.state.getPackageDetails(e.name)};var t}))}]}]}}packageDetails(e){return{class:"overflow-auto h-100 mx-auto",children:[{tag:"h4",class:"fv-text-focus",innerText:e.name},{tag:"table",class:"fv-color-primary  w-100 text-center",style:{"max-height":"100%"},children:[{tag:"thead",children:[{tag:"tr",class:"fv-bg-background-alt",children:[{tag:"td",innerText:"Version",class:"px-2"},{tag:"td",innerText:"files count",class:"px-2"},{tag:"td",innerText:"bundle size (Ko)",class:"px-2"},{tag:"td",innerText:"",class:"px-2"}]}]},{tag:"tbody",children:e.versions.map((t=>{return{tag:"tr",class:"fv-hover-bg-background-alt",children:[{tag:"td",innerText:t.version,class:"px-2"},{tag:"td",innerText:t.filesCount,class:"px-2"},{tag:"td",innerText:Math.floor(t.bundleSize/100)/10,class:"px-2"},(s=e.name,a=t.version,{tag:"td",children:[{class:"fas fa-trash fv-text-error px-2 fv-pointer",onclick:()=>{confirm(`Are you sure you want to remove ${s}@${a} from local CDN`)&&D.localCdnPackages.deleteVersion$(s,a).subscribe()}}]})]};var s,a}))}]}]}}}function Mt(e){return{tag:"td",innerText:e.name,class:"px-2"}}function _t(e){return{tag:"td",innerText:e.versions.length,class:"px-2"}}function qt(e){return{tag:"td",innerText:e.versions[0].version,class:"px-2"}}let Wt={[ee.LocalEnvPackage]:"Packages",[ee.LocalEnvFronts]:"Front Ends",[ee.LocalEnvBacks]:"Back Ends",[ee.LocalEnvCDN]:"CDN"};class Yt{constructor(e){this.selectedPanel$=e,this.logMessages$=new c.Subject,this.modulesState=new xt,this.frontendsState=new ft,this.backendsState=new Ot,this.cdnState=new Ut}}class zt extends xe.Tabs.TabData{constructor(e){super(ee.LocalEnvPackage,Wt[ee.LocalEnvPackage]),this.modulesState=e}view(){return new $t(this.modulesState)}}class Ht extends xe.Tabs.TabData{constructor(e){super(ee.LocalEnvFronts,Wt[ee.LocalEnvFronts]),this.frontEndsState=e}view(){return new gt(this.frontEndsState)}}class Jt extends xe.Tabs.TabData{constructor(e){super(ee.LocalEnvBacks,Wt[ee.LocalEnvBacks]),this.backendsState=e}view(){return new Bt(this.backendsState)}}class Qt extends xe.Tabs.TabData{constructor(e){super(ee.LocalEnvCDN,Wt[ee.LocalEnvCDN]),this.cdnState=e}view(){return new Ft(this.cdnState)}}class Kt{constructor(e){this.tag="div",this.class="p-2 h-100 flex-grow-1";let t=[new zt(e.modulesState),new Ht(e.frontendsState),new Jt(e.backendsState),new Qt(e.cdnState)];this.children=[new xe.Tabs.View({class:"d-flex flex-column h-100",state:new xe.Tabs.State(t,e.selectedPanel$),headerView:(e,t)=>({innerText:t.name,class:"px-2"}),contentView:(e,t)=>t.view()})]}}s(897);let Xt=new class{constructor(){this.environmentChildren$=new c.BehaviorSubject([ee.ConfigurationGeneral,ee.ConfigurationRawFile]),this.localChildren$=new c.BehaviorSubject([ee.LocalEnvPackage,ee.LocalEnvFronts,ee.LocalEnvBacks,ee.LocalEnvCDN]),this.uploadChildren$=new c.BehaviorSubject([ee.AssetsUploadPackages,ee.AssetsUploadFluxApps]),this.downloadChildren$=new c.BehaviorSubject([ee.AssetsDownloadPackages]),this.selected$=new c.BehaviorSubject(ee.ConfigurationGeneral),this.localState=new Yt(this.selected$),this.assetsUploadState=new tt(this.selected$),this.assetsDownloadState=new Pe(this.selected$),this.configurationState=new lt(this.selected$),this.panelViewFactory$=this.selected$.pipe((0,l.map)((e=>[ee.LocalEnvPackage,ee.LocalEnvFronts,ee.LocalEnvBacks,ee.LocalEnvCDN].includes(e)?new Kt(this.localState):[ee.AssetsUploadPackages,ee.AssetsUploadFluxApps].includes(e)?new at(this.assetsUploadState):[ee.ConfigurationGeneral,ee.ConfigurationRawFile].includes(e)?new ut(this.configurationState):[ee.AssetsDownloadPackages].includes(e)?new Ie(this.assetsDownloadState):void 0)))}addTabUpload(e){let t=this.uploadChildren$.getValue();pe[ee.AssetsUploadPackage]={title:e,enabled:!0},this.uploadChildren$.next([...t,ee.AssetsUploadPackage])}},Zt={class:"d-flex fv-text-primary h-100",children:[new class{constructor(e){this.state=e,this.tag="div",this.class="d-flex justify-content-center py-5 px-2 border h-100 ",this.style={"min-width":"300px"},this.children=[{class:"h-100 mx-auto d-flex flex-column pl-3",children:[{tag:"a",href:"/ui/workspace-explorer",class:"w-100 mb-2 d-flex justify-content-center",children:[{tag:"img",class:"mx-auto text-center fv-pointer",style:{width:"75%"},href:"/ui/workspace-explorer",src:"/api/assets-gateway/raw/package/QHlvdXdvbC9mbHV4LXlvdXdvbC1lc3NlbnRpYWxz/latest/assets/images/logo_YouWol_Platform_white.png"}]},(0,i.child$)(D.environment.environments$,(e=>{return{class:"mb-5",children:[{class:"d-flex align-items-center fv-hover-text-focus fv-pointer  justify-content-center",onclick:()=>ne(),children:[{class:"fas fa-user"},{class:"fv-hover-text-focus fv-pointer mx-2",innerText:(t=e).userInfo.email}]},{class:"d-flex align-items-center justify-content-center",children:[{class:"fas fa-wifi px-2 "+(t.remoteGatewayInfo.connected?"fv-text-success":"fv-text-error")},{innerText:t.remoteGatewayInfo.host}]}]};var t})),we("Environment","fas fa-users-cog my-2",this.state.environmentChildren$,this.state.selected$),we("My computer","fas fa-laptop-code my-2",this.state.localChildren$,this.state.selected$),we("Upload assets","fas fa-cloud-upload-alt my-2",this.state.uploadChildren$,this.state.selected$),we("Download assets","fas fa-cloud-download-alt my-2",this.state.downloadChildren$,this.state.selected$),{class:"my-2 ",children:[fe("Resources","fas fa-book",new c.BehaviorSubject(!1)),(0,i.child$)(ue.environment$,(e=>({tag:"ul",class:"d-flex flex-column",children:Object.entries(e.configuration.general.resources).map((([e,t])=>({tag:"li",children:[{tag:"a",href:t,innerText:e}]})))})))]}]}]}}(Xt),(0,i.child$)(Xt.panelViewFactory$,(e=>e))]},es=D.system.connectWs();es.pipe((0,l.filter)((e=>"SystemError"==e.type))).subscribe((e=>{let t=new be(e),s=new J.Modal.View({state:t,contentView:me}),a=(0,i.render)(s);document.querySelector("body").appendChild(a),t.ok$.subscribe((()=>a.remove())),t.cancel$.subscribe((()=>a.remove()))})),es.pipe((0,l.take)(1)).subscribe((e=>{document.body.appendChild((0,i.render)(Zt))}))}}]);
//# sourceMappingURL=642.353dcebeeac178868213.js.map