(self.webpackChunk=self.webpackChunk||[]).push([[600],{322:(e,t,n)=>{"use strict";n.d(t,{hb:()=>E});var o=n(935),s=n(862),i=n(158),r=n(519),l=n(249);class a extends class{constructor(e,t,n){this.id=e,this.classes=t,this.data=n}}{constructor(e,t,n,o,s,i){super(e,t,s),this.id=e,this.classes=t,this.inputGroup=n,this.outputGroup=o,this.data=s,this.adaptor=i}}let d='\n<linearGradient id="a" gradientTransform="matrix(1 0 0 -1 0 -22278)" gradientUnits="userSpaceOnUse" x1="0" x2="512" y1="-22534" y2="-22534"><stop offset="0" stop-color="#00f1ff"/><stop offset=".231" stop-color="#00d8ff"/><stop offset=".5138" stop-color="#00c0ff"/><stop offset=".7773" stop-color="#00b2ff"/><stop offset="1" stop-color="#00adff"/></linearGradient>\n<path d="m512 256c0 141.386719-114.613281 256-256 256s-256-114.613281-256-256 114.613281-256 256-256 256 114.613281 256 256zm0 0" fill="url(#a)"/><g fill="#fff"><path d="m279.050781 385.15625c0 13.128906-10.640625 23.773438-23.769531 23.773438s-23.773438-10.644532-23.773438-23.773438 10.644532-23.769531 23.773438-23.769531 23.769531 10.640625 23.769531 23.769531zm0 0"/><path d="m85.996094 209.265625c-3.660156 0-7.332032-1.332031-10.222656-4.027344-6.058594-5.644531-6.394532-15.136719-.746094-21.199219 47.460937-50.921874 111.730468-78.964843 180.96875-78.964843 69.246094 0 133.515625 28.042969 180.976562 78.964843 5.648438 6.0625 5.3125 15.554688-.746094 21.199219-6.058593 5.652344-15.550781 5.316407-21.199218-.742187-41.726563-44.769532-98.203125-69.421875-159.023438-69.421875-60.832031 0-117.304687 24.652343-159.03125 69.421875-2.953125 3.167968-6.960937 4.769531-10.976562 4.769531zm0 0"/><path d="m138.582031 269.089844c-3.820312 0-7.640625-1.449219-10.566406-4.355469-5.878906-5.832031-5.914063-15.332031-.082031-21.210937 35.101562-35.375 80.582031-54.859376 128.0625-54.859376 47.472656 0 92.953125 19.480469 128.0625 54.859376 5.835937 5.878906 5.800781 15.375-.078125 21.210937-5.882813 5.835937-15.378907 5.800781-21.214844-.078125-29.433594-29.660156-67.351563-45.992188-106.769531-45.992188-39.421875 0-77.339844 16.332032-106.765625 45.988282-2.933594 2.957031-6.789063 4.4375-10.648438 4.4375zm0 0"/><path d="m315.84375 328.84375c-3.816406 0-7.632812-1.445312-10.558594-4.34375-13.234375-13.113281-32.636718-21.589844-49.421875-21.589844-.003906 0-.003906 0-.007812 0h-1.039063c-.003906 0-.007812 0-.007812 0-16.789063 0-36.1875 8.472656-49.425782 21.589844-5.882812 5.828125-15.378906 5.785156-21.210937-.097656-5.832031-5.886719-5.789063-15.382813.097656-21.214844 18.847657-18.675781 45.875-30.277344 70.535157-30.277344h.011718 1.039063.011719c24.660156 0 51.683593 11.601563 70.535156 30.277344 5.882812 5.832031 5.929687 15.328125.097656 21.214844-2.933594 2.957031-6.796875 4.441406-10.65625 4.441406zm0 0"/></g>\n',c={tag:"g",class:"adaptor",attributes:{},style:{visibility:"visible"},children:[{tag:"path",attributes:{d:"M211.331,190.817c-1.885-1.885-4.396-2.922-7.071-2.922c-2.675,0-5.186,1.038-7.07,2.922l-32.129,32.129l-24.403-24.403   l32.129-32.129c3.897-3.899,3.897-10.243-0.001-14.142l-11.125-11.125c-1.885-1.885-4.396-2.922-7.071-2.922   c-2.675,0-5.187,1.038-7.07,2.923l-32.128,32.128l-18.256-18.256c-1.885-1.885-4.396-2.922-7.071-2.922   c-2.675,0-5.186,1.038-7.07,2.922L66.95,171.062c-3.899,3.899-3.899,10.243,0,14.143l3.802,3.802   c-1.596,1.086-3.103,2.325-4.496,3.718l-46.679,46.679c-5.836,5.835-9.049,13.62-9.049,21.92c0,8.301,3.214,16.086,9.049,21.92   l17.943,17.943L5.126,333.582c-6.835,6.835-6.835,17.915,0,24.749c3.417,3.417,7.896,5.125,12.374,5.125s8.957-1.708,12.374-5.125   l32.395-32.395l18.091,18.091c5.834,5.835,13.619,9.048,21.92,9.048s16.086-3.213,21.92-9.048l46.679-46.679   c1.394-1.393,2.633-2.901,3.719-4.497l3.802,3.802c1.885,1.885,4.396,2.923,7.07,2.923c2.675,0,5.186-1.038,7.072-2.923   l16.04-16.042c1.887-1.885,2.925-4.396,2.925-7.072c0-2.676-1.038-5.187-2.924-7.071l-18.255-18.255l32.129-32.129   c3.898-3.899,3.898-10.244-0.001-14.142L211.331,190.817z"}},{tag:"path",attributes:{d:"M358.33,5.126c-6.834-6.834-17.914-6.834-24.748,0l-32.686,32.686l-17.944-17.944c-5.834-5.835-13.619-9.048-21.92-9.048   c-8.301,0-16.086,3.213-21.92,9.048l-46.679,46.679c-1.393,1.393-2.632,2.9-3.719,4.497l-3.802-3.802   c-1.885-1.885-4.396-2.923-7.071-2.923c-2.675,0-5.187,1.038-7.071,2.923l-16.042,16.042c-1.886,1.885-2.924,4.396-2.924,7.072   c0,2.675,1.038,5.187,2.924,7.071l111.447,111.448c1.885,1.885,4.396,2.923,7.071,2.923c2.676,0,5.186-1.038,7.071-2.923   l16.043-16.043c3.899-3.899,3.899-10.243,0-14.142l-3.801-3.801c1.596-1.086,3.103-2.325,4.496-3.719l46.679-46.679   c5.835-5.834,9.049-13.62,9.049-21.92s-3.213-16.086-9.049-21.92l-18.09-18.09l32.686-32.686   C365.165,23.04,365.165,11.96,358.33,5.126z"}}]};function u(e){if(!e.data.adaptor){let t={tag:"g",attributes:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},children:{connection:{tag:"path",class:"connection-path",attributes:{d:`M${e.x1},${e.y1} C${.5*(e.x1+e.x2)},${e.y1} ${.5*(e.x1+e.x2)},${e.y2} ${e.x2},${e.y2}`}}}};return(0,o.createHTMLElement)({data:t,namespace:"svg"})}let t=Math.pow((e.x2-e.x1)*(e.x2-e.x1)+(e.y2-e.y1)*(e.y2-e.y1),.5),n=(e.x1-e.x2)/t,s=(e.y1-e.y2)/t,i=(2*Number(e.y2<e.y1)-1)*Math.acos((e.x1-e.x2)/t)*180/3.14,r=e.x1-50*n,l=e.y1-50*s,a=c;a.attributes={transform:`translate(${-(e.x2-e.x1)/2-50*n},${-(e.y2-e.y1)/2-50*s} ) rotate(${i+45})  translate(-0,-36) scale(0.1)`};let d={tag:"g",attributes:{x1:r,y1:l,x2:e.x2,y2:e.y2},children:{connection:{tag:"path",class:"connection-path",attributes:{d:`M${e.x2},${e.y2} C${.5*(r+e.x2)},${e.y2} ${.5*(r+e.x2)},${.5*(l+e.y2)} ${r},${l}`,x1:r,y1:l,x2:e.x2,y2:e.y2}},adaptor:a}};return(0,o.createHTMLElement)({data:d,namespace:"svg"})}function p(e){return e.connectionId}function m(e,t,n){let o=t[e];if(o)return o;let s=n.getParentGroup(e);return s?t[s.moduleId]:void 0}function h(e,t,n,s){let i=n.getAttribute("slotId")||n.getAttribute("slotid"),r=e.getSlot(i);if(r)return r;if(e instanceof o.GroupModules.Module&&i){let o=n.getAttribute("moduleId")||n.getAttribute("moduleid");return e.getAllChildren(t).find((e=>e.moduleId==o)).getSlot(i)}return console.warn("The builder plot should define the attribute 'slotId' of the slots elements",n),r="input"===s?e.inputSlots.find((e=>n.id==="input-slot_"+e.slotId+"_"+e.moduleId)):e.outputSlots.find((e=>n.id==="output-slot_"+e.slotId+"_"+e.moduleId)),r}function g(e,t){let n=e.parentElement,o=t.getModuleOrPlugin(n.getAttribute("moduleId")||n.getAttribute("id"));return o||(n=n.parentElement,o=t.getModuleOrPlugin(n.getAttribute("moduleId")||n.getAttribute("id"))),[o,n]}class f{constructor(e,t,n,o,s,i,r){this.mdle=e,this.workflow=t,this.domModuleElement=n,this.domPlugElement=o,this.plugType=s,this.isDrawing=i,this.isStarted=r,this.xOrigin=void 0,this.yOrigin=void 0,this.slot=void 0,this.xOrigin=Number(n.getAttribute("x"))+Number(o.getAttribute("cx")),this.yOrigin=Number(n.getAttribute("y"))+Number(o.getAttribute("cy")),this.slot=h(e,t,o,s)}}class w{constructor(e,t,n,c){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=c,this.debugSingleton=s.ST.getInstance(),this.connectionPlots=void 0,this.drawingConnection=void 0,this.connectionCreationEnabled=!0;let w=new i.Subject;this.connectUserInteractions(w),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create connections plotter",object:{drawingArea:e,plottersObservables:t}}),(0,i.combineLatest)(this.appObservables.connectionsUpdated$,this.plottersObservables.modulesDrawn$).subscribe((([e,t])=>{this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"connections updated",object:{connections:e,modulesGroup:t}}),function(e,t,n,o,s){let i=e.map((e=>function(e,t,n){let o=n.project.builderRendering.connectionsView.find((t=>t.connectionId==e.connectionId));return new a(p(e),["connection","mdle-color-stroke",(0,l.toCssName)(n.getModule(e.start.moduleId).Factory.uid)].concat(o&&o.wireless?["wireless"]:[]),m(e.end.moduleId,t,n),m(e.start.moduleId,t,n),e,e.adaptor)}(e,t,s))),r=new l.LinkPlot({plotId:"connectionsPlot",plotClasses:[],drawingArea:n,orderIndex:3});r.defaultElementDisplay=u,r.draw(i),r.entities$.subscribe((e=>o.next(e))),function(e,t){let n=e.svgCanvas.node().querySelectorAll(".wireless"),o=e.drawingGroup.node(),s=o.querySelector("#wireless-slots");s&&s.remove(),s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.id="wireless-slots",o.appendChild(s),n.forEach((e=>{let n=n=>{n.stopPropagation(),t.selectConnection(t.getConnection(e.id))},o=Number(e.getAttribute("x1")),i=Number(e.getAttribute("y1")),r=Number(e.getAttribute("x2")),l=Number(e.getAttribute("y2"));const a=document.createElementNS("http://www.w3.org/2000/svg","g"),c=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("transform",e.getAttribute("transform")),c.setAttribute("transform",e.getAttribute("transform")),a.innerHTML=`<line class='' x1="${o}" y1="${i}" x2="${Number(o)-50}" y2="${i}"></line><g transform="translate(${o-50-50},${i-25}) scale(0.1)" > ${d}</g>`,c.innerHTML=`<line class='' x1="${r}" y1="${l}" x2="${r+50}" y2="${l}"></line><g transform="translate(${r+50},${l-25}) scale(0.1)" > ${d}</g>`,a.onclick=n,c.onclick=n,s.appendChild(a),s.appendChild(c)}))}(n,s)}(c.project.workflow.connections,t,this.drawingArea,w,c),this.plottersObservables.connectionsDrawn$.next()}));let b=(e,t)=>{e.pipe(r.filter((e=>null==this.drawingConnection&&this.connectionCreationEnabled))).subscribe((e=>{let[n,o]=g(e.event.target,c);this.drawingConnection=new f(n,c.project.workflow,o,e.event.target,t,!0,!1)}))},v=(e,t)=>{e.pipe(r.filter((e=>null!=this.drawingConnection&&this.drawingConnection.plugType==("input"==t?"output":"input")))).subscribe((e=>{let[n,s]=g(e.event.target,c),i="input"==t?new o.Connection(this.drawingConnection.slot,h(n,c.project.workflow,e.event.target,"input")):new o.Connection(h(n,c.project.workflow,e.event.target,"output"),this.drawingConnection.slot);this.appStore.addConnection(i),this.connectionCreationEnabled=!1,setTimeout((()=>this.connectionCreationEnabled=!0),500)}))};b(this.plottersObservables.plugInputClicked$,"input"),b(this.plottersObservables.plugOutputClicked$,"output"),v(this.plottersObservables.plugInputClicked$,"input"),v(this.plottersObservables.plugOutputClicked$,"output"),this.plottersObservables.mouseMoved$.pipe(r.filter((e=>void 0!==this.drawingConnection))).subscribe((e=>this.plotDrawingConnection(this.drawingConnection,e))),this.appObservables.connectionSelected$.subscribe((e=>document.getElementById(p(e)).classList.toggle("selected"))),this.appObservables.unselect$.subscribe((()=>{let e=document.getElementById("drawing-connection");e&&e.remove(),this.drawingConnection=void 0}))}plotDrawingConnection(e,t){e.isStarted=!0;let n=[(t[0]-1-this.drawingArea.overallTranform.translateX)/this.drawingArea.overallTranform.scale,(t[1]-1-this.drawingArea.overallTranform.translateY)/this.drawingArea.overallTranform.scale],o=this.drawingArea.drawingGroup.selectAll(".drawing-connection").data([{data:e.data,htmlPlug:e.domElement}]);o.exit().remove(),o.attr("x2",n[0]),o.attr("y2",n[1]),o.enter().append("line").attr("id","drawing-connection").attr("class","drawing-connection").attr("x1",e.xOrigin).attr("y1",e.yOrigin).attr("x2",n[0]).attr("y2",n[1])}connectUserInteractions(e){e.pipe(r.filter((e=>"click"===e.action))).subscribe((e=>this.appStore.selectConnection(e.data.data)))}}var b=n(137),v=n(578),x=n(979);function y(e,t,n){let o=(new e.Factory.BuilderView).render(e);o.onclick=t=>{t.stopPropagation(),n.selectModule(e.moduleId)};let s=t.querySelector("#"+e.moduleId);s&&s.remove(),o.id=e.moduleId,o.classList.add("module","plugin");let i=0,r=50;t.getBBox&&(i=t.getBBox().height-t.querySelector(".content").getBBox().height/2),t.appendChild(o),o.getBBox&&(r=o.getBBox().height/2);let l=i+r;return o.setAttribute("x",t.getAttribute("x")),o.setAttribute("y",Number(t.getAttribute("y"))+l),o.setAttribute("transform","translate(0,"+l+")"),o}class I{constructor(e,t,n,o){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=o,this.debugSingleton=s.ST.getInstance(),this.groups={},this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create plugins plotter",object:{drawingArea:e,plottersObservables:t}})}draw(e){Object.values(this.groups).forEach((e=>e.remove()));let t=this.appStore.project.workflow.plugins.filter((t=>e[t.parentModule.moduleId])).map((t=>[t,e[t.parentModule.moduleId]]));return this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"PluginsPlotter draw",object:{modulesDrawn:e,plugins:this.appStore.project.workflow.plugins,plugInsToPlot:t}}),this.groups=t.map((([e,t])=>[e.moduleId,y(e,t,this.appStore)])).reduce(((e,t)=>(e[t[0]]=t[1],e)),{}),this.groups}}function S(e,t,n){let o=e.map((e=>document.getElementById(e))).filter((e=>e)).map((e=>e.getBBox?function(e,t,n){var o=document.getElementById(n.svgCanvas.attr("id")).getBoundingClientRect();let s=n.overallTranform;return{xmin:(t.a*e.x+t.c*e.y+t.e-o.left-s.translateX)/s.scale,ymin:(t.b*e.x+t.d*e.y+t.f-o.top-s.translateY)/s.scale,xmax:(t.a*(e.x+e.width)+t.c*(e.y+e.height)+t.e-o.left-s.translateX)/s.scale,ymax:(t.b*(e.x+e.width)+t.d*(e.y+e.height)+t.f-o.top-s.translateY)/s.scale}}(e.getBBox(),e.getScreenCTM(),n):{xmin:e.getAttribute("x"),xmax:e.getAttribute("x"),ymin:e.getAttribute("y"),ymax:e.getAttribute("y")})).reduce(((e,t)=>({xmin:Math.min(e.xmin,t.xmin),xmax:Math.max(e.xmax,t.xmax),ymin:Math.min(e.ymin,t.ymin),ymax:Math.max(e.ymax,t.ymax)})),{xmin:1e6,xmax:-1e6,ymin:1e6,ymax:1e-6});return{x:o.xmin-t,y:o.ymin-t,width:o.xmax-o.xmin+2*t,height:o.ymax-o.ymin+2*t}}class j{constructor(e,t,n,r){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=r,this.plotsFactory={},this.debugSingleton=s.ST.getInstance(),this.modulePlots=[],this.previousActiveSeriesId=[],this.dragging=!1,this.dragTranslation=[0,0];let a=new i.Subject;this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create modules plotter",object:{drawingArea:e,plottersObservables:t}}),new l.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:e,entities:[]}).draw([]),this.pluginsPlotter=new I(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),(0,i.combineLatest)([n.packagesLoaded$,this.plottersObservables.modulesViewUpdated$]).subscribe((()=>{let{modulesDrawn:e,activeSeries:t}=function(e,t,n){let o,s=[],r=t.getDisplayedModulesView();if(t.activeGroupId!=t.rootComponentId){let e=function(e){let t=e.modulesView.map((e=>[e.xWorld,e.yWorld])),n=t.reduce(((e,t)=>e<t[0]?e:t[0]),1e10),o=t.reduce(((e,t)=>e>t[0]?e:t[0]),-1e10),s=t.reduce(((e,t)=>e<t[1]?e:t[1]),1e10);return[(o+n)/2,(t.reduce(((e,t)=>e>t[1]?e:t[1]),-1e10)+s)/2]}(r.currentLayer),t=function(e){let t=e.modulesView.map((e=>[e.xWorld,e.yWorld])),n=t.reduce(((e,t)=>e<t[0]?e:t[0]),1e10),o=t.reduce(((e,t)=>e>t[0]?e:t[0]),-1e10),s=t.reduce(((e,t)=>e<t[1]?e:t[1]),1e10);return[(o-n)/2,(t.reduce(((e,t)=>e>t[1]?e:t[1]),-1e10)-s)/2]}(r.currentLayer),n=r.parentLayer.currentGroupModuleView;o=(o,s)=>{let i=Math.pow((o-n.xWorld)*(o-n.xWorld)+(s-n.yWorld)*(s-n.yWorld),.5),r=(o-n.xWorld)/i,l=(s-n.yWorld)/i,a=(i+t[0])*r+r/Math.abs(r)*50,d=(i+t[1])*l+l/Math.abs(l)*75;return[e[0]+a,e[1]+d]}}let a=e=>({x:e.xWorld,y:e.yWorld,classes:["module"].concat(t.isSelected(e.moduleId)?["selected"]:[]),attributes:{moduleId:e.moduleId},id:e.moduleId,Factory:e.Factory,data:{module:t.getModule(e.moduleId),moduleView:e}}),d=r.currentLayer.modulesView.map(a),c=r.parentLayer.modulesView.map((e=>Object.assign({},a(e),{projection:o}))),u=b.groupBy([...d,...c],(e=>e.Factory.uid)),p={},m=[],h=e=>{e.filter((e=>e)).forEach((e=>{if(e.id.includes("group")){let n=t.getModule(e.id);n.inputSlots.map((e=>e.moduleId)).concat(n.outputSlots.map((e=>e.moduleId))).forEach((t=>{p[t]=e}))}p[e.id]=e}))};return Object.entries(u).map((([t,o])=>{let r=function(e,t){let n=e.Factory,o=new n.BuilderView,s=new i.Subject,r=(0,l.toCssName)(n.uid)+"_ModulesPlot",a=new l.CrossPlot({plotId:r,plotClasses:[r,n.packId],drawingArea:t,entities$:s});return a.defaultElementDisplay=e=>o.render(e.data.module),a}(o[0],e);m.push(r.plotId),s.push(r);let a=r.draw(o);return a.entered._groups.forEach((e=>h(e))),a.updated._groups.forEach((e=>h(e))),r.entities$.subscribe((e=>n.next(e))),r})),{modulesDrawn:p,activeSeries:m}}(this.drawingArea,this.appStore,a),n=this.pluginsPlotter.draw(e),s=function(e,t,n){if(!e||e===n.rootComponentId)return new l.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:t,entities:[]}).draw([]),{};let s=n.getGroup(e),i=n.project.workflow.modules.find((e=>e instanceof o.GroupModules.Module&&e.moduleId==s.moduleId)),r=S(n.getDisplayedModulesView().currentLayer.modulesView.map((e=>e.moduleId)),50,t),a=t.hScale.invert(r.x+r.width/2),d=t.vScale.invert(r.y+r.height/2),c=[{id:"expanded_"+i.moduleId,x:a,y:d,classes:["active-layer-box"],attributes:{layerId:e},data:{boundingBox:r}}],u=new l.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:t,entities:c});u.defaultElementDisplay=o.GroupModules.expandedGroupPlot(i);let p=u.draw(c),m=p.entered._groups.concat(p.updated._groups).reduce(((e,t)=>e.concat(t)),[]).filter((e=>e));return{[i.moduleId]:m[0]}}(this.appStore.activeGroupId,this.drawingArea,this.appStore);this.connectUserInteractions(Object.assign({},e,s)),this.emptyRemovedSeries(this.previousActiveSeriesId,t),this.previousActiveSeriesId=t,this.plottersObservables.modulesDrawn$.next({...e,...n,...s})})),this.appObservables.moduleSelected$.subscribe((e=>{let t=document.getElementById(e.moduleId);t&&!t.classList.contains("selected")&&t.classList.add("selected")})),this.appObservables.modulesUnselected$.subscribe((e=>{e.forEach((e=>{let t=document.getElementById(e.moduleId);t&&t.classList.contains("selected")&&t.classList.remove("selected")}))})),n.unselect$.subscribe((()=>{this.unselect()}))}highlight(e){e.map((e=>document.getElementById(e))).forEach((e=>{e&&e.classList.add("highlighted")}))}unselect(){let e=document.getElementsByClassName("selected");for(;e.length>0;)e[0].classList.remove("selected"),e=document.getElementsByClassName("selected");for(e=document.getElementsByClassName("highlighted");e.length>0;)e[0].classList.remove("highlighted"),e=document.getElementsByClassName("highlighted")}connectUserInteractions(e){Object.entries(e).forEach((([e,t])=>{let n=n=>{n.target.classList.contains("slot")?n.target.classList.contains("output")?this.plottersObservables.plugOutputClicked$.next({event:n,group:t,moduleId:e}):this.plottersObservables.plugInputClicked$.next({event:n,group:t,moduleId:e}):(n.stopPropagation(),this.appStore.selectModule(e))};if(t.onclick=n,t.onmousedown=n,!this.appStore.project.workflow.plugins.map((e=>e.moduleId)).includes(e)&&!t.classList.contains("active-layer-box")){var o=(0,v.Z)();o.on("start",(e=>{this.dragSelection(e,!1)})).on("drag",(e=>this.dragSelection(e,!1))).on("end",(e=>this.dragSelection(e,!0))),(0,x.Z)(t).call(o)}}))}emptyRemovedSeries(e,t){e.filter((e=>!t.includes(e))).forEach((e=>document.querySelector("g#"+e).remove()))}dragSelection(e,t){this.dragging=!0;let n=this.appStore.getModulesSelected().filter((e=>this.appStore.getActiveGroup().getModuleIds().includes(e.moduleId)||e.layerId)),o=[];return n.forEach((n=>{let s=document.getElementById(n.moduleId),i=s.querySelectorAll("g.plugin"),r=Number(s.getAttribute("x"))+e.dx,l=Number(s.getAttribute("y"))+e.dy;Array.from(i).forEach((t=>{t.setAttribute("x",Number(t.getAttribute("x"))+e.dx),t.setAttribute("y",Number(t.getAttribute("y"))+e.dy)})),this.dragTranslation[0]+=e.dx,this.dragTranslation[1]-=e.dy,s.setAttribute("x",r),s.setAttribute("y",l),s.style.transform="translate("+r+"px,"+l+"px)",s.setAttribute("transform","translate("+r+","+l+")"),t&&(o.push({moduleId:n.moduleId,x:this.drawingArea.hScale.invert(r),y:this.drawingArea.vScale.invert(l),translation:this.dragTranslation}),s.style.transform="")})),t&&(this.appStore.moveModules(o),this.dragging=!1,this.dragTranslation=[0,0]),o}}class k{constructor(e,t,n,o,i){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=o,this.modulesPlotter=i,this.debugSingleton=s.ST.getInstance(),this.start=void 0,this.rect=void 0}startSelection(e){e=this.convert(e),this.rect=this.drawingArea.drawingGroup.append("rect").attr("class","rectangle-selector").attr("x",e[0]).attr("y",e[1]).attr("height",0).attr("width",0),this.start=e}finishSelection(e){this.start=void 0;let t=k.getSelectedModules(this.appStore.getActiveModulesView(),this.drawingArea,this.rect);S(t,10,this.drawingArea),this.rect.remove(),this.appStore.select({modulesId:t,connectionsId:[]})}moveTo(e){if(!this.start)return;e=this.convert(e),this.rect.attr("width",Math.max(0,e[0]-+this.rect.attr("x"))).attr("height",Math.max(0,e[1]-+this.rect.attr("y")));let t=k.getSelectedModules(this.appStore.getActiveModulesView(),this.drawingArea,this.rect);this.modulesPlotter.highlight(t)}static getSelectedModules(e,t,n){let o=e.map((e=>[e.moduleId,t.hScale(e.xWorld),t.vScale(e.yWorld)])),s=Number(n.attr("x")),i=Number(n.attr("y")),r=s+Number(n.attr("width")),l=i+Number(n.attr("height"));return o.filter((([e,t,n])=>t>s&&t<r&&n>i&&n<l)).map((([e,t,n])=>e))}convert([e,t]){let n=this.drawingArea.overallTranform;return[(e-n.translateX)/n.scale,(t-n.translateY)/n.scale]}}function $(e,t,n){let o=e.map((e=>{let o=S(e.modulesId,10,t),s=t.hScale.invert(o.x+o.width/2),i=t.vScale.invert(o.y+o.height/2),r=n.descriptionBoxSelected&&n.descriptionBoxSelected.descriptionBoxId==e.descriptionBoxId;return{x:s,y:i,classes:["description-box"].concat(r?["selected"]:[]),attributes:{descriptionBoxId:e.descriptionBoxId},id:e.descriptionBoxId,data:{descriptionBox:e,boundingBox:o}}})),s=new l.CrossPlot({plotId:"descriptionsBoxPlotter",plotClasses:[],drawingArea:t,entities:o});s.defaultElementDisplay=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","g");let n=e.data.boundingBox.width,o=e.data.boundingBox.height;return t.innerHTML=`\n       <rect height="${o}" width="${n}" \n        class="description-box content"  x="${-n/2}" y="${-o/2}"\n        filter="url(#shadow)" ></rect>\n        <path d="M${-n/2},${0-o/2} v-15 q0,-10 10,-10 h${n-20} q10,0 10,10  v15 z" \n                class="description-box mdle-color-fill header " />\n        <path d="M${-n/2},${0-o/2} v-15 q0,-10 10,-10 h${n-20} q10,0 10,10  v15 " \n                class="description-box header outline" />\n\n        <text class="description-box title" x="${-n/2+10}" y="${-o/2-5}" >${e.data.descriptionBox.title}</text>\n        `,t};let i=s.draw(o);return i.entered._groups.concat(i.updated._groups).map((e=>e.filter((e=>e)).reduce(((e,t)=>e.concat(t)),[]))).reduce(((e,t)=>e.concat(t)),[])}class C{constructor(e,t,n,o){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=o,this.debugSingleton=s.ST.getInstance(),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create descriptions boxes plotter",object:{drawingArea:e,plottersObservables:t}}),$([],this.drawingArea,this.appStore),this.appObservables.descriptionsBoxesUpdated$.subscribe((e=>{let t=$(e,this.drawingArea,this.appStore);this.connectUserInteractions(t),this.plottersObservables.descriptionsBoxesDrawn$.next(t)}))}connectUserInteractions(e){e.forEach((e=>e.onclick=t=>this.appStore.selectDescriptionBox(e.id)))}}class M{static initialize(e){M.workflowPlotter=e}}class E{constructor(e,t,n,i,l={margin:50}){this.drawingArea=e,this.appObservables=t,this.plottersObservables=n,this.appStore=i,this.options=l,this.debugSingleton=s.ST.getInstance(),this.modulesPlotter=void 0,this.connectionsPlotters=void 0,this.boxSelectorPlotter=void 0,this.descriptionsBoxesPlotter=void 0,this.pluginsPlotter=void 0,this.descriptionsBoxesPlotter=new C(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.modulesPlotter=new j(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.connectionsPlotters=new w(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.boxSelectorPlotter=new k(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore,this.modulesPlotter),function(e,t,n){(function(e,t){return e.pipe((0,r.filter)((({fromLayerId:e,toLayerId:t})=>null!=e&&null!=t)),(0,r.map)((({fromLayerId:e,toLayerId:n})=>({fromLayer:t.getGroup(e),toLayer:t.getGroup(n)}))),(0,r.map)((({fromLayer:e,toLayer:n})=>{if(e.getAllChildren(t.project.workflow).includes(n))return document.getElementById("expanded_"+n.moduleId);if(n.getAllChildren(t.project.workflow).includes(e)){let s=n.getDirectChildren(t.project.workflow).find((t=>t instanceof o.GroupModules.Module&&(t==e||t.getModuleIds().includes(e.moduleId))));return document.getElementById(s.moduleId)}return document.getElementById("expanded_"+n.moduleId)})),(0,r.map)((e=>{let t=e.getBoundingClientRect();return[.5*(t.left+t.right),.5*(t.top+t.bottom)]})))})(e,t).subscribe((e=>n.lookAt(e[0],e[1])))}(this.appObservables.activeLayerUpdated$,this.appStore,this.drawingArea),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create WorkflowPlotter",object:{drawingArea:this.drawingArea,modulePlotter:this.modulesPlotter,connectionsPlotters:this.connectionsPlotters}}),this.appObservables.activeLayerUpdated$.subscribe((t=>{t.toLayerId!=i.rootComponentId?e.svgCanvas.select(".workspace-background").attr("class","workspace-background child-layer"):e.svgCanvas.select(".workspace-background").attr("class","workspace-background")}));let a=this.plottersObservables,d=this.boxSelectorPlotter,c=document.querySelector("svg"),u=e=>[e.offsetX||e.clientX,e.offsetY||e.clientY];c.onmousedown=e=>{d.startSelection(u(e))},c.onmousemove=e=>{e.ctrlKey?d.moveTo(u(e)):a.mouseMoved$.next(u(e))},c.onmouseup=e=>{e.ctrlKey&&d.finishSelection(u(e))},c.onclick=e=>{e.ctrlKey||i.unselect()},window.onkeydown=e=>{"Delete"==e.key&&"BODY"==document.activeElement.tagName&&this.appStore.deleteSelected()},this.loadExtensions()}loadExtensions(){o.FluxExtensionAPIs&&(M.initialize(this),o.FluxExtensionAPIs.registerAPI("BuilderRenderingAPI",M))}}},862:(e,t,n)=>{"use strict";var o;n.d(t,{Dw:()=>d,ST:()=>r,dk:()=>$,in:()=>o,CE:()=>k}),function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Error=2]="Error"}(o||(o={}));class s{constructor(e,t,n,o){this.topic=e,this.message=t,this.object=n,this.level=o,this.hours=0,this.minutes=0,this.seconds=0,this.miniseconds=0,this.date=new Date}}class i{log(e){e.level!=o.Info&&e.level!=o.Debug||console.log("#"+e.topic,{date:e.date.getHours()+"h"+e.date.getMinutes()+"mn"+e.date.getSeconds()+"s"+e.date.getMilliseconds(),level:e.level,message:e.message,object:e.object}),e.level==o.Error&&console.error("#"+e.topic,{date:e.date.getHours()+"h"+e.date.getMinutes()+"mn"+e.date.getSeconds()+"s"+e.date.getMilliseconds(),level:e.level,message:e.message,object:e.object})}}class r{constructor({WorkflowBuilder:e,workflowView:t,observable:n,UI:s,renderTopicLevel:r}){this.debugOn=!0,this.WorkflowBuilderEnabled=!0,this.WorkflowBuilderLevel=o.Info,this.workflowViewEnabled=!0,this.workflowViewLevel=o.Info,this.workflowView$Enabled=!0,this.workflowView$Level=o.Info,this.observableEnabled=!0,this.observableLevel=o.Info,this.renderTopicEnabled=!0,this.renderTopicLevel=o.Info,this.appTopicEnabled=!0,this.appTopicLevel=o.Info,this.workflowUIEnabled=!0,this.loger=new i,this.WorkflowBuilderLevel=e,this.observableLevel=n,this.renderTopicLevel=r}logWorkflowBuilder({level:e,message:t,object:n}){this.WorkflowBuilderEnabled&&e>=this.WorkflowBuilderLevel&&this.loger.log(new s("WorkflowBuilder",t,n,e))}logObservable({level:e,message:t,object:n}){this.observableEnabled&&e>=this.observableLevel&&this.loger.log(new s("Observables",t,n,e))}logWorkflowView({level:e,message:t,object:n}){this.workflowViewEnabled&&e>=this.workflowViewLevel&&this.loger.log(new s("WorkflowView",t,n,e))}logWorkflowView$({level:e,message:t,object:n}){this.workflowView$Enabled&&e>=this.workflowView$Level&&this.loger.log(new s("WorkflowView Observables",t,n,e))}logRenderTopic({level:e,message:t,object:n}){this.renderTopicEnabled&&e>=this.renderTopicLevel&&this.loger.log(new s("Render",t,n,e))}logAppTopic({level:e,message:t,object:n}){this.appTopicEnabled&&e>=this.appTopicLevel&&this.loger.log(new s("App",t,n,e))}static getInstance(){return r.instance||(r.instance=new r({WorkflowBuilder:o.Info,workflowView:o.Info,UI:o.Info,observable:o.Info,renderTopicLevel:o.Info,appTopicLevel:o.Info})),r.instance}}r.instance=void 0;var l=n(158);class a{constructor(){this.debugSingleton=r.getInstance(),this.projectUpdated$=new l.ReplaySubject(1),this.packagesObserver$=new l.ReplaySubject(1),this.packagesLoaded$=new l.ReplaySubject(1),this.uiStateUpdated$=new l.ReplaySubject(1),this.packagesUpdated$=new l.Subject,this.connectionsUpdated$=new l.Subject,this.modulesUpdated$=new l.Subject,this.moduleAdded$=new l.Subject,this.moduleSelected$=new l.Subject,this.modulesUnselected$=new l.Subject,this.moduleSettingsEdited$=new l.Subject,this.adaptorEdited$=new l.Subject,this.connectionSelected$=new l.Subject,this.unselect$=new l.Subject,this.renderingLoaded$=new l.Subject,this.cssUpdated$=new l.Subject,this.descriptionsBoxesUpdated$=new l.Subject,this.activeLayerUpdated$=new l.Subject,this.ready$=new l.ReplaySubject(1),this.flowReady$=new l.Subject,this.suggestions$=new l.Subject,this.notifications$=new l.Subject,this.debugSingleton.debugOn&&["projectUpdated$","packagesObserver$","packagesLoaded$","packagesUpdated$","connectionsUpdated$","unselect$","moduleSelected$","modulesUnselected$","moduleSettingsEdited$","connectionSelected$","renderingLoaded$","moduleAdded$","cssUpdated$","uiStateUpdated$","descriptionsBoxesUpdated$","activeLayerUpdated$","ready$","flowReady$","suggestions$","modulesUpdated$","notifications$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return a.instance||(a.instance=new a),a.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logObservable({level:o.Info,message:e,object:{args:t}})}}a.instance=void 0;class d{constructor(){this.debugSingleton=r.getInstance(),this.connectionsView$=new l.Subject,this.modulesViewUpdated$=new l.Subject,this.moduleViewSelected$=new l.Subject,this.modulesDrawn$=new l.ReplaySubject(1),this.connectionsDrawn$=new l.ReplaySubject(1),this.descriptionsBoxesDrawn$=new l.ReplaySubject(1),this.activeLayerDrawn$=new l.ReplaySubject(1),this.modulesViewCompleted$=new l.Subject,this.plugsViewCompleted$=new l.Subject,this.connectionsViewCompleted$=new l.Subject,this.moduleEvent$=new l.Subject,this.moduleSelected$=new l.Subject,this.plugInputClicked$=new l.Subject,this.plugOutputClicked$=new l.Subject,this.mouseMoved$=new l.Subject,this.notification$=new l.ReplaySubject(1),this.debugSingleton.debugOn&&["modulesViewUpdated$","moduleViewSelected$","moduleSelected$","moduleEvent$","modulesDrawn$","descriptionsBoxesDrawn$","activeLayerDrawn$","notification$","connectionsDrawn$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return d.instance||(d.instance=new d),d.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView$({level:o.Info,message:e,object:{args:t}})}}d.instance=void 0;var c=n(935);class u extends c.ExtensionsObservables{constructor(){super(),this.debugSingleton=r.getInstance(),this.debugSingleton.debugOn&&["projectUpdated$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return u.instance||(u.instance=new u),u.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logObservable({level:o.Info,message:e,object:{args:t}})}}u.instance=void 0;var p=n(519);function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function h(e,t,n,o){if(n.moduleId===o)return[n,t];let s,i=n.getDirectChildren(e).filter((e=>e instanceof c.GroupModules.Module));for(let t of i){let i=h(e,n,t,o);if(i){s=i;break}}return s}function g(e,t,n,s,i,l,a,d){let u=r.getInstance();u.debugOn&&u.logWorkflowBuilder({level:o.Info,message:"createLayer",object:{modules:t,title:e}});let p=t.map((e=>e.moduleId)),m=new i.Module({moduleId:i.id.replace("@","_")+"_"+(0,c.uuidv4)(),configuration:new c.ModuleConfiguration({title:e,description:"",data:new i.PersistentData({moduleIds:t.map((e=>e.moduleId))})}),Factory:i,workflow$:a,environment:d}),h=n.workflow.modules.find((e=>e.moduleId==s)),g=f(h,{moduleIds:h.getModuleIds().filter((e=>!p.includes(e))).concat(m.moduleId)}),w=new c.Workflow({modules:n.workflow.modules.filter((e=>e.moduleId!=h.moduleId)).concat(m,g),connections:n.workflow.connections,plugins:n.workflow.plugins}),b=n.builderRendering.modulesView.filter((e=>m.getModuleIds().includes(e.moduleId))),v=b.reduce(((e,t)=>e+t.xWorld),0)/b.length,x=b.reduce(((e,t)=>e+t.yWorld),0)/b.length,y=new c.ModuleView(m.moduleId,v,x,i),I=[...n.builderRendering.modulesView,y];return{project:new c.Project({...n,workflow:w,builderRendering:new c.BuilderRendering(I,n.builderRendering.connectionsView,n.builderRendering.descriptionsBoxes)})}}function f(e,t){let n=new e.Factory.PersistentData({...e.getPersistentData(),...t}),o=new c.ModuleConfiguration({...e.configuration,data:n});return new e.Factory.Module(Object.assign({},e,{configuration:o}))}function w(e,t){return f(e,t)}function b({mdle:e,ready$:t,configuration:n,parent:o,workflow:s}){let i=e.Factory;if(null==n){let t=new i.PersistentData(e.configuration.data);n=new i.Configuration({title:e.configuration.title,description:e.configuration.description,data:t})}return"parentModule"in e?new e.Factory.Module({parentModule:o||e.parentModule,moduleId:e.moduleId,configuration:n,ready$:t,Factory:i,cache:e.cache,environment:e.environment}):new e.Factory.Module(Object.assign({},e,{workflow:s,configuration:n,ready$:t,Factory:i}))}function v(e,t){return e.map((e=>[e,t.plugins.find((t=>t.parentModule.moduleId==e.moduleId))])).filter((([e,t])=>null!=t)).map((([e,t])=>new t.Factory.Module({...t,parentModule:e})))}function x(e,t){return{createdElements:t.filter((t=>!e.includes(t))),removedElements:e.filter((e=>!t.includes(e)))}}var y,I=n(137);class S{static initialize(e){S.appStore=e}}function j(e,t){let n=t.requirements,o=e.lock.reduce(((e,t)=>({...e,[t.name]:t.version})),{}),s=e.lock.filter((e=>"flux-pack"==e.type)).map((e=>e.name)),i=new c.Requirements(n.fluxComponents,Array.from(s),o,e);return new c.Project({...t,requirements:i})}class k{constructor(e,t,n){this.mode=e,this.rendererEditorsVisible=t,this.isEditing=n}}class ${constructor(e,t,n){this.environment=e,this.appObservables=t,this.appBuildViewObservables=n,this.debugSingleton=r.getInstance(),this.builderViewsActions={configurationUpdated:e=>this.updateModule(e.module,e.configuration)},this.allSubscriptions=new Map,this.projectId=void 0,this.project=new c.Project({name:"new project",schemaVersion:"1.0",description:"",requirements:new c.Requirements([],[],{},{}),workflow:new c.Workflow({modules:[],connections:[],plugins:[]}),builderRendering:new c.BuilderRendering([],[],[]),runnerRendering:new c.RunnerRendering("","")}),this.workflow$=new l.ReplaySubject(1),this.rootComponentId="Component_root-component",this.activeGroupId=this.rootComponentId,this.adaptors=[],this.history=new Array(this.project),this.indexHistory=0,this.uiState=new k("combined",!1,!1),this.packages=[],this.implicitModules=[],this.moduleSelected=void 0,this.modulesSelected=[],this.connectionSelected=void 0,this.descriptionBoxSelected=void 0,this.appExtensionsObservables=u.getInstance(),this.environment=e,this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"AppStore constructed",object:{appStore:this}}),c.GroupModules.BuilderView.notifier$.pipe((0,p.filter)((e=>"groupFocused"==e.type))).subscribe((e=>this.selectActiveGroup(e.data))),c.Component.BuilderView.notifier$.pipe((0,p.filter)((e=>"groupFocused"==e.type))).subscribe((e=>this.selectActiveGroup(e.data))),c.GroupModules.BuilderView.notifier$.pipe((0,p.filter)((e=>"closeLayer"==e.type))).subscribe((e=>this.selectActiveGroup(this.getParentGroup(e.data).moduleId))),c.Component.BuilderView.notifier$.pipe((0,p.filter)((e=>"closeLayer"==e.type))).subscribe((e=>this.selectActiveGroup(this.getParentGroup(e.data).moduleId))),this.appObservables.renderingLoaded$.next({style:"",layout:"",cssLinks:[]})}static getInstance(e){return $.instance||($.instance=new $(e,a.getInstance(),d.getInstance())),$.instance}setUiState(e){this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"ui state updated",object:{state:e}}),this.uiState=e,this.appObservables.uiStateUpdated$.next(this.uiState)}loadProject(e,t,n){this.projectId=e;let o=(0,c.loadProjectDependencies$)(t,this.environment,n).pipe((0,p.map)((({project:e,packages:t})=>(0,c.createProject)(e,t,this.workflow$,this.allSubscriptions,this.environment))));this.initializeProject(o)}loadProjectId(e){this.projectId=e;let t=(0,c.loadProjectDatabase$)(e,this.workflow$,this.allSubscriptions,this.environment);this.initializeProject(t)}loadProjectURI(e){this.projectId=void 0;let t=(0,c.loadProjectURI$)(e,this.workflow$,this.allSubscriptions,this.environment);this.initializeProject(t)}initializeProject(e){e.subscribe((({project:e,packages:t})=>{this.appObservables.packagesUpdated$.next(t);let n=e.workflow.modules.find((e=>e.moduleId==this.rootComponentId));this.activeGroupId=n.moduleId,this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"project created",object:{project:this.project}}),this.updateProject(e),this.loadExtensions(),this.appObservables.ready$.next(!0),this.appObservables.packagesLoaded$.next(),this.appObservables.uiStateUpdated$.next(this.uiState);let s=n.getFullHTML(e.workflow),i=n.getFullCSS(e.workflow,{asString:!0});this.appObservables.renderingLoaded$.next({style:i,layout:s,cssLinks:[]}),this.unselect()}))}loadExtensions(){c.FluxExtensionAPIs&&(S.initialize(this),c.FluxExtensionAPIs.registerAPI("BuilderState",S))}addLibraries$(e,t){return function(e,t,n,o){let s=n.requirements.libraries;e.filter((e=>null!=s[e.name]&&s[e.name]!=e.version)).length>0&&console.error("You can not dynamically add libraries that are already used with different version");let i=e.filter((e=>null==s[e.name])).reduce(((e,t)=>({...e,[t.name]:t.version})),{}),r=n.requirements.fluxPacks;Array.from(new Set(t.map((e=>e.name)))).filter((e=>!r.includes(e))).filter((e=>(console.log(e,window[e]),window[e]&&(window[e].install||window[e].pack.install)))).forEach((e=>{let t=(window[e].install||window[e].pack.install)(o);t instanceof l.Observable&&t.subscribe(),t instanceof Promise&&t.then((()=>{}))}));let a={libraries:{...n.requirements.libraries,...i}};return o.getLoadingGraph(a).pipe((0,p.map)((e=>j(e,n))))}(e,t,this.project,this.environment).pipe((0,p.tap)((e=>{this.updateProject(e)})))}projectSchema$(){return function(e,t){let n=new Set([...e.workflow.modules.map((e=>e.Factory.packId)),...e.workflow.plugins.map((e=>e.Factory.packId))]),o=new Array(...n);if(o.length==e.requirements.fluxPacks.length)return(0,l.of)(e);let s={libraries:Object.entries(e.requirements.libraries).filter((([e,t])=>o.find((t=>e.includes(t))))).reduce(((e,[t,n])=>({...e,[t]:n})),{}),using:e.requirements.libraries};return t.getLoadingGraph(s).pipe((0,p.map)((t=>j(t,e))))}(this.project,this.environment).pipe((0,p.map)((e=>function(e){return{name:e.name,schemaVersion:e.schemaVersion,description:e.description,runnerRendering:e.runnerRendering,builderRendering:{descriptionsBoxes:e.builderRendering.descriptionsBoxes.map((e=>({descriptionBoxId:e.descriptionBoxId,descriptionHtml:e.descriptionHtml,modulesId:e.modulesId,title:e.title,properties:{color:e.properties.color}}))),modulesView:e.builderRendering.modulesView.map((e=>({moduleId:e.moduleId,xWorld:e.xWorld,yWorld:e.yWorld}))),connectionsView:e.builderRendering.connectionsView.map((e=>({connectionId:e.connectionId,wireless:e.wireless})))},requirements:e.requirements,workflow:(t=e.workflow,{modules:t.modules.map((e=>({moduleId:e.moduleId,factoryId:{module:e.Factory.id,pack:e.Factory.packId},configuration:{title:e.configuration.title,description:e.configuration.description,data:Object.assign({},e.configuration.data)}}))),connections:t.connections.map((e=>Object.assign({end:{moduleId:e.end.moduleId,slotId:e.end.slotId},start:{moduleId:e.start.moduleId,slotId:e.start.slotId}},e.adaptor?{adaptor:{adaptorId:e.adaptor.adaptorId,mappingFunction:e.adaptor.toString()}}:{}))),plugins:t.plugins.map((e=>({parentModuleId:e.parentModule.moduleId,moduleId:e.moduleId,factoryId:{module:e.Factory.id,pack:e.Factory.packId},configuration:{title:e.configuration.title,description:e.configuration.description,data:Object.assign({},e.configuration.data)}}))),rootLayerTree:void 0})};var t}(e))))}projectURI$(){return this.projectSchema$().pipe((0,p.map)((e=>{return`/ui/flux-builder/?uri=${t=e,encodeURIComponent(JSON.stringify(t))}`;var t})))}saveProject(){this.projectSchema$().pipe((0,p.mergeMap)((e=>this.environment.postProject(this.projectId,e).pipe((0,p.map)((()=>e)))))).subscribe((e=>{this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"project saved",object:{body:e,project:this.project}})}))}getModulesFactory(){return this.packages.map((e=>Object.entries(e.modules).map((([t,n])=>[`${n.id}@${e.id}`,n])))).reduce(((e,t)=>e.concat(t)),[]).reduce(((e,t)=>I.merge(e,{[t[0]]:t[1]})),{})}getAvailablePlugins(e){return function(e,t){let n=[];return Array.from(t.entries()).forEach((([t,o])=>{e.factory&&o.parentModule===e.factory.id&&n.push({factoryId:t,pluginFactory:o})})),n}(e,this.pluginsFactory)}getPlugins(e){return function(e,t){return t.workflow.plugins.filter((t=>t.parentModule.moduleId===e))}(e,this.project)}addPlugin(e,t){let n=function(e,t,n,s,i){let l=r.getInstance(),a=new e.Configuration,d=e.id+"_"+m(),u=new e.Module({parentModule:t,moduleId:d,configuration:a,Factory:e,ready$:s,environment:i});l.debugOn&&l.logWorkflowBuilder({level:o.Info,message:"add plugin",object:{plugin:u,pluginFactory:e}});let p=new c.Workflow({...n.workflow,plugins:n.workflow.plugins.concat([u])});return new c.Project({...n,workflow:p})}(e,t,this.project,this.appObservables.ready$,this.environment);return this.updateProject(n),n.workflow.plugins.slice(-1)[0]}addModule(e,t=[0,0]){let n=function(e,t,n,s,i,l){let a=r.getInstance(),d=new e.Configuration,u=e.id+"_"+m(),p=new e.Module({moduleId:u,configuration:d,Factory:e,ready$:i,environment:l}),h=new c.ModuleView(p.moduleId,t[0],t[1],e),g=n.workflow.modules.find((e=>e.moduleId==s)),f=new g.Factory.PersistentData({...g.getPersistentData(),moduleIds:g.getPersistentData().getModuleIds().concat(u)}),w=new c.ModuleConfiguration({...g.configuration,data:f}),b=new g.Factory.Module(Object.assign({},g,{configuration:w})),v=new c.Workflow({...n.workflow,modules:n.workflow.modules.filter((e=>e.moduleId!=g.moduleId)).concat(p,b),rootLayerTree:void 0}),x=new c.BuilderRendering(n.builderRendering.modulesView.concat(h),n.builderRendering.connectionsView,n.builderRendering.descriptionsBoxes),y=n.runnerRendering.layout,I=new c.Project({...n,workflow:v,builderRendering:x,runnerRendering:new c.RunnerRendering(y,n.runnerRendering.style)});return a.debugOn&&a.logWorkflowBuilder({level:o.Info,message:"add module",object:{factory:e,module:p,moduleView:h,project:I}}),I}(e,t,this.project,this.activeGroupId,this.appObservables.ready$,this.environment);return this.updateProject(n),n.workflow.modules.slice(-1)[0]}updateModule(e,t,n=!0){let s=function(e,t,n,s,i){let l=r.getInstance(),a=e.Factory,d="parentModule"in e,u=b({mdle:e,ready$:i,configuration:t,workflow:n.workflow});c.GroupModules.Module;let p=e=>{let t=n.workflow.plugins.filter((t=>t.parentModule.moduleId==e.moduleId)),o=t.map((e=>p(e))).filter((e=>e.length>0));if(o.length>0)throw"UPDATE MODULE: IMPLEMENTATION NOT DONE IN CASE OF NESTED PLUGINS";return t.concat(o.reduce(((e,t)=>e.concat(t)),[]))},m=p(e),h=[e.moduleId].concat(m.map((e=>e.moduleId))),g=n.workflow.modules.filter((e=>!h.includes(e.moduleId))),f=n.workflow.plugins.filter((e=>!h.includes(e.moduleId))),w=d?n.workflow.modules:g.concat([u]),v=d?f.concat([u]):f;v=v.concat(m.map((e=>b({mdle:e,ready$:i,parent:u}))));let x=u.inputSlots.map((e=>e.slotId)),y=u.outputSlots.map((e=>e.slotId)),I=n.workflow.connections.filter((e=>!(e.start.moduleId==u.moduleId&&!y.includes(e.start.slotId)||e.end.moduleId==u.moduleId&&!x.includes(e.end.slotId)))),S=new c.Workflow({modules:w,connections:I,plugins:v}),j=new c.Project({...n,workflow:S});return l.debugOn&&l.logWorkflowBuilder({level:o.Info,message:"module updated",object:{factory:a,newModule:u,newConfiguration:t,plugins:m,project:j,newPlugins:v,toRemoveIds:h,newModules:w,otherModules:g,otherPlugins:f}}),j}(e,t,this.project,this.allSubscriptions,this.appObservables.ready$);n&&this.unselect(),this.updateProject(s)}duplicateModules(e){let t=function(e,t,n){let s=r.getInstance(),i=t.workflow,l=e.map((e=>{let t=new e.Factory.Configuration({title:e.configuration.title,description:e.configuration.description,data:_.cloneDeep(e.configuration.data)}),o=e.Factory.id+"_"+m();return new e.Factory.Module({moduleId:o,configuration:t,ready$:n,Factory:e.Factory,environment:e.environment})})),a=t.builderRendering.modulesView.filter((t=>e.map((e=>e.moduleId)).includes(t.moduleId))),d=Math.max(...a.map((e=>e.yWorld))),u=Math.max(...a.map((e=>e.xWorld))),p=e.map(((e,t)=>new c.ModuleView(l[t].moduleId,u+50*(t+1),d+50*(t+1),e.Factory))),h=e.map(((e,n)=>[t.workflow.modules.find((t=>t instanceof c.GroupModules.Module&&t.getModuleIds().includes(e.moduleId))).moduleId,l[n].moduleId])).reduce(((e,[t,n])=>(e[t]=e[t]?e[t].concat(n):[n],e)),{}),g=Object.entries(h).map((([e,n])=>{let o=t.workflow.modules.find((t=>t.moduleId==e)),s=o.getPersistentData();return f(o,{moduleIds:s.getModuleIds().concat(...n)})})),w=new c.BuilderRendering(t.builderRendering.modulesView.concat(p),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes),b=new c.Project({...t,workflow:new c.Workflow({modules:i.modules.filter((e=>!g.map((e=>e.moduleId)).includes(e.moduleId))).concat(...l,...g),connections:i.connections,plugins:i.plugins}),builderRendering:w});return s.debugOn&&s.logWorkflowBuilder({level:o.Info,message:"duplicateModules",object:{modules:e,newModules:l,newViews:p,projectNew:b}}),b}(e,this.project,this.appObservables.ready$);this.updateProject(t)}alignH(e){let t=function(e,t,n){let o=t.builderRendering.modulesView.filter((t=>e.includes(t.moduleId))),s=t.builderRendering.modulesView.filter((t=>!e.includes(t.moduleId))),i=o.reduce(((e,t)=>e+t.yWorld),0)/o.length,r=o.map((e=>new c.ModuleView(e.moduleId,e.xWorld,i,e.Factory)));return new c.Project({...t,builderRendering:new c.BuilderRendering(s.concat(r),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes)})}(e.map((e=>e.moduleId)),this.project,this.appObservables.ready$);this.updateProject(t)}alignV(e){let t=function(e,t,n){let o=t.builderRendering.modulesView.filter((t=>e.includes(t.moduleId))),s=t.builderRendering.modulesView.filter((t=>!e.includes(t.moduleId))),i=o.reduce(((e,t)=>e+t.xWorld),0)/o.length,r=o.map((e=>new c.ModuleView(e.moduleId,i,e.yWorld,e.Factory)));return new c.Project({...t,builderRendering:new c.BuilderRendering(s.concat(r),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes)})}(e.map((e=>e.moduleId)),this.project,this.appObservables.ready$);this.updateProject(t)}moveModules(e){let t=function(e,t,n,s){let i=r.getInstance(),l=e.map((e=>[e])).reduce(((e,t)=>e.concat(t)),[]),a=t.filter((e=>!l.map((e=>e.moduleId)).includes(e.moduleId))),d=l.map((e=>[e,t.find((t=>t.moduleId==e.moduleId))])).filter((([e,t])=>Math.abs(t.xWorld-e.x)>3||Math.abs(t.yWorld-e.y)>3)).map((([e,t])=>new c.ModuleView(e.moduleId,e.x,e.y,t.Factory)));if(0==d.length)return;i.debugOn&&i.logWorkflowBuilder({level:o.Info,message:"move modules",object:{modulesPosition:e,modulesViewToKeep:a,modulesViewNew:d}});let u=n.builderRendering.descriptionsBoxes.find((e=>e.modulesId.length!==e.modulesId.filter((e=>d.map((e=>e.moduleId)).indexOf(e)>=0)).length))?n.builderRendering.descriptionsBoxes.map((e=>e.modulesId.find((e=>d.map((e=>e.moduleId)).indexOf(e)>=0))?new c.DescriptionBox(e.descriptionBoxId,e.title,e.modulesId,e.descriptionHtml,e.properties):e)):n.builderRendering.descriptionsBoxes;return new c.Project({...n,builderRendering:new c.BuilderRendering(a.concat(d),n.builderRendering.connectionsView,u)})}(e=e.filter((e=>this.getActiveGroup().getModuleIds().includes(e.moduleId))),this.project.builderRendering.modulesView,this.project,this.implicitModules);this.updateProject(t)}getModuleSelected(){return this.moduleSelected?this.moduleSelected:1==this.modulesSelected.length?this.modulesSelected[0]:void 0}getModulesSelected(){return this.moduleSelected?[this.moduleSelected]:this.modulesSelected.length>0?this.modulesSelected:[]}isSelected(e){return!(!this.moduleSelected||this.moduleSelected.moduleId!==e)||!(!this.modulesSelected||!this.modulesSelected.find((t=>t.moduleId===e)))}selectModule(e){this.modulesSelected.find((t=>t.moduleId==e))||this.moduleSelected&&this.moduleSelected.moduleId==e||(this.moduleSelected&&this.moduleSelected.moduleId!=e&&(this.appObservables.modulesUnselected$.next([this.moduleSelected]),this.moduleSelected=void 0),this.modulesSelected.find((t=>t.moduleId==e))||(this.appObservables.modulesUnselected$.next(this.modulesSelected),this.modulesSelected=[]),this.moduleSelected=this.getModule(e),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"module selected",object:{module:this.moduleSelected}}),this.appObservables.moduleSelected$.next(this.moduleSelected))}selectConnection(e){this.unselect(),this.connectionSelected=e instanceof c.Connection?e:this.getConnection(e),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"connection selected",object:{module:this.connectionSelected}}),this.appObservables.connectionSelected$.next(this.connectionSelected);let t=this.getModule(this.connectionSelected.start.moduleId),n=this.getModule(this.connectionSelected.end.moduleId),s=this.adaptors.filter((e=>e.fromModuleFactoryId===t.factoryId&&e.toModuleFactoryId===n.factoryId&&e.fromModuleSlotId===this.connectionSelected.start.slotId&&e.toModuleSlotId===this.connectionSelected.end.slotId));this.connectionSelected.adaptor||this.appObservables.suggestions$.next(s)}select({modulesId:e,connectionsId:t}){this.unselect(),this.modulesSelected=this.project.workflow.modules.filter((t=>e.includes(t.moduleId))),this.modulesSelected.forEach((e=>this.appObservables.moduleSelected$.next(e)))}getModuleOrPlugin(e){return this.getModulesAndPlugins().find((t=>t.moduleId===e))}getModule(e){let t=this.getModulesAndPlugins().find((t=>t.moduleId===e));return t||(t=this.implicitModules.find((t=>t.moduleId===e)),t)}deleteModules(e){this.unselect();let t=function(e,t){let n=r.getInstance();if(0===e.length)return;let s=e.map((e=>e.moduleId));n.debugOn&&n.logWorkflowBuilder({level:o.Info,message:"deleteModules",object:{modulesDeleted:e}});let i=e.filter((e=>e instanceof c.GroupModules.Module)),l=i.map((e=>e.getAllChildren(t.workflow))).flat(),a=t.workflow.modules.filter((e=>e instanceof c.GroupModules.Module)).filter((e=>!i.includes(e))).filter((e=>{let t=e.getModuleIds(),n=t.filter((e=>!s.includes(e)));return t.length!=n.length})),d=[...e.map((e=>e.moduleId)),...l.reduce(((e,t)=>e.concat(t.moduleId)),[])],u=t.workflow.plugins.filter((e=>d.includes(e.parentModule.moduleId))).map((e=>e.moduleId)),p=[...d,...u],m=a.map((e=>{let t=e.getModuleIds();return f(e,{moduleIds:t.filter((e=>!p.includes(e)))})})).filter((e=>{let t=e.getModuleIds().length>0||"Component_root-component"==e.moduleId;return t||p.push(e.moduleId),t})),h=v(m,t.workflow),g=[...d,...u,...a.map((e=>e.moduleId)),...h.map((e=>e.moduleId))],w=t.workflow.modules.filter((e=>!g.includes(e.moduleId))).concat(...m),b=t.workflow.plugins.filter((e=>!g.includes(e.moduleId))).concat(h),x=t.builderRendering.modulesView.filter((e=>!p.includes(e.moduleId))),y=t.workflow.connections.filter((e=>!p.includes(e.end.moduleId)&&!p.includes(e.start.moduleId))),I=new c.Workflow({modules:w,connections:y,plugins:b}),S=t.builderRendering.descriptionsBoxes.find((t=>t.modulesId.length!==t.modulesId.filter((t=>e.map((e=>e.moduleId)).indexOf(t)>=0)).length))?t.builderRendering.descriptionsBoxes.map((t=>{let n=t.modulesId.filter((t=>e.map((e=>e.moduleId)).indexOf(t)<0));return n.length==t.modulesId.length?t:(console.log("REMOVE MODULE FORM DBOX",n),new c.DescriptionBox(t.descriptionBoxId,t.title,n,t.descriptionHtml,t.properties))})):t.builderRendering.descriptionsBoxes;return new c.Project({...t,workflow:I,builderRendering:new c.BuilderRendering(x,t.builderRendering.connectionsView,S)})}(e,this.project);if(!t)return;let n=t.workflow.modules.find((e=>e.moduleId==this.rootComponentId));if(!h(t.workflow,n,n,this.activeGroupId)){let e=this.activeGroupId;return this.activeGroupId=this.rootComponentId,this.updateProject(t),void this.appObservables.activeLayerUpdated$.next({fromLayerId:e,toLayerId:this.activeGroupId})}this.updateProject(t)}deleteModule(e){e==this.moduleSelected&&this.unselect(),this.deleteModules([e])}getActiveGroup(){return h(this.project.workflow,void 0,this.getModule(this.rootComponentId),this.activeGroupId)[0]}getRootComponent(){return h(this.project.workflow,void 0,this.getModule(this.rootComponentId),this.rootComponentId)[0]}getGroup(e){let t=h(this.project.workflow,void 0,this.getModule(this.rootComponentId),e);if(null!=t)return t[0];console.error("Can not find group ",e)}selectActiveGroup(e){if(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"selectActiveLayer",object:{groupId:e}}),this.activeGroupId==e)return;let t=this.activeGroupId;this.activeGroupId=e,this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),this.appObservables.activeLayerUpdated$.next({fromLayerId:t,toLayerId:e})}getActiveModulesId(){return this.getGroup(this.activeGroupId).getModuleIds()}getActiveModulesView(){const e=this.getDisplayedModulesView();return[...e.currentLayer.modulesView,...e.parentLayer.modulesView]}getDisplayedModulesView(){let[e,t]=h(this.project.workflow,void 0,this.getModule(this.rootComponentId),this.activeGroupId);return function(e,t,n,o){let s=e.getModuleIds(),i=o.builderRendering.modulesView.filter((e=>s.includes(e.moduleId))),r=[];if(t){let e=t.getModuleIds();r=o.builderRendering.modulesView.filter((t=>e.includes(t.moduleId)))}return{parentLayer:{modulesView:r.filter((t=>!t.moduleId.includes(e.moduleId))),modules:r.map((e=>n.getModule(e.moduleId))),currentGroupModuleView:r.find((t=>t.moduleId.includes(e.moduleId)))},currentLayer:{modulesView:i,modules:i.map((e=>n.getModule(e.moduleId)))}}}(e,t,this,this.project)}getGroupModule(e){return this.project.workflow.modules.find((t=>t instanceof c.GroupModules.Module&&t.moduleId==e))}getParentGroup(e){let t=this.getModule(e);return this.project.workflow.plugins.map((e=>e.moduleId)).includes(t.moduleId)&&(t=t.parentModule),this.project.workflow.modules.filter((e=>e instanceof c.GroupModules.Module)).find((e=>e.getModuleIds().includes(t.moduleId)))}getModulesAndPlugins(){return this.project.workflow.modules.concat(this.project.workflow.plugins)}getConnection(e){return this.project.workflow.connections.find((t=>t.connectionId===e))}addConnection(e){let t=function(e,t,n){let s=r.getInstance();s.debugOn&&s.logWorkflowBuilder({level:o.Info,message:"connection added",object:{connection:e}});let i=t.workflow.modules,l=t.workflow.connections.concat(e),a=new c.Workflow({modules:i,connections:l,plugins:t.workflow.plugins});return a=new c.Workflow({modules:i,connections:l,plugins:t.workflow.plugins}),new c.Project({...t,workflow:a})}(e,this.project,this.allSubscriptions);this.updateProject(t),this.unselect(),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}setConnectionView(e,t,n=!0){let o=function(e,t,n){let o=n.builderRendering.connectionsView.filter((t=>t.connectionId!=e.connectionId)).concat([{connectionId:e.connectionId,wireless:t.wireless}]),s=new c.BuilderRendering(n.builderRendering.modulesView,o,n.builderRendering.descriptionsBoxes);return new c.Project({...n,builderRendering:s})}(e,t,this.project);this.updateProject(o),n&&this.unselect(),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}getConnectionSelected(){return this.connectionSelected}getConnectionView(e){return this.project.builderRendering.connectionsView.find((t=>t.connectionId==e))}deleteConnection(e){this.connectionSelected===e&&(this.connectionSelected=void 0,this.appObservables.unselect$.next());let t=function(e,t,n){let o=t.workflow.connections.filter((t=>t!=e)),s=new c.Workflow({...t.workflow,connections:o});return new c.Project({...t,workflow:s})}(e,this.project,this.allSubscriptions);this.updateProject(t),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}addAdaptor(e,t){let n=function(e,t,n,o){let s=n.workflow.connections.filter((t=>t!=e)),i=new c.Connection(e.start,e.end,t),r=new c.Workflow({...n.workflow,connections:s.concat(i)});return new c.Project({...n,workflow:r})}(t,e,this.project,this.allSubscriptions);this.updateProject(n),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}deleteAdaptor(e){let t=function(e,t,n){let o=t.workflow.connections.filter((t=>t!=e)),s=new c.Connection(e.start,e.end,void 0),i=new c.Workflow({...t.workflow,connections:o.concat(s)});return new c.Project({...t,workflow:i})}(e,this.project,this.allSubscriptions);this.updateProject(t),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}updateAdaptor(e,t){let n=function(e,t,n,o){let s=n.workflow.connections.filter((t=>t!==e)),i=e.adaptor?new c.Adaptor(e.adaptor.adaptorId,t):new c.Adaptor(m(),t),r=new c.Connection(e.start,e.end,i),l=new c.Workflow({...n.workflow,connections:s.concat(r)});return new c.Project({...n,workflow:l})}(e,t,this.project,this.allSubscriptions);this.updateProject(n),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}unselect(){this.modulesSelected=[],this.moduleSelected=void 0,this.connectionSelected=void 0,this.descriptionBoxSelected=void 0,this.appObservables.unselect$.next(),this.appObservables.suggestions$.next([])}deleteSelected(){this.uiState.isEditing||(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"delete selected",object:{connectionSelected:this.connectionSelected,moduleSelected:this.moduleSelected,modulesSelected:this.modulesSelected,descriptionBoxSelected:this.descriptionBoxSelected}}),this.connectionSelected&&this.deleteConnection(this.connectionSelected),this.moduleSelected&&this.deleteModule(this.moduleSelected),this.modulesSelected&&this.modulesSelected.length>0&&this.deleteModules(this.modulesSelected),this.descriptionBoxSelected&&this.deleteDescriptionBox(this.descriptionBoxSelected),this.appObservables.suggestions$.next([]))}addGroup(e){let t=new c.DescriptionBox(m(),"grouped module",e,"",new c.DescriptionBoxProperties(void 0)),{project:n}=(new c.GroupModules.Configuration({title:t.title}),g(t.title,t.modulesId.map((e=>this.getModule(e))),this.project,this.activeGroupId,c.GroupModules,0,this.workflow$,this.environment));this.updateProject(n)}addComponent(e){let t=new c.DescriptionBox(m(),"component",e,"",new c.DescriptionBoxProperties(void 0)),{project:n}=(new c.Component.Configuration({title:t.title}),g(t.title,t.modulesId.map((e=>this.getModule(e))),this.project,this.activeGroupId,c.Component,0,this.workflow$,this.environment));this.updateProject(n)}publishComponent(e){let t=void this.project;sessionStorage.setItem(e.moduleId,JSON.stringify(t)),window.open("/ui/assets-publish-ui?kind=flux-component&related_id="+e.moduleId,"_blank")}setRenderingLayout(e,t=!0){let n=function(e,t){let n=r.getInstance();n.debugOn&&n.logWorkflowBuilder({level:o.Info,message:"set rendering layout",object:{layout:e}});let s=function(e,t){let n=r.getInstance(),s=(i=t,(l=document.createElement("div")).innerHTML=i.trim(),l);var i,l;if(!s)return e;let a=Array.from(s.querySelectorAll(".flux-component")).reduce(((e,t)=>({...e,[t.id]:t.cloneNode(!0)})),{}),d=Object.keys(a),u=d.map((t=>e.modules.find((e=>e.moduleId==t)))).map((t=>{let n=a[t.moduleId];if(!n)return;t.getDirectChildren(e).filter((e=>e instanceof c.Component.Module)).forEach((e=>{let t=n.querySelector(`#${e.moduleId}`);t&&(t.innerHTML="")}));let o=n.outerHTML;return o!=t.getPersistentData().html?w(t,{html:o}):void 0})).filter((e=>e));n.debugOn&&n.logWorkflowBuilder({level:o.Info,message:"apply html layout",object:{newComponents:u,eventualUpdateNeeded:d}});let p=v(u,e);return new c.Workflow({...e,modules:e.modules.filter((e=>!u.find((t=>t.moduleId==e.moduleId)))).concat(...u),plugins:e.plugins.filter((e=>!p.find((t=>t.moduleId==e.moduleId)))).concat(...p)})}(t.workflow,e);return new c.Project({...t,workflow:s,runnerRendering:new c.RunnerRendering(e,t.runnerRendering.style)})}(e,this.project);this.updateProject(n,t)}setRenderingStyle(e,t=!0){let n=function(e,t,n){let s=r.getInstance();s.debugOn&&s.logWorkflowBuilder({level:o.Info,message:"set rendering style",object:{style:t}});let i=function(e,t,n){let s=r.getInstance(),i=e=>{let t=document.createElement("div");return t.appendChild(e),t},l=(e=>{let t=new CSSStyleSheet;return e.split("}").filter((e=>""!=e)).forEach((e=>{t.insertRule(e)})),t})(n),a=i(e.getFullHTML(t));if(!a)return t;let d=t.modules.filter((e=>e instanceof c.Component.Module)).filter((e=>null!=a.querySelector(`#${e.moduleId}`))).map((e=>{let n=e.getOuterHTML(),o=i(n),s=new Set;for(let n=0;n<l.rules.length;n++){let i=l.rules[n];Array.from(o.querySelectorAll(i.selectorText)).filter((n=>!e.getDirectChildren(t).filter((e=>e instanceof c.Component.Module)).map((e=>e.moduleId)).includes(n.id))).length>0&&s.add(i.cssText)}if(r=e.getPersistentData().css.split("\n"),a=[...s],r=r.filter((e=>""!=e)),a=a.filter((e=>""!=e)),r.length==a.length&&r.map((e=>a.includes(e))).reduce(((e,t)=>e&&t),!0))return;var r,a;let d=[...s].reduce(((e,t)=>e+"\n"+t),"");return w(e,{css:d})})).filter((e=>e));return 0==d.length?(s.debugOn&&s.logWorkflowBuilder({level:o.Info,message:"no changes in css",object:{}}),t):new c.Workflow({...t,modules:t.modules.filter((e=>!d.find((t=>t.moduleId==e.moduleId)))).concat(...d)})}(e,n.workflow,t);return i==n.workflow?n:new c.Project({...n,workflow:i,runnerRendering:new c.RunnerRendering(n.runnerRendering.layout,t)})}(this.getGroup(this.rootComponentId),e,this.project);n!=this.project&&this.updateProject(n,t)}addDescriptionBox(e){let t=function(e,t){let n=t.builderRendering.descriptionsBoxes.concat(e);return new c.Project({...t,builderRendering:new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,n)})}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}selectDescriptionBox(e){this.unselect(),this.descriptionBoxSelected=this.project.builderRendering.descriptionsBoxes.find((t=>t.descriptionBoxId==e)),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}updateDescriptionBox(e){this.unselect();let t=function(e,t){let n=t.builderRendering.descriptionsBoxes.filter((t=>t.descriptionBoxId!=e.descriptionBoxId)).concat([e]);return new c.Project({...t,builderRendering:new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,n)})}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}deleteDescriptionBox(e){e==this.descriptionBoxSelected&&this.unselect();let t=function(e,t){let n=t.builderRendering.descriptionsBoxes.filter((t=>t.descriptionBoxId!=e.descriptionBoxId));return new c.Project({...t,builderRendering:new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,n)})}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}updateProjectToIndexHistory(e,t){let n={modules:!1,modulesView:!1,connections:!1,activeLayer:!1,descriptionBox:!1};this.indexHistory=e,this.project=this.history[this.indexHistory];let s=this.history[t],i=function(e,t){let n={createdElements:[],removedElements:[]},o={createdElements:[],removedElements:[]};if(t.connections!==e.connections){let o=x(e.connections,t.connections);n.createdElements.push(...o.createdElements),n.removedElements.push(...o.removedElements)}if(t.modules!==e.modules){let s=x(e.modules,t.modules);o.createdElements.push(...s.createdElements),o.removedElements.push(...s.removedElements);let i=s.createdElements.map((e=>e.moduleId)),r=s.removedElements.map((e=>e.moduleId));n.createdElements.push(...t.connections.filter((e=>i.includes(e.end.moduleId))),...t.connections.filter((e=>i.includes(e.start.moduleId)))),n.removedElements.push(...e.connections.filter((e=>r.includes(e.start.moduleId)||r.includes(e.end.moduleId))))}if(t.plugins!==e.plugins){let s=x(e.plugins,t.plugins);o.createdElements.push(...s.createdElements),o.removedElements.push(...s.removedElements);let i=s.createdElements.map((e=>e.moduleId)),r=s.removedElements.map((e=>e.moduleId));n.createdElements.push(...t.connections.filter((e=>i.includes(e.end.moduleId))),...t.connections.filter((e=>i.includes(e.start.moduleId)))),n.removedElements.push(...e.connections.filter((e=>r.includes(e.start.moduleId)||r.includes(e.end.moduleId))))}return n.createdElements=Array.from(new Set(n.createdElements)),n.removedElements=Array.from(new Set(n.removedElements)),o.createdElements=Array.from(new Set(o.createdElements)),o.removedElements=Array.from(new Set(o.removedElements)),{connections:n,modules:o,hasDiff:n.createdElements.length+n.removedElements.length+o.createdElements.length+o.removedElements.length>0}}(s.workflow,this.project.workflow);var r,l,a;if(i.modules.removedElements&&i.modules.removedElements.filter((e=>(0,c.instanceOfSideEffects)(e))).forEach((e=>e.dispose())),i.modules.createdElements&&(r=i.modules.createdElements,l=this.builderViewsActions,a=this.appBuildViewObservables.notification$,r.forEach((e=>{e.Factory.consumersData.FluxAppstore||(e.Factory.consumersData.FluxAppstore={notifiersPluged:!1}),e.Factory.BuilderView.notifier$&&!e.Factory.consumersData.FluxAppstore.notifiersPluged&&(e.Factory.BuilderView.notifier$.pipe((0,p.filter)((e=>"configurationUpdated"==e.type))).subscribe((e=>{l[e.type]&&l[e.type](e.data)})),e.Factory.BuilderView.notifier$.subscribe((e=>a.next(e))),e.Factory.consumersData.FluxAppstore.notifiersPluged=!0)})),i.modules.createdElements.filter((e=>(0,c.instanceOfSideEffects)(e))).forEach((e=>e.apply()))),i.hasDiff&&this.workflow$.next(this.project.workflow),!n.modules&&(i.modules.createdElements.length>0||i.modules.removedElements.length>0)&&(this.appObservables.modulesUpdated$.next(i.modules),this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),n.modules=!0,n.modulesView=!0),!n.connections&&(i.connections.createdElements.length>0||i.connections.removedElements.length>0)&&(this.appObservables.connectionsUpdated$.next(this.project.workflow.connections),n.connections=!0),!n.modulesView&&this.project.builderRendering.modulesView!==s.builderRendering.modulesView){let e=x(s.builderRendering.modulesView,this.project.builderRendering.modulesView),t=[...e.createdElements.filter((t=>null==e.removedElements.find((e=>e.moduleId==t.moduleId)))),...e.createdElements.filter((t=>null==e.removedElements.find((e=>e.moduleId==t.moduleId))))];t.length>0?this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()):this.appObservables.connectionsUpdated$.next(this.project.workflow.connections),t.length>0&&(n.modulesView=!0)}n.activeLayer||this.activeGroupId==this.rootComponentId&&this.project.workflow.modules.find((e=>e.moduleId==this.rootComponentId))==s.workflow.modules.find((e=>e.moduleId==this.rootComponentId))||(n.modulesView||this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),this.appObservables.activeLayerUpdated$.next({fromLayerId:void 0,toLayerId:this.activeGroupId}),n.activeLayer=!0),n.descriptionBox||this.project.builderRendering.descriptionsBoxes===s.builderRendering.descriptionsBoxes||(this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),n.descriptionBox=!0),function(e,t,n,o){let s=n.concat(o).reduce(((e,t)=>e.concat(t.inputSlots)),[]),i=n.concat(o).reduce(((e,t)=>e.concat(t.outputSlots)),[]);t.removedElements.forEach((t=>{e.get(t).unsubscribe(),e.delete(t)})),t.createdElements.forEach((t=>{let n=i.find((e=>e.slotId==t.start.slotId&&e.moduleId==t.start.moduleId)),o=s.find((e=>e.slotId==t.end.slotId&&e.moduleId==t.end.moduleId)),r=n.observable$.subscribe((e=>o.subscribeFct({connection:t,message:e})));e.set(t,r)}))}(this.allSubscriptions,i.connections,this.project.workflow.modules,this.project.workflow.plugins),this.appObservables.projectUpdated$.next(this),this.appExtensionsObservables.projectUpdated$.next(i),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"updateProjectToIndexHistory",object:{oldProject:s,delta:i,newProject:this.project,history:this.history,updatesDone:n}})}undo(){0!=this.indexHistory&&(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"undo",object:{history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory-1,this.indexHistory))}redo(){this.indexHistory!=this.history.length-1&&(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"redo",object:{history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory+1,this.indexHistory))}updateProject(e,t=!0){if(!e)return;let n=this.indexHistory;t||(this.history=this.history.slice(0,-1),this.indexHistory--),this.indexHistory===this.history.length-1&&(this.history.push(e),this.indexHistory++),this.indexHistory<this.history.length-1&&(this.history=this.history.slice(0,this.indexHistory+1),this.history.push(e),this.indexHistory=this.history.length-1),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"updateProject",object:{newProject:e,history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory,n)}}$.instance=void 0,function(e){let t=new BroadcastChannel("out=>code-editor@BroadcastDrive"),n=new BroadcastChannel("code-editor@BroadcastDrive=>out");e.mountBroadcastDrive=function(e,o){let s,i=e.ownerId,r={action:"ping",channelResp:"code-editor=>flux",ownerId:i},a=!1,d=new l.BehaviorSubject(!1);(0,l.interval)(500).pipe((0,p.take)(1)).pipe((0,p.take)(1)).subscribe((()=>{a||(window.open(o,"_tab_code_editor"),(0,l.interval)(200).pipe((0,p.filter)((()=>!a))).subscribe((()=>t.postMessage(r))))})),t.postMessage(r),d.pipe((0,p.filter)((e=>1==e)),(0,p.mergeMap)((()=>e.mount$.pipe((0,p.map)((t=>e.drive(t))),(0,p.tap)((e=>s=e)))))).subscribe((n=>{let o={action:"mount",ownerId:i,codeEditor:{drive:{name:n.name,data:n.data},UI:e.UI}};t.postMessage(o)}));let c=e.unmount$.subscribe((()=>{t.postMessage({action:"unmount",ownerId:i}),c.unsubscribe()}));n.onmessage=({data:e})=>{if("ping-ack"==e.action&&e.ownerId==i&&(a=!0,d.next(!0)),"updateFile"==e.action&&e.ownerId==i){let n=()=>t.postMessage({action:"updateFile-ack",actionId:e.actionId,ownerId:i});s.onFileUpdated(e.data,n)}}}}(y||(y={}))},48:(e,t,n)=>{"use strict";n.d(t,{eD:()=>$.e,j3:()=>S,rj:()=>C.r});var o,s=n(888),i=n(396),r=n(158),l=n(519),a=n(222),d=n(327),c=n(735),u=n(97);!function(e){class t{constructor({ok$:e}){this.buffer$=new r.BehaviorSubject([]),this.ok$=e,this.explorerState=c.Q.singletonState,this.explorerState.selectionBuffer$=this.buffer$}}class n{constructor({state:e,options:t,...o}){Object.assign(this,o),this.options={...n.defaultOptions,...t||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.bufferColumnView(),this.explorerView()],this.connectedCallback=e=>{e.subscriptions.push(this.state.explorerState.selection$.pipe((0,l.scan)(((e,{node:t,selected:n})=>[...e.filter((e=>e!=t)),...n?[t]:[]]),[])).subscribe((e=>this.state.buffer$.next(e))))}}bufferColumnView(){let e=new d.Button.View({state:new d.Button.State(this.state.ok$),contentView:()=>({innerText:"Import"}),class:"fv-btn fv-btn-primary fv-bg-focus"});return{class:"px-2 d-flex flex-column w-25",style:{width:"200px"},children:[{class:"w-100 text-center",innerText:"selection buffer",style:{"font-family":"fantasy"}},(0,a.child$)(this.state.buffer$,(e=>e.length>0?{class:"d-flex flex-column flex-grow-1 overflow-auto",children:e.map((e=>({class:"d-flex align-items-center",children:[{innerText:e.name},{class:"fas fa-times px-2 yw-hover-opacity yw-pointer",onclick:()=>{this.state.explorerState.selection$.next({node:e,selected:!1})}}]})))}:{tag:"div",class:"py-2",innerText:"Pick one or more module(s) using the tabs on the right side to add them in your worksheet",style:{"font-style":"italic","text-align":"justify"}})),(0,a.child$)(this.state.buffer$,(t=>t.length>0?e:{}))]}}explorerView(){return{class:"h-100 overflow-auto w-75 border rounded",children:[new c.Q.View({state:this.state.explorerState,class:"h-100"})]}}}n.defaultOptions={containerClass:"h-100 w-100 p-3 rounded d-flex solid rounded",containerStyle:{}},e.View=n,e.popupModal=function(e,o){let s=new r.Subject,i=new t({ok$:s}),l=new n({state:i});u.R.popup({view:l,ok$:s,options:{displayOk:!1,displayCancel:!1}}).subscribe((()=>{o(i.buffer$.getValue())}))}}(o||(o={}));var p,m=n(313),h=n(230);!function(e){class t{constructor({module:e}){this.module=e}}e.State=t;class n{constructor({state:e,...t}){if(Object.assign(this,t),this.state=e,this.class=this.class||n.defaultOptions.containerClass,this.style=this.style||n.defaultOptions.containerStyle,0==this.state.module.journals.length)return void(this.children=[this.noJournalsAvailableView()]);if(1==this.state.module.journals.length)return void(this.children=[this.journalView(this.state.module.journals[0])]);let o=new r.BehaviorSubject(this.state.module.journals[0].title);this.children=[this.selectJournalView(o),(0,a.child$)(o.pipe((0,l.map)((e=>this.state.module.journals.find((t=>t.title==e))))),(e=>this.journalView(e)))]}noJournalsAvailableView(){return{innerText:"The module does not contains journals yet, it is likely that it did not run already."}}selectJournalView(e){let t=this.state.module.journals.map((e=>new m.Select.ItemData(e.title,e.title))),n=new m.Select.State(t,e);return{class:"d-flex align-items-center py-2",children:[{innerText:"Available reports:",class:"px-2"},new m.Select.View({state:n})]}}journalView(e){let t=new h.R.State({context:e.entryPoint,expandedNodes:[e.entryPoint.id]});return{class:"h-100 d-flex flex-column",children:[{class:"d-flex align-items-center justify-content-center",children:[{tag:"i",class:"fas fa-newspaper fa-2x px-3"},{class:"text-center py-2",style:{"font-family":"fantasy","font-size":"larger"},innerText:e.title}]},new h.R.View({state:t,options:{containerClass:"p-4 flex-grow-1 overflow-auto"}})]}}}n.defaultOptions={containerClass:"d-flex flex-column p-3",containerStyle:{"min-height":"0px"}},e.View=n,e.popupModal=function({module:e}){let o=new t({module:e}),s=new n({state:o});u.R.popup({view:s,style:{"max-height":"75vh",width:"75vw"},options:{displayCancel:!1,displayOk:!1}}).subscribe((()=>{}))}}(p||(p={}));class g extends s.ImmutableTree.Node{constructor({id:e,children:t,name:n,faIcon:o}){super({id:e,children:t}),this.name=n,this.faIcon=o}execute(e,{event:t}){}}class f extends g{constructor({children:e}){super({id:"root",children:e,name:"menu list",faIcon:""})}}class w extends g{constructor(){super({id:"new-modules",children:void 0,name:"new module(s)",faIcon:"fas fa-microchip"})}execute(e,{event:t}){let n=e.drawingArea.invert(t.clientX,t.clientY);o.popupModal(e.appState,(t=>{let o=t.map((e=>e.library)),s=t.flatMap((e=>e.fluxPacks.map((e=>e))));e.appState.addLibraries$(o,s).subscribe((()=>{t.forEach((t=>e.appState.addModule(t.factory,n)))}))}))}}class b extends g{constructor(){super({id:"add-plugins",children:void 0,name:"add plugin(s)",faIcon:"fas fa-microchip"})}execute(e,{event:t}){o.popupModal(e.appState,(t=>{let n=e.appState.getModuleSelected(),o=t.map((e=>e.library)),s=t.flatMap((e=>e.fluxPacks.map((e=>e))));e.appState.addLibraries$(o,s).subscribe((()=>{t.forEach((t=>e.appState.addPlugin(t.factory,n)))}))}))}}class v extends g{constructor(){super({id:"journals",children:void 0,name:"journals",faIcon:"fas fa-newspaper"})}execute(e){let t=e.appState.getModuleSelected();p.popupModal({module:t})}}class x extends g{static createChildren(e){let t=e.getModuleSelected().Factory.resources;return Object.entries(t).map((([e,t])=>new y({name:e,url:t})))}constructor(e){super({id:"documentation",children:x.createChildren(e),name:"documentation",faIcon:"fas fa-book"})}}class y extends g{constructor({name:e,url:t}){super({id:e,children:void 0,name:e,faIcon:"fas fa-book"}),this.url=t}execute(e){window.open(this.url,"_blank")}}let I={newModules:{createNode:e=>new w,applicable:e=>e.getModulesSelected().length>=0},addPlugins:{createNode:()=>new b,applicable:e=>1==e.getModulesSelected().length},journals:{createNode:e=>new v,applicable:e=>1==e.getModulesSelected().length&&e.getModuleSelected().journals.length>0},documentation:{createNode:e=>new x(e),applicable:e=>{if(1!=e.getModulesSelected().length)return!1;let t=e.getModuleSelected().Factory.resources;return t&&Object.entries(t).length>0}}};class S extends i.ContextMenu.State{constructor(e,t){super((0,r.fromEvent)(t.parentDiv,"contextmenu").pipe((0,l.tap)((e=>e.preventDefault())))),this.appState=e,this.drawingArea=t,this.htmlElement=t.parentDiv}dispatch(e){let t=Object.values(I).filter((e=>e.applicable(this.appState))).map((e=>e.createNode(this.appState))),n=new f({children:t}),o=new j(n),i=new s.ImmutableTree.View({state:o,headerView:k,class:"fv-bg-background fv-text-primary p-2 rounded"});return o.selectedNode$.next(n),o.selectedNode$.subscribe((t=>t.execute(this,{event:e}))),i}}class j extends s.ImmutableTree.State{constructor(e){super({rootNode:e,expandedNodes:[e.id]})}}function k(e,t){return{class:"d-flex w-100 align-items-baseline fv-pointer fv-hover-bg-background-alt px-1",children:[{tag:"i",class:t.faIcon},{tag:"span",class:"mx-2 w-100",innerText:t.name,style:{"user-select":"none"}}]}}n(182),n(825),n(350);var $=n(142),C=(n(991),n(910));n(143),n(700),n(864)},182:(e,t,n)=>{"use strict";n.d(t,{b:()=>o});var o,s=n(222),i=n(158),r=n(519),l=n(825),a=n(137),d=n(143),c=n(991),u=n(700),p=n(97);!function(e){class t{constructor(e,t,n){this.message=e,this.row=t,this.col=n}}class n{constructor({connection:e,initialCode:n,appStore:o}){this.appStore=o,this.connection=e;let s=new i.BehaviorSubject(n);this.codeEditorState=new l.a.State({content$:s}),this.mdleStart=this.appStore.getModule(e.start.moduleId),this.mdleEnd=this.appStore.getModule(e.end.moduleId),this.rawInput$=this.mdleStart.getOutputSlot(e.start.slotId).observable$,this.contract=this.mdleEnd.getInputSlot(this.connection.end.slotId).contract,this.adaptedInput$=(0,i.combineLatest)([s.pipe((0,r.debounceTime)(.5)),this.rawInput$]).pipe((0,r.map)((([e,n])=>{try{let t=new Function(e)()(n,this.mdleEnd.helpers);return t.configuration=a.merge({},this.mdleEnd.getPersistentData(),t.configuration),t}catch(e){return function(e){try{let n=e.split("\n"),o=n[0];if(n=n.filter((e=>e.includes("eval")&&2==e.split(",").length)),0==n.length)return new t(o,void 0,void 0);let s=n[0].split(",")[1].split("<anonymous>:")[1].split(")")[0],[i,r]=[Number(s.split(":")[0])-2,Number(s.split(":")[1])];return new t(o,i,r)}catch(e){return new t("Unidentified error",void 0,void 0)}}(e.stack)}})))}}e.State=n;class o{constructor({state:e,editorConfiguration:t,options:n,...s}){Object.assign(this,s),this.options={...o.defaultOptions,...n||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.dataColumnView(),{class:"d-flex flex-grow-1 flex-column h-100 w-100 mx-2",style:{"min-width":"0px"},children:[new l.a.View({state:e.codeEditorState,editorConfiguration:t,options:{containerClass:"w-100 h-50"}}),this.statusView()]}]}dataColumnView(){return{class:"d-flex flex-column h-100 fv-text-primary w-50",style:{"font-family":"monospace"},children:[this.rawInputView(),this.adaptedInputView()]}}statusView(){return{style:{height:"33%","font-family":"monospace"},class:"overflow-auto flex-grow-1 d-flex flex-column",children:[(0,d.Z)("Presented here is a blind test of the input that is reaching the module's implementation with respect to its internal validation rules. \n Make sure the trigger turn green before updating the adaptor."),(0,s.child$)(this.state.adaptedInput$,(e=>{if(e instanceof t||!e.data)return{class:"flex-grow-1 py-2",style:{"min-height":"0px","font-family":"monospace"},children:[{innerText:"error while executing the adaptor"},{innerText:`${(n=e).message}.`+(n.row?` Row:${n.row}, column:${n.col}`:"")}]};var n;let o=new u.Z.State({mdle:this.state.mdleEnd,adaptedInput:e,contract:this.state.contract});return new u.Z.View({state:o,options:{containerClass:"flex-grow-1 w-100 overflow-auto",containerStyle:{"min-height":"0px"}}})}))]}}rawInputView(){return{class:"h-50 d-flex flex-column overflow-auto py-1",children:[{innerText:"Adaptor's input data",class:"text-center fv-text-focus"},{class:"flex-grow-1 d-flex flex-column",style:{"min-height":"0"},children:[(0,d.Z)("Presented here is the latest input that have reached the adaptor, before any transformation. The input that is actually reaching the module's implementation is presented below."),this.dataTreeView(this.state.rawInput$,"input")]}]}}adaptedInputView(){return{class:"h-50 d-flex flex-column overflow-auto py-1",children:[{innerText:"Module's input data",class:"text-center  fv-text-focus"},{class:"flex-grow-1 d-flex flex-column",style:{"min-height":"0"},children:[(0,d.Z)("Presented here is the input that is actually reaching the module's implementation. Here, the configuration part of the input is merging the default one (defined in module's settings) with the one returned by the adaptor (as presented in the previous tab)."),this.dataTreeView(this.state.adaptedInput$,"input")]}]}}dataTreeView(e,t){let n=[t+"_0"];return{class:"cm-s-blackboard overflow-auto flex-grow-1",style:{"min-height":"0px"},children:[(0,s.child$)(e,(e=>{if(!e)return{innerText:"code not valid",class:"p-3"};let o=new c.g.State({title:t,data:e,expandedNodes:n});return new c.g.View({state:o,connectedCallback:e=>{e.subscriptions.push(o.expandedNodes$.subscribe((e=>n=e)))}})}),{untilFirst:this.options.untilFirst})]}}}o.defaultOptions={containerClass:"fv-bg-background p-3 fv-text-primary rounded d-flex h-100 w-100",containerStyle:{},untilFirst:{class:"d-flex flex-column fv-text-primary ",style:{"font-family":"monospace"},children:[{tag:"p",innerText:"No data available: the module has not played any scenario yet. Having data available may help to write your code."},{tag:"p",innerText:"Getting some data is usually as easy as connecting the input(s) of your module."}]}},e.View=o,e.popupModal=function({connection:e,initialCode:t,appStore:s,onUpdate:i}){let r=new n({connection:e,initialCode:t,appStore:s}),l=new o({state:r,options:{containerClass:"p-3 d-flex flex-grow-1 w-100",containerStyle:{"min-height":"0px"}}});p.R.popup({view:l,style:{height:"50vh",width:"90vw","max-width":"1500px"}}).subscribe((()=>{i(r.codeEditorState.content$.getValue())}))}}(o||(o={}))},735:(e,t,n)=>{"use strict";n.d(t,{Q:()=>o});var o,s=n(935),i=n(222),r=n(888),l=n(158),a=n(519),d=n(931);!function(e){class t extends r.ImmutableTree.State{constructor({appStore:e,selectionBuffer$:n}){super({rootNode:new p({favorites:t.favorites$.getValue()})}),this.favorites=new Array,this.appStore=e,this.selectionBuffer$=n||(0,l.of)([]),t.favorites$.subscribe((e=>{localStorage.setItem("flux-builder#favorites",JSON.stringify(e))})),this.selection$=new l.Subject}toggleFavorite(e){let n=y(),o=e instanceof v?e.favorite.id:e.id;if(n.find((e=>e.id==o)))return n=n.filter((e=>e.id!=o)),t.favorites$.next(n),void this.removeNode(e instanceof v?e.id:"favorite_"+o);let s=new x(o,e.name,e.type);n=n.concat([s]),t.favorites$.next(n),this.addChild("explorer",new v({favorite:s}))}}t.favorites$=new l.BehaviorSubject(y()),e.State=t;class n extends r.ImmutableTree.View{constructor({state:e,...t}){super({state:e,headerView:o,...t})}}function o(e,n){if(!(n instanceof b)){let o="fas fa-star fa-xs fv-hover-opacity fv-pointer ";return{class:"d-flex w-100 align-items-center fv-pointer",children:[{tag:"i",class:n.faIcon?n.faIcon:""},n instanceof v?{tag:"i",class:"fas fa-star fa-xs px-1 fv-text-focus fv-hover-opacity",onclick:t=>{t.stopPropagation(),e.toggleFavorite(n)}}:{},{tag:"span",class:"mx-2",innerText:n.name,style:{"user-select":"none"}},n instanceof g?{tag:"i",class:(0,i.attr$)(t.favorites$,(e=>e.find((e=>e.id==n.id))?o+"fv-text-focus":o+"fv-text-primary")),onclick:t=>{t.stopPropagation(),e.toggleFavorite(n)}}:{},(0,i.child$)(n.status$,(e=>e.find((e=>"request-pending"==e.type))?{tag:"i",class:"fas fa-spinner fa-spin"}:{}))]}}if(n instanceof b)return{class:"d-flex w-100 align-items-baseline fv-pointer",onclick:()=>e.selection$.next({node:n,selected:!0}),children:[{tag:"i",class:(0,i.attr$)(e.selectionBuffer$,(e=>e.includes(n)?"fv-text-focus":""),{wrapper:e=>"fas fa-cloud-download-alt fv-text-primary fv-hover-opacity "+e})},{tag:"span",class:"mx-2 w-100",innerText:n.name,style:{"user-select":"none"}}]}}e.View=n;class c extends r.ImmutableTree.Node{constructor({id:e,name:t,children:n,type:o,faIcon:s}){super({id:e,children:n}),this.status$=new l.BehaviorSubject([]),this.name=t,this.faIcon=s,this.type=o}addStatus({type:e,id:t}){t=t||this.id;let n=this.status$.getValue().concat({type:e,id:t});this.status$.next(n)}removeStatus({type:e,id:t}){t=t||this.id;let n=this.status$.getValue().filter((n=>n.type!=e&&n.id!=t));this.status$.next(n)}resolveChildren(){if(!this.children||Array.isArray(this.children))return;let e=(0,s.uuidv4)();return this.addStatus({type:"request-pending",id:e}),super.resolveChildren().pipe((0,a.tap)((()=>{this.removeStatus({type:"request-pending",id:e})})))}}class u extends c{constructor({id:e,name:t,type:n,children:o,faIcon:s}){super({id:e,name:t,type:n||"FolderNode",children:o,faIcon:s||"fas fa-folder"})}}class p extends u{constructor({favorites:e,children:t}){super({id:"explorer",name:"Explorer",type:"RootNode",children:t||I()}),this.favorites=e}}class m extends u{constructor({groupId:e,path:t,children:n}){super({id:e,name:t.split("/").slice(-1)[0],type:"GroupNode",children:n||S(t),faIcon:"fas fa-users"}),this.groupId=e,this.path=t}}class h extends u{constructor({driveId:e,name:t,children:n}){super({id:e,name:t,type:"DriveNode",children:n||j(e),faIcon:"fas fa-hdd"}),this.driveId=e}}class g extends u{constructor({folderId:e,name:t,children:n}){super({id:e,name:t,type:"AssetFolderNode",children:n||j(e)}),this.folderId=e}}class f extends c{constructor({id:e,name:t,type:n,children:o,faIcon:s}){super({id:e,name:t,type:n||"ItemNode",children:o,faIcon:s})}}class w extends f{constructor({assetId:e,name:t,rawId:n,children:o}){super({id:e,name:t,type:"AssetItemNode",children:o||k(n),faIcon:"fas fa-box"}),this.assetId=e}}class b extends f{constructor({factory:e,library:t,fluxPacks:n}){super({id:e.uid,name:e.displayName,type:"ModuleItemNode",faIcon:""}),this.factory=e,this.library=t,this.fluxPacks=n}}e.ModuleItemNode=b;class v extends f{constructor({favorite:e}){super({id:"favorite_"+e.id,name:e.name,type:"FavoriteNode",children:v.getChildrenFactory[e.type](e),faIcon:"fas fa-folder"}),this.favorite=e}}v.getChildrenFactory={AssetFolderNode:e=>j(e.id)};class x{constructor(e,t,n){this.id=e,this.name=t,this.type=n}}function y(){let e=localStorage.getItem("flux-builder#favorites");return e?JSON.parse(e):[]}function I(){let e=y();return S().pipe((0,a.map)((t=>[...t,...e.map((e=>new v({favorite:e})))])))}function S(e=""){return d.k.getGroupChildren$(e).pipe((0,a.map)((e=>[...e.groups.map((e=>new m({groupId:e.id,path:e.path}))),...e.drives.map((e=>new h({driveId:e.driveId,name:e.name})))])))}function j(e){return d.k.getFolderChildren$(e).pipe((0,a.map)((e=>[...e.folders.map((e=>new g({folderId:e.folderId,name:e.name}))),...e.items.filter((e=>"package"==e.kind)).map((e=>new w({assetId:e.assetId,name:e.name,rawId:e.rawId})))])))}function k(e){return d.k.getModules$(e).pipe((0,a.map)((({factories:e,library:t,loadingGraph:n})=>e.map((e=>new b({factory:e,library:{name:t.name,version:t.versions[0],namespace:t.namespace},fluxPacks:n.lock.flat().filter((e=>"flux-pack"==e.type))}))))))}}(o||(o={}))},825:(e,t,n)=>{"use strict";n.d(t,{a:()=>o});var o,s=n(222),i=n(158),r=n(519);!function(e){e.State=class{constructor({content$:e}){this.content$=e}};class t{constructor({state:e,editorConfiguration:o,options:i,...r}){Object.assign(this,r);let l={...t.defaultOptions,...i||{}};this.state=e,this.class=l.containerClass,this.style=l.containerStyle;let a={value:e.content$.getValue(),mode:"javascript",lineNumbers:!0,theme:"blackboard",extraKeys:{Tab:e=>e.replaceSelection("    ","end")},...o||{}};this.children=[(0,s.child$)(n(a.mode),(()=>({id:"code-mirror-editor",class:"w-100 h-100",connectedCallback:t=>{let n=window.CodeMirror(t,a);n.on("changes",(()=>{e.content$.next(n.getValue())}))}})))]}}function n(e){let t=window["@youwol/cdn-client"],n={javascript:"codemirror#5.52.0~mode/javascript.min.js",python:"codemirror#5.52.0~mode/python.min.js",css:"codemirror#5.52.0~mode/css.min.js",xml:"codemirror#5.52.0~mode/xml.min.js",html:"codemirror#5.52.0~mode/htmlmixed.min.js"};return(0,i.from)(t.fetchBundles({codemirror:{version:"5.52.0"}},window)).pipe((0,r.mergeMap)((()=>{let o=Array.isArray(n[e])?n[e]:[n[e]],s=t.fetchJavascriptAddOn(o,window);return(0,i.from)(s)})))}t.defaultOptions={containerClass:"h-100 w-100",containerStyle:{}},e.View=t}(o||(o={}))},350:(e,t,n)=>{"use strict";n.d(t,{s:()=>o});var o,s=n(158),i=n(825),r=n(97);!function(e){class t{constructor({mdle:e,initialCode:t}){this.mdle=e;let n=new s.BehaviorSubject(t);this.codeEditorState=new i.a.State({content$:n})}}e.State=t;class n{constructor({state:e,editorConfiguration:t,options:o,...s}){Object.assign(this,s),this.options={...n.defaultOptions,...o||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.moduleContextView(),{class:"d-flex flex-column h-100 w-100 mx-2",children:[new i.a.View({state:this.state.codeEditorState,editorConfiguration:t})]}]}moduleContextView(){return{}}}n.defaultOptions={containerClass:"fv-bg-background p-3 fv-text-primary rounded d-flex ",containerStyle:{height:"50vh",width:"90vw","max-width":"1500px"}},e.View=n,e.popupModal=function({mdle:e,initialCode:o,editorConfiguration:s,onUpdate:i}){let l=new t({mdle:e,initialCode:o}),a=new n({state:l,editorConfiguration:s,options:{containerClass:"p-2 d-flex flex-grow-1 w-100",containerStyle:{"min-height":"0px"}}});r.R.popup({view:a,style:{height:"50vh",width:"90vw","max-width":"1500px"}}).subscribe((()=>{i(l.codeEditorState.content$.getValue())}))}}(o||(o={}))},142:(e,t,n)=>{"use strict";n.d(t,{e:()=>o});var o,s=n(991);!function(e){e.State=class{constructor({status:e,stringLengthLimit:t}){this.status=e,this.stringLengthLimit=t||100;let n=e;(0!=n.intrus.length||n.typeErrors||n.missings)&&(n.typeErrors&&n.typeErrors.length>0&&(this.typingErrors=new s.g.State({title:"typing errors",data:n.typeErrors})),n.missings&&n.missings.length>0&&(this.missingFields=new s.g.State({title:"missing fields",data:n.missings})),n.intrus.length>0&&(this.unexpectedFields=new s.g.State({title:"unexpected fields",data:n.intrus})))}};class t{constructor({state:e,options:n,...o}){Object.assign(this,o);let i={...t.defaultOptions,...n||{}};this.state=e,this.class=i.containerClass,this.style=i.containerStyle;let r=[this.state.typingErrors,this.state.missingFields,this.state.unexpectedFields].filter((e=>e)).map((e=>new s.g.View({state:e})));this.children=0==r.length?[{innerText:"Your configuration is validated"}]:r}}t.defaultOptions={containerClass:"d-flex flex-column",containerStyle:{"min-height":"0px"}},e.View=t,e.journalWidget=function(t){let n=new s.g.State({title:"merged configuration",data:t.result}),o=new e.State({status:t});return{children:[{class:"d-flex justify-content-around w-100",style:{"white-space":"nowrap"},children:[new s.g.View({state:n}),{class:"px-4"},new e.View({state:o})]}]}}}(o||(o={}))},230:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var o,s=n(935),i=n(888),r=n(991),l=n(97);!function(e){function t(e){return e instanceof window["@youwol/flux-core"].Context?new o({context:e}):e instanceof window["@youwol/flux-core"].ErrorLog?new p({log:e}):e instanceof window["@youwol/flux-core"].WarningLog?new u({log:e}):e instanceof window["@youwol/flux-core"].InfoLog?new c({log:e}):void 0}class n extends i.ImmutableTree.Node{constructor({id:e,children:t}){super({id:e,children:t})}}class o extends n{constructor({context:e}){super({id:e.id,children:e.children.map((e=>t(e)))}),this.context=e}}class a extends n{constructor({data:e}){super({id:(0,s.uuidv4)()}),this.data=e}}class d extends n{constructor({log:e}){super({id:e.id,children:null!=e.data?[new a({data:e.data})]:void 0}),this.log=e}}class c extends d{constructor(e){super(e)}}class u extends d{constructor(e){super(e)}}class p extends d{constructor(e){super(e)}}function m(e){return e.parent?m(e.parent).concat([e.id]):[e.id]}class h extends i.ImmutableTree.State{constructor({context:e,expandedNodes:n,selectedNode:o}){super({rootNode:t(e.root()),expandedNodes:n}),this.rootCtx=e.root(),this.context=e,this.tStart=this.rootCtx.startTimestamp,this.tEnd=this.rootCtx.startTimestamp+this.rootCtx.elapsed(),o&&this.selectedNode$.next(this.getNode(o))}}e.State=h;class g{constructor({state:e,options:t,...n}){this.domId="contextView-view",Object.assign(this,n),this.state=e;let o={...g.defaultOptions,...t||{}};this.class=o.containerClass,this.style=o.containerStyle;let s=new i.ImmutableTree.View({state:e,headerView:f,class:o.treeViewClass,style:o.treeViewStyle,options:{classes:{header:"d-flex align-items-baseline fv-tree-header fv-hover-bg-background-alt "}}});this.children=[s]}}function f(e,t){let n="3px";if(t instanceof o){let o=100*(t.context.startTimestamp-e.rootCtx.startTimestamp)/(e.tEnd-e.tStart),i=100*t.context.elapsed()/(e.tEnd-e.tStart),r=Math.floor(100*t.context.elapsed())/100;return{class:"w-100 pb-2",children:[{class:"d-flex align-items-center",children:[{tag:"i",class:{[s.ContextStatus.FAILED]:"fas fa-times fv-text-error",[s.ContextStatus.SUCCESS]:"fas fa-check fv-text-success",[s.ContextStatus.RUNNING]:"fas fa-cog fa-spin"}[t.context.status()]},{innerText:t.context.title+`  - ${r} ms`,class:"fv-pointer px-2",style:{"font-family":"fantasy"}}]},{class:"fv-bg-success",style:{top:"0px",height:n,width:i+"%",position:"absolute",left:o+"%"}}]}}if(t instanceof d){let o=100*(t.log.timestamp-e.rootCtx.startTimestamp)/(e.tEnd-e.tStart),s="fv-text-primary fas fa-info";return t instanceof p&&(s="fv-text-error fas fa-times"),t instanceof u&&(s="fv-text-focus fas fa-exclamation"),{class:"pb-1 fv-pointer w-100",children:[{class:"d-flex align-items-center",children:[{class:s},{innerText:t.log.text,class:"px-2"}]},{class:"fv-bg-success rounded",style:{height:n,width:n,top:"0px",position:"absolute",left:`calc( ${o}% - 5px)`}}]}}if(t instanceof a){let e=s.Journal.getViews(t.data).map((e=>e.view));if(e.length>0)return{class:"d-flex flex-grow-1",style:{"white-space":"nowrap","min-width":"0px"},children:e};let n=new r.g.State({title:"",data:t.data,expandedNodes:["_0"]});return{children:[new r.g.View({state:n})]}}return{innerText:"unknown type"}}g.defaultOptions={containerClass:"p-4 fv-bg-background fv-text-primary",containerStyle:{width:"100%",height:"100%"},treeViewClass:"h-100 overflow-auto",treeViewStyle:{}},e.View=g,e.reportContext=function(e,t){let n=new h({context:e,expandedNodes:t?m(e).concat(t):m(e),selectedNode:t}),o=new g({state:n});l.R.popup({view:o,style:{"max-height":"75vh",width:"75vw"},options:{displayCancel:!1,displayOk:!1}})}}(o||(o={}))},991:(e,t,n)=>{"use strict";n.d(t,{g:()=>o});var o,s=n(888),i=n(158),r=n(519);!function(e){function t(e,t,n){return null==t?new o({name:e,nestedIndex:n}):"string"==typeof t?new c({name:e,data:t,nestedIndex:n}):"number"==typeof t?new d({name:e,data:t,nestedIndex:n}):"boolean"==typeof t?new u({name:e,data:t,nestedIndex:n}):"function"==typeof t?new m({name:e,data:t,nestedIndex:n}):Array.isArray(t)?new g({name:e,data:t,nestedIndex:n}):t instanceof ArrayBuffer?new p({name:e,data:t,nestedIndex:n}):"object"==typeof t?new h({name:e,data:t,nestedIndex:n}):new l({name:e,nestedIndex:n})}class n extends s.ImmutableTree.Node{constructor({id:e,name:t,children:n,classes:o,nestedIndex:s}){super({id:e||`${t}_${s}`,children:n}),this.name=t,this.classes=o,this.nestedIndex=s}}e.DataNode=n;class o extends n{constructor({name:e,nestedIndex:t,id:n}){super({id:n,name:e,classes:"fv-text-disabled",nestedIndex:t})}}e.UndefinedNode=o;class l extends n{constructor({name:e,nestedIndex:t,id:n}){super({id:n,name:e,classes:"",nestedIndex:t})}}e.UnknownNode=l;class a extends n{constructor({name:e,data:t,classes:n,nestedIndex:o,id:s}){super({id:s,name:e,classes:n,nestedIndex:o}),this.data=t}}e.ValueNode=a;class d extends a{constructor({name:e,data:t,nestedIndex:n,id:o}){super({id:o,name:e,data:t,classes:"cm-number",nestedIndex:n})}}e.NumberNode=d;class c extends a{constructor({name:e,data:t,nestedIndex:n,id:o}){super({id:o,name:e,data:t,classes:"cm-string",nestedIndex:n})}}e.StringNode=c;class u extends a{constructor({name:e,data:t,nestedIndex:n,id:o}){super({id:o,name:e,data:t,classes:"cm-atom",nestedIndex:n})}}e.BoolNode=u;class p extends a{constructor({name:e,data:t,nestedIndex:n,id:o}){super({id:o,name:e,data:t,classes:"cm-string",nestedIndex:n})}}e.ArrayBufferNode=p;class m extends n{constructor({name:e,data:t,nestedIndex:n,id:o}){super({id:o,name:e,classes:"cm-def",nestedIndex:n}),this.data=t}}e.FunctionNode=m;class h extends n{constructor({name:e,data:t,nestedIndex:n,id:o}){super({id:o,name:e,children:(0,i.of)(t).pipe((0,r.map)((e=>this.getChildrenNodes(e)))),classes:"",nestedIndex:n}),this.data=t}getChildrenNodes(e){let n=[];for(var o in e)n.push(t(o,e[o],this.nestedIndex+1));let s=[];try{s=Object.entries(e.__proto__).map((([e,t])=>new m({name:e,data:t,nestedIndex:this.nestedIndex+1})))}catch(e){}return[...n,...s]}}e.ObjectNode=h;class g extends n{constructor({name:e,data:n,nestedIndex:o,id:s}){super({id:s,name:e,children:(0,i.of)(n).pipe((0,r.map)((e=>Object.entries(e).map((([e,n])=>t(`${e}`,n,o+1)))))),classes:"",nestedIndex:o}),this.data=n}}e.ArrayNode=g;class f extends s.ImmutableTree.State{constructor({title:e,data:n,expandedNodes:o,...s}){super({rootNode:t(e,n,0),expandedNodes:o,...s})}}e.State=f;class w extends s.ImmutableTree.View{constructor({state:e,options:t,...n}){super({state:e,headerView:b,class:w.getStyling(t).containerClass,style:w.getStyling(t).containerStyle,...n})}static getStyling(e){return{...w.defaultOptions,...e||{}}}}function b(e,t){if(t instanceof l)return{class:"d-flex fv-text-disabled flex-wrap",innerText:t.name};let n="";return t instanceof a&&(n=String(t.data),"string"==typeof t.data&&(n="'"+n+"'")),t instanceof o&&(n="undefined"),t instanceof m&&(n=`f(${t.data.length} arg(s))`),t instanceof h&&(n="{...}"),t instanceof g&&(n="[...]"),t instanceof p&&(n=`Array Buffer (${t.data.byteLength} bytes)`),{class:"d-flex fv-pointer",children:[{innerText:t.name},{class:"px-2 w-100 "+t.classes,innerHTML:`<i>${n}</i>`,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}]}}w.defaultOptions={containerClass:"cm-s-blackboard",containerStyle:{"white-space":"nowrap"}},e.View=w,e.dataNodeHeaderView=b}(o||(o={}))},910:(e,t,n)=>{"use strict";n.d(t,{r:()=>o});var o,s=n(935),i=n(888),r=n(991);!function(e){class t extends i.ImmutableTree.Node{constructor({name:e,children:t,isRealized:n,evaluatedFrom:o}){super({id:(0,s.uuidv4)(),children:t}),this.name=e,this.isRealized=n,this.evaluatedFrom=o}}e.ExpectationNode=t;class n extends t{constructor({name:e,children:t,isRealized:n,evaluatedFrom:o}){super({name:e,children:t,isRealized:n,evaluatedFrom:o})}}e.AnyOfNode=n;class o extends t{constructor({name:e,children:t,isRealized:n,evaluatedFrom:o}){super({name:e,children:t,isRealized:n,evaluatedFrom:o})}}e.AllOfNode=o;class l extends t{constructor({name:e,children:t,isRealized:n,evaluatedFrom:o}){super({name:e,children:t,isRealized:n,evaluatedFrom:o})}}function a(e){let i=e=>{let a=e.children&&e.children.length>0?e.children.map((e=>i(e))):void 0,d=new r.g.ObjectNode({id:(0,s.uuidv4)(),name:"evaluated-with",data:e.fromValue,nestedIndex:0});return!a||null==e.succeeded||e.expectation instanceof s.Contract||(a=[d,...a]),e.expectation instanceof s.Contract?new t({name:e.expectation.description,children:a,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):e.expectation instanceof s.AnyOf?new n({name:e.expectation.description,children:a,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):e.expectation instanceof s.AllOf?new o({name:e.expectation.description,children:a,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):e.expectation instanceof s.Of?new l({name:e.expectation.description,children:a,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):e.expectation instanceof s.OptionalsOf?new n({name:e.expectation.description,children:a,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):new t({name:e.expectation.description,children:a,isRealized:null!=e.succeeded?e.succeeded:void 0,evaluatedFrom:e.fromValue})};return i(e)}e.OfNode=l,e.parseReport=a;class d{constructor(e,t,n){this.message=e,this.row=t,this.col=n}}e.ExecutionError=d,e.parseError=function(e){try{let t=e.split("\n"),n=t[0];if(t=t.filter((e=>e.includes("eval")&&2==e.split(",").length)),0==t.length)return new d(n,void 0,void 0);let o=t[0].split(",")[1].split("<anonymous>:")[1].split(")")[0],[s,i]=[Number(o.split(":")[0])-2,Number(o.split(":")[1])];return new d(n,s,i)}catch(e){return new d("Unidentified error",void 0,void 0)}},e.State=class{constructor({status:e,expandedNodes$:n}){this.status=e;let o=a(this.status),s=o.children&&o.children.length>0?o.children[0]:new t({name:"No required conditions defined",children:void 0,isRealized:!0,evaluatedFrom:void 0});this.treeStateRequired=new i.ImmutableTree.State({rootNode:s,expandedNodes:n});let r=o.children&&o.children.length>1?o.children[1]:new t({name:"No optional conditions defined",children:void 0,isRealized:!0,evaluatedFrom:void 0});this.treeStateOptionals=new i.ImmutableTree.State({rootNode:r,expandedNodes:n})}};class c{constructor({state:e,options:t,...n}){Object.assign(this,n);let o={...c.defaultOptions,...t||{}};this.state=e,this.class=o.containerClass,this.style=o.containerStyle,this.children=[{class:"d-flex align-items-center",children:[{class:this.state.status.succeeded?"fas fa-check fv-text-success":"fas fa-times fv-text-error",style:{"min-width":"25px"}},{class:"px-2",innerText:this.state.status.expectation.description}]},{class:"pl-2 flex-grow-1 overflow-auto ",style:{"min-height":"0px"},children:[{class:"pl-2",children:[new i.ImmutableTree.View({state:this.state.treeStateRequired,headerView:u}),new i.ImmutableTree.View({state:this.state.treeStateOptionals,headerView:u})]}]}]}}function u(e,t){if(t instanceof r.g.DataNode)return r.g.dataNodeHeaderView(void 0,t);let s="";t.isRealized&&(s="fv-text-success"),null==t.isRealized&&(s="fv-text-disabled");let i="";return t.isRealized&&(i="fas fa-check fv-text-success px-1"),0==t.isRealized&&(i="fas fa-times fv-text-error px-1"),t instanceof o?{class:"d-flex align-items-center",children:[{class:s+" "+i},{innerText:t.name,class:"fv-text-primary px-2"},{tag:"i",class:"fv-text-primary",innerText:"All of the following:"}]}:t instanceof n?{class:"d-flex align-items-center",children:[{class:s+" "+i},{innerText:t.name,class:"fv-text-primary px-2"},{tag:"i",class:"fv-text-primary",innerText:"Any of the following:"}]}:{class:"d-flex flex-align-items-center ",children:[{class:i},{innerText:t.name,class:s}]}}c.defaultOptions={containerClass:"d-flex flex-column",containerStyle:{"min-height":"0px"}},e.View=c,e.journalWidget=function(t){let n=new r.g.State({title:"incoming data",data:t.fromValue,expandedNodes:["incoming data_0"]}),o=new e.State({status:t});return{children:[{class:"d-flex justify-content-around w-100",style:{"white-space":"nowrap"},children:[new r.g.View({state:n}),{class:"px-4"},new e.View({state:o})]}]}}}(o||(o={}))},143:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(222),s=n(158);function i(e){let t=new s.BehaviorSubject(!1);return(0,o.child$)(t,(n=>({class:"p-1 d-flex",children:[{tag:"i",class:"fas fa-info fv-hover-bg-background-alt p-1 fv-pointer rounded "+(n?"fv-bg-background-alt":""),onclick:()=>t.next(!t.getValue())},n?{class:"p-1 px-2 fv-bg-background-alt rounded",style:{"text-align":"justify","font-style":"italic"},innerText:e}:{}]})))}},700:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var o,s=n(935),i=n(690),r=n(158),l=n(142),a=n(910);!function(e){class t extends i.Tabs.TabData{constructor(){super("data","data")}}class n extends i.Tabs.TabData{constructor(){super("configuration","configuration")}}e.State=class{constructor({mdle:e,adaptedInput:o,contract:l,selectedTabId$:a}){this.selectedTabId$=a||new r.BehaviorSubject("data"),this.tabState=new i.Tabs.State([new t,new n],a),this.configStatus=(0,s.mergeConfiguration)(e.configuration.data,o.configuration);let d=new s.Context("",{});this.dataStatus=l.resolve(o.data,d)}};class o{constructor({state:e,options:d,...c}){Object.assign(this,c),this.options={...o.defaultOptions,...d||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle;let u=new r.BehaviorSubject(["optional","required"]),p=new i.Tabs.View({state:this.state.tabState,contentView:(e,o)=>{if(o instanceof t){let e=new a.r.State({status:this.state.dataStatus,expandedNodes$:u});return new a.r.View({state:e})}if(o instanceof n){let e=new l.e.State({status:this.state.configStatus});return new l.e.View({state:e})}},headerView:(e,o)=>o instanceof t?function(e){let t="fas fa-check fv-text-success px-1";return e?e.succeeded||(t="fas fa-times fv-text-error px-1"):t="fas fa-question px-1",{class:"d-flex align-items-center px-2",children:[{class:t},{innerText:"data"}]}}(this.state.dataStatus):o instanceof n?function(e){let t={};return e instanceof s.InconsistentConfiguration&&(t={class:"fas fa-times fv-text-error px-1"}),e instanceof s.ConsistentConfiguration&&e.intrus.length>0&&(t={class:"fas fa-exclamation fv-text-danger px-1"}),e instanceof s.ConsistentConfiguration&&0==e.intrus.length&&(t={class:"fas fa-check fv-text-success px-1"}),{class:"d-flex align-items-center px-2",children:[t,{innerText:"configuration"}]}}(this.state.configStatus):{innerText:o.name,class:"px-2"},class:"h-100 d-flex flex-column",style:{"min-height":"0px"},options:{containerStyle:{"min-height":"0px"},containerClass:"p-2 border flex-grow-1 overflow-auto"}});this.children=[p]}}o.defaultOptions={containerClass:"h-100 w-100",containerStyle:{}},e.View=o}(o||(o={}))},97:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var o,s=n(222),i=n(327),r=n(337),l=n(158);!function(e){e.popup=function({view:e,style:t,ok$:n,options:o}){o=o||{displayOk:!0,displayCancel:!0};let a=new i.Button.View({state:new i.Button.State,contentView:()=>({innerText:"Ok"}),class:"fv-btn fv-btn-primary fv-bg-focus mr-2"}),d=i.Button.simpleTextButton("Cancel"),c=new r.Modal.State(n),u=(0,s.render)(new r.Modal.View({state:c,contentView:()=>({class:"border rounded fv-text-primary fv-bg-background d-flex flex-column",style:t||{height:"50vh",width:"50vw","max-width":"1500px"},children:[e,{class:"d-flex p-2",children:[o.displayOk?a:void 0,o.displayCancel?d:void 0].filter((e=>e))}]}),connectedCallback:e=>{let t=[a.state.click$.subscribe((()=>c.ok$.next())),d.state.click$.subscribe((()=>c.cancel$.next())),(0,l.merge)(c.cancel$,c.ok$).subscribe((()=>u.remove()))];e.subscriptions=[...e.subscriptions,...t]}}));return document.querySelector("body").appendChild(u),c.ok$}}(o||(o={}))},864:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var o,s=n(222),i=n(327),r=n(313),l=n(158),a=n(519),d=n(97);!function(e){class t{constructor({appStore:e}){let t=[new r.Select.ItemData("youwol-url","YouWol Platform URL"),new r.Select.ItemData("relative-url","Relative URL")];"localhost"==location.hostname&&t.push(new r.Select.ItemData("localhost-url","Localhost URL")),this.selectState=new r.Select.State(t,"youwol-url"),this.sourceURI$=(0,l.combineLatest)([e.projectURI$(),this.selectState.selectionId$])}toUrl(e,t){return"relative-url"==t?`${e}`:"localhost-url"==t?`${location.hostname}:${location.port}${e}`:`https://platform.youwol.com${e}`}}e.State=t;class n{constructor({state:e,...t}){Object.assign(this,t),this.state=e,this.class=this.class||n.defaultOptions.containerClass,this.style=this.style||n.defaultOptions.containerStyle;let o=new i.Button.View({state:new i.Button.State,contentView:()=>({innerText:""}),class:"fv-btn fv-btn-primary fv-bg-focus fas fa-copy ml-2"});this.connectedCallback=t=>{t.subscriptions.push(o.state.click$.pipe((0,a.mergeMap)((()=>e.sourceURI$)),(0,a.mergeMap)((([t,n])=>(0,l.from)(navigator.clipboard.writeText(e.toUrl(t,n)))))).subscribe((()=>{console.log("Copied:::!!!")})))},this.children=[{innerText:"The following url can be used to share your application:"},new r.Select.View({state:e.selectState}),{class:"d-flex align-items-center",children:[{style:{"text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden","font-family":"monospace"},innerText:(0,s.attr$)(e.sourceURI$,(([t,n])=>e.toUrl(t,n)))},o]},{class:"d-flex align-items-center fv-bg-background-alt rounded my-3",children:[{class:"fas fa-exclamation fv-text-focus px-2"},{innerText:"This feature is a work in progress, it is expected to work with 'relatively' small application for now. Also, the consumer of this link will need to have access to all packages/modules/resources included in your app."}]}]}}n.defaultOptions={containerClass:"d-flex flex-column p-3",containerStyle:{"min-height":"0px"}},e.View=n,e.popupModal=function(e){let o=new t({appStore:e}),s=new n({state:o});d.R.popup({view:s,style:{width:"75vw","max-width":"1000px"},options:{displayOk:!1,displayCancel:!1}})}}(o||(o={}))},931:(e,t,n)=>{"use strict";n.d(t,{k:()=>l});var o=n(935),s=n(158),i=n(519),r=n(995);class l{static setHeaders(e){l.headers=e}static getAsset$(e){let t=l.urlBaseAssets+`/${e}`,n=new Request(t,{headers:l.headers});return(0,o.createObservableFromFetch)(n)}static getFolderChildren$(e){let t=new Request(`/api/assets-gateway/tree/folders/${e}/children`,{headers:l.headers});return(0,o.createObservableFromFetch)(t)}static getGroupChildrenDrives$(e){let t=new Request(`/api/assets-gateway/tree/groups/${e}/drives`,{headers:l.headers});return(0,o.createObservableFromFetch)(t)}static getGroupChildren$(e=""){let t=new Request("/api/assets-gateway/groups",{headers:l.headers});return(this.allGroups?(0,s.of)(this.allGroups):(0,o.createObservableFromFetch)(t).pipe((0,i.tap)((({groups:e})=>this.allGroups=e)),(0,i.map)((({groups:e})=>e)))).pipe((0,i.mergeMap)((t=>{let n=t.filter((t=>""==e?"private"==t.path||"/youwol-users"==t.path:t.path!=e&&t.path.includes(e)&&1==t.path.slice(e.length).match(/\//g).length));if(""==e)return(0,s.of)({groups:n,drives:[],groupId:void 0});let o=t.find((t=>t.path==e)).id;return l.getGroupChildrenDrives$(o).pipe((0,i.map)((({drives:e})=>({groupId:o,groups:n,drives:e}))))})))}static getModules$(e){let t=new Request(`/api/assets-gateway/raw/package/metadata/${e}`,{headers:l.headers});return(0,o.createObservableFromFetch)(t).pipe((0,i.mergeMap)((e=>{if(window[e.name])return(0,s.of)({targetLibrary:e,loadingGraph:{lock:[],fluxPacks:[],libraries:{}}});let t={...l.appStore.project.requirements.libraries,[e.name]:e.versions[0]},n=(0,r.fetchBundles)(t,window);return(0,s.from)(n).pipe((0,i.map)((t=>({targetLibrary:e,loadingGraph:t}))))})),(0,i.map)((({targetLibrary:e,loadingGraph:t})=>{let n=window[e.name];return{factories:Object.values(n).filter((e=>e&&e.Module&&e.BuilderView)),library:e,loadingGraph:t}})))}}l.appStore=void 0,l.tmpLibraries=void 0,l.urlBase="/api/assets-gateway",l.urlBaseOrganisation="/api/assets-gateway/tree",l.urlBaseAssets="/api/assets-gateway/assets",l.urlBaseRaws="/api/assets-gateway/raw",l.allGroups=void 0,l.headers={}},568:(e,t,n)=>{"use strict";n.d(t,{D:()=>r,H:()=>l});var o=n(935),s=n(862),i=n(606);function r(e,t){let n=s.ST.getInstance(),o=(0,i.HZ)(t),r=e.getActiveGroup().getModuleIds(),a=e.project.workflow.plugins.filter((e=>r.includes(e.parentModule.moduleId))).map((e=>e.moduleId)),d=[...r,...a].filter((e=>!o[e])).map((t=>e.getModule(t))).filter((e=>e.Factory.RenderView)),c=t.BlockManager.getAll().filter((e=>"Components"==e.get("category").id));n.debugOn&&n.logRenderTopic({level:s.in.Info,message:"set dynamic components block",object:{modulesToRender:d,componentBlocks:c}}),c.forEach((e=>t.BlockManager.remove(e.id))),d.forEach((n=>t.BlockManager.add(n.moduleId,function(e,t,n){return{id:e.moduleId,label:e.configuration.title,name:e.configuration.title,content:l(e,t,n),activate:!0,category:"Components",render:({el:t})=>{let n=document.createElement("div");n.id=e.moduleId,t.appendChild(n);let o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width","100px"),o.setAttribute("height","70px");let s=(new e.Factory.BuilderView).icon();const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.style.stroke="currentColor",i.classList.add("group-target"),i.innerHTML=s.content,o.appendChild(i),n.appendChild(o),document.body.appendChild(o),function(e){if(e.style.transform)return;let t=e.parentElement.getBoundingClientRect(),n=e.getBoundingClientRect(),o=t.top-n.top,s=t.left-n.left,i=Math.min(t.width/n.width,t.height/n.height);e.style.transform=`translate(${t.width/4}px,${t.height/4}px) scale(${.5*i}) translate(${s}px,${o}px)`}(i),o.remove(),n.appendChild(o)}}}(n,t,e.project.workflow))))}function l(e,t,n){let i=s.ST.getInstance();if(i.debugOn&&i.logRenderTopic({level:s.in.Info,message:"getDynamicBlockWrapperDiv",object:{mdle:e}}),e instanceof o.Component.Module){let t=e.getFullHTML(n);return t?t.outerHTML:`<div id="${e.moduleId}" class="flux-element flux-component"  data-gjs-name="${e.configuration.title}"></div>`}let r=e.Factory.RenderView.wrapperDivAttributes,l="flux-element"+(r&&r(e).class?" "+r(e).class:""),a=r&&r(e).style?r(e).style:{},d=Object.entries(a).reduce(((e,[t,n])=>e+t+":"+n+";"),"");return t.getStyle().add(`#${e.moduleId}{${d}}`),console.log("getFluxBlockContent",e),`<div id="${e.moduleId}" class="${l}"  data-gjs-name="${e.configuration.title}"></div>`}},595:(e,t,n)=>{"use strict";n.d(t,{tj:()=>l,Ni:()=>a,kH:()=>d,l3:()=>c,fr:()=>u});var o=n(935),s=n(862),i=n(568),r=n(606);function l(e,t){let n=(0,r.HZ)(t),o=e.filter((e=>e.Factory.RenderView)),i=s.ST.getInstance();i.debugOn&&i.logRenderTopic({level:s.in.Info,message:"removeTemplateElements",object:{modules:e,modulesToRemove:o}}),o.filter((e=>n[e.moduleId])).forEach((e=>n[e.moduleId].remove()))}function a(e,t,n){let i=s.ST.getInstance();if(0==e.length)return;i.debugOn&&i.logRenderTopic({level:s.in.Info,message:"replaceTemplateElements",object:{moduleIds:e,appStore:n}});let l=t.Canvas.getDocument().body.querySelector("div"),a=e.map((e=>n.getModule(e))).filter((e=>e.Factory.RenderView));(0,o.renderTemplate)(l,a.filter((e=>!(e instanceof o.Component.Module))),{applyWrapperAttributes:!1}),a.filter((e=>e instanceof o.Component.Module)).map((e=>[e,t.Canvas.getDocument().getElementById(e.moduleId)])).filter((([e,t])=>t)).forEach((([e,t])=>{e.renderedElementDisplayed$.next(t)}));let d=(0,r.HZ)(t);return a.filter((e=>null!=d[e.moduleId])).forEach((e=>{d[e.moduleId].attributes.name=e.configuration.title})),a}function d(e,t,n){let o=e.removedElements.map((e=>e.moduleId));a(e.createdElements.filter((e=>e.Factory.RenderView)).filter((e=>o.includes(e.moduleId))).map((e=>e.moduleId)),t,n)}function c(e,t,n){let s=(0,r.HZ)(t),l=e.removedElements.map((e=>e.moduleId));a(e.createdElements.filter((e=>e.Factory.RenderView)).filter((e=>!l.includes(e.moduleId))).filter((e=>n.getRootComponent().getModuleIds().includes(e.moduleId))).filter((e=>!(e instanceof o.Component.Module))).map((e=>{let o=(0,i.H)(e,t,n.project.workflow);return console.log(s[n.rootComponentId]),s[n.rootComponentId].append(o,{at:0}),e.moduleId})),t,n)}function u(e,t,n){let s=e.removedElements.map((e=>e.moduleId));l(e.createdElements.filter((e=>e instanceof o.Component.Module)).filter((e=>!s.includes(e.moduleId))).map((e=>e.getDirectChildren(n.project.workflow))).flat(),t)}},95:(e,t,n)=>{"use strict";n.d(t,{cw:()=>h,Af:()=>g});var o=n(595);function s(e,t){var n=e.CodeManager.getViewer("CodeMirror").clone();return n.set({codeName:"html"===t?"htmlmixed":"css",readOnly:!1,theme:"hopscotch",autoBeautify:!0,autoCloseTags:!0,autoCloseBrackets:!0,styleActiveLine:!0,smartIndent:!0}),n}var i=n(935),r=n(862),l=n(606),a=n(568),d=n(864);function c(e){return[{id:"app-basic-actions",el:"#panel__app-basic-actions",buttons:[{id:"save-project",className:"btn-save-project",label:'<i class="fas fa-save panel-action" data-toggle="tooltip" title="Save project" ></i>',command(t){e.saveProject()}},{id:"share-uri",className:"btn-share-uri",label:'<i class="fas fa-link panel-action" data-toggle="tooltip" title="share uri" ></i>',command(t){d.R.popupModal(e)}},{id:"undo",className:"btn-undo",label:'<i class="fas fa-undo panel-action" data-toggle="tooltip" title="Undo" ></i>',command(t){e.undo()}},{id:"redo",className:"btn-redo",label:'<i class="fas fa-redo panel-action" data-toggle="tooltip" title="Redo" ></i>',command(t){e.redo()}}]},{id:"app-layout-builder-actions",el:"#panel__app-layout-builder-actions",buttons:[{id:"toggle-builder-view",active:!0,className:"app-layout-builder-actions",label:'<i id="toggle-builder-view" class="fas fa-project-diagram  panel-action" data-toggle="tooltip" title="Toggle builder view"></i>',command:"toggle-builder-view"}]},{id:"app-layout-render-actions",el:"#panel__app-layout-render-actions",buttons:[{id:"toggle-render-view",className:"app-layout-render-actions",label:'<i id="toggle-render-view" class="fas fa-eye  panel-action" data-toggle="tooltip" title="Toggle builder view"></i>',command:"toggle-render-view"}]},{id:"app-layout-actions",el:"#panel__app-layout-actions",buttons:[{id:"toggle-full-screen",active:!1,className:"app-layout-actions",label:'<i id="toggle-render-view" class="fas fa-expand  panel-action" data-toggle="tooltip" title="Fullscreen mode"></i>',command:"toggle-fullscreen",toggable:!1}]},{id:"panel__app-selection-actions",el:"#panel__app-selection-actions",buttons:[{id:"duplicate-module",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-clone panel-action" data-toggle="tooltip" title="duplicate selected modules"></i>',command:"duplicate-module",toggable:!1},{id:"horizontal-align",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-ruler-vertical panel-action" data-toggle="tooltip" title="horizontal align selected modules"></i>',command:"horizontal-align",toggable:!1},{id:"vertical-align",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-ruler-horizontal panel-action" data-toggle="tooltip" title="vertical align selected modules"></i>',command:"vertical-align",toggable:!1},{id:"group-module",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-object-group panel-action" data-toggle="tooltip" title="group selected modules"></i>',command:"group-module",toggable:!1}]},{id:"panel__app-component-actions",el:"#panel__app-component-actions",buttons:[{id:"create-component",active:!1,className:"selection-actions",label:'<i id="create-component" class="fas fa-cube panel-action" data-toggle="tooltip" title="create a component from selected modules"></i>',command:"group-as-component",toggable:!1},{id:"publish-component",active:!1,className:"selection-actions",label:'<i id="publish-component" class="fas fa-upload panel-action" data-toggle="tooltip" title="publish selected component"></i>',command:"publish-component",toggable:!1}]},{id:"panel__app-tree-structure",el:"#panel__app-tree-structure",buttons:[{id:"display-tree-structure",active:!1,className:"tree-structure",label:'<label class="text-light border px-2" >active layer <i class="fas fa-caret-down pl-2"></i> </label>',command:"display-tree-structure",toggable:!1}]}]}var u=n(158),p=n(519),m=n(586);async function h(){localStorage.setItem("gjs-components",""),localStorage.setItem("gjs-html",""),localStorage.setItem("gjs-css",""),localStorage.setItem("gjs-styles","");let e=r.ST.getInstance();e.debugOn&&e.logRenderTopic({level:r.in.Info,message:"create layout editor",object:{}});let t=new u.Subject,n=m.init({autorender:!1,container:"#gjs",canvas:{styles:[],scripts:[]},height:"100%",width:"auto",panels:{defaults:[]},assetManager:{assets:[],autoAdd:1},keymaps:{defaults:{}},commands:{defaults:[]},selectorManager:{appendTo:"#styles"},blockManager:{appendTo:"#blocks",blocks:[{id:"section",label:"<b>Section</b>",category:"Basic",attributes:{class:"gjs-block-section"},content:"<section>\n        <h1>This is a simple title</h1>\n        <div>This is just a Lorem text: Lorem ipsum dolor sit amet</div>\n      </section>",render({el:e}){e.classList.add("gjs-fonts","gjs-f-h1p")}},{id:"text",label:"Text",category:"Basic",content:'<div data-gjs-type="text">Insert your text here</div>',render({el:e}){e.classList.add("gjs-fonts","gjs-f-text")}},{id:"image",label:"Image",category:"Basic",select:!0,content:{type:"image"},activate:!0,render({el:e}){e.classList.add("gjs-fonts","gjs-f-image")}},{id:"link",label:"Link",category:"Basic",select:!0,content:{type:"link",content:"Text for the link",attributes:{href:""}}},{id:"2-columns",label:"2 Columns",category:"Layouts",content:'\n            <div class="" style="display:flex; width:100%; height:100%; padding:5px" data-gjs-droppable=".fx-row-cell" data-gjs-custom-name="Row">\n              <div class="" style="min-width:50px; width:100%" data-gjs-draggable=".row" \n                data-gjs-resizable="resizerRight" data-gjs-name= "Cell"></div>\n              <div class="" style="min-width:50px; width:100%"  data-gjs-draggable=".row"\n                data-gjs-resizable="resizerRight" data-gjs-name= "Cell" ></div>\n            </div>\n          ',render({el:e}){e.classList.add("gjs-fonts","gjs-f-b2")}}]},styleManager:{appendTo:"#styles",sectors:[{name:"Dimension",open:!1,buildProps:["width","height","min-width","min-height","max-width","max-height","padding","margin"],properties:[{type:"integer",name:"The width",property:"width",units:["px","%"],defaults:"auto",min:0}]},{name:"Extra",open:!1,buildProps:["background-color","box-shadow","custom-prop"],properties:[{id:"custom-prop",name:"Custom Label",property:"font-size",type:"select",defaults:"32px",options:[{value:"12px",name:"Tiny"},{value:"18px",name:"Medium"},{value:"32px",name:"Big"}]}]},{name:"Typography",open:!1,buildProps:["font-family","font-size","font-weight","letter-spacing","color","line-height","text-align","text-decoration","text-shadow"],properties:[{name:"Font",property:"font-family"},{name:"Weight",property:"font-weight"},{name:"Font color",property:"color"},{property:"text-align",type:"radio",defaults:"left",list:[{value:"left",name:"Left",className:"fa fa-align-left"},{value:"center",name:"Center",className:"fa fa-align-center"},{value:"right",name:"Right",className:"fa fa-align-right"},{value:"justify",name:"Justify",className:"fa fa-align-justify"}]},{property:"text-decoration",type:"radio",defaults:"none",list:[{value:"none",name:"None",className:"fa fa-times"},{value:"underline",name:"underline",className:"fa fa-underline"},{value:"line-through",name:"Line-through",className:"fa fa-strikethrough"}]},{property:"text-shadow",properties:[{name:"X position",property:"text-shadow-h"},{name:"Y position",property:"text-shadow-v"},{name:"Blur",property:"text-shadow-blur"},{name:"Color",property:"text-shadow-color"}]}]},{name:"Decorations",open:!1,buildProps:["opacity","background-color","border-radius","border","box-shadow","background"],properties:[{type:"slider",property:"opacity",defaults:1,step:.01,max:1,min:0},{property:"border-radius",properties:[{name:"Top",property:"border-top-left-radius"},{name:"Right",property:"border-top-right-radius"},{name:"Bottom",property:"border-bottom-left-radius"},{name:"Left",property:"border-bottom-right-radius"}]},{property:"box-shadow",properties:[{name:"X position",property:"box-shadow-h"},{name:"Y position",property:"box-shadow-v"},{name:"Blur",property:"box-shadow-blur"},{name:"Spread",property:"box-shadow-spread"},{name:"Color",property:"box-shadow-color"},{name:"Shadow type",property:"box-shadow-type"}]},{property:"background",properties:[{name:"Image",property:"background-image"},{name:"Repeat",property:"background-repeat"},{name:"Position",property:"background-position"},{name:"Attachment",property:"background-attachment"},{name:"Size",property:"background-size"}]}]},{name:"Extra",open:!1,buildProps:["transition","perspective","transform"],properties:[{property:"transition",properties:[{name:"Property",property:"transition-property"},{name:"Duration",property:"transition-duration"},{name:"Easing",property:"transition-timing-function"}]},{property:"transform",properties:[{name:"Rotate X",property:"transform-rotate-x"},{name:"Rotate Y",property:"transform-rotate-y"},{name:"Rotate Z",property:"transform-rotate-z"},{name:"Scale X",property:"transform-scale-x"},{name:"Scale Y",property:"transform-scale-y"},{name:"Scale Z",property:"transform-scale-z"}]}]},{name:"Flex",open:!1,properties:[{name:"Flex Container",property:"display",type:"select",defaults:"block",list:[{value:"block",name:"Disable"},{value:"flex",name:"Enable"}]},{name:"Flex Parent",property:"label-parent-flex",type:"integer"},{name:"Direction",property:"flex-direction",type:"radio",defaults:"row",list:[{value:"row",name:"Row",className:"icons-flex icon-dir-row",title:"Row"},{value:"row-reverse",name:"Row reverse",className:"icons-flex icon-dir-row-rev",title:"Row reverse"},{value:"column",name:"Column",title:"Column",className:"icons-flex icon-dir-col"},{value:"column-reverse",name:"Column reverse",title:"Column reverse",className:"icons-flex icon-dir-col-rev"}]},{name:"Justify",property:"justify-content",type:"radio",defaults:"flex-start",list:[{value:"flex-start",className:"icons-flex icon-just-start",title:"Start"},{value:"flex-end",title:"End",className:"icons-flex icon-just-end"},{value:"space-between",title:"Space between",className:"icons-flex icon-just-sp-bet"},{value:"space-around",title:"Space around",className:"icons-flex icon-just-sp-ar"},{value:"center",title:"Center",className:"icons-flex icon-just-sp-cent"}]},{name:"Align",property:"align-items",type:"radio",defaults:"center",list:[{value:"flex-start",title:"Start",className:"icons-flex icon-al-start"},{value:"flex-end",title:"End",className:"icons-flex icon-al-end"},{value:"stretch",title:"Stretch",className:"icons-flex icon-al-str"},{value:"center",title:"Center",className:"icons-flex icon-al-center"}]},{name:"Flex Children",property:"label-parent-flex",type:"integer"},{name:"Order",property:"order",type:"integer",defaults:0,min:0},{name:"Flex",property:"flex",type:"composite",properties:[{name:"Grow",property:"flex-grow",type:"integer",defaults:0,min:0},{name:"Shrink",property:"flex-shrink",type:"integer",defaults:0,min:0},{name:"Basis",property:"flex-basis",type:"integer",units:["px","%",""],unit:"",defaults:"auto"}]},{name:"Align",property:"align-self",type:"radio",defaults:"auto",list:[{value:"auto",name:"Auto"},{value:"flex-start",title:"Start",className:"icons-flex icon-al-start"},{value:"flex-end",title:"End",className:"icons-flex icon-al-end"},{value:"stretch",title:"Stretch",className:"icons-flex icon-al-str"},{value:"center",title:"Center",className:"icons-flex icon-al-center"}]}]}]},layerManager:{appendTo:"#layers"},traitManager:{appendTo:"#traits"}});n.dynamicModulesId=[],n.fluxCache={};let o=document.getElementById("bootstrap-css");o||console.error("Bootstrap css needs to be included in host application with id 'bootstrap-css' ");let s=document.getElementById("fontawesome-css");s||console.error("Fontawesome css needs to be included in host application with id 'fontawesome-css' ");let i=document.getElementById("youwol-css");return i||console.error("Fontawesome css needs to be included in host application with id 'fontawesome-css' "),n.on("load",(function(){let e=n.Canvas.getDocument(),r=e.head;r.appendChild(o.cloneNode()),r.appendChild(s.cloneNode()),r.appendChild(i.cloneNode());var l=e.createElement("style");l.innerHTML=".mw-50px{ min-width:50px}.w-5{width:5%};.w-10{width:10%}.w-15{width:15%}.w-20{width:20%}.w-30{width:30%}.w-40{width:40%}.w-60{width:60%}.w-70{width:70%}.w-80{width:80%}.w-90{width:90%}.zindex-1{z-index:1}\n    .flux-component{min-height:50px;} .preview .gjs-hovered{outline:0px !important} .preview .gjs-selected{outline:0px !important} \n    .flux-builder-only{opacity:0.5} .flux-builder-only.preview{ display:none}\n    .flux-fill-parent{width:100%; height:100%}",e.body.appendChild(l),t.next(n)})),n.SelectorManager.getAll().each((e=>{console.log("Set privates class!!"),e.set("private",!0)})),n.render(),new Promise((e=>t.pipe((0,p.take)(1)).subscribe((t=>e(t)))))}function g(e,{layout:t,style:n},d){let u=r.ST.getInstance();u.debugOn&&u.logRenderTopic({level:r.in.Info,message:"initialize layout editor",object:{}}),function(e,t){let n=r.ST.getInstance();e.on("change",(e=>{let o=localStorage.getItem("gjs-html");t.project.runnerRendering.layout!==o&&""!=o&&(n.debugOn&&n.logRenderTopic({level:r.in.Info,message:"change => layout",object:{element:e,oldLayout:t.project.runnerRendering.layout,newLayout:o}}),t.setRenderingLayout(localStorage.getItem("gjs-html")));let s=(0,l.ar)(localStorage.getItem("gjs-css"));t.project.runnerRendering.style!==s&&""!=s&&(n.debugOn&&n.logRenderTopic({level:r.in.Info,message:"change => style",object:{element:e,oldCss:t.project.runnerRendering.style,newCss:s}}),t.setRenderingStyle(s))})),e.on("canvas:drop",((s,l)=>{n.debugOn&&n.logRenderTopic({level:r.in.Info,message:"canvas:drop",object:{dataTransfer:s,component:l.toJSON()}});let d=l.view.el,c=t.getModule(d.id);if(c){n.debugOn&&n.logRenderTopic({level:r.in.Info,message:"canvas:drop => flux-module",object:{module:c}});let s=[];c instanceof i.Component.Module&&(s=c.getAllChildren(t.project.workflow).map((e=>e.moduleId)),e.getStyle().add(c.getFullCSS(t.project.workflow,{asString:!0}))),d.id=c.moduleId,(0,o.Ni)([d.id,...s],e,t),(0,a.D)(t,e)}})),e.on("component:update:content",(e=>{n.debugOn&&n.logRenderTopic({level:r.in.Info,message:"component:update:content",object:{module:e}})})),e.on("component:update:style",(e=>{n.debugOn&&n.logRenderTopic({level:r.in.Info,message:"component:update:style",object:{module:e}})})),e.on("sorter:drag:end",(({modelToDrop:s,srcEl:l})=>{if(n.debugOn&&n.logRenderTopic({level:r.in.Info,message:"sorter:drag:end",object:{module:s}}),"string"==typeof s)return;let a=t.getModule(s.ccid);if(!a)return;let d=a instanceof i.Component.Module?a.getAllChildren(t.project.workflow).map((e=>e.moduleId)):[a.moduleId];(0,o.Ni)(d,e,t)})),e.on("component:remove",(n=>{t.getActiveGroup().getModuleIds().includes(n.ccid)&&(0,a.D)(t,e)})),e.on("selector:add",(e=>{e.set("active",!1),e.set("private",l.cV.includes(e.id))})),e.Commands.add("show-blocks",{getRowEl:e=>e.getContainer().closest("#editor-row"),getLayersEl:e=>e.querySelector("#blocks"),run(e,t){this.getLayersEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getLayersEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-styles",{getRowEl:e=>e.getContainer().closest("#editor-row"),getStyleEl:e=>e.querySelector("#styles"),run(e,t){this.getStyleEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getStyleEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-layers",{getRowEl:e=>e.getContainer().closest("#editor-row"),getLayersEl:e=>e.querySelector("#layers"),run(e,t){this.getLayersEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getLayersEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-traits",{getRowEl:e=>e.getContainer().closest("#editor-row"),getTraitsEl:e=>e.querySelector("#traits"),run(e,t){this.getTraitsEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getTraitsEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("open-code",{getRowEl:e=>e.getContainer().closest("#editor-row"),getCodeEl:e=>e.querySelector("#codes"),run:function(e,n){const i=e.Panels,r="code",l=i.getPanel(r)||i.addPanel({id:r});let a=this.getCodeEl(this.getRowEl(e));console.log("Code elements",a),this.codePanel||(this.codePanel=function(e,t,n){const i=document.createElement("div");i.classList.add("code-panel");const r=document.createElement("section"),l=document.createElement("section");r.innerHTML="<div>HTML</div>",l.innerHTML="<div>CSS</div>";const a=s(t,"html"),d=s(t,"css"),c=document.createElement("textarea"),u=document.createElement("textarea");return r.appendChild(c),l.appendChild(u),i.appendChild(r),i.appendChild(l),n.set("appendContent",i).trigger("change:appendContent"),a.init(c),d.init(u),a.setContent(t.getHtml()),d.setContent(t.getCss({avoidProtected:!0})),function(e,t,n){function s(){const s=n.editor.getValue();if(!s)return;t.setComponents(s),(0,o.Ni)(e.project.workflow.modules.map((e=>e.moduleId)),t,e);let i=Object.values(t.fluxCache).reduce(((e,t)=>e+" "+t.styles),"");t.getStyle().add(i)}var i;n.editor.on("change",(function(){clearTimeout(i),i=setTimeout(s,300)})),n.editor.refresh()}(e,t,a),function(e,t){function n(){const n=t.editor.getValue();n&&e.setStyle(n)}var o;t.editor.on("change",(function(){clearTimeout(o),o=setTimeout(n,300)}))}(t,d),setTimeout((()=>{a.editor.refresh(),d.editor.refresh()}),320),i}(t,e,l)),console.log("Code Panel",this.codePanel),this.codePanel.style.display="block",a.appendChild(this.codePanel)},stop:function(e,t){this.codePanel&&(this.codePanel.style.display="none")}}),e.Commands.add("custom-preview",{run(e,t){document.querySelector("#gjs-cv-tools").classList.add("preview"),e.Canvas.getDocument().body.querySelector("div").classList.add("preview"),Array.from(e.Canvas.getDocument().querySelectorAll(".flux-builder-only")).forEach((e=>e.classList.add("preview"))),document.getElementById("panels-container-render").classList.add("collapsed");let n=document.getElementById("panel__right_render");n.classList.add("collapsed"),n.querySelectorAll(".flex-align-switch").forEach((e=>e.style.flexDirection="column")),n.querySelectorAll(".buttons-toolbox").forEach((e=>{let t=e.firstChild;t&&t.style&&(t.style.flexDirection="column")}))},stop(e,t){document.querySelector("#gjs-cv-tools").classList.remove("preview"),e.Canvas.getDocument().body.querySelector("div").classList.remove("preview"),Array.from(e.Canvas.getDocument().querySelectorAll(".flux-builder-only")).forEach((e=>e.classList.remove("preview"))),document.getElementById("panels-container-render").classList.remove("collapsed");let n=document.getElementById("panel__right_render");n.classList.remove("collapsed"),n.querySelectorAll(".flex-align-switch").forEach((e=>e.style.flexDirection="row")),n.querySelectorAll(".buttons-toolbox").forEach((e=>{let t=e.firstChild;t&&t.style&&(t.style.flexDirection="row")}))}}),e.Commands.add("set-device-tablet",{run(e,t){e.setDevice("Tablet")},stop(e,t){}}),e.Commands.add("set-device-desktop",{run(e,t){e.setDevice("Desktop")},stop(e,t){}}),e.Commands.add("set-device-mobile-landscape",{run(e,t){e.setDevice("Mobile landscape")},stop(e,t){}}),e.Commands.add("set-device-mobile-portrait",{run(e,t){e.setDevice("Mobile portrait")},stop(e,t){}}),e.on("run:preview:before",(({sender:e})=>{e.panelRight=document.getElementById("panel__right"),e.panelRight.remove()})),e.on("stop:preview:before",(({sender:e})=>{e&&e.panelRight&&document.getElementById("editor-row").appendChild(e.panelRight)}))}(e,d),e.BlockManager.getCategories().each((e=>e.set("open",!1))),[...c(d),{id:"layout-basic-actions",el:"#panel__layout-basic-actions",buttons:[{id:"visibility",active:!0,className:"btn-toggle-borders",label:'<i class="fas fa-border-none"></i>',command:"sw-visibility"}]},{id:"layout-show-actions",el:"#panel__render-show-actions",buttons:[{id:"preview",className:"btn-preview",label:'<i class="fas fa-eye"></i>',command:"custom-preview"}]},{id:"layout-devices-actions",el:"#panel__layout-devices-actions",buttons:[{id:"desktop",active:!0,className:"btn-set-device-desktop",label:'<i class="fas fa-desktop"></i>',command:"set-device-desktop"},{id:"tablet",active:!1,className:"btn-set-device-tablet",label:'<i class="fas fa-tablet-alt"></i>',command:"set-device-tablet"},{id:"mobile landscape",active:!1,className:"btn-set-device-phone",label:'<i class="fas fa-mobile-alt"></i>',command:"set-device-mobile-landscape"},{id:"mobile portrait",active:!1,className:"btn-set-device-phone",label:'<i class="fas fa-mobile-alt"></i>',command:"set-device-mobile-portrait"}]},{id:"layout-managers-actions",el:"#panel__render-panels-actions",buttons:[{id:"show-blocks",active:!0,label:'<i class="fas fa-th-large"></i>',command:"show-blocks",togglable:!1},{id:"show-style",active:!1,label:'<i class="fas fa-palette"></i>',command:"show-styles",togglable:!1},{id:"show-traits",active:!1,className:"fa fa-cog",command:"show-traits",attributes:{title:"Open Trait Manager"},togglable:!1},{id:"show-layers",active:!1,className:"fa fa-bars",command:"show-layers",attributes:{title:"Open Layer Manager"},togglable:!1},{id:"code",className:"btn-preview",label:'<i class="fas fa-code"></i>',command:"open-code"}]}].forEach((t=>e.Panels.addPanel(t))),function(e){let t=document.getElementById("gjs-tools").querySelector(".gjs-toolbar");new MutationObserver((function(e,n){t.children.length>0&&(t.querySelector(".fa-arrows").classList.add("fas","fa-arrows-alt"),t.querySelector(".fa-trash-o").classList.add("fas","fa-trash"))})).observe(t,{attributes:!0,childList:!0,subtree:!1});let n=e.Commands.get("tlb-move");e.Commands.add("tlb-move",{run(e,t,o={}){o&&o.event&&o.event.target||n.run(e,t,o)}}),e.Commands.run("show-attributes"),e.Commands.stop("show-attributes"),e.Commands.run("show-styles"),e.Commands.stop("show-styles"),e.Commands.run("show-traits"),e.Commands.stop("show-traits"),e.Commands.run("show-layers"),e.Commands.stop("show-layers"),document.getElementById("panel__layout-devices-actions").children[0].classList.add("d-flex","flex-wrap"),document.getElementById("panel__render-panels-actions").children[0].classList.add("d-flex","flex-wrap")}(e),console.log("INIT!!",{layout:t.outerHTML,style:n}),e.setComponents(t.outerHTML),e.setStyle(n)}},606:(e,t,n)=>{"use strict";n.d(t,{cV:()=>o,ar:()=>s,HZ:()=>i});let o=["flux-element","flux-component","flux-fill-parent","d-flex","flex-column"];function s(e){return[...new Set(e.split("}"))].filter((e=>e.length>0)).map((e=>e+"}")).reduce(((e,t)=>e+t),"")}function i(e,t){const n=(e,t=[])=>(t.push(e),e.components().each((e=>n(e,t))),t);return t=t||e.DomComponents.getWrapper(),n(t).reduce(((e,t)=>Object.assign({},e,{[t.ccid]:t})),{})}},345:(e,t,n)=>{"use strict";n.d(t,{o:()=>l});var o=n(935),s=n(222),i=n(519),r=n(230);function l(e,t){e.environment.errors$.pipe((0,i.filter)((e=>e.error instanceof o.ModuleError))).subscribe((n=>a.error({message:n.error.message,title:n.error.module.Factory.id,actions:[{name:"focus",exe:()=>function(e,t,n,s,i=5e3){t.getRootComponent();let r=t.project.workflow.modules.find((e=>e instanceof o.GroupModules.Module&&e.getModuleIds().includes(e.moduleId)));t.selectActiveGroup(r.moduleId),setTimeout((()=>{let t=document.getElementById(e.moduleId),o=t.getBoundingClientRect();n.drawingArea.lookAt(.5*(o.left+o.right),.5*(o.top+o.bottom)),t.classList.toggle(s),setTimeout((()=>t.classList.toggle(s)),i)}),0)}(n.error.module,e,t,"error")},{name:"report",exe:()=>r.R.reportContext(n.context,n.id)}]}))),e.environment.processes$.subscribe((e=>{let t={[o.ProcessMessageKind.Scheduled]:"fas fa-clock px-2",[o.ProcessMessageKind.Started]:"fas fa-cog fa-spin px-2",[o.ProcessMessageKind.Succeeded]:"fas fa-check fv-text-success px-2",[o.ProcessMessageKind.Failed]:"fas fa-times fv-text-error px-2",[o.ProcessMessageKind.Log]:"fas fa-cog fa-spin px-2"},n=[o.ProcessMessageKind.Succeeded,o.ProcessMessageKind.Failed],l=e.context?[{name:"report",exe:()=>r.R.reportContext(e.context)}]:[];a.notify({title:e.title,message:(0,s.attr$)(e.messages$,(e=>e.text)),classIcon:(0,s.attr$)(e.messages$,(e=>t[e.kind])),actions:l,timeout:e.messages$.pipe((0,i.filter)((e=>n.includes(e.kind))),(0,i.take)(1),(0,i.delay)(1e3))})}))}class a{constructor(e){this.appStore=e}static notify({message:e,title:t,classIcon:n,actions:o,timeout:s}){a.popup({message:e,title:t,actions:o,classIcon:n,timeout:s,classBorder:""})}static error({message:e,title:t,actions:n}){a.popup({message:e,title:t,actions:n,classIcon:a.classesIcon[4],classBorder:a.classesBorder[4]})}static warning({message:e,title:t,actions:n}){a.popup({message:e,title:t,actions:n,classIcon:a.classesIcon[3],classBorder:a.classesBorder[3]})}static popup({message:e,title:t,actions:n,classIcon:o,classBorder:i,timeout:r}){let l={class:"m-2 p-2 my-1 bg-white rounded "+i,style:{border:"solid"},children:[{class:"fas fa-times",style:{float:"right",cursor:"pointer"},onclick:e=>{e.target.parentElement.remove()}},{class:"d-flex py-2 align-items-center",children:[{tag:"i",class:o},{tag:"span",class:"d-block",innerText:t}]},e?{tag:"span",class:"d-block px-2",innerText:e}:{},{class:"d-flex align-space-around mt-2 fv-pointer",children:n.map((e=>({tag:"span",class:"mx-2 p-2 fv-bg-background-alt rounded fv-hover-bg-background fv-hover-text-focus fv-text-primary",innerText:e.name,onclick:()=>e.exe()})))}],connectedCallback:e=>{r&&r.subscribe((()=>e.remove()))}},a=(0,s.render)(l);document.getElementById("notifications-container").appendChild(a)}}a.classesIcon={4:"fas fa-2x fa-exclamation-circle text-danger px-2 mt-auto mb-auto",3:"fas fa-2x fa-exclamation text-warning px-2 mt-auto mb-auto"},a.classesBorder={4:"border-danger",3:"border-warning"}},600:(e,t,n)=>{"use strict";n.a(e,(async e=>{n.r(t),n.d(t,{connectStreams:()=>C,createDrawingArea:()=>M});var o=n(158),s=n(519),i=n(935),r=n(249),l=n(396),a=n(862),d=n(322),c=n(48),u=n(95),p=n(345),m=n(931),h=n(735),g=n(222),f=n(401),w=n(595),b=n(568),v=n(450);let x=!1,y=a.ST.getInstance();y.workflowUIEnabled=x,y.observableEnabled=x,y.workflowUIEnabled=x,y.workflowViewEnabled=x,y.WorkflowBuilderEnabled=x,y.renderTopicEnabled=x,y.workflowView$Enabled=x;let I=new i.Environment({console,renderingWindow:void 0,executingWindow:window});y.logWorkflowBuilder({level:a.in.Info,message:"Environment instantiated",object:{environment:I}});let S=a.dk.getInstance(I);!function(e){m.k.appStore=e,h.Q.singletonState=new h.Q.State({appStore:e}),i.Journal.registerView({name:"ConfigurationStatus",isCompatible:e=>e instanceof i.ConfigurationStatus,view:e=>(0,g.render)(c.eD.journalWidget(e))}),i.Journal.registerView({name:"ExpectationStatus",isCompatible:e=>e instanceof i.ExpectationStatus,view:e=>(0,g.render)(c.rj.journalWidget(e))})}(S),function(e){let t=(0,v.E)(e);document.body.appendChild((0,g.render)(t))}(S);let j=await(0,u.cw)();!function(e){I.renderingWindow=e.Canvas.getDocument().defaultView}(j);let k=M(S,S.appObservables);(0,p.o)(S,k);let $=new c.j3(S,k.drawingArea);async function C(e,t){let n=!0,i=e.appObservables;i.packagesLoaded$.subscribe((()=>document.getElementById("loading-screen").remove())),i.uiStateUpdated$.subscribe((e=>function(e){let t=document.getElementById("render-component"),n=document.getElementById("builder-component");n.classList.remove("combined","builder","render","none"),t.classList.remove("combined","builder","render","none"),n.classList.add(e.mode),t.classList.add(e.mode)}(e))),await i.renderingLoaded$.pipe((0,s.take)(1)).toPromise().then((({layout:n,style:o})=>{(0,u.Af)(t,{layout:n,style:o},e),(0,w.Ni)(e.getModulesAndPlugins().map((e=>e.moduleId)),t,e)})),i.modulesUpdated$.subscribe((o=>{let s=o.createdElements.map((e=>e.moduleId)),i=o.removedElements.filter((e=>!s.includes(e.moduleId)));(0,w.tj)(i,t),n&&(0,w.Ni)(s,t,e),n||((0,w.l3)(o,t,e),(0,w.kH)(o,t,e),(0,w.fr)(o,t,e)),(0,b.D)(e,t)})),i.activeLayerUpdated$.subscribe((()=>{(0,b.D)(e,t)})),i.unselect$.subscribe((()=>{t.Commands.stop("show-attributes")})),(0,o.merge)(i.moduleSelected$,i.connectionSelected$).subscribe((()=>{t.Commands.run("show-attributes")})),i.uiStateUpdated$.subscribe((()=>{t.refresh()})),n=!1}function M(e,t){let n=a.Dw.getInstance(),o=(0,r.createDrawingArea)({containerDivId:"wf-builder-view",width:1e3,height:1e3,xmin:-500,ymin:-500,xmax:500,ymax:500,margin:50,overflowDisplay:{left:1e8,right:1e8,top:1e8,bottom:1e8}});return new d.hb(o,t,n,e)}new l.ContextMenu.View({state:$,class:"fv-bg-background"}),C(S,j),function(e){let t=new URLSearchParams(window.location.search).get("id"),n=new URLSearchParams(window.location.search).get("uri");if(t){let n=document.getElementById("content-loading-screen"),o=(0,f.XF)(n);e.environment.getProject(t).subscribe((s=>{o.innerText="> project loaded",o.style.setProperty("color","green"),e.loadProject(t,s,(e=>{(0,f.Cu)(e,n)}))}))}else n&&e.loadProjectURI(encodeURI(n))}(S),e()}),1)},450:(e,t,n)=>{"use strict";n.d(t,{E:()=>C});var o,s=n(935),i=n(222),r=n(158),l=n(939),a=n(519),d=n(182),c=n(327),u=n(313),p=n(690),m=n(137);!function(e){function t(e,t,n,o){let s=t.reduce(((e,t)=>e[t]),n),i=o.elementsViewFactory.find((t=>t.test(e)));if(!i)return{id:"unkwnown-element-"+e.name+"-"+e.type};let l=new r.BehaviorSubject(s),d=i.view(l,e),c=l.pipe((0,a.map)((e=>({path:t,value:e}))));return o.outputValues$.push(c),d}function n(e,o,s=[],i){let r=e.filter((([e,t])=>!e.includes(".")&&function(e){return e.type&&["Number","String","Boolean","Object"].includes(e.type)}(t))),l=e.filter((e=>e[0].includes("."))).map((([e,t])=>{let n=e.split(".")[0];return[n,[e.split(".").slice(1).join("."),t],s.concat(n)]})).reduce(((e,[t,n,o])=>(e[t]||(e[t]={values:[],basePath:o}),e[t].values.push(n),e)),{}),a=Object.entries(l).map((([e,{values:t,basePath:s}])=>[e,n(t,o,s,i)])).reduce(((e,[t,n])=>Object.assign({},e,{[t]:n})),{}),d=function(e,n,o,s){let i=Object.keys(n.reduce(((e,t)=>e[t]),o));return 0==(e=e.sort(((e,t)=>i.indexOf(e[0])-i.indexOf(t[0])))).length?{}:{class:"row",style:{padding:"0px",margin:"0px"},children:e.map((e=>[{class:"col my-auto p-0",innerText:e[0]},{class:"col pl-0",style:{"align-self":"center"},children:[t(e[1],n.concat(e[0]),o,s)]},{class:"w-100 py-1"}])).reduce(((e,t)=>e.concat(t)))}}(r,s,o,i),c=Object.entries(a).map((([e,t])=>{let n=new p.Tabs.TabData(e,e);return n.view=t,n}));if(0==c.length)return{class:"p-2",children:[d]};let u=new p.Tabs.State(c);return{class:"p-2",children:[d,new p.Tabs.View({state:u,contentView:(e,t)=>t.view,headerView:(e,t)=>({innerText:t.name,class:"px-2"})})]}}e.State=class{constructor(t,n,o=e.viewFactory){this.schema=n,this.elementsViewFactory=o,this.outputValues$=new Array,this.inputValues$=t instanceof r.BehaviorSubject?t:new r.BehaviorSubject(t),this.currentValue$=new r.BehaviorSubject(this.inputValues$.getValue())}},e.viewFactory=[{test:e=>"Boolean"==e.type,view:e=>(c.Switch.View.defaultRadius=10,new c.Switch.View({state:new c.Switch.State(e)}))},{test:e=>"color"==e.metadata.type,view:(e,t)=>new u.ColorPicker.View({state:new u.ColorPicker.State(e)})},{test:e=>e.metadata.enum,view:(e,t)=>{let n=t.metadata.enum.map((e=>new u.Select.ItemData(e,e)));return new u.Select.View({state:new u.Select.State(n,e),class:"w-100 ",style:{fontSize:"larger"}})}},{test:e=>"String"==e.type,view:e=>({tag:"input",type:"text",value:e.getValue(),onchange:t=>e.next(t.target.value)})},{test:e=>"Number"==e.type&&null!=e.metadata.min&&null!=e.metadata.max,view:(e,t)=>{let n=new r.BehaviorSubject(!1),o=new u.Slider.State({min:t.metadata.min,max:t.metadata.max,value:e,count:1e3});return{class:"d-flex",children:[{tag:"input",class:(0,i.attr$)(n,(e=>e?"w-100":"w-25")),type:"number",value:(0,i.attr$)(e,(e=>e)),onchange:t=>e.next(Number(t.target.value)),onmouseenter:()=>n.next(!0),onmouseleave:()=>n.next(!1)},new u.Slider.View({state:o,class:"w-75"})]}}},{test:e=>"Number"==e.type,view:e=>({tag:"input",type:"number",value:e.getValue(),onchange:t=>e.next(Number(t.target.value))})}],e.View=class{constructor({state:e,...t}){Object.assign(this,t),this.state=e,this.children=[(0,i.child$)(e.inputValues$,(t=>n(Object.entries(e.schema),t,[],e)),{sideEffects:(t,n)=>{let o=(0,r.combineLatest)(this.state.outputValues$).subscribe((t=>{let n=(0,m.cloneDeep)(e.inputValues$.getValue());t.forEach((({path:e,value:t})=>{let o=e.slice(-1)[0];e.slice(0,-1).reduce(((e,t)=>e[t]),n)[o]=t})),e.currentValue$.next(n)}));n.ownSubscriptions(o)}})]}}}(o||(o={}));let h=class{constructor(e={}){this.wireless=!1,this.adaptor="\n    return ({data,configuration,context}) => ({\n        data: data,\n        context:{},\n        configuration: configuration\n    })",Object.assign(this,e)}};(0,l.gn)([(0,s.Property)({description:"wireless"}),(0,l.w6)("design:type",Boolean)],h.prototype,"wireless",void 0),(0,l.gn)([(0,s.Property)({description:"adaptor",type:"code"}),(0,l.w6)("design:type",String)],h.prototype,"adaptor",void 0),h=(0,l.gn)([(0,s.Schema)({pack:{}}),(0,l.w6)("design:paramtypes",[Object])],h);class g{constructor(e,t){this.appStore=t;let n=t.getConnectionView(e.connectionId),i=new h({...n?{wireless:n.wireless}:{},...e.adaptor?{adaptor:e.adaptor.toString()}:{}}),l=(0,s.flattenSchemaWithValue)(i);Object.keys(l).forEach((e=>l[e]=l[e][0]));let c=new r.BehaviorSubject(i);this.autoFormState=new o.State(c,l,((e,t)=>[{test:e=>e.metadata&&"code"==e.metadata.type,view:n=>({class:"fab fa-js-square fv-pointer fa-2x fv-hover-bg-background",onclick:()=>{d.b.popupModal({connection:e,initialCode:n.getValue(),appStore:t,onUpdate:e=>n.next(e)})}})},...o.viewFactory])(e,t)),this.initialSettings$=new r.BehaviorSubject(i);let u=this.autoFormState.currentValue$.pipe((0,a.filter)((e=>e.wireless!=this.initialSettings$.getValue().wireless))).subscribe((t=>{this.initialSettings$.next(t),this.appStore.setConnectionView(e,{wireless:t.wireless},!0),this.appStore.selectConnection(e.connectionId)})),p=this.autoFormState.currentValue$.pipe((0,a.filter)((e=>e.adaptor!=this.initialSettings$.getValue().adaptor))).subscribe((n=>{this.initialSettings$.next(n);let o=new s.Adaptor((0,s.uuidv4)(),n.adaptor);t.addAdaptor(o,e),this.appStore.selectConnection(e.connectionId)}));this.subscriptions=[u,p]}}class f{constructor(e){this.state=e,this.class="h-100 d-flex flex-column",this.style={fontSize:"smaller"},this.children=[new o.View({state:e.autoFormState,class:"flex-grow-1 overflow-auto my-1",style:{"min-height":"0px"}})],this.connectedCallback=t=>{t.ownSubscriptions(...e.subscriptions)}}}var w=n(350);function b(e,t,n,o){let s=o.metadata.editorConfiguration||{};return{class:`${e} fv-pointer fa-2x fv-hover-bg-background`,onclick:()=>w.s.popupModal({mdle:t,initialCode:n.getValue(),editorConfiguration:s,onUpdate:e=>n.next(e)})}}class v{constructor(e,t){this.mdle=e,this.appStore=t,this.onTheFlyUpdates$=new r.BehaviorSubject(!0);let n=(0,s.flattenSchemaWithValue)(e.configuration.data);Object.keys(n).forEach((e=>n[e]=n[e][0]));let i=new r.BehaviorSubject(e.configuration.data);this.initialSettings$=new r.BehaviorSubject(e.configuration.data),this.autoFormState=new o.State(i,n,(e=>[{test:e=>e.metadata&&"code"==e.metadata.type&&(!e.metadata.editorConfiguration||"javascript"==e.metadata.editorConfiguration.mode),view:(t,n)=>b("fab fa-js-square",e,t,n)},{test:e=>e.metadata&&"code"==e.metadata.type&&"css"==e.metadata.editorConfiguration.mode,view:(t,n)=>b("fab fa-css3-alt",e,t,n)},{test:e=>e.metadata&&"code"==e.metadata.type&&("html"==e.metadata.editorConfiguration.mode||"htmlmixed"==e.metadata.editorConfiguration.mode||"xml"==e.metadata.editorConfiguration.mode),view:(t,n)=>b("fab fa-html5",e,t,n)},...o.viewFactory])(e));let l=this.autoFormState.currentValue$.pipe((0,a.withLatestFrom)(this.onTheFlyUpdates$),(0,a.filter)((([e,t])=>t)),(0,a.filter)((([e])=>JSON.stringify(e)!=JSON.stringify(this.initialSettings$.getValue())))).subscribe((()=>this.applySettings()));this.subscriptions=[l]}toggleUpdatePolicy(){this.onTheFlyUpdates$.next(!this.onTheFlyUpdates$.getValue())}applySettings(e){let t=this.autoFormState.currentValue$.getValue(),n=new this.mdle.Factory.PersistentData(t),o=new s.ModuleConfiguration({title:e||this.mdle.configuration.title,description:this.mdle.configuration.description,data:n});this.initialSettings$.next(t),this.appStore.updateModule(this.mdle,o,!1)}}class x{constructor(e){this.state=e,this.class="h-100 d-flex flex-column",this.style={fontSize:"smaller"},this.applyChangesButton={children:[{class:"fas fa-sync fv-text-focus fv-hover-bg-background p-1 border rounded fv-pointer"}],onclick:()=>this.state.applySettings()},this.children=[this.header(),new o.View({state:e.autoFormState,class:"flex-grow-1 overflow-auto my-1",style:{"min-height":"0px"}})],this.connectedCallback=t=>{t.ownSubscriptions(...e.subscriptions)}}header(){return{class:"border rounded p-1",children:[(0,i.child$)(this.state.onTheFlyUpdates$,(e=>this.updatePolicyView(e))),{class:"d-flex align-items-center py-2 justify-content-around",children:[{innerText:"Module's title",class:"my-auto"},{tag:"input",type:"text",value:this.state.mdle.configuration.title,onchange:e=>{this.state.applySettings(e.target.value)}}]}]}}updatePolicyView(e){return{class:"d-flex align-items-center",children:[{tag:"input",type:"checkbox",checked:e,onclick:()=>this.state.toggleUpdatePolicy()},{class:"px-2",innerText:"auto apply changes"},e?{}:this.applyChangesButton]}}}function y(e){let t={combined:"h-50 d-flex",builder:"h-100 d-flex",render:"d-none"};return{id:"builder-component",class:(0,i.attr$)(e.appObservables.uiStateUpdated$,(e=>t[e.mode])),children:[{id:"wf-builder-view",class:"h-100 flex-grow-1"},I(e)]}}function I(e){let t=e.appObservables,n=[{when:e=>e instanceof s.ModuleFlux,mapTo:t=>{let n=new v(t,e);return new x(n)}},{when:e=>e instanceof s.Connection,mapTo:t=>{let n=new g(t,e);return new f(n)}}];return{id:"panel__right_builder",class:"d-flex flex-column grapes-bg-color fv-color-primary p-1 border border-dark text-left fv-text-primary",style:{width:"300px",minHeight:"0px",fontSize:"small"},children:[(0,i.child$)((0,r.merge)(t.unselect$,t.moduleSelected$,t.connectionSelected$),(e=>{let t=n.find((t=>t.when(e)));return t?t.mapTo(e):{}}))]}}function S(e){let t={combined:"h-50",builder:"d-none",render:"h-100"};return{id:"render-component",class:(0,i.attr$)(e.appObservables.uiStateUpdated$,(e=>t[e.mode])),children:[{id:"editor-row",class:"d-flex h-100",children:[{id:"gjs"},{id:"panel__right_render",class:"grapes-bg-color fv-color-primary border-top fv-color-primary controls-panel",children:[{class:"d-flex justify-content-between  flex-align-switch",children:[{id:"panel__layout-basic-actions",class:"d-block position-relative flex-align-switch buttons-toolbox"},{id:"panel__layout-devices-actions",class:"d-block position-relative flex-align-switch buttons-toolbox"}]},{id:"panel__layout-managers-actions",class:"d-flex position-relative  flex-align-switch justify-content-between ",children:[{id:"panel__render-panels-actions",class:"d-block position-relative buttons-toolbox "},{id:"panel__render-show-actions",class:"d-block position-relative buttons-toolbox "}]},{id:"panels-container-render",class:"overflow-auto  p-1 border border-dark panels-container",style:{height:"calc(100% - 80px)",width:"300px"},children:[{id:"blocks"},{id:"styles"},{id:"traits"},{id:"layers"},{id:"codes"}]}]}]}]}}var j=n(862);function k(e){let t=function(e){let t=e.appObservables;return{main:[{name:"save",class:"fas fa-save",visible:(0,r.of)(!0),enabled:(0,r.of)(!0),onTriggered:()=>e.saveProject()},{name:"undo",class:"fas fa-undo",visible:new r.BehaviorSubject(!0),enabled:t.projectUpdated$.pipe((0,a.map)((e=>e.indexHistory>1))),onTriggered:()=>e.undo()},{name:"redo",class:"fas fa-redo",visible:new r.BehaviorSubject(!0),enabled:t.projectUpdated$.pipe((0,a.map)((e=>e.indexHistory<e.history.length-1))),onTriggered:()=>e.redo()}],layout:[{name:"builder-view",class:"fas fa-project-diagram",visible:(0,r.of)(!0),enabled:t.uiStateUpdated$.pipe((0,a.map)((e=>"render"==e.mode||"combined"==e.mode))),onTriggered:()=>e.setUiState(new j.CE("builder",!1,!1))},{name:"render-view",class:"fas fa-eye",visible:(0,r.of)(!0),enabled:t.uiStateUpdated$.pipe((0,a.map)((e=>"builder"==e.mode||"combined"==e.mode))),onTriggered:()=>e.setUiState(new j.CE("render",!1,!1))},{name:"builder-view",class:"fas fa-columns fa-rotate-90",visible:(0,r.of)(!0),enabled:t.uiStateUpdated$.pipe((0,a.map)((e=>"render"==e.mode||"builder"==e.mode))),onTriggered:()=>e.setUiState(new j.CE("combined",!1,!1))},{name:"builder-view",class:"fas fa-expand  ",visible:(0,r.of)(!0),enabled:(0,r.of)(!0),onTriggered:()=>document.documentElement.requestFullscreen()}],modules:[{name:"duplicate",class:"fas fa-clone",visible:(0,r.of)(!0),enabled:(0,r.merge)(t.unselect$,t.moduleSelected$).pipe((0,a.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{let t=e.getModulesSelected();e.duplicateModules(t)}},{name:"horizontal align",class:"fas fa-ruler-vertical",visible:(0,r.of)(!0),enabled:(0,r.merge)(t.unselect$,t.moduleSelected$).pipe((0,a.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{let t=e.getModulesSelected();e.alignH(t)}},{name:"horizontal align",class:"fas fa-ruler-horizontal",visible:(0,r.of)(!0),enabled:(0,r.merge)(t.unselect$,t.moduleSelected$).pipe((0,a.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{let t=e.getModulesSelected();e.alignV(t)}}],groups:[{name:"group",class:"fas fa-object-group",visible:(0,r.of)(!0),enabled:(0,r.merge)(t.unselect$,t.moduleSelected$).pipe((0,a.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{e.addGroup(e.getModulesSelected().map((e=>e.moduleId)))}},{name:"component",class:"fas fa-cube",visible:(0,r.of)(!0),enabled:(0,r.merge)(t.unselect$,t.moduleSelected$).pipe((0,a.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{e.addComponent(e.getModulesSelected().map((e=>e.moduleId)))}}]}}(e);return{class:"d-flex grapes-bg-color py-1  fv-color-primary justify-content-around",children:[$(t.main),$(t.layout),$(t.modules),$(t.groups)]}}function $(e,t){return{class:"d-flex ",children:e.map((e=>function(e){let t=e.visible instanceof r.Observable?e.visible:(0,r.of)(e.visible),n=e.enabled instanceof r.Observable?e.enabled:(0,r.of)(e.enabled);return{tag:"button",type:"button",disabled:(0,i.attr$)(n,(e=>!e)),class:(0,i.attr$)(t,(e=>e?"d-block":"d-none"),{wrapper:e=>e+" fv-btn fv-btn-secondary mx-1 fv-pointer"}),style:(0,i.attr$)(n,(e=>e?{opacity:1}:{opacity:.5})),children:[{tag:"i",class:e.class+""}],onclick:()=>e.onTriggered()}}(e)))}}function C(e){return{id:"main-container",class:"h-100 w-100 d-flex flex-column",children:[k(e),{class:"flex-grow-1",style:{minHeight:"0px"},children:[y(e),S(e)]},{id:"notifications-container"}]}}}}]);
//# sourceMappingURL=600.10203ab983112efa7508.js.map