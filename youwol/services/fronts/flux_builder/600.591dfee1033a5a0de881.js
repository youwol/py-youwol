(self.webpackChunk=self.webpackChunk||[]).push([[600],{322:(e,t,n)=>{"use strict";n.d(t,{hb:()=>L});var o=n(935),s=n(549),i=n(158),r=n(519),l=n(249);class a extends class{constructor(e,t,n){this.id=e,this.classes=t,this.data=n}}{constructor(e,t,n,o,s,i){super(e,t,s),this.id=e,this.classes=t,this.inputGroup=n,this.outputGroup=o,this.data=s,this.adaptor=i}}let d='\n<linearGradient id="a" gradientTransform="matrix(1 0 0 -1 0 -22278)" gradientUnits="userSpaceOnUse" x1="0" x2="512" y1="-22534" y2="-22534"><stop offset="0" stop-color="#00f1ff"/><stop offset=".231" stop-color="#00d8ff"/><stop offset=".5138" stop-color="#00c0ff"/><stop offset=".7773" stop-color="#00b2ff"/><stop offset="1" stop-color="#00adff"/></linearGradient>\n<path d="m512 256c0 141.386719-114.613281 256-256 256s-256-114.613281-256-256 114.613281-256 256-256 256 114.613281 256 256zm0 0" fill="url(#a)"/><g fill="#fff"><path d="m279.050781 385.15625c0 13.128906-10.640625 23.773438-23.769531 23.773438s-23.773438-10.644532-23.773438-23.773438 10.644532-23.769531 23.773438-23.769531 23.769531 10.640625 23.769531 23.769531zm0 0"/><path d="m85.996094 209.265625c-3.660156 0-7.332032-1.332031-10.222656-4.027344-6.058594-5.644531-6.394532-15.136719-.746094-21.199219 47.460937-50.921874 111.730468-78.964843 180.96875-78.964843 69.246094 0 133.515625 28.042969 180.976562 78.964843 5.648438 6.0625 5.3125 15.554688-.746094 21.199219-6.058593 5.652344-15.550781 5.316407-21.199218-.742187-41.726563-44.769532-98.203125-69.421875-159.023438-69.421875-60.832031 0-117.304687 24.652343-159.03125 69.421875-2.953125 3.167968-6.960937 4.769531-10.976562 4.769531zm0 0"/><path d="m138.582031 269.089844c-3.820312 0-7.640625-1.449219-10.566406-4.355469-5.878906-5.832031-5.914063-15.332031-.082031-21.210937 35.101562-35.375 80.582031-54.859376 128.0625-54.859376 47.472656 0 92.953125 19.480469 128.0625 54.859376 5.835937 5.878906 5.800781 15.375-.078125 21.210937-5.882813 5.835937-15.378907 5.800781-21.214844-.078125-29.433594-29.660156-67.351563-45.992188-106.769531-45.992188-39.421875 0-77.339844 16.332032-106.765625 45.988282-2.933594 2.957031-6.789063 4.4375-10.648438 4.4375zm0 0"/><path d="m315.84375 328.84375c-3.816406 0-7.632812-1.445312-10.558594-4.34375-13.234375-13.113281-32.636718-21.589844-49.421875-21.589844-.003906 0-.003906 0-.007812 0h-1.039063c-.003906 0-.007812 0-.007812 0-16.789063 0-36.1875 8.472656-49.425782 21.589844-5.882812 5.828125-15.378906 5.785156-21.210937-.097656-5.832031-5.886719-5.789063-15.382813.097656-21.214844 18.847657-18.675781 45.875-30.277344 70.535157-30.277344h.011718 1.039063.011719c24.660156 0 51.683593 11.601563 70.535156 30.277344 5.882812 5.832031 5.929687 15.328125.097656 21.214844-2.933594 2.957031-6.796875 4.441406-10.65625 4.441406zm0 0"/></g>\n',c={tag:"g",class:"adaptor",attributes:{},style:{visibility:"visible"},children:[{tag:"path",attributes:{d:"M211.331,190.817c-1.885-1.885-4.396-2.922-7.071-2.922c-2.675,0-5.186,1.038-7.07,2.922l-32.129,32.129l-24.403-24.403   l32.129-32.129c3.897-3.899,3.897-10.243-0.001-14.142l-11.125-11.125c-1.885-1.885-4.396-2.922-7.071-2.922   c-2.675,0-5.187,1.038-7.07,2.923l-32.128,32.128l-18.256-18.256c-1.885-1.885-4.396-2.922-7.071-2.922   c-2.675,0-5.186,1.038-7.07,2.922L66.95,171.062c-3.899,3.899-3.899,10.243,0,14.143l3.802,3.802   c-1.596,1.086-3.103,2.325-4.496,3.718l-46.679,46.679c-5.836,5.835-9.049,13.62-9.049,21.92c0,8.301,3.214,16.086,9.049,21.92   l17.943,17.943L5.126,333.582c-6.835,6.835-6.835,17.915,0,24.749c3.417,3.417,7.896,5.125,12.374,5.125s8.957-1.708,12.374-5.125   l32.395-32.395l18.091,18.091c5.834,5.835,13.619,9.048,21.92,9.048s16.086-3.213,21.92-9.048l46.679-46.679   c1.394-1.393,2.633-2.901,3.719-4.497l3.802,3.802c1.885,1.885,4.396,2.923,7.07,2.923c2.675,0,5.186-1.038,7.072-2.923   l16.04-16.042c1.887-1.885,2.925-4.396,2.925-7.072c0-2.676-1.038-5.187-2.924-7.071l-18.255-18.255l32.129-32.129   c3.898-3.899,3.898-10.244-0.001-14.142L211.331,190.817z"}},{tag:"path",attributes:{d:"M358.33,5.126c-6.834-6.834-17.914-6.834-24.748,0l-32.686,32.686l-17.944-17.944c-5.834-5.835-13.619-9.048-21.92-9.048   c-8.301,0-16.086,3.213-21.92,9.048l-46.679,46.679c-1.393,1.393-2.632,2.9-3.719,4.497l-3.802-3.802   c-1.885-1.885-4.396-2.923-7.071-2.923c-2.675,0-5.187,1.038-7.071,2.923l-16.042,16.042c-1.886,1.885-2.924,4.396-2.924,7.072   c0,2.675,1.038,5.187,2.924,7.071l111.447,111.448c1.885,1.885,4.396,2.923,7.071,2.923c2.676,0,5.186-1.038,7.071-2.923   l16.043-16.043c3.899-3.899,3.899-10.243,0-14.142l-3.801-3.801c1.596-1.086,3.103-2.325,4.496-3.719l46.679-46.679   c5.835-5.834,9.049-13.62,9.049-21.92s-3.213-16.086-9.049-21.92l-18.09-18.09l32.686-32.686   C365.165,23.04,365.165,11.96,358.33,5.126z"}}]};function u(e){if(!e.data.adaptor){let t={tag:"g",attributes:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},children:{connection:{tag:"path",class:"connection-path",attributes:{d:`M${e.x1},${e.y1} C${.5*(e.x1+e.x2)},${e.y1} ${.5*(e.x1+e.x2)},${e.y2} ${e.x2},${e.y2}`}}}};return(0,o.createHTMLElement)({data:t,namespace:"svg"})}let t=Math.pow((e.x2-e.x1)*(e.x2-e.x1)+(e.y2-e.y1)*(e.y2-e.y1),.5),n=(e.x1-e.x2)/t,s=(e.y1-e.y2)/t,i=(2*Number(e.y2<e.y1)-1)*Math.acos((e.x1-e.x2)/t)*180/3.14,r=e.x1-50*n,l=e.y1-50*s,a=c;a.attributes={transform:`translate(${-(e.x2-e.x1)/2-50*n},${-(e.y2-e.y1)/2-50*s} ) rotate(${i+45})  translate(-0,-36) scale(0.1)`};let d={tag:"g",attributes:{x1:r,y1:l,x2:e.x2,y2:e.y2},children:{connection:{tag:"path",class:"connection-path",attributes:{d:`M${e.x2},${e.y2} C${.5*(r+e.x2)},${e.y2} ${.5*(r+e.x2)},${.5*(l+e.y2)} ${r},${l}`,x1:r,y1:l,x2:e.x2,y2:e.y2}},adaptor:a}};return(0,o.createHTMLElement)({data:d,namespace:"svg"})}function p(e){return e.connectionId}function m(e,t,n){let o=t[e];if(o)return o;let s=n.getParentGroupModule(e);return s?t[s.moduleId]:void 0}function h(e,t,n){let s=t.getAttribute("slotId")||t.getAttribute("slotid"),i=e.getSlot(s);if(i)return i;if(e instanceof o.GroupModules.Module&&s){let n=t.getAttribute("moduleId")||t.getAttribute("moduleid");return e.getAllChildren().find((e=>e.moduleId==n)).getSlot(s)}return console.warn("The builder plot should define the attribute 'slotId' of the slots elements",t),i="input"===n?e.inputSlots.find((e=>t.id==="input-slot_"+e.slotId+"_"+e.moduleId)):e.outputSlots.find((e=>t.id==="output-slot_"+e.slotId+"_"+e.moduleId)),i}function g(e,t){let n=e.parentElement,o=t.getModuleOrPlugin(n.getAttribute("moduleId")||n.getAttribute("id"));return o||(n=n.parentElement,o=t.getModuleOrPlugin(n.getAttribute("moduleId")||n.getAttribute("id"))),[o,n]}class f{constructor(e,t,n,o,s,i){this.mdle=e,this.domModuleElement=t,this.domPlugElement=n,this.plugType=o,this.isDrawing=s,this.isStarted=i,this.xOrigin=void 0,this.yOrigin=void 0,this.slot=void 0,this.xOrigin=Number(t.getAttribute("x"))+Number(n.getAttribute("cx")),this.yOrigin=Number(t.getAttribute("y"))+Number(n.getAttribute("cy")),this.slot=h(e,n,o)}}class w{constructor(e,t,n,c){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=c,this.debugSingleton=s.ST.getInstance(),this.connectionPlots=void 0,this.drawingConnection=void 0,this.connectionCreationEnabled=!0;let w=new i.Subject;this.connectUserInteractions(w),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create connections plotter",object:{drawingArea:e,plottersObservables:t}}),(0,i.combineLatest)(this.appObservables.connectionsUpdated$,this.plottersObservables.modulesDrawn$).subscribe((([e,t])=>{this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"connections updated",object:{connections:e,modulesGroup:t}}),function(e,t,n,o,s){let i=e.map((e=>function(e,t,n){let o=n.project.builderRendering.connectionsView.find((t=>t.connectionId==e.connectionId));return new a(p(e),["connection","mdle-color-stroke",(0,l.toCssName)(n.getModule(e.start.moduleId).Factory.uid)].concat(o&&o.wireless?["wireless"]:[]),m(e.end.moduleId,t,n),m(e.start.moduleId,t,n),e,e.adaptor)}(e,t,s))),r=new l.LinkPlot({plotId:"connectionsPlot",plotClasses:[],drawingArea:n,orderIndex:3});r.defaultElementDisplay=u,r.draw(i),r.entities$.subscribe((e=>o.next(e))),function(e,t){let n=e.svgCanvas.node().querySelectorAll(".wireless"),o=e.drawingGroup.node(),s=o.querySelector("#wireless-slots");s&&s.remove(),s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.id="wireless-slots",o.appendChild(s),n.forEach((e=>{let n=n=>{n.stopPropagation(),t.selectConnection(t.getConnection(e.id))},o=Number(e.getAttribute("x1")),i=Number(e.getAttribute("y1")),r=Number(e.getAttribute("x2")),l=Number(e.getAttribute("y2"));const a=document.createElementNS("http://www.w3.org/2000/svg","g"),c=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("transform",e.getAttribute("transform")),c.setAttribute("transform",e.getAttribute("transform")),a.innerHTML=`<line class='' x1="${o}" y1="${i}" x2="${Number(o)-50}" y2="${i}"></line><g transform="translate(${o-50-50},${i-25}) scale(0.1)" > ${d}</g>`,c.innerHTML=`<line class='' x1="${r}" y1="${l}" x2="${r+50}" y2="${l}"></line><g transform="translate(${r+50},${l-25}) scale(0.1)" > ${d}</g>`,a.onclick=n,c.onclick=n,s.appendChild(a),s.appendChild(c)}))}(n,s)}(c.project.workflow.connections,t,this.drawingArea,w,c),this.plottersObservables.connectionsDrawn$.next()}));let b=(e,t)=>{e.pipe(r.filter((e=>null==this.drawingConnection&&this.connectionCreationEnabled))).subscribe((e=>{let[n,o]=g(e.event.target,c);this.drawingConnection=new f(n,o,e.event.target,t,!0,!1)}))},y=(e,t)=>{e.pipe(r.filter((e=>null!=this.drawingConnection&&this.drawingConnection.plugType==("input"==t?"output":"input")))).subscribe((e=>{let[n,s]=g(e.event.target,c),i="input"==t?new o.Connection(this.drawingConnection.slot,h(n,e.event.target,"input")):new o.Connection(h(n,e.event.target,"output"),this.drawingConnection.slot);this.appStore.addConnection(i),this.connectionCreationEnabled=!1,setTimeout((()=>this.connectionCreationEnabled=!0),500)}))};b(this.plottersObservables.plugInputClicked$,"input"),b(this.plottersObservables.plugOutputClicked$,"output"),y(this.plottersObservables.plugInputClicked$,"input"),y(this.plottersObservables.plugOutputClicked$,"output"),this.plottersObservables.mouseMoved$.pipe(r.filter((e=>void 0!==this.drawingConnection))).subscribe((e=>this.plotDrawingConnection(this.drawingConnection,e))),this.appObservables.connectionSelected$.subscribe((e=>document.getElementById(p(e)).classList.toggle("selected"))),this.appObservables.unselect$.subscribe((()=>{let e=document.getElementById("drawing-connection");e&&e.remove(),this.drawingConnection=void 0}))}plotDrawingConnection(e,t){e.isStarted=!0;let n=[(t[0]-1-this.drawingArea.overallTranform.translateX)/this.drawingArea.overallTranform.scale,(t[1]-1-this.drawingArea.overallTranform.translateY)/this.drawingArea.overallTranform.scale],o=this.drawingArea.drawingGroup.selectAll(".drawing-connection").data([{data:e.data,htmlPlug:e.domElement}]);o.exit().remove(),o.attr("x2",n[0]),o.attr("y2",n[1]),o.enter().append("line").attr("id","drawing-connection").attr("class","drawing-connection").attr("x1",e.xOrigin).attr("y1",e.yOrigin).attr("x2",n[0]).attr("y2",n[1])}connectUserInteractions(e){e.pipe(r.filter((e=>"click"===e.action))).subscribe((e=>this.appStore.selectConnection(e.data.data)))}}var b=n(137),y=n(578),x=n(979);function v(e,t,n){let o=(new e.Factory.BuilderView).render(e);o.onclick=t=>{t.stopPropagation(),n.selectModule(e.moduleId)};let s=t.querySelector("#"+e.moduleId);s&&s.remove(),o.id=e.moduleId,o.classList.add("module","plugin");let i=0,r=50;t.getBBox&&(i=t.getBBox().height-t.querySelector(".content").getBBox().height/2),t.appendChild(o),o.getBBox&&(r=o.getBBox().height/2);let l=i+r;return o.setAttribute("x",t.getAttribute("x")),o.setAttribute("y",Number(t.getAttribute("y"))+l),o.setAttribute("transform","translate(0,"+l+")"),o}class I{constructor(e,t,n,o){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=o,this.debugSingleton=s.ST.getInstance(),this.groups={},this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create plugins plotter",object:{drawingArea:e,plottersObservables:t}})}draw(e){Object.values(this.groups).forEach((e=>e.remove()));let t=this.appStore.project.workflow.plugins.filter((t=>e[t.parentModule.moduleId])).map((t=>[t,e[t.parentModule.moduleId]]));return this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"PluginsPlotter draw",object:{modulesDrawn:e,plugins:this.appStore.project.workflow.plugins,plugInsToPlot:t}}),this.groups=t.map((([e,t])=>[e.moduleId,v(e,t,this.appStore)])).reduce(((e,t)=>(e[t[0]]=t[1],e)),{}),this.groups}}function S(e,t,n){let o=e.map((e=>document.getElementById(e))).filter((e=>e)).map((e=>e.getBBox?function(e,t,n){var o=document.getElementById(n.svgCanvas.attr("id")).getBoundingClientRect();let s=n.overallTranform;return{xmin:(t.a*e.x+t.c*e.y+t.e-o.left-s.translateX)/s.scale,ymin:(t.b*e.x+t.d*e.y+t.f-o.top-s.translateY)/s.scale,xmax:(t.a*(e.x+e.width)+t.c*(e.y+e.height)+t.e-o.left-s.translateX)/s.scale,ymax:(t.b*(e.x+e.width)+t.d*(e.y+e.height)+t.f-o.top-s.translateY)/s.scale}}(e.getBBox(),e.getScreenCTM(),n):{xmin:e.getAttribute("x"),xmax:e.getAttribute("x"),ymin:e.getAttribute("y"),ymax:e.getAttribute("y")})).reduce(((e,t)=>({xmin:Math.min(e.xmin,t.xmin),xmax:Math.max(e.xmax,t.xmax),ymin:Math.min(e.ymin,t.ymin),ymax:Math.max(e.ymax,t.ymax)})),{xmin:1e6,xmax:-1e6,ymin:1e6,ymax:1e-6});return{x:o.xmin-t,y:o.ymin-t,width:o.xmax-o.xmin+2*t,height:o.ymax-o.ymin+2*t}}class j{constructor(e,t,n,r){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=r,this.plotsFactory={},this.debugSingleton=s.ST.getInstance(),this.modulePlots=[],this.previousActiveSeriesId=[],this.dragging=!1,this.dragTranslation=[0,0];let a=new i.Subject;this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create modules plotter",object:{drawingArea:e,plottersObservables:t}}),new l.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:e,entities:[]}).draw([]),this.pluginsPlotter=new I(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),(0,i.combineLatest)([n.packagesLoaded$,this.plottersObservables.modulesViewUpdated$]).subscribe((()=>{let{modulesDrawn:e,activeSeries:t}=function(e,t,n){let o,s=[],r=t.getDisplayedModulesView();if(t.activeLayerId!=t.project.workflow.rootLayerTree.layerId){let e=function(e){let t=e.modulesView.map((e=>[e.xWorld,e.yWorld])),n=t.reduce(((e,t)=>e<t[0]?e:t[0]),1e10),o=t.reduce(((e,t)=>e>t[0]?e:t[0]),-1e10),s=t.reduce(((e,t)=>e<t[1]?e:t[1]),1e10);return[(o+n)/2,(t.reduce(((e,t)=>e>t[1]?e:t[1]),-1e10)+s)/2]}(r.currentLayer),t=function(e){let t=e.modulesView.map((e=>[e.xWorld,e.yWorld])),n=t.reduce(((e,t)=>e<t[0]?e:t[0]),1e10),o=t.reduce(((e,t)=>e>t[0]?e:t[0]),-1e10),s=t.reduce(((e,t)=>e<t[1]?e:t[1]),1e10);return[(o-n)/2,(t.reduce(((e,t)=>e>t[1]?e:t[1]),-1e10)-s)/2]}(r.currentLayer),n=r.parentLayer.currentGroupModuleView;o=(o,s)=>{let i=Math.pow((o-n.xWorld)*(o-n.xWorld)+(s-n.yWorld)*(s-n.yWorld),.5),r=(o-n.xWorld)/i,l=(s-n.yWorld)/i,a=(i+t[0])*r+r/Math.abs(r)*50,d=(i+t[1])*l+l/Math.abs(l)*75;return[e[0]+a,e[1]+d]}}let a=e=>({x:e.xWorld,y:e.yWorld,classes:["module"].concat(t.isSelected(e.moduleId)?["selected"]:[]),attributes:{moduleId:e.moduleId},id:e.moduleId,Factory:e.Factory,data:{module:t.getModule(e.moduleId),moduleView:e}}),d=r.currentLayer.modulesView.map(a),c=r.parentLayer.modulesView.map((e=>Object.assign({},a(e),{projection:o}))),u=b.groupBy([...d,...c],(e=>e.Factory.uid)),p={},m=[],h=e=>{e.filter((e=>e)).forEach((e=>{if(e.id.includes("group")){let n=t.getModule(e.id);n.inputSlots.map((e=>e.moduleId)).concat(n.outputSlots.map((e=>e.moduleId))).forEach((t=>{p[t]=e}))}p[e.id]=e}))};return Object.entries(u).map((([t,o])=>{let r=function(e,t){let n=e.Factory,o=new n.BuilderView,s=new i.Subject,r=(0,l.toCssName)(n.uid)+"_ModulesPlot",a=new l.CrossPlot({plotId:r,plotClasses:[r,n.packId],drawingArea:t,entities$:s});return a.defaultElementDisplay=e=>o.render(e.data.module),a}(o[0],e);m.push(r.plotId),s.push(r);let a=r.draw(o);return a.entered._groups.forEach((e=>h(e))),a.updated._groups.forEach((e=>h(e))),r.entities$.subscribe((e=>n.next(e))),r})),{modulesDrawn:p,activeSeries:m}}(this.drawingArea,this.appStore,a),n=this.pluginsPlotter.draw(e),s=function(e,t,n){if(!e||e===n.project.workflow.rootLayerTree.layerId)return new l.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:t,entities:[]}).draw([]),{};let s=n.getLayer(e),i=n.project.workflow.modules.find((e=>e instanceof o.GroupModules.Module&&e.layerId==s.layerId)),r=S(n.getDisplayedModulesView().currentLayer.modulesView.map((e=>e.moduleId)),50,t),a=t.hScale.invert(r.x+r.width/2),d=t.vScale.invert(r.y+r.height/2),c=[{id:"expanded_"+i.moduleId,x:a,y:d,classes:["active-layer-box"],attributes:{layerId:e},data:{boundingBox:r}}],u=new l.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:t,entities:c});u.defaultElementDisplay=o.GroupModules.expandedGroupPlot(i);let p=u.draw(c),m=p.entered._groups.concat(p.updated._groups).reduce(((e,t)=>e.concat(t)),[]).filter((e=>e));return{[i.moduleId]:m[0]}}(this.appStore.activeLayerId,this.drawingArea,this.appStore);this.connectUserInteractions(Object.assign({},e,s)),this.emptyRemovedSeries(this.previousActiveSeriesId,t),this.previousActiveSeriesId=t,this.plottersObservables.modulesDrawn$.next({...e,...n,...s})})),this.appObservables.moduleSelected$.subscribe((e=>{let t=document.getElementById(e.moduleId);t&&!t.classList.contains("selected")&&t.classList.add("selected")})),this.appObservables.modulesUnselected$.subscribe((e=>{e.forEach((e=>{let t=document.getElementById(e.moduleId);t&&t.classList.contains("selected")&&t.classList.remove("selected")}))})),n.unselect$.subscribe((()=>{this.unselect()}))}highlight(e){e.map((e=>document.getElementById(e))).forEach((e=>{e&&e.classList.add("highlighted")}))}unselect(){let e=document.getElementsByClassName("selected");for(;e.length>0;)e[0].classList.remove("selected"),e=document.getElementsByClassName("selected");for(e=document.getElementsByClassName("highlighted");e.length>0;)e[0].classList.remove("highlighted"),e=document.getElementsByClassName("highlighted")}connectUserInteractions(e){Object.entries(e).forEach((([e,t])=>{let n=n=>{n.target.classList.contains("slot")?n.target.classList.contains("output")?this.plottersObservables.plugOutputClicked$.next({event:n,group:t,moduleId:e}):this.plottersObservables.plugInputClicked$.next({event:n,group:t,moduleId:e}):(n.stopPropagation(),this.appStore.selectModule(e))};if(t.onclick=n,t.onmousedown=n,!this.appStore.project.workflow.plugins.map((e=>e.moduleId)).includes(e)&&!t.classList.contains("active-layer-box")){var o=(0,y.Z)();o.on("start",(e=>{this.dragSelection(e,!1)})).on("drag",(e=>this.dragSelection(e,!1))).on("end",(e=>this.dragSelection(e,!0))),(0,x.Z)(t).call(o)}}))}emptyRemovedSeries(e,t){e.filter((e=>!t.includes(e))).forEach((e=>document.querySelector("g#"+e).remove()))}dragSelection(e,t){this.dragging=!0;let n=this.appStore.getModulesSelected().filter((e=>this.appStore.getActiveLayer().moduleIds.includes(e.moduleId)||e.layerId)),o=[];return n.forEach((n=>{let s=document.getElementById(n.moduleId),i=s.querySelectorAll("g.plugin"),r=Number(s.getAttribute("x"))+e.dx,l=Number(s.getAttribute("y"))+e.dy;Array.from(i).forEach((t=>{t.setAttribute("x",Number(t.getAttribute("x"))+e.dx),t.setAttribute("y",Number(t.getAttribute("y"))+e.dy)})),this.dragTranslation[0]+=e.dx,this.dragTranslation[1]-=e.dy,s.setAttribute("x",r),s.setAttribute("y",l),s.style.transform="translate("+r+"px,"+l+"px)",s.setAttribute("transform","translate("+r+","+l+")"),t&&(o.push({moduleId:n.moduleId,x:this.drawingArea.hScale.invert(r),y:this.drawingArea.vScale.invert(l),translation:this.dragTranslation}),s.style.transform="")})),t&&(this.appStore.moveModules(o),this.dragging=!1,this.dragTranslation=[0,0]),o}}class k{constructor(e,t,n,o,i){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=o,this.modulesPlotter=i,this.debugSingleton=s.ST.getInstance(),this.start=void 0,this.rect=void 0}startSelection(e){e=this.convert(e),this.rect=this.drawingArea.drawingGroup.append("rect").attr("class","rectangle-selector").attr("x",e[0]).attr("y",e[1]).attr("height",0).attr("width",0),this.start=e}finishSelection(e){this.start=void 0;let t=k.getSelectedModules(this.appStore.getActiveModulesView(),this.drawingArea,this.rect);S(t,10,this.drawingArea),this.rect.remove(),this.appStore.select({modulesId:t,connectionsId:[]})}moveTo(e){if(!this.start)return;e=this.convert(e),this.rect.attr("width",Math.max(0,e[0]-+this.rect.attr("x"))).attr("height",Math.max(0,e[1]-+this.rect.attr("y")));let t=k.getSelectedModules(this.appStore.getActiveModulesView(),this.drawingArea,this.rect);this.modulesPlotter.highlight(t)}static getSelectedModules(e,t,n){let o=e.map((e=>[e.moduleId,t.hScale(e.xWorld),t.vScale(e.yWorld)])),s=Number(n.attr("x")),i=Number(n.attr("y")),r=s+Number(n.attr("width")),l=i+Number(n.attr("height"));return o.filter((([e,t,n])=>t>s&&t<r&&n>i&&n<l)).map((([e,t,n])=>e))}convert([e,t]){let n=this.drawingArea.overallTranform;return[(e-n.translateX)/n.scale,(t-n.translateY)/n.scale]}}function $(e,t,n){let o=e.map((e=>{let o=S(e.modulesId,10,t),s=t.hScale.invert(o.x+o.width/2),i=t.vScale.invert(o.y+o.height/2),r=n.descriptionBoxSelected&&n.descriptionBoxSelected.descriptionBoxId==e.descriptionBoxId;return{x:s,y:i,classes:["description-box"].concat(r?["selected"]:[]),attributes:{descriptionBoxId:e.descriptionBoxId},id:e.descriptionBoxId,data:{descriptionBox:e,boundingBox:o}}})),s=new l.CrossPlot({plotId:"descriptionsBoxPlotter",plotClasses:[],drawingArea:t,entities:o});s.defaultElementDisplay=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","g");let n=e.data.boundingBox.width,o=e.data.boundingBox.height;return t.innerHTML=`\n       <rect height="${o}" width="${n}" \n        class="description-box content"  x="${-n/2}" y="${-o/2}"\n        filter="url(#shadow)" ></rect>\n        <path d="M${-n/2},${0-o/2} v-15 q0,-10 10,-10 h${n-20} q10,0 10,10  v15 z" \n                class="description-box mdle-color-fill header " />\n        <path d="M${-n/2},${0-o/2} v-15 q0,-10 10,-10 h${n-20} q10,0 10,10  v15 " \n                class="description-box header outline" />\n\n        <text class="description-box title" x="${-n/2+10}" y="${-o/2-5}" >${e.data.descriptionBox.title}</text>\n        `,t};let i=s.draw(o);return i.entered._groups.concat(i.updated._groups).map((e=>e.filter((e=>e)).reduce(((e,t)=>e.concat(t)),[]))).reduce(((e,t)=>e.concat(t)),[])}class C{constructor(e,t,n,o){this.drawingArea=e,this.plottersObservables=t,this.appObservables=n,this.appStore=o,this.debugSingleton=s.ST.getInstance(),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create descriptions boxes plotter",object:{drawingArea:e,plottersObservables:t}}),$([],this.drawingArea,this.appStore),this.appObservables.descriptionsBoxesUpdated$.subscribe((e=>{let t=$(e,this.drawingArea,this.appStore);this.connectUserInteractions(t),this.plottersObservables.descriptionsBoxesDrawn$.next(t)}))}connectUserInteractions(e){e.forEach((e=>e.onclick=t=>this.appStore.selectDescriptionBox(e.id)))}}class E{static initialize(e){E.workflowPlotter=e}}class L{constructor(e,t,n,o,i={margin:50}){this.drawingArea=e,this.appObservables=t,this.plottersObservables=n,this.appStore=o,this.options=i,this.debugSingleton=s.ST.getInstance(),this.modulesPlotter=void 0,this.connectionsPlotters=void 0,this.boxSelectorPlotter=void 0,this.descriptionsBoxesPlotter=void 0,this.pluginsPlotter=void 0,this.descriptionsBoxesPlotter=new C(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.modulesPlotter=new j(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.connectionsPlotters=new w(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.boxSelectorPlotter=new k(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore,this.modulesPlotter),function(e,t,n){(function(e,t){return e.pipe((0,r.filter)((({fromLayerId:e,toLayerId:t})=>null!=e&&null!=t)),(0,r.map)((({fromLayerId:e,toLayerId:n})=>({fromLayer:t.getLayer(e),toLayer:t.getLayer(n)}))),(0,r.map)((({fromLayer:e,toLayer:n})=>{if(e.getChildrenLayers().includes(n))return document.getElementById("expanded_"+t.getGroupModule(n.layerId).moduleId);if(n.getChildrenLayers().includes(e)){let o=n.children.find((t=>t==e||t.getChildrenLayers().includes(e)));return document.getElementById(t.getGroupModule(o.layerId).moduleId)}return document.getElementById("expanded_"+t.getGroupModule(n.layerId).moduleId)})),(0,r.map)((e=>{let t=e.getBoundingClientRect();return[.5*(t.left+t.right),.5*(t.top+t.bottom)]})))})(e,t).subscribe((e=>n.lookAt(e[0],e[1])))}(this.appObservables.activeLayerUpdated$,this.appStore,this.drawingArea),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create WorkflowPlotter",object:{drawingArea:this.drawingArea,modulePlotter:this.modulesPlotter,connectionsPlotters:this.connectionsPlotters}});let l=this.plottersObservables,a=this.boxSelectorPlotter,d=document.querySelector("svg"),c=e=>[e.offsetX||e.clientX,e.offsetY||e.clientY];d.onmousedown=e=>{a.startSelection(c(e))},d.onmousemove=e=>{e.ctrlKey?a.moveTo(c(e)):l.mouseMoved$.next(c(e))},d.onmouseup=e=>{e.ctrlKey&&a.finishSelection(c(e))},d.onclick=e=>{e.ctrlKey||o.unselect()},window.onkeydown=e=>{"Delete"==e.key&&"BODY"==document.activeElement.tagName&&this.appStore.deleteSelected()},this.loadExtensions()}loadExtensions(){o.FluxExtensionAPIs&&(E.initialize(this),o.FluxExtensionAPIs.registerAPI("BuilderRenderingAPI",E))}}},549:(e,t,n)=>{"use strict";var o;n.d(t,{Dw:()=>d,ST:()=>r,RV:()=>a,dk:()=>E,in:()=>o,CE:()=>C}),function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Error=2]="Error"}(o||(o={}));class s{constructor(e,t,n,o){this.topic=e,this.message=t,this.object=n,this.level=o,this.hours=0,this.minutes=0,this.seconds=0,this.miniseconds=0,this.date=new Date}}class i{log(e){e.level!=o.Info&&e.level!=o.Debug||console.log("#"+e.topic,{date:e.date.getHours()+"h"+e.date.getMinutes()+"mn"+e.date.getSeconds()+"s"+e.date.getMilliseconds(),level:e.level,message:e.message,object:e.object}),e.level==o.Error&&console.error("#"+e.topic,{date:e.date.getHours()+"h"+e.date.getMinutes()+"mn"+e.date.getSeconds()+"s"+e.date.getMilliseconds(),level:e.level,message:e.message,object:e.object})}}class r{constructor({WorkflowBuilder:e,workflowView:t,observable:n,UI:s,renderTopicLevel:r}){this.debugOn=!0,this.WorkflowBuilderEnabled=!0,this.WorkflowBuilderLevel=o.Info,this.workflowViewEnabled=!0,this.workflowViewLevel=o.Info,this.workflowView$Enabled=!0,this.workflowView$Level=o.Info,this.observableEnabled=!0,this.observableLevel=o.Info,this.renderTopicEnabled=!0,this.renderTopicLevel=o.Info,this.appTopicEnabled=!0,this.appTopicLevel=o.Info,this.workflowUIEnabled=!0,this.loger=new i,this.WorkflowBuilderLevel=e,this.observableLevel=n,this.renderTopicLevel=r}logWorkflowBuilder({level:e,message:t,object:n}){this.WorkflowBuilderEnabled&&e>=this.WorkflowBuilderLevel&&this.loger.log(new s("WorkflowBuilder",t,n,e))}logObservable({level:e,message:t,object:n}){this.observableEnabled&&e>=this.observableLevel&&this.loger.log(new s("Observables",t,n,e))}logWorkflowView({level:e,message:t,object:n}){this.workflowViewEnabled&&e>=this.workflowViewLevel&&this.loger.log(new s("WorkflowView",t,n,e))}logWorkflowView$({level:e,message:t,object:n}){this.workflowView$Enabled&&e>=this.workflowView$Level&&this.loger.log(new s("WorkflowView Observables",t,n,e))}logRenderTopic({level:e,message:t,object:n}){this.renderTopicEnabled&&e>=this.renderTopicLevel&&this.loger.log(new s("Render",t,n,e))}logAppTopic({level:e,message:t,object:n}){this.appTopicEnabled&&e>=this.appTopicLevel&&this.loger.log(new s("App",t,n,e))}static getInstance(){return r.instance||(r.instance=new r({WorkflowBuilder:o.Info,workflowView:o.Info,UI:o.Info,observable:o.Info,renderTopicLevel:o.Info,appTopicLevel:o.Info})),r.instance}}r.instance=void 0;var l=n(158);class a{constructor(){this.debugSingleton=r.getInstance(),this.packagesObserver$=new l.ReplaySubject(1),this.packagesLoaded$=new l.ReplaySubject(1),this.uiStateUpdated$=new l.ReplaySubject(1),this.packagesUpdated$=new l.Subject,this.connectionsUpdated$=new l.Subject,this.modulesUpdated$=new l.Subject,this.moduleAdded$=new l.Subject,this.moduleSelected$=new l.Subject,this.modulesUnselected$=new l.Subject,this.moduleSettingsEdited$=new l.Subject,this.adaptorEdited$=new l.Subject,this.connectionSelected$=new l.Subject,this.unselect$=new l.Subject,this.renderingLoaded$=new l.Subject,this.cssUpdated$=new l.Subject,this.descriptionsBoxesUpdated$=new l.Subject,this.activeLayerUpdated$=new l.Subject,this.ready$=new l.ReplaySubject(1),this.flowReady$=new l.Subject,this.suggestions$=new l.Subject,this.notifications$=new l.Subject,this.debugSingleton.debugOn&&["packagesObserver$","packagesLoaded$","packagesUpdated$","connectionsUpdated$","unselect$","moduleSelected$","modulesUnselected$","moduleSettingsEdited$","connectionSelected$","renderingLoaded$","moduleAdded$","cssUpdated$","uiStateUpdated$","descriptionsBoxesUpdated$","activeLayerUpdated$","ready$","flowReady$","suggestions$","modulesUpdated$","notifications$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return a.instance||(a.instance=new a),a.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logObservable({level:o.Info,message:e,object:{args:t}})}}a.instance=void 0;class d{constructor(){this.debugSingleton=r.getInstance(),this.connectionsView$=new l.Subject,this.modulesViewUpdated$=new l.Subject,this.moduleViewSelected$=new l.Subject,this.modulesDrawn$=new l.ReplaySubject(1),this.connectionsDrawn$=new l.ReplaySubject(1),this.descriptionsBoxesDrawn$=new l.ReplaySubject(1),this.activeLayerDrawn$=new l.ReplaySubject(1),this.modulesViewCompleted$=new l.Subject,this.plugsViewCompleted$=new l.Subject,this.connectionsViewCompleted$=new l.Subject,this.moduleEvent$=new l.Subject,this.moduleSelected$=new l.Subject,this.plugInputClicked$=new l.Subject,this.plugOutputClicked$=new l.Subject,this.mouseMoved$=new l.Subject,this.notification$=new l.ReplaySubject(1),this.debugSingleton.debugOn&&["modulesViewUpdated$","moduleViewSelected$","moduleSelected$","moduleEvent$","modulesDrawn$","descriptionsBoxesDrawn$","activeLayerDrawn$","notification$","connectionsDrawn$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return d.instance||(d.instance=new d),d.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView$({level:o.Info,message:e,object:{args:t}})}}d.instance=void 0;var c=n(935);class u extends c.ExtensionsObservables{constructor(){super(),this.debugSingleton=r.getInstance(),this.debugSingleton.debugOn&&["projectUpdated$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return u.instance||(u.instance=new u),u.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logObservable({level:o.Info,message:e,object:{args:t}})}}function p(e){return{layerId:e.layerId,moduleIds:e.moduleIds,title:e.title,children:e.children.map((e=>p(e)))}}function m(e){return{modules:e.modules.map((e=>({moduleId:e.moduleId,factoryId:{module:e.Factory.id,pack:e.Factory.packId},configuration:{title:e.configuration.title,description:e.configuration.description,data:Object.assign({},e.configuration.data)}}))),connections:e.connections.map((e=>Object.assign({end:{moduleId:e.end.moduleId,slotId:e.end.slotId},start:{moduleId:e.start.moduleId,slotId:e.start.slotId}},e.adaptor?{adaptor:{adaptorId:e.adaptor.adaptorId,mappingFunction:e.adaptor.toString()}}:{}))),plugins:e.plugins.map((e=>({parentModuleId:e.parentModule.moduleId,moduleId:e.moduleId,factoryId:{module:e.Factory.id,pack:e.Factory.packId},configuration:{title:e.configuration.title,description:e.configuration.description,data:Object.assign({},e.configuration.data)}}))),rootLayerTree:p(e.rootLayerTree)}}u.instance=void 0;var h=n(519);function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function f(e,t,n){if(t.layerId===n)return[t,e];let o;return t.children.forEach((e=>{o||(o=f(t,e,n))})),o}function w(e,t=(e=>!0)){return new c.LayerTree(e.layerId,e.title,e.children.map((e=>w(e,t))),e.moduleIds.filter((e=>t(e))))}function b(e,t){let n=e.children.filter((e=>e.moduleIds.length>0));return new c.LayerTree(e.layerId,e.title,n.map((e=>b(e,t))),t?e.moduleIds.filter((e=>t.includes(e))):e.moduleIds)}function y(e,t,n,s,i,l,a,d){let u=r.getInstance();u.debugOn&&u.logWorkflowBuilder({level:o.Info,message:"createLayer",object:{modules:t,title:e}});let p=t.map((e=>e.moduleId)),m=new c.LayerTree(g(),e,[],p),h=t.filter((e=>e instanceof c.GroupModules.Module)).map((e=>e.layerId)),b=w(n.workflow.rootLayerTree),y=f(void 0,b,s)[0];y.moduleIds=y.moduleIds.filter((e=>!p.includes(e))),y.children.filter((e=>h.includes(e.layerId))).forEach((e=>m.children.push(e))),y.children=y.children.filter((e=>!h.includes(e.layerId))),y.children.push(m);let x=new i.Module({moduleId:i.id.replace("@","_")+"_"+m.layerId,configuration:l,Factory:i,workflowGetter:a,layerId:m.layerId,environment:d}),v=new c.Workflow([...n.workflow.modules,x],n.workflow.connections,n.workflow.plugins,b),I=n.builderRendering.modulesView.filter((e=>m.moduleIds.includes(e.moduleId))),S=I.reduce(((e,t)=>e+t.xWorld),0)/I.length,j=I.reduce(((e,t)=>e+t.yWorld),0)/I.length,k=new c.ModuleView(x.moduleId,S,j,i),$=[...n.builderRendering.modulesView,k];return y.moduleIds.push(x.moduleId),{project:new c.Project(n.name,n.description,n.requirements,v,new c.BuilderRendering($,n.builderRendering.connectionsView,n.builderRendering.descriptionsBoxes),n.runnerRendering),layer:m}}function x({mdle:e,ready$:t,configuration:n,parent:o,workflow:s}){let i=e.Factory;if(null==n){let t=new i.PersistentData(e.configuration.data);n=new i.Configuration({title:e.configuration.title,description:e.configuration.description,data:t})}return"parentModule"in e?new e.Factory.Module({parentModule:o||e.parentModule,moduleId:e.moduleId,configuration:n,ready$:t,Factory:i,cache:e.cache,environment:e.environment}):new e.Factory.Module(Object.assign({},e,{workflow:s,configuration:n,ready$:t,Factory:i}))}function v(e,t){let n=r.getInstance();if(0===e.length)return;n.debugOn&&n.logWorkflowBuilder({level:o.Info,message:"deleteModules",object:{modulesDeleted:e}});let s=e.filter((e=>e instanceof c.GroupModules.Module)).map((e=>function(e,t){let n=t.rootLayerTree.getLayerRecursive((t=>t.layerId==e.layerId)),o=e=>e.moduleIds.concat(e.children.reduce(((e,t)=>e.concat(o(t))),[]));return o(n)}(e,t.workflow))),i=[...e.map((e=>e.moduleId)),...s.reduce(((e,t)=>e.concat(t)),[])],l=t.workflow.plugins.filter((e=>i.includes(e.parentModule.moduleId))).map((e=>e.moduleId));i=i.concat(l);let a=w(t.workflow.rootLayerTree,(e=>!i.includes(e)));a=b(a);let d=t.workflow.modules.filter((e=>!i.includes(e.moduleId))),u=t.workflow.plugins.filter((e=>!i.includes(e.moduleId)));console.log("modules",d);let p=t.builderRendering.modulesView.filter((e=>!i.includes(e.moduleId))),m=t.workflow.connections.filter((e=>!i.includes(e.end.moduleId)&&!i.includes(e.start.moduleId))),h=new c.Workflow(d,m,u,a),g=t.builderRendering.descriptionsBoxes.find((t=>t.modulesId.length!==t.modulesId.filter((t=>e.map((e=>e.moduleId)).indexOf(t)>=0)).length))?t.builderRendering.descriptionsBoxes.map((t=>{let n=t.modulesId.filter((t=>e.map((e=>e.moduleId)).indexOf(t)<0));return n.length==t.modulesId.length?t:(console.log("REMOVE MODULE FORM DBOX",n),new c.DescriptionBox(t.descriptionBoxId,t.title,n,t.descriptionHtml,t.properties))})):t.builderRendering.descriptionsBoxes;return new c.Project(t.name,t.description,t.requirements,h,new c.BuilderRendering(p,t.builderRendering.connectionsView,g),t.runnerRendering)}function I(e,t){return{createdElements:t.filter((t=>!e.includes(t))),removedElements:e.filter((e=>!t.includes(e)))}}var S,j=n(137);class k{static initialize(e){k.appStore=e}}function $(e,t){let n=t.requirements,o=e.lock.reduce(((e,t)=>({...e,[t.name]:t.version})),{}),s=e.lock.filter((e=>"flux-pack"==e.type)).map((e=>e.name)),i=new c.Requirements(n.fluxComponents,Array.from(s),o,e);return new c.Project(t.name,t.description,i,t.workflow,t.builderRendering,t.runnerRendering)}class C{constructor(e,t,n){this.mode=e,this.rendererEditorsVisible=t,this.isEditing=n}}class E{constructor(e,t,n){this.environment=e,this.appObservables=t,this.appBuildViewObservables=n,this.debugSingleton=r.getInstance(),this.builderViewsActions={configurationUpdated:e=>this.updateModule(e.module,e.configuration)},this.allSubscriptions=new Map,this.projectId=void 0,this.project=new c.Project("new project","",new c.Requirements([],[],{},{}),new c.Workflow([],[],[],new c.LayerTree("","",[],[])),new c.BuilderRendering([],[],[]),new c.RunnerRendering("","")),this.activeLayerId=this.project.workflow.rootLayerTree.layerId,this.adaptors=[],this.history=new Array(this.project),this.indexHistory=0,this.uiState=new C("combined",!1,!1),this.packages=[],this.implicitModules=[],this.moduleSelected=void 0,this.modulesSelected=[],this.connectionSelected=void 0,this.descriptionBoxSelected=void 0,this.appExtensionsObservables=u.getInstance(),this.environment=e,this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"AppStore constructed",object:{appStore:this}}),c.GroupModules.BuilderView.notifier$.pipe((0,h.filter)((e=>"layerFocused"==e.type))).subscribe((e=>this.selectActiveLayer(e.data))),c.Component.BuilderView.notifier$.pipe((0,h.filter)((e=>"layerFocused"==e.type))).subscribe((e=>this.selectActiveLayer(e.data))),c.GroupModules.BuilderView.notifier$.pipe((0,h.filter)((e=>"closeLayer"==e.type))).subscribe((e=>this.selectActiveLayer(this.getParentLayer(e.data).layerId))),c.Component.BuilderView.notifier$.pipe((0,h.filter)((e=>"closeLayer"==e.type))).subscribe((e=>this.selectActiveLayer(this.getParentLayer(e.data).layerId))),this.appObservables.renderingLoaded$.next({style:"",layout:"",cssLinks:[]})}static getInstance(e){return E.instance||(E.instance=new E(e,a.getInstance(),d.getInstance())),E.instance}setUiState(e){this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"ui state updated",object:{state:e}}),this.uiState=e,this.appObservables.uiStateUpdated$.next(this.uiState)}loadProject(e){this.projectId=e;let t=(0,c.loadProjectDatabase$)(e,(()=>this.project.workflow),this.allSubscriptions,this.environment);this.initializeProject(t)}loadProjectURI(e){this.projectId=void 0;let t=(0,c.loadProjectURI$)(e,(()=>this.project.workflow),this.allSubscriptions,this.environment);this.initializeProject(t)}initializeProject(e){e.subscribe((({project:e,packages:t})=>{this.appObservables.packagesUpdated$.next(t),this.activeLayerId=e.workflow.rootLayerTree.layerId,this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"project created",object:{project:this.project}}),this.updateProject(e),this.loadExtensions(),this.appObservables.ready$.next(!0),this.appObservables.packagesLoaded$.next(),this.appObservables.uiStateUpdated$.next(this.uiState),this.appObservables.renderingLoaded$.next({style:e.runnerRendering.style,layout:e.runnerRendering.layout,cssLinks:[]})}))}loadExtensions(){c.FluxExtensionAPIs&&(k.initialize(this),c.FluxExtensionAPIs.registerAPI("BuilderState",k))}addLibraries$(e){return function(e,t,n){let o=t.requirements.libraries;e.filter((e=>null!=o[e.name]&&o[e.name]!=e.version)).length>0&&console.error("You can not dynamically add libraries that are already used with different version");let s=e.filter((e=>null==o[e.name])).reduce(((e,t)=>({...e,[t.name]:t.version})),{});Object.keys(s).filter((e=>window[e]&&(window[e].install||window[e].pack.install))).forEach((e=>{let t=(window[e].install||window[e].pack.install)(n);t instanceof l.Observable&&t.subscribe(),t instanceof Promise&&t.then((()=>{}))}));let i={libraries:{...t.requirements.libraries,...s}};return n.getLoadingGraph(i).pipe((0,h.map)((e=>$(e,t))))}(e,this.project,this.environment).pipe((0,h.tap)((e=>{this.updateProject(e)})))}projectSchema$(){return function(e,t){let n=new Set([...e.workflow.modules.map((e=>e.Factory.packId)),...e.workflow.plugins.map((e=>e.Factory.packId))]),o=new Array(...n);if(o.length==e.requirements.fluxPacks.length)return(0,l.of)(e);let s={libraries:Object.entries(e.requirements.libraries).filter((([e,t])=>o.find((t=>e.includes(t))))).reduce(((e,[t,n])=>({...e,[t]:n})),{}),using:e.requirements.libraries};return t.getLoadingGraph(s).pipe((0,h.map)((t=>$(t,e))))}(this.project,this.environment).pipe((0,h.map)((e=>function(e){return{name:e.name,description:e.description,runnerRendering:e.runnerRendering,builderRendering:{descriptionsBoxes:e.builderRendering.descriptionsBoxes.map((e=>({descriptionBoxId:e.descriptionBoxId,descriptionHtml:e.descriptionHtml,modulesId:e.modulesId,title:e.title,properties:{color:e.properties.color}}))),modulesView:e.builderRendering.modulesView.map((e=>({moduleId:e.moduleId,xWorld:e.xWorld,yWorld:e.yWorld}))),connectionsView:e.builderRendering.connectionsView.map((e=>({connectionId:e.connectionId,wireless:e.wireless})))},requirements:e.requirements,workflow:m(e.workflow)}}(e))))}projectURI$(){return this.projectSchema$().pipe((0,h.map)((e=>{return`/ui/flux-builder/?uri=${t=e,encodeURIComponent(JSON.stringify(t))}`;var t})))}saveProject(){this.projectSchema$().pipe((0,h.mergeMap)((e=>this.environment.postProject(this.projectId,e).pipe((0,h.map)((()=>e)))))).subscribe((e=>{this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"project saved",object:{body:e,project:this.project}})}))}getModulesFactory(){return this.packages.map((e=>Object.entries(e.modules).map((([t,n])=>[`${n.id}@${e.id}`,n])))).reduce(((e,t)=>e.concat(t)),[]).reduce(((e,t)=>j.merge(e,{[t[0]]:t[1]})),{})}getAvailablePlugins(e){return function(e,t){let n=[];return Array.from(t.entries()).forEach((([t,o])=>{e.factory&&o.parentModule===e.factory.id&&n.push({factoryId:t,pluginFactory:o})})),n}(e,this.pluginsFactory)}getPlugins(e){return function(e,t){return t.workflow.plugins.filter((t=>t.parentModule.moduleId===e))}(e,this.project)}addPlugin(e,t){let n=function(e,t,n,s,i){let l=r.getInstance(),a=new e.Configuration,d=e.id+"_"+g(),u=new e.Module({parentModule:t,moduleId:d,configuration:a,Factory:e,ready$:s,environment:i});l.debugOn&&l.logWorkflowBuilder({level:o.Info,message:"add plugin",object:{plugin:u,pluginFactory:e}});let p=new c.Workflow(n.workflow.modules,n.workflow.connections,n.workflow.plugins.concat([u]),n.workflow.rootLayerTree);return new c.Project(n.name,n.description,n.requirements,p,n.builderRendering,n.runnerRendering)}(e,t,this.project,this.appObservables.ready$,this.environment);return this.updateProject(n),n.workflow.plugins.slice(-1)[0]}addModule(e,t=[0,0]){let n=function(e,t,n,s,i,l){let a=r.getInstance(),d=new e.Configuration,u=e.id+"_"+g(),p=new e.Module({moduleId:u,configuration:d,Factory:e,ready$:i,environment:l}),m=new c.ModuleView(p.moduleId,t[0],t[1],e),h=w(n.workflow.rootLayerTree);f(void 0,h,s)[0].moduleIds.push(u);let b=new c.Workflow(n.workflow.modules.concat(p),n.workflow.connections,n.workflow.plugins,h),y=new c.BuilderRendering(n.builderRendering.modulesView.concat(m),n.builderRendering.connectionsView,n.builderRendering.descriptionsBoxes),x=n.runnerRendering.layout;if(null!=e.RenderView){let e=function(e){let t=document.createElement("div");return t.setAttribute("id",e.moduleId),t.setAttribute("name",e.configuration.title),t.classList.add("flux-component"),e.moduleId.includes("viewer3d")&&t.classList.add("fill-parent"),e.moduleId.includes("cesium")&&t.classList.add("fill-parent"),t}(p);x=n.runnerRendering.layout+e.outerHTML+"\n"}let v=new c.Project(n.name,n.description,n.requirements,b,y,new c.RunnerRendering(x,n.runnerRendering.style));return a.debugOn&&a.logWorkflowBuilder({level:o.Info,message:"add module",object:{factory:e,module:p,moduleView:m,project:v}}),v}(e,t,this.project,this.activeLayerId,this.appObservables.ready$,this.environment);return this.updateProject(n),n.workflow.modules.slice(-1)[0]}updateModule(e,t){let n=function(e,t,n,s,i){let l=r.getInstance(),a=e.Factory,d="parentModule"in e,u=x({mdle:e,ready$:i,configuration:t,workflow:n.workflow}),p=n.workflow.rootLayerTree;u instanceof c.GroupModules.Module&&(p=w(n.workflow.rootLayerTree),f(void 0,p,u.layerId)[0].title=u.configuration.title);let m=e=>{let t=n.workflow.plugins.filter((t=>t.parentModule.moduleId==e.moduleId)),o=t.map((e=>m(e))).filter((e=>e.length>0));if(o.length>0)throw"UPDATE MODULE: IMPLEMENTATION NOT DONE IN CASE OF NESTED PLUGINS";return t.concat(o.reduce(((e,t)=>e.concat(t)),[]))},h=m(e),g=[e.moduleId].concat(h.map((e=>e.moduleId))),b=n.workflow.modules.filter((e=>!g.includes(e.moduleId))),y=n.workflow.plugins.filter((e=>!g.includes(e.moduleId))),v=d?n.workflow.modules:b.concat([u]),I=d?y.concat([u]):y;I=I.concat(h.map((e=>x({mdle:e,ready$:i,parent:u}))));let S=u.inputSlots.map((e=>e.slotId)),j=u.outputSlots.map((e=>e.slotId)),k=n.workflow.connections.filter((e=>!(e.start.moduleId==u.moduleId&&!j.includes(e.start.slotId)||e.end.moduleId==u.moduleId&&!S.includes(e.end.slotId)))),$=new c.Workflow(v,k,I,p),C=new c.Project(n.name,n.description,n.requirements,$,n.builderRendering,n.runnerRendering);return l.debugOn&&l.logWorkflowBuilder({level:o.Info,message:"module updated",object:{factory:a,newModule:u,newConfiguration:t,plugins:h,project:C,newPlugins:I,toRemoveIds:g,newModules:v,otherModules:b,otherPlugins:y}}),C}(e,t,this.project,this.allSubscriptions,this.appObservables.ready$);this.unselect(),this.updateProject(n)}duplicateModules(e){let t=function(e,t,n){let s=r.getInstance(),i=t.workflow,l=t.workflow.rootLayerTree,a=e.map((e=>{let t=new e.Factory.Configuration({title:e.configuration.title,description:e.configuration.description,data:_.cloneDeep(e.configuration.data)}),o=e.Factory.id+"_"+g();return new e.Factory.Module({moduleId:o,configuration:t,ready$:n,Factory:e.Factory,environment:e.environment})})),d=t.builderRendering.modulesView.filter((t=>e.map((e=>e.moduleId)).includes(t.moduleId))),u=Math.max(...d.map((e=>e.yWorld))),p=Math.max(...d.map((e=>e.xWorld))),m=e.map(((e,t)=>new c.ModuleView(a[t].moduleId,p+50*(t+1),u+50*(t+1),e.Factory))),h=w(l);e.map(((e,t)=>{h.getLayerRecursive((t=>t.moduleIds.includes(e.moduleId))).moduleIds.push(a[t].moduleId)}));let f=new c.BuilderRendering(t.builderRendering.modulesView.concat(m),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes);i.rootLayerTree.moduleIds.concat(a.map((e=>e.moduleId)));let b=new c.Project(t.name,t.description,t.requirements,new c.Workflow(i.modules.concat(a),i.connections,i.plugins,h),f,t.runnerRendering);return s.debugOn&&s.logWorkflowBuilder({level:o.Info,message:"duplicateModules",object:{modules:e,newModules:a,newViews:m,projectNew:b,newLayerTree:h}}),b}(e,this.project,this.appObservables.ready$);this.updateProject(t)}alignH(e){let t=function(e,t,n){let o=t.builderRendering.modulesView.filter((t=>e.includes(t.moduleId))),s=t.builderRendering.modulesView.filter((t=>!e.includes(t.moduleId))),i=o.reduce(((e,t)=>e+t.yWorld),0)/o.length,r=o.map((e=>new c.ModuleView(e.moduleId,e.xWorld,i,e.Factory)));return new c.Project(t.name,t.description,t.requirements,t.workflow,new c.BuilderRendering(s.concat(r),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes),t.runnerRendering)}(e.map((e=>e.moduleId)),this.project,this.appObservables.ready$);this.updateProject(t)}alignV(e){let t=function(e,t,n){let o=t.builderRendering.modulesView.filter((t=>e.includes(t.moduleId))),s=t.builderRendering.modulesView.filter((t=>!e.includes(t.moduleId))),i=o.reduce(((e,t)=>e+t.xWorld),0)/o.length,r=o.map((e=>new c.ModuleView(e.moduleId,i,e.yWorld,e.Factory)));return new c.Project(t.name,t.description,t.requirements,t.workflow,new c.BuilderRendering(s.concat(r),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes),t.runnerRendering)}(e.map((e=>e.moduleId)),this.project,this.appObservables.ready$);this.updateProject(t)}moveModules(e){let t=function(e,t,n,s){let i=r.getInstance(),l=e.map((e=>[e])).reduce(((e,t)=>e.concat(t)),[]),a=t.filter((e=>!l.map((e=>e.moduleId)).includes(e.moduleId))),d=l.map((e=>[e,t.find((t=>t.moduleId==e.moduleId))])).filter((([e,t])=>Math.abs(t.xWorld-e.x)>3||Math.abs(t.yWorld-e.y)>3)).map((([e,t])=>new c.ModuleView(e.moduleId,e.x,e.y,t.Factory)));if(0==d.length)return;i.debugOn&&i.logWorkflowBuilder({level:o.Info,message:"move modules",object:{modulesPosition:e,modulesViewToKeep:a,modulesViewNew:d}});let u=n.builderRendering.descriptionsBoxes.find((e=>e.modulesId.length!==e.modulesId.filter((e=>d.map((e=>e.moduleId)).indexOf(e)>=0)).length))?n.builderRendering.descriptionsBoxes.map((e=>e.modulesId.find((e=>d.map((e=>e.moduleId)).indexOf(e)>=0))?new c.DescriptionBox(e.descriptionBoxId,e.title,e.modulesId,e.descriptionHtml,e.properties):e)):n.builderRendering.descriptionsBoxes;return new c.Project(n.name,n.description,n.requirements,n.workflow,new c.BuilderRendering(a.concat(d),n.builderRendering.connectionsView,u),n.runnerRendering)}(e=e.filter((e=>this.getActiveLayer().moduleIds.includes(e.moduleId))),this.project.builderRendering.modulesView,this.project,this.implicitModules);this.updateProject(t)}getModuleSelected(){return this.moduleSelected?this.moduleSelected:1==this.modulesSelected.length?this.modulesSelected[0]:void 0}getModulesSelected(){return this.moduleSelected?[this.moduleSelected]:this.modulesSelected.length>0?this.modulesSelected:[]}isSelected(e){return!(!this.moduleSelected||this.moduleSelected.moduleId!==e)||!(!this.modulesSelected||!this.modulesSelected.find((t=>t.moduleId===e)))}selectModule(e){this.modulesSelected.find((t=>t.moduleId==e))||this.moduleSelected&&this.moduleSelected.moduleId==e||(this.moduleSelected&&this.moduleSelected.moduleId!=e&&(this.appObservables.modulesUnselected$.next([this.moduleSelected]),this.moduleSelected=void 0),this.modulesSelected.find((t=>t.moduleId==e))||(this.appObservables.modulesUnselected$.next(this.modulesSelected),this.modulesSelected=[]),this.moduleSelected=this.getModule(e),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"module selected",object:{module:this.moduleSelected}}),this.appObservables.moduleSelected$.next(this.moduleSelected))}selectConnection(e){this.unselect(),this.connectionSelected=e,this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"connection selected",object:{module:this.connectionSelected}}),this.appObservables.connectionSelected$.next(this.connectionSelected);let t=this.getModule(this.connectionSelected.start.moduleId),n=this.getModule(this.connectionSelected.end.moduleId),s=this.adaptors.filter((e=>e.fromModuleFactoryId===t.factoryId&&e.toModuleFactoryId===n.factoryId&&e.fromModuleSlotId===this.connectionSelected.start.slotId&&e.toModuleSlotId===this.connectionSelected.end.slotId));this.connectionSelected.adaptor||this.appObservables.suggestions$.next(s)}select({modulesId:e,connectionsId:t}){this.unselect(),this.modulesSelected=this.project.workflow.modules.filter((t=>e.includes(t.moduleId))),this.modulesSelected.forEach((e=>this.appObservables.moduleSelected$.next(e)))}getModuleOrPlugin(e){return this.getModulesAndPlugins().find((t=>t.moduleId===e))}getModule(e){let t=this.getModulesAndPlugins().find((t=>t.moduleId===e));return t||(t=this.implicitModules.find((t=>t.moduleId===e)),t)}deleteModules(e){this.unselect();let t=v(e,this.project);if(t){if(!f(t.workflow.rootLayerTree,t.workflow.rootLayerTree,this.activeLayerId)){let e=this.activeLayerId;return this.activeLayerId=t.workflow.rootLayerTree.layerId,this.updateProject(t),void this.appObservables.activeLayerUpdated$.next({fromLayerId:e,toLayerId:this.activeLayerId})}this.updateProject(t)}}deleteModule(e){e==this.moduleSelected&&this.unselect(),this.deleteModules([e])}getActiveLayer(){return this.getLayer(this.activeLayerId)}getLayer(e){let t=f(void 0,this.project.workflow.rootLayerTree,e);if(null!=t)return t[0];console.error("Can not find layer ",e)}getParentLayer(e){return f(void 0,this.project.workflow.rootLayerTree,e)[1]}selectActiveLayer(e){if(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"selectActiveLayer",object:{layerId:e,layers:this.project.workflow.rootLayerTree}}),this.activeLayerId==e)return;let t=this.activeLayerId;this.activeLayerId=e,this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),this.appObservables.activeLayerUpdated$.next({fromLayerId:t,toLayerId:e})}getActiveModulesId(){return this.getLayer(this.activeLayerId).moduleIds}getActiveModulesView(){const e=this.getDisplayedModulesView();return[...e.currentLayer.modulesView,...e.parentLayer.modulesView]}getDisplayedModulesView(){return function(e,t,n,o){let s=e.moduleIds,i=o.builderRendering.modulesView.filter((e=>s.includes(e.moduleId))),r=[];if(t){let e=t.moduleIds;r=o.builderRendering.modulesView.filter((t=>e.includes(t.moduleId)))}return{parentLayer:{modulesView:r.filter((t=>!t.moduleId.includes(e.layerId))),modules:r.map((e=>n.getModule(e.moduleId))),currentGroupModuleView:r.find((t=>t.moduleId.includes(e.layerId)))},currentLayer:{modulesView:i,modules:i.map((e=>n.getModule(e.moduleId)))}}}(this.getLayer(this.activeLayerId),this.getParentLayer(this.activeLayerId),this,this.project)}getGroupModule(e){return this.project.workflow.modules.find((t=>t instanceof c.GroupModules.Module&&t.layerId==e))}getParentGroupModule(e){let t=this.getModule(e);this.project.workflow.plugins.map((e=>e.moduleId)).includes(t.moduleId)&&(t=t.parentModule);let n=this.project.workflow.rootLayerTree.getLayerRecursive((e=>e.moduleIds.includes(t.moduleId)));if(n)return this.project.workflow.modules.find((e=>e.moduleId.includes(n.layerId)))}getChildrenRecursive(e){return this.getLayer(e).getChildrenModules()}getModulesAndPlugins(){return this.project.workflow.modules.concat(this.project.workflow.plugins)}addRemoteComponent(e,[t,n]){}getConnection(e){return this.project.workflow.connections.find((t=>t.connectionId===e))}addConnection(e){let t=function(e,t,n){let s=r.getInstance();s.debugOn&&s.logWorkflowBuilder({level:o.Info,message:"connection added",object:{connection:e}});let i=t.workflow.modules,l=t.workflow.connections.concat(e),a=new c.Workflow(i,l,t.workflow.plugins,t.workflow.rootLayerTree);return a=new c.Workflow(i,l,t.workflow.plugins,t.workflow.rootLayerTree),new c.Project(t.name,t.description,t.requirements,a,t.builderRendering,t.runnerRendering)}(e,this.project,this.allSubscriptions);this.updateProject(t),this.unselect(),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}setConnectionView(e,t){let n=function(e,t,n){let o=n.builderRendering.connectionsView.filter((t=>t.connectionId!=e.connectionId)).concat([{connectionId:e.connectionId,wireless:t.wireless}]),s=new c.BuilderRendering(n.builderRendering.modulesView,o,n.builderRendering.descriptionsBoxes);return new c.Project(n.name,n.description,n.requirements,n.workflow,s,n.runnerRendering)}(e,t,this.project);this.updateProject(n),this.unselect(),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}getConnectionSelected(){return this.connectionSelected}getConnectionView(e){return this.project.builderRendering.connectionsView.find((t=>t.connectionId==e))}deleteConnection(e){this.connectionSelected===e&&(this.connectionSelected=void 0,this.appObservables.unselect$.next());let t=function(e,t,n){let o=t.workflow.connections.filter((t=>t!=e)),s=new c.Workflow(t.workflow.modules,o,t.workflow.plugins,t.workflow.rootLayerTree);return new c.Project(t.name,t.description,t.requirements,s,t.builderRendering,t.runnerRendering)}(e,this.project,this.allSubscriptions);this.updateProject(t),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}addAdaptor(e,t){let n=function(e,t,n,o){let s=n.workflow.connections.filter((t=>t!=e)),i=new c.Connection(e.start,e.end,t),r=new c.Workflow(n.workflow.modules,s.concat(i),n.workflow.plugins,n.workflow.rootLayerTree);return new c.Project(n.name,n.description,n.requirements,r,n.builderRendering,n.runnerRendering)}(t,e,this.project,this.allSubscriptions);this.updateProject(n),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}deleteAdaptor(e){let t=function(e,t,n){let o=t.workflow.connections.filter((t=>t!=e)),s=new c.Connection(e.start,e.end,void 0),i=new c.Workflow(t.workflow.modules,o.concat(s),t.workflow.plugins,t.workflow.rootLayerTree);return new c.Project(t.name,t.description,t.requirements,i,t.builderRendering,t.runnerRendering)}(e,this.project,this.allSubscriptions);this.updateProject(t),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}publishAdaptor(e){}updateAdaptor(e,t){let n=function(e,t,n,o){let s=n.workflow.connections.filter((t=>t!==e)),i=e.adaptor?new c.Adaptor(e.adaptor.adaptorId,t):new c.Adaptor(g(),t),r=new c.Connection(e.start,e.end,i),l=new c.Workflow(n.workflow.modules,s.concat(r),n.workflow.plugins,n.workflow.rootLayerTree);return new c.Project(n.name,n.description,n.requirements,l,n.builderRendering,n.runnerRendering)}(e,t,this.project,this.allSubscriptions);this.updateProject(n),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}unselect(){this.modulesSelected=[],this.moduleSelected=void 0,this.connectionSelected=void 0,this.descriptionBoxSelected=void 0,this.appObservables.unselect$.next(),this.appObservables.suggestions$.next([])}deleteSelected(){this.uiState.isEditing||(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"delete selected",object:{connectionSelected:this.connectionSelected,moduleSelected:this.moduleSelected,modulesSelected:this.modulesSelected,descriptionBoxSelected:this.descriptionBoxSelected}}),this.connectionSelected&&this.deleteConnection(this.connectionSelected),this.moduleSelected&&this.deleteModule(this.moduleSelected),this.modulesSelected&&this.modulesSelected.length>0&&this.deleteModules(this.modulesSelected),this.descriptionBoxSelected&&this.deleteDescriptionBox(this.descriptionBoxSelected),this.appObservables.suggestions$.next([]))}addDescriptionBox(e){let t=function(e,t){let n=t.builderRendering.descriptionsBoxes.concat(e);return new c.Project(t.name,t.description,t.requirements,t.workflow,new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,n),t.runnerRendering)}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}selectDescriptionBox(e){this.unselect(),this.descriptionBoxSelected=this.project.builderRendering.descriptionsBoxes.find((t=>t.descriptionBoxId==e)),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}deleteDescriptionBox(e){e==this.descriptionBoxSelected&&this.unselect();let t=function(e,t){let n=t.builderRendering.descriptionsBoxes.filter((t=>t.descriptionBoxId!=e.descriptionBoxId));return new c.Project(t.name,t.description,t.requirements,t.workflow,new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,n),t.runnerRendering)}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}addGroup(e){let t=new c.DescriptionBox(g(),"grouped module",e,"",new c.DescriptionBoxProperties(void 0)),n=new c.GroupModules.Configuration({title:t.title}),{project:o}=y(t.title,t.modulesId.map((e=>this.getModule(e))),this.project,this.activeLayerId,c.GroupModules,n,(e=>this.project.workflow),this.environment);this.updateProject(o)}addComponent(e){let t=new c.DescriptionBox(g(),"component",e,"",new c.DescriptionBoxProperties(void 0)),n=new c.Component.Configuration({title:t.title}),{project:o}=y(t.title,t.modulesId.map((e=>this.getModule(e))),this.project,this.activeLayerId,c.Component,n,(e=>this.project.workflow),this.environment);this.updateProject(o)}publishComponent(e){let t=function(e,t){let n=[e,...e.getAllChildren()],o=n.filter((e=>!(e instanceof c.PluginFlux))),s=o.map((e=>e.moduleId)),i=t.workflow.plugins.filter((e=>s.includes(e.parentModule.moduleId))),r=e.getConnections(),l=e.getLayerTree(),a=new c.Workflow(o,r.internals,i,l),d=new Set(n.map((e=>e.Factory.packId))),u={modulesView:s.map((e=>t.builderRendering.modulesView.find((t=>t.moduleId==e)))),connectionsView:r.internals.map((e=>t.builderRendering.connectionsView.find((t=>t.connectionId==e)))).filter((e=>e))},p=document.createElement("div");p.innerHTML=t.runnerRendering.layout;let h=p.querySelector("#"+e.moduleId);if(!h)return{componentId:e.moduleId,workflow:m(a),builderRendering:u,fluxPacks:new Array(...d)};let g=h?h.outerHTML:"",f=window.youwol.renderView.document.querySelector("#"+e.moduleId);var w=f.getElementsByTagName("*");let b=[f];for(var y=-1,x=w.length;++y<x;)b.push(w[y]);let v=new Set(b.filter((e=>e.matches)).map((e=>function(e,t){var n=window.youwol.renderView.document.styleSheets,o=[];for(var s in e.matches=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector,n){var i=n[s].rules||n[s].cssRules;for(var r in i)e.matches(i[r].selectorText)&&o.push(i[r].cssText)}return o}(e))).reduce(((e,t)=>e.concat(t)),[]).filter((e=>"#"==e[0]||"."==e[0])));return{componentId:e.moduleId,workflow:m(a),builderRendering:u,fluxPacks:new Array(...d),runnerRendering:{layout:g,style:[...v].reduce(((e,t)=>e+" "+t),"")}}}(e,this.project);sessionStorage.setItem(e.moduleId,JSON.stringify(t)),window.open("/ui/assets-publish-ui?kind=flux-component&related_id="+e.moduleId,"_blank")}projectSettings(){window.open("/ui/assets-publish-ui?kind=flux-project&related_id="+this.projectId,"_blank")}updateDescriptionBox(e){this.unselect();let t=function(e,t){let n=t.builderRendering.descriptionsBoxes.filter((t=>t.descriptionBoxId!=e.descriptionBoxId)).concat([e]);return new c.Project(t.name,t.description,t.requirements,t.workflow,new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,n),t.runnerRendering)}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}setRenderingLayout(e,t=!0){let n=function(e,t){let n=r.getInstance();return n.debugOn&&n.logWorkflowBuilder({level:o.Info,message:"set rendering layout",object:{layout:e}}),new c.Project(t.name,t.description,t.requirements,t.workflow,t.builderRendering,new c.RunnerRendering(e,t.runnerRendering.style))}(e,this.project);this.updateProject(n,t)}applyStyle(){this.appObservables.cssUpdated$.next(this.project.runnerRendering.style)}setRenderingStyle(e,t=!0){let n=function(e,t){let n=r.getInstance();return n.debugOn&&n.logWorkflowBuilder({level:o.Info,message:"set rendering style",object:{style:e}}),new c.Project(t.name,t.description,t.requirements,t.workflow,t.builderRendering,new c.RunnerRendering(t.runnerRendering.layout,e))}(e,this.project);this.updateProject(n,t)}addModuleRenderDiv(e){let t=this.project.runnerRendering.layout+e+"\n";this.setRenderingLayout(t)}updateProjectToIndexHistory(e,t){let n={modules:!1,modulesView:!1,connections:!1,activeLayer:!1,descriptionBox:!1};this.indexHistory=e,this.project=this.history[this.indexHistory];let s=this.history[t],i=function(e,t){let n={createdElements:[],removedElements:[]},o={createdElements:[],removedElements:[]};if(t.connections!==e.connections){let o=I(e.connections,t.connections);n.createdElements.push(...o.createdElements),n.removedElements.push(...o.removedElements)}if(t.modules!==e.modules){let s=I(e.modules,t.modules);o.createdElements.push(...s.createdElements),o.removedElements.push(...s.removedElements);let i=s.createdElements.map((e=>e.moduleId)),r=s.removedElements.map((e=>e.moduleId));n.createdElements.push(...t.connections.filter((e=>i.includes(e.end.moduleId))),...t.connections.filter((e=>i.includes(e.start.moduleId)))),n.removedElements.push(...e.connections.filter((e=>r.includes(e.start.moduleId)||r.includes(e.end.moduleId))))}if(t.plugins!==e.plugins){let s=I(e.plugins,t.plugins);o.createdElements.push(...s.createdElements),o.removedElements.push(...s.removedElements);let i=s.createdElements.map((e=>e.moduleId)),r=s.removedElements.map((e=>e.moduleId));n.createdElements.push(...t.connections.filter((e=>i.includes(e.end.moduleId))),...t.connections.filter((e=>i.includes(e.start.moduleId)))),n.removedElements.push(...e.connections.filter((e=>r.includes(e.start.moduleId)||r.includes(e.end.moduleId))))}return n.createdElements=Array.from(new Set(n.createdElements)),n.removedElements=Array.from(new Set(n.removedElements)),o.createdElements=Array.from(new Set(o.createdElements)),o.removedElements=Array.from(new Set(o.removedElements)),{connections:n,modules:o}}(s.workflow,this.project.workflow);var r,l,a;if(i.modules.removedElements&&i.modules.removedElements.filter((e=>(0,c.instanceOfSideEffects)(e))).forEach((e=>e.dispose())),i.modules.createdElements&&(r=i.modules.createdElements,l=this.builderViewsActions,a=this.appBuildViewObservables.notification$,r.forEach((e=>{e.Factory.consumersData.FluxAppstore||(e.Factory.consumersData.FluxAppstore={notifiersPluged:!1}),e.Factory.BuilderView.notifier$&&!e.Factory.consumersData.FluxAppstore.notifiersPluged&&(e.Factory.BuilderView.notifier$.pipe((0,h.filter)((e=>"configurationUpdated"==e.type))).subscribe((e=>{l[e.type]&&l[e.type](e.data)})),e.Factory.BuilderView.notifier$.subscribe((e=>a.next(e))),e.Factory.consumersData.FluxAppstore.notifiersPluged=!0)})),i.modules.createdElements.filter((e=>(0,c.instanceOfSideEffects)(e))).forEach((e=>e.apply()))),!n.modules&&(i.modules.createdElements.length>0||i.modules.removedElements.length>0)&&(this.appObservables.modulesUpdated$.next(i.modules),this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),n.modules=!0,n.modulesView=!0),!n.connections&&(i.connections.createdElements.length>0||i.connections.removedElements.length>0)&&(this.appObservables.connectionsUpdated$.next(this.project.workflow.connections),n.connections=!0),!n.modulesView&&this.project.builderRendering.modulesView!==s.builderRendering.modulesView){let e=I(s.builderRendering.modulesView,this.project.builderRendering.modulesView),t=[...e.createdElements.filter((t=>null==e.removedElements.find((e=>e.moduleId==t.moduleId)))),...e.createdElements.filter((t=>null==e.removedElements.find((e=>e.moduleId==t.moduleId))))];t.length>0?this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()):this.appObservables.connectionsUpdated$.next(this.project.workflow.connections),t.length>0&&(n.modulesView=!0)}n.activeLayer||this.activeLayerId==this.project.workflow.rootLayerTree.layerId&&this.project.workflow.rootLayerTree==s.workflow.rootLayerTree||(n.modulesView||this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),this.appObservables.activeLayerUpdated$.next({fromLayerId:void 0,toLayerId:this.activeLayerId}),n.activeLayer=!0),n.descriptionBox||this.project.builderRendering.descriptionsBoxes===s.builderRendering.descriptionsBoxes||(this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),n.descriptionBox=!0),function(e,t,n,o){let s=n.concat(o).reduce(((e,t)=>e.concat(t.inputSlots)),[]),i=n.concat(o).reduce(((e,t)=>e.concat(t.outputSlots)),[]);t.removedElements.forEach((t=>{e.get(t).unsubscribe(),e.delete(t)})),t.createdElements.forEach((t=>{let n=i.find((e=>e.slotId==t.start.slotId&&e.moduleId==t.start.moduleId)),o=s.find((e=>e.slotId==t.end.slotId&&e.moduleId==t.end.moduleId)),r=n.observable$.subscribe((e=>o.subscribeFct({connection:t,message:e})));e.set(t,r)}))}(this.allSubscriptions,i.connections,this.project.workflow.modules,this.project.workflow.plugins),this.appExtensionsObservables.projectUpdated$.next(i),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"updateProjectToIndexHistory",object:{oldProject:s,delta:i,newProject:this.project,history:this.history,updatesDone:n}})}undo(){0!=this.indexHistory&&(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"undo",object:{history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory-1,this.indexHistory))}redo(){this.indexHistory!=this.history.length-1&&(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"redo",object:{history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory+1,this.indexHistory))}updateProject(e,t=!0){if(!e)return;let n=this.indexHistory;t||(this.history=this.history.slice(0,-1),this.indexHistory--),this.indexHistory===this.history.length-1&&(this.history.push(e),this.indexHistory++),this.indexHistory<this.history.length-1&&(this.history=this.history.slice(0,this.indexHistory+1),this.history.push(e),this.indexHistory=this.history.length-1),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:o.Info,message:"updateProject",object:{newProject:e,history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory,n)}}E.instance=void 0,function(e){let t=new BroadcastChannel("out=>code-editor@BroadcastDrive"),n=new BroadcastChannel("code-editor@BroadcastDrive=>out");e.mountBroadcastDrive=function(e,o){let s,i=e.ownerId,r={action:"ping",channelResp:"code-editor=>flux",ownerId:i},a=!1,d=new l.BehaviorSubject(!1);(0,l.interval)(500).pipe((0,h.take)(1)).pipe((0,h.take)(1)).subscribe((()=>{a||(window.open(o,"_tab_code_editor"),(0,l.interval)(200).pipe((0,h.filter)((()=>!a))).subscribe((()=>t.postMessage(r))))})),t.postMessage(r),d.pipe((0,h.filter)((e=>1==e)),(0,h.mergeMap)((()=>e.mount$.pipe((0,h.map)((t=>e.drive(t))),(0,h.tap)((e=>s=e)))))).subscribe((n=>{let o={action:"mount",ownerId:i,codeEditor:{drive:{name:n.name,data:n.data},UI:e.UI}};t.postMessage(o)}));let c=e.unmount$.subscribe((()=>{t.postMessage({action:"unmount",ownerId:i}),c.unsubscribe()}));n.onmessage=({data:e})=>{if("ping-ack"==e.action&&e.ownerId==i&&(a=!0,d.next(!0)),"updateFile"==e.action&&e.ownerId==i){let n=()=>t.postMessage({action:"updateFile-ack",actionId:e.actionId,ownerId:i});s.onFileUpdated(e.data,n)}}}}(S||(S={}))},198:(e,t,n)=>{"use strict";n.d(t,{eD:()=>C,j3:()=>v,rj:()=>E,eW:()=>U});var o,s=n(888),i=n(396),r=n(158),l=n(519),a=n(222),d=n(327),c=n(735),u=n(97);!function(e){class t{constructor({ok$:e}){this.buffer$=new r.BehaviorSubject([]),this.ok$=e,this.explorerState=c.Q.singletonState,this.explorerState.selectionBuffer$=this.buffer$}}class n{constructor({state:e,options:t,...o}){Object.assign(this,o),this.options={...n.defaultOptions,...t||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.bufferColumnView(),this.explorerView()],this.connectedCallback=e=>{e.subscriptions.push(this.state.explorerState.selection$.pipe((0,l.scan)(((e,{node:t,selected:n})=>[...e.filter((e=>e!=t)),...n?[t]:[]]),[])).subscribe((e=>this.state.buffer$.next(e))))}}bufferColumnView(){let e=new d.Button.View({state:new d.Button.State(this.state.ok$),contentView:()=>({innerText:"Import"}),class:"fv-btn fv-btn-primary fv-bg-focus"});return{class:"px-2 d-flex flex-column w-25",style:{width:"200px"},children:[{class:"w-100 text-center",innerText:"selection buffer",style:{"font-family":"fantasy"}},(0,a.child$)(this.state.buffer$,(e=>e.length>0?{class:"d-flex flex-column flex-grow-1 overflow-auto",children:e.map((e=>({class:"d-flex align-items-center",children:[{innerText:e.name},{class:"fas fa-times px-2 yw-hover-opacity yw-pointer",onclick:()=>{this.state.explorerState.selection$.next({node:e,selected:!1})}}]})))}:{tag:"div",class:"py-2",innerText:"Pick one or more module(s) using the tabs on the right side to add them in your worksheet",style:{"font-style":"italic","text-align":"justify"}})),(0,a.child$)(this.state.buffer$,(t=>t.length>0?e:{}))]}}explorerView(){return{class:"h-100 overflow-auto w-75 border rounded",children:[new c.Q.View({state:this.state.explorerState,class:"h-100"})]}}}n.defaultOptions={containerClass:"h-100 w-100 p-3 rounded d-flex solid rounded",containerStyle:{}},e.View=n,e.popupModal=function(e,o){let s=new r.Subject,i=new t({ok$:s}),l=new n({state:i});u.R.popup({view:l,ok$:s,options:{displayOk:!1,displayCancel:!1}}).subscribe((()=>{o(i.buffer$.getValue())}))}}(o||(o={}));var p,m=n(313),h=n(230);!function(e){class t{constructor({module:e}){this.module=e}}e.State=t;class n{constructor({state:e,...t}){if(Object.assign(this,t),this.state=e,this.class=this.class||n.defaultOptions.containerClass,this.style=this.style||n.defaultOptions.containerStyle,0==this.state.module.journals.length)return void(this.children=[this.noJournalsAvailableView()]);if(1==this.state.module.journals.length)return void(this.children=[this.journalView(this.state.module.journals[0])]);let o=new r.BehaviorSubject(this.state.module.journals[0].title);this.children=[this.selectJournalView(o),(0,a.child$)(o.pipe((0,l.map)((e=>this.state.module.journals.find((t=>t.title==e))))),(e=>this.journalView(e)))]}noJournalsAvailableView(){return{innerText:"The module does not contains journals yet, it is likely that it did not run already."}}selectJournalView(e){let t=this.state.module.journals.map((e=>new m.Select.ItemData(e.title,e.title))),n=new m.Select.State(t,e);return{class:"d-flex align-items-center py-2",children:[{innerText:"Available reports:",class:"px-2"},new m.Select.View({state:n})]}}journalView(e){let t=new h.R.State({context:e.entryPoint,expandedNodes:[e.entryPoint.id]});return{class:"h-100 d-flex flex-column",children:[{class:"d-flex align-items-center justify-content-center",children:[{tag:"i",class:"fas fa-newspaper fa-2x px-3"},{class:"text-center py-2",style:{"font-family":"fantasy","font-size":"larger"},innerText:e.title}]},new h.R.View({state:t,options:{containerClass:"p-4 flex-grow-1 overflow-auto"}})]}}}n.defaultOptions={containerClass:"d-flex flex-column p-3",containerStyle:{"min-height":"0px"}},e.View=n,e.popupModal=function({module:e}){let o=new t({module:e}),s=new n({state:o});u.R.popup({view:s,style:{"max-height":"75vh",width:"75vw"},options:{displayCancel:!1,displayOk:!1}}).subscribe((()=>{}))}}(p||(p={}));class g extends s.ImmutableTree.Node{constructor({id:e,children:t,name:n,faIcon:o}){super({id:e,children:t}),this.name=n,this.faIcon=o}execute(e,{event:t}){}}class f extends g{constructor({children:e}){super({id:"root",children:e,name:"menu list",faIcon:""})}}class w extends g{constructor(){super({id:"new-modules",children:void 0,name:"new module(s)",faIcon:"fas fa-microchip"})}execute(e,{event:t}){let n=e.drawingArea.invert(t.clientX,t.clientY);o.popupModal(e.appState,(t=>{let o=t.map((e=>e.library));e.appState.addLibraries$(o).subscribe((()=>{t.forEach((t=>e.appState.addModule(t.factory,n)))}))}))}}class b extends g{constructor(){super({id:"add-plugins",children:void 0,name:"add plugin(s)",faIcon:"fas fa-microchip"})}execute(e,{event:t}){o.popupModal(e.appState,(t=>{let n=e.appState.getModuleSelected(),o=t.map((e=>e.library));e.appState.addLibraries$(o).subscribe((()=>{t.forEach((t=>e.appState.addPlugin(t.factory,n)))}))}))}}class y extends g{constructor(){super({id:"journals",children:void 0,name:"journals",faIcon:"fas fa-newspaper"})}execute(e){let t=e.appState.getModuleSelected();p.popupModal({module:t})}}let x={newModules:{createNode:()=>new w,applicable:e=>e.getModulesSelected().length>=0},addPlugins:{createNode:()=>new b,applicable:e=>1==e.getModulesSelected().length},journals:{createNode:()=>new y,applicable:e=>1==e.getModulesSelected().length&&e.getModuleSelected().journals.length>0}};class v extends i.ContextMenu.State{constructor(e,t){super((0,r.fromEvent)(t.parentDiv,"contextmenu").pipe((0,l.tap)((e=>e.preventDefault())))),this.appState=e,this.drawingArea=t,this.htmlElement=t.parentDiv}dispatch(e){let t=Object.values(x).filter((e=>e.applicable(this.appState))).map((e=>e.createNode())),n=new f({children:t}),o=new I(n),i=new s.ImmutableTree.View({state:o,headerView:S,class:"fv-bg-background fv-text-primary p-2 rounded"});return o.selectedNode$.next(n),o.selectedNode$.subscribe((t=>t.execute(this,{event:e}))),i}}class I extends s.ImmutableTree.State{constructor(e){super({rootNode:e,expandedNodes:[e.id]})}}function S(e,t){return{class:"d-flex w-100 align-items-baseline fv-pointer fv-hover-bg-background-alt px-1",children:[{tag:"i",class:t.faIcon},{tag:"span",class:"mx-2 w-100",innerText:t.name,style:{"user-select":"none"}}]}}var j;!function(e){e.State=class{constructor({content$:e}){this.codeMirror$=function(){let e=window["@youwol/cdn-client"];return(0,r.from)(e.fetchBundles({codemirror:{version:"5.52.0"}},window)).pipe((0,l.mergeMap)((()=>{let t=e.fetchJavascriptAddOn(["codemirror#5.52.0~mode/javascript.min.js"],window);return(0,r.from)(t)})))}(),this.content$=e}};class t{constructor({state:e,options:n,...o}){Object.assign(this,o);let s={...t.defaultOptions,...n||{}};this.state=e,this.class=s.containerClass,this.style=s.containerStyle,this.children=[(0,a.child$)(e.codeMirror$,(()=>({id:"code-mirror-editor",class:"w-100 h-100",connectedCallback:t=>{let n=window.CodeMirror(t,{value:e.content$.getValue(),mode:"javascript",lineNumbers:!0,theme:"blackboard"});n.on("changes",(()=>{e.content$.next(n.getValue())}))}})))]}}t.defaultOptions={containerClass:"h-100 w-100",containerStyle:{}},e.View=t}(j||(j={}));var k=n(137);function $(e){let t=new r.BehaviorSubject(!1);return(0,a.child$)(t,(n=>({class:"p-1 d-flex",children:[{tag:"i",class:"fas fa-info fv-hover-bg-background-alt p-1 fv-pointer rounded "+(n?"fv-bg-background-alt":""),onclick:()=>t.next(!t.getValue())},n?{class:"p-1 px-2 fv-bg-background-alt rounded",style:{"text-align":"justify","font-style":"italic"},innerText:e}:{}]})))}var C,E,L,R,M,B=n(991),O=n(935),T=n(690);!function(e){e.State=class{constructor({status:e,stringLengthLimit:t}){this.status=e,this.stringLengthLimit=t||100;let n=e;(0!=n.intrus.length||n.typeErrors||n.missings)&&(n.typeErrors&&n.typeErrors.length>0&&(this.typingErrors=new B.g.State({title:"typing errors",data:n.typeErrors})),n.missings&&n.missings.length>0&&(this.missingFields=new B.g.State({title:"missing fields",data:n.missings})),n.intrus.length>0&&(this.unexpectedFields=new B.g.State({title:"unexpected fields",data:n.intrus})))}};class t{constructor({state:e,options:n,...o}){Object.assign(this,o);let s={...t.defaultOptions,...n||{}};this.state=e,this.class=s.containerClass,this.style=s.containerStyle;let i=[this.state.typingErrors,this.state.missingFields,this.state.unexpectedFields].filter((e=>e)).map((e=>new B.g.View({state:e})));this.children=0==i.length?[{innerText:"Your configuration is validated"}]:i}}t.defaultOptions={containerClass:"d-flex flex-column",containerStyle:{"min-height":"0px"}},e.View=t,e.journalWidget=function(t){let n=new B.g.State({title:"merged configuration",data:t.result}),o=new e.State({status:t});return{children:[{class:"d-flex justify-content-around w-100",style:{"white-space":"nowrap"},children:[new B.g.View({state:n}),{class:"px-4"},new e.View({state:o})]}]}}}(C||(C={})),function(e){class t extends s.ImmutableTree.Node{constructor({name:e,children:t,isRealized:n}){super({id:e,children:t}),this.name=e,this.isRealized=n}}e.ExpectationNode=t;class n extends t{constructor({name:e,children:t,isRealized:n}){super({name:e,children:t,isRealized:n})}}e.AnyOfNode=n;class o extends t{constructor({name:e,children:t,isRealized:n}){super({name:e,children:t,isRealized:n})}}e.AllOfNode=o;class i extends t{constructor({name:e,children:t,isRealized:n}){super({name:e,children:t,isRealized:n})}}function r(e){let s=e=>{let r=e.children&&e.children.length>0?e.children.map((e=>s(e))):void 0;return e.expectation instanceof O.Contract?new t({name:e.expectation.description,children:r,isRealized:e.succeeded}):e.expectation instanceof O.AnyOf?new n({name:e.expectation.description,children:r,isRealized:e.succeeded}):e.expectation instanceof O.AllOf?new o({name:e.expectation.description,children:r,isRealized:e.succeeded}):e.expectation instanceof O.Of?new i({name:e.expectation.description,children:r,isRealized:e.succeeded}):e.expectation instanceof O.OptionalsOf?new n({name:e.expectation.description,children:r,isRealized:e.succeeded}):new t({name:e.expectation.description,children:r,isRealized:e.succeeded?e.succeeded:void 0})};return s(e)}e.OfNode=i,e.parseReport=r;class l{constructor(e,t,n){this.message=e,this.row=t,this.col=n}}e.ExecutionError=l,e.parseError=function(e){try{let t=e.split("\n"),n=t[0];if(t=t.filter((e=>e.includes("eval")&&2==e.split(",").length)),0==t.length)return new l(n,void 0,void 0);let o=t[0].split(",")[1].split("<anonymous>:")[1].split(")")[0],[s,i]=[Number(o.split(":")[0])-2,Number(o.split(":")[1])];return new l(n,s,i)}catch(e){return new l("Unidentified error",void 0,void 0)}},e.State=class{constructor({status:e,expandedNodes$:n}){this.status=e;let o=r(this.status),i=o.children&&o.children.length>0?o.children[0]:new t({name:"No required conditions defined",children:void 0,isRealized:!0});this.treeStateRequired=new s.ImmutableTree.State({rootNode:i,expandedNodes:n});let l=o.children&&o.children.length>1?o.children[1]:new t({name:"No optional conditions defined",children:void 0,isRealized:!0});this.treeStateOptionals=new s.ImmutableTree.State({rootNode:l,expandedNodes:n})}};class a{constructor({state:e,options:t,...n}){Object.assign(this,n);let o={...a.defaultOptions,...t||{}};this.state=e,this.class=o.containerClass,this.style=o.containerStyle,this.children=[{class:"d-flex align-items-center",children:[{class:this.state.status.succeeded?"fas fa-check fv-text-success":"fas fa-times fv-text-error",style:{"min-width":"25px"}},{class:"px-2",innerText:this.state.status.expectation.description}]},{class:"pl-2 flex-grow-1 overflow-auto ",style:{"min-height":"0px"},children:[{class:"pl-2",children:[new s.ImmutableTree.View({state:this.state.treeStateRequired,headerView:d}),new s.ImmutableTree.View({state:this.state.treeStateOptionals,headerView:d})]}]}]}}function d(e,t){let s="";t.isRealized&&(s="fv-text-success"),0==t.isRealized&&(s="fv-text-error"),null==t.isRealized&&(s="fv-text-disabled");let r="";return t.isRealized&&(r="fas fa-check fv-text-success px-1"),0==t.isRealized&&(r="fas fa-times fv-text-error px-1"),t instanceof o?{class:"d-flex align-items-center",children:[{innerText:t.name,class:"fv-text-primary"},{class:s+" "+r},{tag:"i",class:"fv-text-primary",innerText:"All of the following:"}]}:t instanceof n?{class:"d-flex align-items-center",children:[{innerText:t.name,class:"fv-text-primary"},{class:s+" "+r},{tag:"i",class:"fv-text-primary",innerText:"Any of the following:"}]}:t instanceof i?{class:"d-flex flex-align-items-center ",children:[{innerText:t.name,class:s},{class:r}]}:{class:s,innerText:t.name}}a.defaultOptions={containerClass:"d-flex flex-column",containerStyle:{"min-height":"0px"}},e.View=a,e.journalWidget=function(t){let n=new B.g.State({title:"incoming data",data:t.fromValue,expandedNodes:["incoming data_0"]}),o=new e.State({status:t});return{children:[{class:"d-flex justify-content-around w-100",style:{"white-space":"nowrap"},children:[new B.g.View({state:n}),{class:"px-4"},new e.View({state:o})]}]}}}(E||(E={})),function(e){class t extends T.Tabs.TabData{constructor(){super("data","data")}}class n extends T.Tabs.TabData{constructor(){super("configuration","configuration")}}e.State=class{constructor({mdle:e,adaptedInput:o,contract:s,selectedTabId$:i}){this.selectedTabId$=i||new r.BehaviorSubject("data"),this.tabState=new T.Tabs.State([new t,new n],i),this.configStatus=(0,O.mergeConfiguration)(e.configuration.data,o.configuration),this.dataStatus=s.resolve(o.data)}};class o{constructor({state:e,options:s,...i}){Object.assign(this,i),this.options={...o.defaultOptions,...s||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle;let l=new r.BehaviorSubject(["optional","required"]),a=new T.Tabs.View({state:this.state.tabState,contentView:(e,o)=>{if(o instanceof t){let e=new E.State({status:this.state.dataStatus,expandedNodes$:l});return new E.View({state:e})}if(o instanceof n){let e=new C.State({status:this.state.configStatus});return new C.View({state:e})}},headerView:(e,o)=>o instanceof t?function(e){let t="fas fa-check fv-text-success px-1";return e?e.succeeded||(t="fas fa-times fv-text-error px-1"):t="fas fa-question px-1",{class:"d-flex align-items-center px-2",children:[{class:t},{innerText:"data"}]}}(this.state.dataStatus):o instanceof n?function(e){let t={};return e instanceof O.InconsistentConfiguration&&(t={class:"fas fa-times fv-text-error px-1"}),e instanceof O.ConsistentConfiguration&&e.intrus.length>0&&(t={class:"fas fa-exclamation fv-text-danger px-1"}),e instanceof O.ConsistentConfiguration&&0==e.intrus.length&&(t={class:"fas fa-check fv-text-success px-1"}),{class:"d-flex align-items-center px-2",children:[t,{innerText:"configuration"}]}}(this.state.configStatus):{innerText:o.name,class:"px-2"},class:"h-100 d-flex flex-column",style:{"min-height":"0px"},options:{containerStyle:{"min-height":"0px"},containerClass:"p-2 border flex-grow-1 overflow-auto"}});this.children=[a]}}o.defaultOptions={containerClass:"h-100 w-100",containerStyle:{}},e.View=o}(L||(L={})),function(e){class t{constructor(e,t,n){this.message=e,this.row=t,this.col=n}}class n{constructor({connection:e,initialCode:n,appStore:o}){this.appStore=o,this.connection=e;let s=new r.BehaviorSubject(n);this.codeEditorState=new j.State({content$:s}),this.mdleStart=this.appStore.getModule(e.start.moduleId),this.mdleEnd=this.appStore.getModule(e.end.moduleId),this.rawInput$=this.mdleStart.getOutputSlot(e.start.slotId).observable$,this.contract=this.mdleEnd.getInputSlot(this.connection.end.slotId).contract,this.adaptedInput$=(0,r.combineLatest)([s.pipe((0,l.debounceTime)(.5)),this.rawInput$]).pipe((0,l.map)((([e,n])=>{try{let t=new Function(e)()(n,this.mdleEnd.helpers);return t.configuration=k.merge({},this.mdleEnd.getPersistentData(),t.configuration),t}catch(e){return function(e){try{let n=e.split("\n"),o=n[0];if(n=n.filter((e=>e.includes("eval")&&2==e.split(",").length)),0==n.length)return new t(o,void 0,void 0);let s=n[0].split(",")[1].split("<anonymous>:")[1].split(")")[0],[i,r]=[Number(s.split(":")[0])-2,Number(s.split(":")[1])];return new t(o,i,r)}catch(e){return new t("Unidentified error",void 0,void 0)}}(e.stack)}})))}}e.State=n;class o{constructor({state:e,options:t,...n}){Object.assign(this,n),this.options={...o.defaultOptions,...t||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.dataColumnView(),{class:"d-flex flex-grow-1 flex-column h-100 w-100 mx-2",style:{"min-width":"0px"},children:[new j.View({state:e.codeEditorState,options:{containerClass:"w-100 h-50"}}),this.statusView()]}]}dataColumnView(){return{class:"d-flex flex-column h-100 fv-text-primary w-50",style:{"font-family":"monospace"},children:[this.rawInputView(),this.adaptedInputView()]}}statusView(){return{style:{height:"33%","font-family":"monospace"},class:"overflow-auto flex-grow-1 d-flex flex-column",children:[$("Presented here is a blind test of the input that is reaching the module's implementation with respect to its internal validation rules. \n Make sure the trigger turn green before updating the adaptor."),(0,a.child$)(this.state.adaptedInput$,(e=>{if(e instanceof t||!e.data)return{class:"flex-grow-1 py-2",style:{"min-height":"0px","font-family":"monospace"},children:[{innerText:"error while executing the adaptor"},{innerText:`${(n=e).message}.`+(n.row?` Row:${n.row}, column:${n.col}`:"")}]};var n;let o=new L.State({mdle:this.state.mdleEnd,adaptedInput:e,contract:this.state.contract});return new L.View({state:o,options:{containerClass:"flex-grow-1 w-100 overflow-auto",containerStyle:{"min-height":"0px"}}})}))]}}rawInputView(){return{class:"h-50 d-flex flex-column overflow-auto py-1",children:[{innerText:"Adaptor's input data",class:"text-center fv-text-focus"},{class:"flex-grow-1 d-flex flex-column",style:{"min-height":"0"},children:[$("Presented here is the latest input that have reached the adaptor, before any transformation. The input that is actually reaching the module's implementation is presented below."),this.dataTreeView(this.state.rawInput$,"input")]}]}}adaptedInputView(){return{class:"h-50 d-flex flex-column overflow-auto py-1",children:[{innerText:"Module's input data",class:"text-center  fv-text-focus"},{class:"flex-grow-1 d-flex flex-column",style:{"min-height":"0"},children:[$("Presented here is the input that is actually reaching the module's implementation. Here, the configuration part of the input is merging the default one (defined in module's settings) with the one returned by the adaptor (as presented in the previous tab)."),this.dataTreeView(this.state.adaptedInput$,"input")]}]}}dataTreeView(e,t){let n=[t+"_0"];return{class:"cm-s-blackboard overflow-auto flex-grow-1",style:{"min-height":"0px"},children:[(0,a.child$)(e,(e=>{if(!e)return{innerText:"code not valid",class:"p-3"};let o=new B.g.State({title:t,data:e,expandedNodes:n});return new B.g.View({state:o,connectedCallback:e=>{e.subscriptions.push(o.expandedNodes$.subscribe((e=>n=e)))}})}),{untilFirst:this.options.untilFirst})]}}}o.defaultOptions={containerClass:"fv-bg-background p-3 fv-text-primary rounded d-flex h-100 w-100",containerStyle:{},untilFirst:{class:"d-flex flex-column fv-text-primary ",style:{"font-family":"monospace"},children:[{tag:"p",innerText:"No data available: the module has not played any scenario yet. Having data available may help to write your code."},{tag:"p",innerText:"Getting some data is usually as easy as connecting the input(s) of your module."}]}},e.View=o,e.popupModal=function({connection:e,initialCode:t,appStore:s,onUpdate:i}){let r=new n({connection:e,initialCode:t,appStore:s}),l=new o({state:r,options:{containerClass:"p-3 d-flex flex-grow-1 w-100",containerStyle:{"min-height":"0px"}}});u.R.popup({view:l,style:{height:"50vh",width:"90vw","max-width":"1500px"}}).subscribe((()=>{i(r.codeEditorState.content$.getValue())}))}}(R||(R={})),function(e){class t{constructor({mdle:e,initialCode:t}){this.mdle=e;let n=new r.BehaviorSubject(t);this.codeEditorState=new j.State({content$:n})}}e.State=t;class n{constructor({state:e,options:t,...o}){Object.assign(this,o),this.options={...n.defaultOptions,...t||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.moduleContextView(),{class:"d-flex flex-column h-100 w-100 mx-2",children:[new j.View({state:this.state.codeEditorState})]}]}moduleContextView(){return{}}}n.defaultOptions={containerClass:"fv-bg-background p-3 fv-text-primary rounded d-flex ",containerStyle:{height:"50vh",width:"90vw","max-width":"1500px"}},e.View=n,e.popupModal=function({mdle:e,initialCode:o,onUpdate:s}){let i=new t({mdle:e,initialCode:o}),r=new n({state:i,options:{containerClass:"p-2 d-flex flex-grow-1 w-100",containerStyle:{"min-height":"0px"}}});u.R.popup({view:r,style:{height:"50vh",width:"90vw","max-width":"1500px"}}).subscribe((()=>{s(i.codeEditorState.content$.getValue())}))}}(M||(M={})),n(864);var V=n(939),A=n(249);function P({onclick:e,title:t,classes:n}){return{onclick:e,children:[{tag:"span",class:"gjs-pn-btn gjs-pn-active fv-text-focus d-flex align-items-center ",children:[{tag:"i",class:n+" px-1"},{tag:"div",style:{"font-weight":"lighter","letter-spacing":"1px"},class:"px-1",innerText:t}]}]}}let N=class{constructor(e=!1,t="\nreturn ({data,configuration,context}) => ({\n    data: data,\n    context:{},\n    configuration: configuration\n})"){this.wireless=e,this.adaptor=t}};function D(e,t,n,o){let s={[n.slice(1)]:[e,t]};if(e&&e.extends&&o){let i=D(o.schemas[e.extends],t,n,o);_.merge(s,i)}if(e&&e.type&&o&&o.schemas&&o.schemas[e.type]){let i=D(o.schemas[e.type],t,n,o);_.merge(s,i)}if(e&&e.attributes){let i=Object.entries(e.attributes).reduce(((e,[s,i])=>_.merge(e,D(i,t[s],`${n}.${s}`,o))),{});_.merge(s,i)}return Object.keys(s).filter((e=>s[e][0])).reduce(((e,t)=>(e[t]=s[t],e)),{})}function F(e,t,n){let o=t.getConnectionView(e.connectionId)||new N;e.adaptor&&(o.adaptor=e.adaptor.toString());let s=D({attributes:{wireless:{type:"Boolean",name:"wireless",metadata:{description:"wireless"}},adaptor:{type:"String",name:"adaptor",metadata:{description:"adaptor",type:"code"}}},methods:[],extends:[""]},o,"",void 0);return[[...Object.entries(s).slice(1).map((([n,o])=>W(e,n,o,t))).filter((e=>e))],function(e,t,n){let o=_.cloneDeep(e.data),s=document.createElement("div");return s.style.position="sticky",s.style.top="-5px",s.style.zIndex="5",s.style.backgroundColor="#444",s.onclick=()=>{q(e,o,t,n)},s.innerHTML='<span class="gjs-pn-btn gjs-pn-active fv-text-focus"> <i class="fas fa-check p-2 ">Apply settings</i></span>',s}({data:o},(n=>{if(n.data.adaptor){let o=new O.Adaptor((0,O.uuidv4)(),n.data.adaptor);t.addAdaptor(o,e)}t.setConnectionView(e,n.data)}),n)]}function U(e,t){return(0,r.merge)(t.moduleSelected$,t.connectionSelected$).subscribe((t=>{document.getElementById("attributes-panel").innerHTML="";let n=document.getElementById("attributes-panel");var o=document.createDocumentFragment();let[s,i]=t.moduleId?function(e,t,n){let o=(0,O.flattenSchemaWithValue)(e.configuration.data);return[[z("wf-config-title","wf-config-title","title","",[{type:"string"},e.configuration.title]),...Object.entries(o).slice(1).map((([n,o])=>W(e,n,o,t))).filter((e=>e))],function(e,t,n,o){let s=_.cloneDeep(t.data),i=P({title:"apply",classes:"fas fa-check",onclick:()=>q(t,s,n,o)}),l=new r.BehaviorSubject(!1),d=e?{class:"w-100",style:{position:"absolute"},children:Object.entries(e).map((([e,t])=>P({title:e,classes:"",onclick:()=>{window.open(t,"_blank"),l.next(!1)}})))}:{},c={class:"flex-grow-1",style:{position:"relative"},children:[{class:"d-flex align-items-center gjs-pn-btn fv-text-focus",onclick:()=>l.next(!l.getValue()),children:[{tag:"i",class:(0,a.attr$)(l,(e=>e?"fas fa-caret-down px-2":"fas fa-caret-right px-2"))},{tag:"i",class:"fas fa-book-reader"}]},(0,a.child$)(l,(e=>e?d:{}))]},u={class:"d-flex align-items-center p-2",style:{position:"sticky",top:"0px","z-index":5,"background-color":"#444"},children:[i,e?c:{}]};return(0,a.render)(u)}(e.Factory.resources,e.configuration,(({title:n,description:o,data:s})=>t.updateModule(e,new e.Factory.Configuration({title:n,description:o,data:s}))),n)]}(t,e,n):F(t,e,n);n.appendChild(i),s.forEach((e=>o.appendChild(e))),n.appendChild(o)})),t.unselect$.subscribe((e=>{document.getElementById("attributes-panel").innerHTML=""})),document.createDocumentFragment()}function W(e,t,n,o){return"code"===t||n[0]&&n[0].metadata&&n[0].metadata.type&&n[0].metadata.type.includes("code")?function(e,t,n,o,s,i,r,l){let a=`\n    <div id="${t}" class="gjs-sm-property gjs-sm-select gjs-sm-property__" style="display: block;">\n      <div class="gjs-sm-label gjs-four-color">        \n        <span class="gjs-sm-icon pr-2 wf-code-bttn-label wf-config-property" path="${s}" title="" >${o}</span> \n            <i class="fas fa-edit wf-code-bttn btn btn-secondary"></i>\n        <b class="gjs-sm-clear" data-clear-style="" style="display: none;">⨯</b>    \n      </div>\n    </div>\n    `,d=document.createElement("div");d.innerHTML=a;let c=d.querySelector(".wf-code-bttn");d.querySelector(".wf-code-bttn-label").setAttribute("value",i);let u=t=>{let n=s.split("/"),o=e;n.slice(0,-1).reduce(((e,t)=>e[t]),o.configuration.data)[n.slice(-1)[0]]=t,console.log(o.configuration),l.updateModule(o,o.configuration)},p=t=>{let n=new O.Adaptor((0,O.uuidv4)(),t);l.addAdaptor(n,e)};return c.onclick=()=>{e instanceof O.ModuleFlux?M.popupModal({mdle:e,initialCode:i,onUpdate:u}):R.popupModal({connection:e,initialCode:i,appStore:l,onUpdate:p})},d}(e,(0,A.toCssName)(t),0,t,t,n[1],n[0].metadata.type,o):n&&n[0]&&n[0].type&&"boolean"==n[0].type.toLowerCase()?function(e,t,n,o,s){let i=`\n    <div id="${e}" class="d-flex py-1 gjs-sm-property gjs-sm-select gjs-sm-property__${t}" style="display: block;">\n      <div class="gjs-sm-label gjs-four-color">    \n        <span class="gjs-sm-icon " title="">${n}</span>\n        <input type="checkbox" path="${o}" name="${n}" class="wf-config-property mx-2" placeholder="${s}" ${s?"checked":""} value="${s}">  \n      </div>\n    </div>\n    `,r=document.createElement("div");return r.innerHTML=i,r}(e,(0,A.toCssName)(t),t,t,n[1]):n&&n[0]&&n[0].type&&"string"==n[0].type.toLowerCase()&&n[0].metadata&&n[0].metadata.enum?function(e,t,n,o,s,i){let r=`\n    <div id="${e}" class="gjs-sm-property gjs-sm-select gjs-sm-property__" style="display: block;">\n      <div class="gjs-sm-label">\n        \n      \n      <b class="gjs-sm-clear" data-clear-style="" style="display: none;">⨯</b>\n      ${n}\n      </div>\n      <div class="gjs-fields">\n        \n      <div class="gjs-field gjs-select">\n        <span id="gjs-sm-input-holder">\n        <select class="wf-config-property" path="${s}" type="select-one">\n        `+o.map((e=>e==i[1]?`<option value="${e}" selected>${e} </option>`:`<option value="${e}">${e} </option>`))+'</select>\n        <div class="gjs-sel-arrow">\n          <div class="gjs-d-s-arrow"></div>\n        </div>\n      </div>\n    \n      </div>\n    </div>\n    ',l=document.createElement("div");return l.innerHTML=r,l}((0,A.toCssName)(t),0,t,n[0].metadata.enum,t,n):n&&n[0]&&n[0].type&&"string"==n[0].type.toLowerCase()||n&&n[0]&&n[0].type&&"number"==n[0].type.toLowerCase()?z((0,A.toCssName)(t),"",t,t,n):void 0}function q(e,t,n,o){let s=o.querySelector("#wf-config-title input"),i=s?s.value:void 0;o.querySelectorAll(".wf-config-property").forEach((e=>{let n=e.getAttribute("path").split("."),o=n.slice(0,-1).reduce(((e,t)=>e[t]),t);if(o[n.slice(-1)[0]]=e.value||e.getAttribute("value"),"number"==e.type&&(o[n.slice(-1)[0]]=Number(o[n.slice(-1)[0]])),"checkbox"==e.type&&(o[n.slice(-1)[0]]=e.checked),"select-one"==e.type){let t=e.options[e.selectedIndex].value;o[n.slice(-1)[0]]=t}})),document.querySelectorAll("span.modified").forEach((e=>e.classList.toggle("modified"))),n({title:i,description:e.description,data:t})}function z(e,t,n,o,s){let i=s[1],r=`\n    <div id="${e}" class="gjs-sm-property gjs-sm-select gjs-sm-property__${t}" style="display: block;">\n      <div class="gjs-sm-label gjs-four-color">        \n        <span class="gjs-sm-icon " title="">${n}</span>\n        <b class="gjs-sm-clear" data-clear-style="" style="display: none;">⨯</b>    \n      </div>\n      <div class="gjs-fields">        \n        <div class="gjs-field gjs-select">\n            <input path="${o}" type="${s[0].type}" class="wf-config-property" placeholder="${i}" value="${i}">\n        </div>\n      </div>\n    </div>\n    `,l=document.createElement("div");return l.innerHTML=r,l}(0,V.gn)([(0,O.Property)({description:"wireless"}),(0,V.w6)("design:type",Boolean)],N.prototype,"wireless",void 0),(0,V.gn)([(0,O.Property)({description:"adaptor",type:"code"}),(0,V.w6)("design:type",String)],N.prototype,"adaptor",void 0),N=(0,V.gn)([(0,O.Schema)({pack:{schemas:{ConnectionView:{}}},description:"Intersection from ray casting"}),(0,V.w6)("design:paramtypes",[Object,String])],N)},735:(e,t,n)=>{"use strict";n.d(t,{Q:()=>o});var o,s=n(935),i=n(222),r=n(888),l=n(158),a=n(519),d=n(931);!function(e){class t extends r.ImmutableTree.State{constructor({appStore:e,selectionBuffer$:n}){super({rootNode:new p({favorites:t.favorites$.getValue()})}),this.favorites=new Array,this.appStore=e,this.selectionBuffer$=n||(0,l.of)([]),t.favorites$.subscribe((e=>{localStorage.setItem("flux-builder#favorites",JSON.stringify(e))})),this.selection$=new l.Subject}toggleFavorite(e){let n=v(),o=e instanceof y?e.favorite.id:e.id;if(n.find((e=>e.id==o)))return n=n.filter((e=>e.id!=o)),t.favorites$.next(n),void this.removeNode(e instanceof y?e.id:"favorite_"+o);let s=new x(o,e.name,e.type);n=n.concat([s]),t.favorites$.next(n),this.addChild("explorer",new y({favorite:s}))}}t.favorites$=new l.BehaviorSubject(v()),e.State=t;class n extends r.ImmutableTree.View{constructor({state:e,...t}){super({state:e,headerView:o,...t})}}function o(e,n){if(!(n instanceof b)){let o="fas fa-star fa-xs fv-hover-opacity fv-pointer ";return{class:"d-flex w-100 align-items-center fv-pointer",children:[{tag:"i",class:n.faIcon?n.faIcon:""},n instanceof y?{tag:"i",class:"fas fa-star fa-xs px-1 fv-text-focus fv-hover-opacity",onclick:t=>{t.stopPropagation(),e.toggleFavorite(n)}}:{},{tag:"span",class:"mx-2",innerText:n.name,style:{"user-select":"none"}},n instanceof g?{tag:"i",class:(0,i.attr$)(t.favorites$,(e=>e.find((e=>e.id==n.id))?o+"fv-text-focus":o+"fv-text-primary")),onclick:t=>{t.stopPropagation(),e.toggleFavorite(n)}}:{},(0,i.child$)(n.status$,(e=>e.find((e=>"request-pending"==e.type))?{tag:"i",class:"fas fa-spinner fa-spin"}:{}))]}}if(n instanceof b)return{class:"d-flex w-100 align-items-baseline fv-pointer",onclick:()=>e.selection$.next({node:n,selected:!0}),children:[{tag:"i",class:(0,i.attr$)(e.selectionBuffer$,(e=>e.includes(n)?"fv-text-focus":""),{wrapper:e=>"fas fa-cloud-download-alt fv-text-primary fv-hover-opacity "+e})},{tag:"span",class:"mx-2 w-100",innerText:n.name,style:{"user-select":"none"}}]}}e.View=n;class c extends r.ImmutableTree.Node{constructor({id:e,name:t,children:n,type:o,faIcon:s}){super({id:e,children:n}),this.status$=new l.BehaviorSubject([]),this.name=t,this.faIcon=s,this.type=o}addStatus({type:e,id:t}){t=t||this.id;let n=this.status$.getValue().concat({type:e,id:t});this.status$.next(n)}removeStatus({type:e,id:t}){t=t||this.id;let n=this.status$.getValue().filter((n=>n.type!=e&&n.id!=t));this.status$.next(n)}resolveChildren(){if(!this.children||Array.isArray(this.children))return;let e=(0,s.uuidv4)();return this.addStatus({type:"request-pending",id:e}),super.resolveChildren().pipe((0,a.tap)((()=>{this.removeStatus({type:"request-pending",id:e})})))}}class u extends c{constructor({id:e,name:t,type:n,children:o,faIcon:s}){super({id:e,name:t,type:n||"FolderNode",children:o,faIcon:s||"fas fa-folder"})}}class p extends u{constructor({favorites:e,children:t}){super({id:"explorer",name:"Explorer",type:"RootNode",children:t||I()}),this.favorites=e}}class m extends u{constructor({groupId:e,path:t,children:n}){super({id:e,name:t.split("/").slice(-1)[0],type:"GroupNode",children:n||S(t),faIcon:"fas fa-users"}),this.groupId=e,this.path=t}}class h extends u{constructor({driveId:e,name:t,children:n}){super({id:e,name:t,type:"DriveNode",children:n||j(e),faIcon:"fas fa-hdd"}),this.driveId=e}}class g extends u{constructor({folderId:e,name:t,children:n}){super({id:e,name:t,type:"AssetFolderNode",children:n||j(e)}),this.folderId=e}}class f extends c{constructor({id:e,name:t,type:n,children:o,faIcon:s}){super({id:e,name:t,type:n||"ItemNode",children:o,faIcon:s})}}class w extends f{constructor({assetId:e,name:t,rawId:n,children:o}){super({id:e,name:t,type:"AssetItemNode",children:o||k(n),faIcon:"fas fa-box"}),this.assetId=e}}class b extends f{constructor({factory:e,library:t}){super({id:e.uid,name:e.displayName,type:"ModuleItemNode",faIcon:""}),this.factory=e,this.library=t}}e.ModuleItemNode=b;class y extends f{constructor({favorite:e}){super({id:"favorite_"+e.id,name:e.name,type:"FavoriteNode",children:y.getChildrenFactory[e.type](e),faIcon:"fas fa-folder"}),this.favorite=e}}y.getChildrenFactory={AssetFolderNode:e=>j(e.id)};class x{constructor(e,t,n){this.id=e,this.name=t,this.type=n}}function v(){let e=localStorage.getItem("flux-builder#favorites");return e?JSON.parse(e):[]}function I(){let e=v();return S().pipe((0,a.map)((t=>[...t,...e.map((e=>new y({favorite:e})))])))}function S(e=""){return d.k.getGroupChildren$(e).pipe((0,a.map)((e=>[...e.groups.map((e=>new m({groupId:e.id,path:e.path}))),...e.drives.map((e=>new h({driveId:e.driveId,name:e.name})))])))}function j(e){return d.k.getFolderChildren$(e).pipe((0,a.map)((e=>[...e.folders.map((e=>new g({folderId:e.folderId,name:e.name}))),...e.items.filter((e=>"package"==e.kind)).map((e=>new w({assetId:e.assetId,name:e.name,rawId:e.rawId})))])))}function k(e){return d.k.getModules$(e).pipe((0,a.map)((({factories:e,library:t,loadingGraph:n})=>e.map((e=>new b({factory:e,library:{name:t.name,version:t.versions[0],namespace:t.namespace}}))))))}}(o||(o={}))},230:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var o,s=n(935),i=n(888),r=n(991),l=n(97);!function(e){function t(e){return e instanceof window["@youwol/flux-core"].Context?new o({context:e}):e instanceof window["@youwol/flux-core"].ErrorLog?new p({log:e}):e instanceof window["@youwol/flux-core"].WarningLog?new u({log:e}):e instanceof window["@youwol/flux-core"].InfoLog?new c({log:e}):void 0}class n extends i.ImmutableTree.Node{constructor({id:e,children:t}){super({id:e,children:t})}}class o extends n{constructor({context:e}){super({id:e.id,children:e.children.map((e=>t(e)))}),this.context=e}}class a extends n{constructor({data:e}){super({id:(0,s.uuidv4)()}),this.data=e}}class d extends n{constructor({log:e}){super({id:e.id,children:[new a({data:e.data})]}),this.log=e}}class c extends d{constructor(e){super(e)}}class u extends d{constructor(e){super(e)}}class p extends d{constructor(e){super(e)}}function m(e){return e.parent?m(e.parent).concat([e.id]):[e.id]}class h extends i.ImmutableTree.State{constructor({context:e,expandedNodes:n,selectedNode:o}){super({rootNode:t(e.root()),expandedNodes:n}),this.rootCtx=e.root(),this.context=e,this.tStart=this.rootCtx.startTimestamp,this.tEnd=this.rootCtx.startTimestamp+this.rootCtx.elapsed(),o&&this.selectedNode$.next(this.getNode(o))}}e.State=h;class g{constructor({state:e,options:t,...n}){this.domId="contextView-view",Object.assign(this,n),this.state=e;let o={...g.defaultOptions,...t||{}};this.class=o.containerClass,this.style=o.containerStyle;let s=new i.ImmutableTree.View({state:e,headerView:f,class:o.treeViewClass,style:o.treeViewStyle,options:{classes:{header:"d-flex align-items-baseline fv-tree-header fv-hover-bg-background-alt "}}});this.children=[s]}}function f(e,t){let n="3px";if(t instanceof o){let o=100*(t.context.startTimestamp-e.rootCtx.startTimestamp)/(e.tEnd-e.tStart),i=100*t.context.elapsed()/(e.tEnd-e.tStart),r=Math.floor(100*t.context.elapsed())/100;return{class:"w-100 pb-2",children:[{class:"d-flex align-items-center",children:[{tag:"i",class:{[s.ContextStatus.FAILED]:"fas fa-times fv-text-error",[s.ContextStatus.SUCCESS]:"fas fa-check fv-text-success",[s.ContextStatus.RUNNING]:"fas fa-cog fa-spin"}[t.context.status()]},{innerText:t.context.title+`  - ${r} ms`,class:"fv-pointer px-2",style:{"font-family":"fantasy"}}]},{class:"fv-bg-success",style:{top:"0px",height:n,width:i+"%",position:"absolute",left:o+"%"}}]}}if(t instanceof d){let o=100*(t.log.timestamp-e.rootCtx.startTimestamp)/(e.tEnd-e.tStart),s="fv-text-primary fas fa-info";return t instanceof p&&(s="fv-text-error fas fa-times"),t instanceof u&&(s="fv-text-focus fas fa-exclamation"),{class:"pb-1 fv-pointer w-100",children:[{class:"d-flex align-items-center",children:[{class:s},{innerText:t.log.text,class:"px-2"}]},{class:"fv-bg-success rounded",style:{height:n,width:n,top:"0px",position:"absolute",left:`calc( ${o}% - 5px)`}}]}}if(t instanceof a){let e=s.Journal.getViews(t.data).map((e=>e.view));if(e.length>0)return{class:"d-flex justify-content-around w-100",style:{"white-space":"nowrap"},children:e};let n=new r.g.State({title:"",data:t.data,expandedNodes:["_0"]});return{children:[new r.g.View({state:n})]}}return{innerText:"unknown type"}}g.defaultOptions={containerClass:"p-4 fv-bg-background fv-text-primary",containerStyle:{width:"100%",height:"100%"},treeViewClass:"h-100 overflow-auto",treeViewStyle:{}},e.View=g,e.displayModuleErrorModal=function(e){let t=e.context,n=new h({context:t,expandedNodes:m(t).concat(e.id),selectedNode:e.id}),o=new g({state:n});l.R.popup({view:o,style:{"max-height":"75vh",width:"75vw"},options:{displayCancel:!1,displayOk:!1}})}}(o||(o={}))},991:(e,t,n)=>{"use strict";n.d(t,{g:()=>o});var o,s=n(888),i=n(158),r=n(519);!function(e){function t(e,t,n){return null==t?new o({name:e,nestedIndex:n}):"string"==typeof t?new c({name:e,data:t,nestedIndex:n}):"number"==typeof t?new d({name:e,data:t,nestedIndex:n}):"boolean"==typeof t?new u({name:e,data:t,nestedIndex:n}):"function"==typeof t?new m({name:e,data:t,nestedIndex:n}):Array.isArray(t)?new g({name:e,data:t,nestedIndex:n}):t instanceof ArrayBuffer?new p({name:e,data:t,nestedIndex:n}):"object"==typeof t?new h({name:e,data:t,nestedIndex:n}):new l({name:e,nestedIndex:n})}class n extends s.ImmutableTree.Node{constructor({name:e,children:t,classes:n,nestedIndex:o}){super({id:`${e}_${o}`,children:t}),this.name=e,this.classes=n,this.nestedIndex=o}}e.DataNode=n;class o extends n{constructor({name:e,nestedIndex:t}){super({name:e,classes:"fv-text-disabled",nestedIndex:t})}}class l extends n{constructor({name:e,nestedIndex:t}){super({name:e,classes:"",nestedIndex:t})}}class a extends n{constructor({name:e,data:t,classes:n,nestedIndex:o}){super({name:e,classes:n,nestedIndex:o}),this.data=t}}class d extends a{constructor({name:e,data:t,nestedIndex:n}){super({name:e,data:t,classes:"cm-number",nestedIndex:n})}}class c extends a{constructor({name:e,data:t,nestedIndex:n}){super({name:e,data:t,classes:"cm-string",nestedIndex:n})}}class u extends a{constructor({name:e,data:t,nestedIndex:n}){super({name:e,data:t,classes:"cm-atom",nestedIndex:n})}}class p extends a{constructor({name:e,data:t,nestedIndex:n}){super({name:e,data:t,classes:"cm-string",nestedIndex:n})}}class m extends n{constructor({name:e,data:t,nestedIndex:n}){super({name:e,classes:"cm-def",nestedIndex:n}),this.data=t}}class h extends n{constructor({name:e,data:t,nestedIndex:n}){super({name:e,children:(0,i.of)(t).pipe((0,r.map)((e=>this.getChildrenNodes(e)))),classes:"",nestedIndex:n}),this.data=t}getChildrenNodes(e){let n=[];for(var o in e)n.push(t(o,e[o],this.nestedIndex+1));let s=[];try{s=Object.entries(e.__proto__).map((([e,t])=>new m({name:e,data:t,nestedIndex:this.nestedIndex+1})))}catch(e){}return[...n,...s]}}class g extends n{constructor({name:e,data:n,nestedIndex:o}){super({name:e,children:(0,i.of)(n).pipe((0,r.map)((e=>Object.entries(e).map((([e,n])=>t(`${e}`,n,o+1)))))),classes:"",nestedIndex:o}),this.data=n}}class f extends s.ImmutableTree.State{constructor({title:e,data:n,expandedNodes:o,...s}){super({rootNode:t(e,n,0),expandedNodes:o,...s})}}e.State=f;class w extends s.ImmutableTree.View{constructor({state:e,options:t,...n}){super({state:e,headerView:b,class:w.getStyling(t).containerClass,style:w.getStyling(t).containerStyle,...n})}static getStyling(e){return{...w.defaultOptions,...e||{}}}}function b(e,t){if(t instanceof l)return{class:"d-flex fv-text-disabled flex-wrap",innerText:t.name};let n="";return t instanceof a&&(n=String(t.data),"string"==typeof t.data&&(n="'"+n+"'")),t instanceof o&&(n="undefined"),t instanceof m&&(n=`f(${t.data.length} arg(s))`),t instanceof h&&(n="{...}"),t instanceof g&&(n="[...]"),t instanceof p&&(n=`Array Buffer (${t.data.byteLength} bytes)`),{class:"d-flex fv-pointer",children:[{innerText:t.name},{class:"px-2 w-100 "+t.classes,innerHTML:`<i>${n}</i>`,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","max-width":10*e.stringLengthLimit+"px"}}]}}w.defaultOptions={containerClass:"cm-s-blackboard",containerStyle:{"white-space":"nowrap"}},e.View=w}(o||(o={}))},97:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var o,s=n(222),i=n(327),r=n(337),l=n(158);!function(e){e.popup=function({view:e,style:t,ok$:n,options:o}){o=o||{displayOk:!0,displayCancel:!0};let a=new i.Button.View({state:new i.Button.State,contentView:()=>({innerText:"Ok"}),class:"fv-btn fv-btn-primary fv-bg-focus mr-2"}),d=i.Button.simpleTextButton("Cancel"),c=new r.Modal.State(n),u=(0,s.render)(new r.Modal.View({state:c,contentView:()=>({class:"border rounded fv-text-primary fv-bg-background d-flex flex-column",style:t||{height:"50vh",width:"50vw","max-width":"1500px"},children:[e,{class:"d-flex p-2",children:[o.displayOk?a:void 0,o.displayCancel?d:void 0].filter((e=>e))}]}),connectedCallback:e=>{let t=[a.state.click$.subscribe((()=>c.ok$.next())),d.state.click$.subscribe((()=>c.cancel$.next())),(0,l.merge)(c.cancel$,c.ok$).subscribe((()=>u.remove()))];e.subscriptions=[...e.subscriptions,...t]}}));return document.querySelector("body").appendChild(u),c.ok$}}(o||(o={}))},864:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var o,s=n(222),i=n(327),r=n(313),l=n(158),a=n(519),d=n(97);!function(e){class t{constructor({appStore:e}){let t=[new r.Select.ItemData("youwol-url","YouWol Platform URL"),new r.Select.ItemData("relative-url","Relative URL")];"localhost"==location.hostname&&t.push(new r.Select.ItemData("localhost-url","Localhost URL")),this.selectState=new r.Select.State(t,"youwol-url"),this.sourceURI$=(0,l.combineLatest)([e.projectURI$(),this.selectState.selectionId$])}toUrl(e,t){return"relative-url"==t?`${e}`:"localhost-url"==t?`${location.hostname}:${location.port}${e}`:`https://platform.youwol.com${e}`}}e.State=t;class n{constructor({state:e,...t}){Object.assign(this,t),this.state=e,this.class=this.class||n.defaultOptions.containerClass,this.style=this.style||n.defaultOptions.containerStyle;let o=new i.Button.View({state:new i.Button.State,contentView:()=>({innerText:""}),class:"fv-btn fv-btn-primary fv-bg-focus fas fa-copy ml-2"});this.connectedCallback=t=>{t.subscriptions.push(o.state.click$.pipe((0,a.mergeMap)((()=>e.sourceURI$)),(0,a.mergeMap)((([t,n])=>(0,l.from)(navigator.clipboard.writeText(e.toUrl(t,n)))))).subscribe((()=>{console.log("Copied:::!!!")})))},this.children=[{innerText:"The following url can be used to share your application:"},new r.Select.View({state:e.selectState}),{class:"d-flex align-items-center",children:[{style:{"text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden","font-family":"monospace"},innerText:(0,s.attr$)(e.sourceURI$,(([t,n])=>e.toUrl(t,n)))},o]},{class:"d-flex align-items-center fv-bg-background-alt rounded my-3",children:[{class:"fas fa-exclamation fv-text-focus px-2"},{innerText:"This feature is a work in progress, it is expected to work with 'relatively' small application for now. Also, the consumer of this link will need to have access to all packages/modules/resources included in your app."}]}]}}n.defaultOptions={containerClass:"d-flex flex-column p-3",containerStyle:{"min-height":"0px"}},e.View=n,e.popupModal=function(e){let o=new t({appStore:e}),s=new n({state:o});d.R.popup({view:s,style:{width:"75vw","max-width":"1000px"},options:{displayOk:!1,displayCancel:!1}})}}(o||(o={}))},931:(e,t,n)=>{"use strict";n.d(t,{k:()=>l});var o=n(935),s=n(158),i=n(519),r=n(995);class l{static setHeaders(e){l.headers=e}static getAsset$(e){let t=l.urlBaseAssets+`/${e}`,n=new Request(t,{headers:l.headers});return(0,o.createObservableFromFetch)(n)}static getFolderChildren$(e){let t=new Request(`/api/assets-gateway/tree/folders/${e}/children`,{headers:l.headers});return(0,o.createObservableFromFetch)(t)}static getGroupChildrenDrives$(e){let t=new Request(`/api/assets-gateway/tree/groups/${e}/drives`,{headers:l.headers});return(0,o.createObservableFromFetch)(t)}static getGroupChildren$(e=""){let t=new Request("/api/assets-gateway/groups",{headers:l.headers});return(this.allGroups?(0,s.of)(this.allGroups):(0,o.createObservableFromFetch)(t).pipe((0,i.tap)((({groups:e})=>this.allGroups=e)),(0,i.map)((({groups:e})=>e)))).pipe((0,i.mergeMap)((t=>{let n=t.filter((t=>""==e?"private"==t.path||"/youwol-users"==t.path:t.path!=e&&t.path.includes(e)&&1==t.path.slice(e.length).match(/\//g).length));if(""==e)return(0,s.of)({groups:n,drives:[],groupId:void 0});let o=t.find((t=>t.path==e)).id;return l.getGroupChildrenDrives$(o).pipe((0,i.map)((({drives:e})=>({groupId:o,groups:n,drives:e}))))})))}static getModules$(e){let t=new Request(`/api/assets-gateway/raw/package/metadata/${e}`,{headers:l.headers});return(0,o.createObservableFromFetch)(t).pipe((0,i.mergeMap)((e=>{if(window[e.name])return(0,s.of)(e);let t={...l.appStore.project.requirements.libraries,[e.name]:e.versions[0]},n=(0,r.fetchBundles)(t,window);return(0,s.from)(n).pipe((0,i.map)((()=>e)))})),(0,i.map)((e=>{let t=window[e.name];return{factories:Object.values(t).filter((e=>e.Module&&e.BuilderView)),library:e}})))}}l.appStore=void 0,l.tmpLibraries=void 0,l.urlBase="/api/assets-gateway",l.urlBaseOrganisation="/api/assets-gateway/tree",l.urlBaseAssets="/api/assets-gateway/assets",l.urlBaseRaws="/api/assets-gateway/raw",l.allGroups=void 0,l.headers={}},295:(e,t,n)=>{"use strict";n.d(t,{l3:()=>u,cw:()=>y,Af:()=>x,tj:()=>l,Ni:()=>a,DV:()=>v});var o=n(549),s=n(935);let i=["flux-element","flux-component","flux-fill-parent"];function r(e,t){const n=(e,t=[])=>(t.push(e),e.components().each((e=>n(e,t))),t);return t=t||e.DomComponents.getWrapper(),n(t).reduce(((e,t)=>Object.assign({},e,{[t.ccid]:t})),{})}function l(e,t){let n=r(t),s=e.filter((e=>e.Factory.RenderView)),i=o.ST.getInstance();i.debugOn&&i.logRenderTopic({level:o.in.Info,message:"removeTemplateElements",object:{modules:e,modulesToRemove:s}}),s.filter((e=>n[e.moduleId])).forEach((e=>n[e.moduleId].remove()))}function a(e,t,n){let i=r(t),l=t.Canvas.getDocument(),a=e.map((e=>n.getModule(e))).filter((e=>e.Factory.RenderView)),d=a.map((e=>()=>new e.Factory.RenderView(e))),c=a.map((e=>l.getElementById(e.moduleId))),u=_.zip(a,d,c).filter((([,,e])=>e)).filter((([e])=>!(e instanceof s.Component.Module))).map((([e,t,n])=>[e,n,t().render()])).filter((([,,e])=>e)),p=o.ST.getInstance();p.debugOn&&p.logRenderTopic({level:o.in.Info,message:"replaceTemplateElements",object:{mdles:a,toRender:u}});let m=u.map((([e,t,n])=>(null!=t.children[0]&&t.children[0].remove(),t.appendChild(n),e.renderedElementDisplayed$&&n&&e.renderedElementDisplayed$.next(n),e))),h=_.zip(a,d,c).filter((([e])=>e instanceof s.Component.Module)),g=(e,t)=>null==e||null==e.parentNode?t:g(e.parentNode,t+1);return h.map((([e,t,n])=>[e,n,g(n,0)])).sort(((e,t)=>t[2]-e[2])).forEach((([e])=>{let t=l.getElementById(e.moduleId);t&&e.renderedElementDisplayed$.next(t)})),a.forEach((e=>i[e.moduleId]?i[e.moduleId].attributes.name=e.configuration.title:void 0)),n.project.runnerRendering.layout!==localStorage.getItem("gjs-html")&&n.setRenderingLayout(localStorage.getItem("gjs-html"),!1),m}function d(e){let t=e.Factory.RenderView.wrapperDivAttributes,n="flux-element"+(e instanceof s.Component.Module?" flux-component":"")+(t&&t(e).class?" "+t(e).class:""),o=t&&t(e).style?t(e).style:{},i=Object.entries(o).reduce(((e,[t,n])=>e+t+":"+n+";"),"");return`<div id="${e.moduleId}" class="${n}" style="${i}" data-gjs-name="${e.configuration.title}" ></div>`}function c(e,t,n,o){let i=e.getParentGroupModule(o.moduleId),r=d(o);return o instanceof s.Component.Module&&o.rendering&&(r=o.rendering.layout,t.getStyle().add(o.rendering.style),o.rendering=void 0),t.fluxCache[o.moduleId]&&(r=t.fluxCache[o.moduleId].layout),i?n[i.moduleId]?n[i.moduleId].append(r,{at:0}):void 0:t.DomComponents.getComponents().add(r,{at:0})}function u(e,t,n){let i=e.createdElements.filter((e=>e.Factory.RenderView)),l=e.removedElements.map((e=>e.moduleId)),d=i.filter((e=>!l.includes(e.moduleId))).filter((e=>n.project.workflow.rootLayerTree.moduleIds.includes(e.moduleId))),u=i.filter((e=>l.includes(e.moduleId)));if(u.length>0&&a(u.map((e=>e.moduleId)),t,n),0==d.length)return;let m=r(t),h=d.filter((e=>!m[e.moduleId])),g=h.filter((e=>e instanceof s.Component.Module)),f=h.filter((e=>!(e instanceof s.Component.Module))),w=o.ST.getInstance();w.debugOn&&w.logRenderTopic({level:o.in.Info,message:"auto add elements in layout",object:{unitModules:f,components:g}}),f.forEach((e=>c(n,t,m,e)));let b=g.reduce(((e,t)=>e.concat(t.getAllChildren().map((e=>e.moduleId)))),[]);g.forEach((e=>{let o=c(n,t,m,e);t.fluxCache[e.moduleId]||e.getDirectChildren().map((e=>m[e.moduleId])).filter((e=>e)).forEach((e=>{e.remove(),o.append(e)}))})),a(f.map((e=>e.moduleId)).concat(b),t,n),p(n,t)}function p(e,t){let n=o.ST.getInstance(),i=e.project.workflow.modules.filter((e=>e instanceof s.Component.Module)),l=r(t),a=i.filter((e=>l[e.moduleId])).reduce(((e,t)=>{let n=l[t.moduleId].toHTML();return Object.assign({},e,{[t.moduleId]:{layout:n,styles:{}}})}),t.fluxCache);t.fluxCache=Object.assign({},t.fluxCache,a),n.debugOn&&n.logRenderTopic({level:o.in.Info,message:"updateFluxCache",object:{cache:t.fluxCache}})}function m(e,t){var n=e.CodeManager.getViewer("CodeMirror").clone();return n.set({codeName:"html"===t?"htmlmixed":"css",readOnly:!1,theme:"hopscotch",autoBeautify:!0,autoCloseTags:!0,autoCloseBrackets:!0,styleActiveLine:!0,smartIndent:!0}),n}var h=n(864);function g(e){return[{id:"app-basic-actions",el:"#panel__app-basic-actions",buttons:[{id:"save-project",className:"btn-save-project",label:'<i class="fas fa-save panel-action" data-toggle="tooltip" title="Save project" ></i>',command(t){e.saveProject()}},{id:"share-uri",className:"btn-share-uri",label:'<i class="fas fa-link panel-action" data-toggle="tooltip" title="share uri" ></i>',command(t){h.R.popupModal(e)}},{id:"undo",className:"btn-undo",label:'<i class="fas fa-undo panel-action" data-toggle="tooltip" title="Undo" ></i>',command(t){e.undo()}},{id:"redo",className:"btn-redo",label:'<i class="fas fa-redo panel-action" data-toggle="tooltip" title="Redo" ></i>',command(t){e.redo()}},{id:"settings",className:"btn-settings",label:'<i class="fas fa-cog panel-action" data-toggle="tooltip" title="open settings panel" ></i>',command(t){e.projectSettings()}}]},{id:"app-layout-builder-actions",el:"#panel__app-layout-builder-actions",buttons:[{id:"toggle-builder-view",active:!0,className:"app-layout-builder-actions",label:'<i id="toggle-builder-view" class="fas fa-project-diagram  panel-action" data-toggle="tooltip" title="Toggle builder view"></i>',command:"toggle-builder-view"}]},{id:"app-layout-render-actions",el:"#panel__app-layout-render-actions",buttons:[{id:"toggle-render-view",className:"app-layout-render-actions",label:'<i id="toggle-render-view" class="fas fa-eye  panel-action" data-toggle="tooltip" title="Toggle builder view"></i>',command:"toggle-render-view"}]},{id:"app-layout-actions",el:"#panel__app-layout-actions",buttons:[{id:"toggle-full-screen",active:!1,className:"app-layout-actions",label:'<i id="toggle-render-view" class="fas fa-expand  panel-action" data-toggle="tooltip" title="Fullscreen mode"></i>',command:"toggle-fullscreen",toggable:!1}]},{id:"panel__app-selection-actions",el:"#panel__app-selection-actions",buttons:[{id:"duplicate-module",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-clone panel-action" data-toggle="tooltip" title="duplicate selected modules"></i>',command:"duplicate-module",toggable:!1},{id:"horizontal-align",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-ruler-vertical panel-action" data-toggle="tooltip" title="horizontal align selected modules"></i>',command:"horizontal-align",toggable:!1},{id:"vertical-align",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-ruler-horizontal panel-action" data-toggle="tooltip" title="vertical align selected modules"></i>',command:"vertical-align",toggable:!1},{id:"group-module",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-object-group panel-action" data-toggle="tooltip" title="group selected modules"></i>',command:"group-module",toggable:!1}]},{id:"panel__app-component-actions",el:"#panel__app-component-actions",buttons:[{id:"create-component",active:!1,className:"selection-actions",label:'<i id="create-component" class="fas fa-cube panel-action" data-toggle="tooltip" title="create a component from selected modules"></i>',command:"group-as-component",toggable:!1},{id:"publish-component",active:!1,className:"selection-actions",label:'<i id="publish-component" class="fas fa-upload panel-action" data-toggle="tooltip" title="publish selected component"></i>',command:"publish-component",toggable:!1}]},{id:"panel__app-tree-structure",el:"#panel__app-tree-structure",buttons:[{id:"display-tree-structure",active:!1,className:"tree-structure",label:'<label class="text-light border px-2" >active layer <i class="fas fa-caret-down pl-2"></i> </label>',command:"display-tree-structure",toggable:!1}]}]}var f=n(158),w=n(519),b=n(586);async function y(){localStorage.setItem("gjs-components",""),localStorage.setItem("gjs-html",""),localStorage.setItem("gjs-css",""),localStorage.setItem("gjs-styles","");let e=o.ST.getInstance();e.debugOn&&e.logRenderTopic({level:o.in.Info,message:"create layout editor",object:{}});let t=new f.Subject,n=b.init({autorender:!1,container:"#gjs",canvas:{styles:[],scripts:[]},height:"100%",width:"auto",panels:{defaults:[]},assetManager:{assets:[],autoAdd:1},keymaps:{defaults:{}},commands:{defaults:[]},selectorManager:{appendTo:"#styles"},blockManager:{appendTo:"#blocks",blocks:[{id:"section",label:"<b>Section</b>",category:"Basic",attributes:{class:"gjs-block-section"},content:"<section>\n        <h1>This is a simple title</h1>\n        <div>This is just a Lorem text: Lorem ipsum dolor sit amet</div>\n      </section>",render({el:e}){e.classList.add("gjs-fonts","gjs-f-h1p")}},{id:"text",label:"Text",category:"Basic",content:'<div data-gjs-type="text">Insert your text here</div>',render({el:e}){e.classList.add("gjs-fonts","gjs-f-text")}},{id:"image",label:"Image",category:"Basic",select:!0,content:{type:"image"},activate:!0,render({el:e}){e.classList.add("gjs-fonts","gjs-f-image")}},{id:"link",label:"Link",category:"Basic",select:!0,content:{type:"link",content:"Text for the link",attributes:{href:""}}},{id:"2-columns",label:"2 Columns",category:"Layouts",content:'\n            <div class="" style="display:flex; width:100%; height:100%; padding:5px" data-gjs-droppable=".fx-row-cell" data-gjs-custom-name="Row">\n              <div class="" style="min-width:50px; width:100%" data-gjs-draggable=".row" \n                data-gjs-resizable="resizerRight" data-gjs-name= "Cell"></div>\n              <div class="" style="min-width:50px; width:100%"  data-gjs-draggable=".row"\n                data-gjs-resizable="resizerRight" data-gjs-name= "Cell" ></div>\n            </div>\n          ',render({el:e}){e.classList.add("gjs-fonts","gjs-f-b2")}}]},styleManager:{appendTo:"#styles",sectors:[{name:"Dimension",open:!1,buildProps:["width","height","min-width","min-height","max-width","max-height","padding","margin"],properties:[{type:"integer",name:"The width",property:"width",units:["px","%"],defaults:"auto",min:0}]},{name:"Extra",open:!1,buildProps:["background-color","box-shadow","custom-prop"],properties:[{id:"custom-prop",name:"Custom Label",property:"font-size",type:"select",defaults:"32px",options:[{value:"12px",name:"Tiny"},{value:"18px",name:"Medium"},{value:"32px",name:"Big"}]}]},{name:"Typography",open:!1,buildProps:["font-family","font-size","font-weight","letter-spacing","color","line-height","text-align","text-decoration","text-shadow"],properties:[{name:"Font",property:"font-family"},{name:"Weight",property:"font-weight"},{name:"Font color",property:"color"},{property:"text-align",type:"radio",defaults:"left",list:[{value:"left",name:"Left",className:"fa fa-align-left"},{value:"center",name:"Center",className:"fa fa-align-center"},{value:"right",name:"Right",className:"fa fa-align-right"},{value:"justify",name:"Justify",className:"fa fa-align-justify"}]},{property:"text-decoration",type:"radio",defaults:"none",list:[{value:"none",name:"None",className:"fa fa-times"},{value:"underline",name:"underline",className:"fa fa-underline"},{value:"line-through",name:"Line-through",className:"fa fa-strikethrough"}]},{property:"text-shadow",properties:[{name:"X position",property:"text-shadow-h"},{name:"Y position",property:"text-shadow-v"},{name:"Blur",property:"text-shadow-blur"},{name:"Color",property:"text-shadow-color"}]}]},{name:"Decorations",open:!1,buildProps:["opacity","background-color","border-radius","border","box-shadow","background"],properties:[{type:"slider",property:"opacity",defaults:1,step:.01,max:1,min:0},{property:"border-radius",properties:[{name:"Top",property:"border-top-left-radius"},{name:"Right",property:"border-top-right-radius"},{name:"Bottom",property:"border-bottom-left-radius"},{name:"Left",property:"border-bottom-right-radius"}]},{property:"box-shadow",properties:[{name:"X position",property:"box-shadow-h"},{name:"Y position",property:"box-shadow-v"},{name:"Blur",property:"box-shadow-blur"},{name:"Spread",property:"box-shadow-spread"},{name:"Color",property:"box-shadow-color"},{name:"Shadow type",property:"box-shadow-type"}]},{property:"background",properties:[{name:"Image",property:"background-image"},{name:"Repeat",property:"background-repeat"},{name:"Position",property:"background-position"},{name:"Attachment",property:"background-attachment"},{name:"Size",property:"background-size"}]}]},{name:"Extra",open:!1,buildProps:["transition","perspective","transform"],properties:[{property:"transition",properties:[{name:"Property",property:"transition-property"},{name:"Duration",property:"transition-duration"},{name:"Easing",property:"transition-timing-function"}]},{property:"transform",properties:[{name:"Rotate X",property:"transform-rotate-x"},{name:"Rotate Y",property:"transform-rotate-y"},{name:"Rotate Z",property:"transform-rotate-z"},{name:"Scale X",property:"transform-scale-x"},{name:"Scale Y",property:"transform-scale-y"},{name:"Scale Z",property:"transform-scale-z"}]}]},{name:"Flex",open:!1,properties:[{name:"Flex Container",property:"display",type:"select",defaults:"block",list:[{value:"block",name:"Disable"},{value:"flex",name:"Enable"}]},{name:"Flex Parent",property:"label-parent-flex",type:"integer"},{name:"Direction",property:"flex-direction",type:"radio",defaults:"row",list:[{value:"row",name:"Row",className:"icons-flex icon-dir-row",title:"Row"},{value:"row-reverse",name:"Row reverse",className:"icons-flex icon-dir-row-rev",title:"Row reverse"},{value:"column",name:"Column",title:"Column",className:"icons-flex icon-dir-col"},{value:"column-reverse",name:"Column reverse",title:"Column reverse",className:"icons-flex icon-dir-col-rev"}]},{name:"Justify",property:"justify-content",type:"radio",defaults:"flex-start",list:[{value:"flex-start",className:"icons-flex icon-just-start",title:"Start"},{value:"flex-end",title:"End",className:"icons-flex icon-just-end"},{value:"space-between",title:"Space between",className:"icons-flex icon-just-sp-bet"},{value:"space-around",title:"Space around",className:"icons-flex icon-just-sp-ar"},{value:"center",title:"Center",className:"icons-flex icon-just-sp-cent"}]},{name:"Align",property:"align-items",type:"radio",defaults:"center",list:[{value:"flex-start",title:"Start",className:"icons-flex icon-al-start"},{value:"flex-end",title:"End",className:"icons-flex icon-al-end"},{value:"stretch",title:"Stretch",className:"icons-flex icon-al-str"},{value:"center",title:"Center",className:"icons-flex icon-al-center"}]},{name:"Flex Children",property:"label-parent-flex",type:"integer"},{name:"Order",property:"order",type:"integer",defaults:0,min:0},{name:"Flex",property:"flex",type:"composite",properties:[{name:"Grow",property:"flex-grow",type:"integer",defaults:0,min:0},{name:"Shrink",property:"flex-shrink",type:"integer",defaults:0,min:0},{name:"Basis",property:"flex-basis",type:"integer",units:["px","%",""],unit:"",defaults:"auto"}]},{name:"Align",property:"align-self",type:"radio",defaults:"auto",list:[{value:"auto",name:"Auto"},{value:"flex-start",title:"Start",className:"icons-flex icon-al-start"},{value:"flex-end",title:"End",className:"icons-flex icon-al-end"},{value:"stretch",title:"Stretch",className:"icons-flex icon-al-str"},{value:"center",title:"Center",className:"icons-flex icon-al-center"}]}]}]},layerManager:{appendTo:"#layers"},traitManager:{appendTo:"#traits"}});n.dynamicModulesId=[],n.fluxCache={};let s=document.getElementById("bootstrap-css");s||console.error("Bootstrap css needs to be included in host application with id 'bootstrap-css' ");let r=document.getElementById("fontawesome-css");r||console.error("Fontawesome css needs to be included in host application with id 'fontawesome-css' ");let l=document.getElementById("youwol-css");return l||console.error("Fontawesome css needs to be included in host application with id 'fontawesome-css' "),n.on("load",(function(){let e=n.Canvas.getDocument(),o=e.head;o.appendChild(s.cloneNode()),o.appendChild(r.cloneNode()),o.appendChild(l.cloneNode());var a=e.createElement("style");a.innerHTML=".mw-50px{ min-width:50px}.w-5{width:5%};.w-10{width:10%}.w-15{width:15%}.w-20{width:20%}.w-30{width:30%}.w-40{width:40%}.w-60{width:60%}.w-70{width:70%}.w-80{width:80%}.w-90{width:90%}.zindex-1{z-index:1}\n    .flux-component{min-height:50px;} .preview .gjs-hovered{outline:0px !important} .preview .gjs-selected{outline:0px !important} \n    .flux-builder-only{opacity:0.5} .flux-builder-only.preview{ display:none}\n    .flux-fill-parent{width:100%; height:100%}",e.body.appendChild(a),t.next(n),n.SelectorManager.getAll().each((e=>e.set("private",i.includes(e.id))))})),n.render(),new Promise((e=>t.pipe((0,w.take)(1)).subscribe((t=>e(t)))))}function x(e,{style:t,layout:n,cssLinks:l},d){let u=o.ST.getInstance();u.debugOn&&u.logRenderTopic({level:o.in.Info,message:"initialize layout editor",object:{}}),function(e,t){let n=o.ST.getInstance();e.on("change:changesCount",(e=>{t.project.runnerRendering.layout!==localStorage.getItem("gjs-html")&&t.setRenderingLayout(localStorage.getItem("gjs-html"),!1);let n=function(e){return[...new Set(e.split("}"))].filter((e=>e.length>0)).map((e=>e+"}")).reduce(((e,t)=>e+t),"")}(localStorage.getItem("gjs-css"));t.project.runnerRendering.style!==n&&t.setRenderingStyle(n,!1)})),e.on("canvas:drop",((i,r)=>{n.debugOn&&n.logRenderTopic({level:o.in.Info,message:"canvas:drop",object:{dataTransfer:i,component:r.toJSON()}});let l=r.view.el,d=t.getModule(l.id);if(d){n.debugOn&&n.logRenderTopic({level:o.in.Info,message:"canvas:drop => flux-module",object:{module:d}});let i=[];if(d instanceof s.Component.Module&&!e.fluxCache[d.moduleId]&&p(t,e),d instanceof s.Component.Module){let t=r.parent(),s=t.components().indexOf(r),l=e.fluxCache[d.moduleId];n.debugOn&&n.logRenderTopic({level:o.in.Info,message:"canvas:drop => restore cached component",object:{module:d,cachedComponent:l,parent:t.getEl()}}),r.remove(),t.append(l.layout,{at:s}),e.getStyle().add(l.styles),i=d.getAllChildren().map((e=>e.moduleId))}l.id=d.moduleId,a([l.id,...i],e,t),v(t,e)}p(t,e)})),e.on("component:update:content",(n=>{setTimeout((()=>p(t,e)),200)})),e.on("sorter:drag:end",(({modelToDrop:i,srcEl:l})=>{if(n.debugOn&&n.logRenderTopic({level:o.in.Info,message:"sorter:drag:end",object:{module:i}}),"string"==typeof i)return;let d=t.getModule(i.ccid);if(!d||d instanceof s.Component.Module||a([d.moduleId],e,t),d&&d instanceof s.Component.Module){let n=r(e);d instanceof s.Component.Module&&c(t,e,n,d);let o=d.getAllChildren().map((e=>e.moduleId));a([d.moduleId].concat(o),e,t)}p(t,e)})),e.on("component:remove",(n=>{v(t,e)})),e.on("selector:add",(e=>{e.set("private",i.includes(e.id))})),e.Commands.add("show-blocks",{getRowEl:e=>e.getContainer().closest("#editor-row"),getLayersEl:e=>e.querySelector("#blocks"),run(e,t){this.getLayersEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getLayersEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-styles",{getRowEl:e=>e.getContainer().closest("#editor-row"),getStyleEl:e=>e.querySelector("#styles"),run(e,t){this.getStyleEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getStyleEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-layers",{getRowEl:e=>e.getContainer().closest("#editor-row"),getLayersEl:e=>e.querySelector("#layers"),run(e,t){this.getLayersEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getLayersEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-traits",{getRowEl:e=>e.getContainer().closest("#editor-row"),getTraitsEl:e=>e.querySelector("#traits"),run(e,t){this.getTraitsEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getTraitsEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("open-code",{getRowEl:e=>e.getContainer().closest("#editor-row"),getCodeEl:e=>e.querySelector("#codes"),run:function(e,n){const o=e.Panels,s="code",i=o.getPanel(s)||o.addPanel({id:s});let r=this.getCodeEl(this.getRowEl(e));console.log("Code elements",r),this.codePanel||(this.codePanel=function(e,t,n){const o=document.createElement("div");o.classList.add("code-panel");const s=document.createElement("section"),i=document.createElement("section");s.innerHTML="<div>HTML</div>",i.innerHTML="<div>CSS</div>";const r=m(t,"html"),l=m(t,"css"),d=document.createElement("textarea"),c=document.createElement("textarea");return s.appendChild(d),i.appendChild(c),o.appendChild(s),o.appendChild(i),n.set("appendContent",o).trigger("change:appendContent"),r.init(d),l.init(c),r.setContent(t.getHtml()),l.setContent(t.getCss({avoidProtected:!0})),function(e,t,n){function o(){const o=n.editor.getValue();if(!o)return;t.setComponents(o),a(e.project.workflow.modules.map((e=>e.moduleId)),t,e);let s=Object.values(t.fluxCache).reduce(((e,t)=>e+" "+t.styles),"");t.getStyle().add(s)}var s;n.editor.on("change",(function(){clearTimeout(s),s=setTimeout(o,300)})),n.editor.refresh()}(e,t,r),function(e,t){function n(){const n=t.editor.getValue();n&&e.setStyle(n)}var o;t.editor.on("change",(function(){clearTimeout(o),o=setTimeout(n,300)}))}(t,l),setTimeout((()=>{r.editor.refresh(),l.editor.refresh()}),320),o}(t,e,i)),console.log("Code Panel",this.codePanel),this.codePanel.style.display="block",r.appendChild(this.codePanel)},stop:function(e,t){this.codePanel&&(this.codePanel.style.display="none")}}),e.Commands.add("custom-preview",{run(e,t){document.querySelector("#gjs-cv-tools").classList.add("preview"),e.Canvas.getDocument().getElementById("wrapper").classList.add("preview"),Array.from(e.Canvas.getDocument().querySelectorAll(".flux-builder-only")).forEach((e=>e.classList.add("preview"))),document.getElementById("panels-container-render").classList.add("collapsed");let n=document.getElementById("panel__right_render");n.classList.add("collapsed"),n.querySelectorAll(".flex-align-switch").forEach((e=>e.style.flexDirection="column")),e.$("#panel__right_render").get(0).style.width="50px",n.querySelectorAll(".buttons-toolbox").forEach((e=>{let t=e.firstChild;t&&t.style&&(t.style.flexDirection="column")}))},stop(e,t){document.querySelector("#gjs-cv-tools").classList.remove("preview"),e.Canvas.getDocument().getElementById("wrapper").classList.remove("preview"),Array.from(e.Canvas.getDocument().querySelectorAll(".flux-builder-only")).forEach((e=>e.classList.remove("preview"))),document.getElementById("panels-container-render").classList.remove("collapsed");let n=document.getElementById("panel__right_render");n.classList.remove("collapsed"),n.querySelectorAll(".flex-align-switch").forEach((e=>e.style.flexDirection="row")),n.querySelectorAll(".buttons-toolbox").forEach((e=>{let t=e.firstChild;t&&t.style&&(t.style.flexDirection="row")}))}}),e.Commands.add("set-device-tablet",{run(e,t){e.setDevice("Tablet")},stop(e,t){}}),e.Commands.add("set-device-desktop",{run(e,t){e.setDevice("Desktop")},stop(e,t){}}),e.Commands.add("set-device-mobile-landscape",{run(e,t){e.setDevice("Mobile landscape")},stop(e,t){}}),e.Commands.add("set-device-mobile-portrait",{run(e,t){e.setDevice("Mobile portrait")},stop(e,t){}}),e.on("run:preview:before",(({sender:e})=>{e.panelRight=document.getElementById("panel__right"),e.panelRight.remove()})),e.on("stop:preview:before",(({sender:e})=>{e&&e.panelRight&&document.getElementById("editor-row").appendChild(e.panelRight)}))}(e,d),function(){function e(e,t){let n=document.querySelectorAll(e),o=["gjs-pn-active","gjs-four-color"];n.forEach((e=>e.classList.remove(...o))),null!=t&&n[t].classList.add(...o)}return[["show-attributes",{run(t,n){const o=document.getElementById("attributes-panel");e("#panel__builder-managers-actions .gjs-pn-btn",0),o&&o.classList.remove("d-none")},stop(t,n){const o=document.getElementById("attributes-panel");e("#panel__builder-managers-actions .gjs-pn-btn"),o&&o.classList.add("d-none")}}],["show-hide-panels",{run(e,t){document.getElementById("panels-container-builder").classList.add("collapsed");let n=document.getElementById("panel__right_builder");n.classList.add("collapsed"),n.querySelectorAll(".flex-align-switch").forEach((e=>e.style.flexDirection="column")),n.querySelector(".buttons-toolbox>.gjs-pn-buttons").style.flexDirection="column"},stop(e,t){document.getElementById("panels-container-builder").classList.remove("collapsed");let n=document.getElementById("panel__right_builder");n.classList.remove("collapsed"),n.querySelectorAll(".flex-align-switch").forEach((e=>e.style.flexDirection="row")),n.querySelectorAll(".buttons-toolbox"),n.querySelector(".buttons-toolbox>.gjs-pn-buttons").style.flexDirection="row"}}]]}().concat(function(e,t){let n=o.ST.getInstance(),i=[["toggle-render-view",{run(t,n){"builder"==e.uiState.mode&&e.setUiState(new o.CE("combined",!1,!1)),"none"==e.uiState.mode&&e.setUiState(new o.CE("render",!1,!1))},stop(t,n){"combined"==e.uiState.mode&&e.setUiState(new o.CE("builder",!1,!1)),"render"==e.uiState.mode&&e.setUiState(new o.CE("none",!1,!1))}}],["toggle-builder-view",{run(t,n){"render"==e.uiState.mode&&e.setUiState(new o.CE("combined",!1,!1)),"none"==e.uiState.mode&&e.setUiState(new o.CE("builder",!1,!1))},stop(t,n){"combined"==e.uiState.mode&&e.setUiState(new o.CE("render",!1,!1)),"builder"==e.uiState.mode&&e.setUiState(new o.CE("none",!1,!1))}}],["toggle-fullscreen",{run(e,t){document.documentElement.requestFullscreen()}}],["duplicate-module",{run(t,n){let o=e.getModulesSelected();e.duplicateModules(o)}}],["horizontal-align",{run(t,n){let o=e.getModulesSelected();e.alignH(o)}}],["vertical-align",{run(t,n){let o=e.getModulesSelected();e.alignV(o)}}],["group-module",{run(t,n){e.addGroup(e.getModulesSelected().map((e=>e.moduleId)))}}],["group-as-component",{run(t,n){e.addComponent(e.getModulesSelected().map((e=>e.moduleId)))}}],["publish-component",{run(t,n){e.publishComponent(e.getModuleSelected())}}],["display-tree-structure",{run(t,n){const o=function(e,t){return(0,s.createHTMLElement)({data:{id:"tree-view-layers",class:"px-2 text-light border text-left flux-bg-primary",onmouseout:e=>{if("tree-view-layers"==e.path[0].id){const e=document.getElementById("tree-view-layers").querySelector(".children");e&&e.remove()}},onclick:()=>{t.Commands.run("display-tree-structure")},__div:{class:"",innerHTML:"active layer <i class='fas fa-caret-down pl-2'></i>",children:[{tag:"div",class:"flux-bg-primary text-black  children small py-2",__div:function t(n){const o=n.children.map((e=>t(e))),s=n.layerId==e.getActiveLayer().layerId?"font-weight-bold":"";return{class:"w-100",__label:{innerText:n.title,class:"flux-hoverable w-100 px-1 "+s,onclick:()=>e.selectActiveLayer(n.layerId)},__div:{class:"children pl-2 w-100",children:o}}}(e.project.workflow.rootLayerTree)}]}},subscriptions:[],classesDict:{}})}(e,t);document.getElementById("panel__app-tree-structure").innerHTML="",document.getElementById("panel__app-tree-structure").appendChild(o)}}]];return document.addEventListener("fullscreenchange",(()=>{document.querySelectorAll(".controls-panel").forEach((e=>e.classList.toggle("fullscreen"))),t.refresh()})),n.debugOn&&n.logRenderTopic({level:o.in.Info,message:"General commands",object:{cmds:i}}),i}(d,e)).forEach((t=>e.Commands.add(t[0],t[1]))),e.BlockManager.getCategories().each((e=>e.set("open",!1))),[...g(d),{id:"layout-basic-actions",el:"#panel__layout-basic-actions",buttons:[{id:"visibility",active:!0,className:"btn-toggle-borders",label:'<i class="fas fa-border-none"></i>',command:"sw-visibility"}]},{id:"layout-show-actions",el:"#panel__render-show-actions",buttons:[{id:"preview",className:"btn-preview",label:'<i class="fas fa-eye"></i>',command:"custom-preview"}]},{id:"layout-devices-actions",el:"#panel__layout-devices-actions",buttons:[{id:"desktop",active:!0,className:"btn-set-device-desktop",label:'<i class="fas fa-desktop"></i>',command:"set-device-desktop"},{id:"tablet",active:!1,className:"btn-set-device-tablet",label:'<i class="fas fa-tablet-alt"></i>',command:"set-device-tablet"},{id:"mobile landscape",active:!1,className:"btn-set-device-phone",label:'<i class="fas fa-mobile-alt"></i>',command:"set-device-mobile-landscape"},{id:"mobile portrait",active:!1,className:"btn-set-device-phone",label:'<i class="fas fa-mobile-alt"></i>',command:"set-device-mobile-portrait"}]},{id:"layout-managers-actions",el:"#panel__render-panels-actions",buttons:[{id:"show-blocks",active:!0,label:'<i class="fas fa-th-large"></i>',command:"show-blocks",togglable:!1},{id:"show-style",active:!1,label:'<i class="fas fa-palette"></i>',command:"show-styles",togglable:!1},{id:"show-traits",active:!1,className:"fa fa-cog",command:"show-traits",attributes:{title:"Open Trait Manager"},togglable:!1},{id:"show-layers",active:!1,className:"fa fa-bars",command:"show-layers",attributes:{title:"Open Layer Manager"},togglable:!1},{id:"code",className:"btn-preview",label:'<i class="fas fa-code"></i>',command:"open-code"}]},{id:"app-builder-extensions",el:"#extensions-panel"},{id:"app-builder-modules",el:"#modules-panel",buttons:[]},{id:"app-builder-components",el:"#components-panel",buttons:[]},{id:"app-builder-attributes",el:"#attributes-panel",buttons:[]},{id:"builder-managers-actions",el:"#panel__builder-managers-actions",buttons:[{id:"show-attributes",active:!1,label:'<i class="fas fa-tools"></i>',command:"show-attributes"}]},{id:"builder-show-actions",el:"#panel__builder-show-actions",buttons:[{id:"show-hide-panels",active:!1,label:'<i class="fas fa-eye"></i>',command:"show-hide-panels"}]}].forEach((t=>e.Panels.addPanel(t))),function(e){let t=document.getElementById("gjs-tools").querySelector(".gjs-toolbar");new MutationObserver((function(e,n){t.children.length>0&&(t.querySelector(".fa-arrows").classList.add("fas","fa-arrows-alt"),t.querySelector(".fa-trash-o").classList.add("fas","fa-trash"))})).observe(t,{attributes:!0,childList:!0,subtree:!1});let n=e.Commands.get("tlb-move");e.Commands.add("tlb-move",{run(e,t,o={}){o&&o.event&&o.event.target||n.run(e,t,o)}}),e.Commands.run("show-attributes"),e.Commands.stop("show-attributes"),e.Commands.run("show-styles"),e.Commands.stop("show-styles"),e.Commands.run("show-traits"),e.Commands.stop("show-traits"),e.Commands.run("show-layers"),e.Commands.stop("show-layers"),document.getElementById("panel__builder-managers-actions").children[0].classList.add("d-flex","flex-wrap"),document.getElementById("panel__layout-devices-actions").children[0].classList.add("d-flex","flex-wrap"),document.getElementById("panel__render-panels-actions").children[0].classList.add("d-flex","flex-wrap"),document.getElementById("panel__builder-actions-items").children[0].classList.add("d-flex","flex-wrap")}(e),p(d,e),e.SelectorManager.getAll().each((e=>e.set("private",i.includes(e.id)))),e.setComponents(n),e.setStyle(t)}function v(e,t){let n=o.ST.getInstance(),s=r(t),i=e.getActiveLayer().moduleIds,l=e.project.workflow.plugins.filter((e=>i.includes(e.parentModule.moduleId))).map((e=>e.moduleId)),a=[...i,...l].filter((e=>!s[e])).map((t=>e.getModule(t))).filter((e=>e.Factory.RenderView)),c=t.BlockManager.getAll().filter((e=>"Components"==e.get("category").id));n.debugOn&&n.logRenderTopic({level:o.in.Info,message:"set dynamic components block",object:{modulesToRender:a,componentBlocks:c}}),c.forEach((e=>t.BlockManager.remove(e.id))),a.forEach((e=>{return t.BlockManager.add(e.moduleId,{id:(n=e).moduleId,label:n.configuration.title,content:d(n),activate:!0,category:"Components",render:({el:e})=>{let t=document.createElement("div");t.id=n.moduleId,e.appendChild(t);let o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width","100px"),o.setAttribute("height","70px");let s=(new n.Factory.BuilderView).icon();const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.style.stroke="currentColor",i.classList.add("group-target"),i.innerHTML=s.content,o.appendChild(i),t.appendChild(o),document.body.appendChild(o),function(e){if(e.style.transform)return;let t=e.parentElement.getBoundingClientRect(),n=e.getBoundingClientRect(),o=t.top-n.top,s=t.left-n.left,i=Math.min(t.width/n.width,t.height/n.height);e.style.transform=`translate(${t.width/4}px,${t.height/4}px) scale(${.5*i}) translate(${s}px,${o}px)`}(i),o.remove(),t.appendChild(o)}});var n}))}},345:(e,t,n)=>{"use strict";n.d(t,{o:()=>l});var o=n(935),s=n(222),i=n(519),r=n(230);function l(e,t){e.environment.errors$.pipe((0,i.filter)((e=>e.error instanceof o.ModuleError))).subscribe((n=>a.error({message:n.error.message,title:n.error.module.Factory.id,actions:[{name:"focus",exe:()=>function(e,t,n,o,s=5e3){let i=t.project.workflow.rootLayerTree.getLayerRecursive((t=>t.moduleIds.includes(e.moduleId)));t.selectActiveLayer(i.layerId),setTimeout((()=>{let t=document.getElementById(e.moduleId),i=t.getBoundingClientRect();n.drawingArea.lookAt(.5*(i.left+i.right),.5*(i.top+i.bottom)),t.classList.toggle(o),setTimeout((()=>t.classList.toggle(o)),s)}),0)}(n.error.module,e,t,"error")},{name:"report",exe:()=>r.R.displayModuleErrorModal(n)}]})))}class a{constructor(e){this.appStore=e}static notify({message:e,title:t,actions:n}){a.popup({message:e,title:t,actions:n,classIcon:"",classBorder:""})}static error({message:e,title:t,actions:n}){a.popup({message:e,title:t,actions:n,classIcon:a.classesIcon[4],classBorder:a.classesBorder[4]})}static warning({message:e,title:t,actions:n}){a.popup({message:e,title:t,actions:n,classIcon:a.classesIcon[3],classBorder:a.classesBorder[3]})}static popup({message:e,title:t,actions:n,classIcon:o,classBorder:i}){let r={class:"m-2 p-2 my-1 bg-white "+i,style:{border:"solid"},children:[{class:"fas fa-times",style:{float:"right",cursor:"pointer"},onclick:e=>{e.target.parentElement.remove()}},{class:"d-flex py-2",children:[{tag:"i",class:o},{children:[{tag:"span",class:"d-block",innerText:t},{tag:"span",class:"d-block",innerText:e}]}]},{class:"d-flex align-space-around",children:n.map((e=>({tag:"span",class:"px-1 mx-1 ",innerText:e.name,onclick:()=>e.exe(),style:{cursor:"pointer","background-color":"darkslategrey",color:"white"}})))}]},l=(0,s.render)(r);document.getElementById("notifications-container").appendChild(l)}}a.classesIcon={4:"fas fa-2x fa-exclamation-circle text-danger px-2 mt-auto mb-auto",3:"fas fa-2x fa-exclamation text-warning px-2 mt-auto mb-auto"},a.classesBorder={4:"border-danger",3:"border-warning"}},600:(e,t,n)=>{"use strict";n.a(e,(async e=>{n.r(t),n.d(t,{initializeRessources:()=>S,connectStreams:()=>j,initDrawingArea:()=>k});var o=n(158),s=n(519),i=n(935),r=n(249),l=n(396),a=n(549),d=n(322),c=n(198),u=n(295),p=n(345),m=n(931),h=n(735),g=n(222);let{appStore:f,appObservables:w,layoutEditor:b}=await S(),y=k(f,w);(0,p.o)(f,y);let x=new c.j3(f,y.drawingArea);new l.ContextMenu.View({state:x,class:"fv-bg-background"}),j(f,0,b,w);let v=new URLSearchParams(window.location.search).get("id"),I=new URLSearchParams(window.location.search).get("uri");async function S(){let e=!1,t=a.RV.getInstance(),n=a.ST.getInstance();n.workflowUIEnabled=e,n.observableEnabled=e,n.workflowUIEnabled=e,n.workflowViewEnabled=e,n.WorkflowBuilderEnabled=e,n.renderTopicEnabled=e,n.workflowView$Enabled=e;let o=await(0,u.cw)(),s=o.Canvas.getDocument(),r=new i.Environment({renderingWindow:s.defaultView,executingWindow:window});n.logWorkflowBuilder({level:a.in.Info,message:"Environment",object:{environment:r}});let l=a.dk.getInstance(r);return m.k.appStore=l,h.Q.singletonState=new h.Q.State({appStore:l}),i.Journal.registerView({name:"ConfigurationStatus",isCompatible:e=>e instanceof i.ConfigurationStatus,view:e=>(0,g.render)(c.eD.journalWidget(e))}),i.Journal.registerView({name:"ExpectationStatus",isCompatible:e=>e instanceof i.ExpectationStatus,view:e=>(0,g.render)(c.rj.journalWidget(e))}),{appStore:l,appObservables:t,layoutEditor:o}}function j(e,t,n,i){let r=!0;i.packagesLoaded$.subscribe((()=>document.getElementById("loading-screen").remove())),i.uiStateUpdated$.subscribe((e=>function(e){let t=document.getElementById("render-component"),n=document.getElementById("builder-component");n.classList.remove("combined","builder","render","none"),t.classList.remove("combined","builder","render","none"),n.classList.add(e.mode),t.classList.add(e.mode)}(e))),i.adaptorEdited$.subscribe((({adaptor:e,connection:t})=>{}));let l=new o.ReplaySubject(1);i.renderingLoaded$.subscribe((t=>{(0,u.Af)(n,t,e),l.next(n)})),(0,o.combineLatest)([l,i.modulesUpdated$]).subscribe((([t,n])=>{let o=n.removedElements.filter((e=>!n.createdElements.map((e=>e.moduleId)).includes(e.moduleId)));(0,u.tj)(o,t),r&&(0,u.Ni)(n.createdElements.map((e=>e.moduleId)),t,e),r||(0,u.l3)(n,t,e),(0,u.DV)(e,t)})),(0,o.combineLatest)([l,i.activeLayerUpdated$]).subscribe((([t,n])=>{(0,u.DV)(e,t)})),(0,o.combineLatest)([l,i.uiStateUpdated$]).pipe((0,s.filter)((([e,t])=>"combined"===t.mode||"render"===t.mode))).subscribe((([t,n])=>(0,u.Ni)(e.project.workflow.modules.map((e=>e.moduleId)),t,e))),(0,o.combineLatest)([l,i.unselect$]).subscribe((([e,t])=>{e.Commands.stop("show-attributes")}));let a=(0,o.merge)(i.moduleSelected$,i.connectionSelected$);(0,o.combineLatest)([l,a]).subscribe((([e,t])=>{e.Commands.run("show-attributes")})),(0,o.combineLatest)([l,i.uiStateUpdated$]).subscribe((([e,t])=>{e.refresh()})),i.ready$.subscribe((()=>{document.getElementById("attributes-panel").appendChild((0,c.eW)(e,i))})),l.subscribe((e=>{r=!1}))}function k(e,t){let n=a.Dw.getInstance(),o=(0,r.createDrawingArea)({containerDivId:"wf-builder-view",width:1e3,height:1e3,xmin:-500,ymin:-500,xmax:500,ymax:500,margin:50,overflowDisplay:{left:1e8,right:1e8,top:1e8,bottom:1e8}});return new d.hb(o,t,n,e)}v?f.loadProject(v):I&&f.loadProjectURI(encodeURI(I)),e()}),1)}}]);
//# sourceMappingURL=600.591dfee1033a5a0de881.js.map