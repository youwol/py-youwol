(self.webpackChunk=self.webpackChunk||[]).push([[600],{322:(e,t,o)=>{"use strict";o.d(t,{hb:()=>O});var n=o(935),s=o(94),i=o(158),a=o(519),r=o(249);class l extends class{constructor(e,t,o){this.id=e,this.classes=t,this.data=o}}{constructor(e,t,o,n,s,i){super(e,t,s),this.id=e,this.classes=t,this.inputGroup=o,this.outputGroup=n,this.data=s,this.adaptor=i}}let d='\n<linearGradient id="a" gradientTransform="matrix(1 0 0 -1 0 -22278)" gradientUnits="userSpaceOnUse" x1="0" x2="512" y1="-22534" y2="-22534"><stop offset="0" stop-color="#00f1ff"/><stop offset=".231" stop-color="#00d8ff"/><stop offset=".5138" stop-color="#00c0ff"/><stop offset=".7773" stop-color="#00b2ff"/><stop offset="1" stop-color="#00adff"/></linearGradient>\n<path d="m512 256c0 141.386719-114.613281 256-256 256s-256-114.613281-256-256 114.613281-256 256-256 256 114.613281 256 256zm0 0" fill="url(#a)"/><g fill="#fff"><path d="m279.050781 385.15625c0 13.128906-10.640625 23.773438-23.769531 23.773438s-23.773438-10.644532-23.773438-23.773438 10.644532-23.769531 23.773438-23.769531 23.769531 10.640625 23.769531 23.769531zm0 0"/><path d="m85.996094 209.265625c-3.660156 0-7.332032-1.332031-10.222656-4.027344-6.058594-5.644531-6.394532-15.136719-.746094-21.199219 47.460937-50.921874 111.730468-78.964843 180.96875-78.964843 69.246094 0 133.515625 28.042969 180.976562 78.964843 5.648438 6.0625 5.3125 15.554688-.746094 21.199219-6.058593 5.652344-15.550781 5.316407-21.199218-.742187-41.726563-44.769532-98.203125-69.421875-159.023438-69.421875-60.832031 0-117.304687 24.652343-159.03125 69.421875-2.953125 3.167968-6.960937 4.769531-10.976562 4.769531zm0 0"/><path d="m138.582031 269.089844c-3.820312 0-7.640625-1.449219-10.566406-4.355469-5.878906-5.832031-5.914063-15.332031-.082031-21.210937 35.101562-35.375 80.582031-54.859376 128.0625-54.859376 47.472656 0 92.953125 19.480469 128.0625 54.859376 5.835937 5.878906 5.800781 15.375-.078125 21.210937-5.882813 5.835937-15.378907 5.800781-21.214844-.078125-29.433594-29.660156-67.351563-45.992188-106.769531-45.992188-39.421875 0-77.339844 16.332032-106.765625 45.988282-2.933594 2.957031-6.789063 4.4375-10.648438 4.4375zm0 0"/><path d="m315.84375 328.84375c-3.816406 0-7.632812-1.445312-10.558594-4.34375-13.234375-13.113281-32.636718-21.589844-49.421875-21.589844-.003906 0-.003906 0-.007812 0h-1.039063c-.003906 0-.007812 0-.007812 0-16.789063 0-36.1875 8.472656-49.425782 21.589844-5.882812 5.828125-15.378906 5.785156-21.210937-.097656-5.832031-5.886719-5.789063-15.382813.097656-21.214844 18.847657-18.675781 45.875-30.277344 70.535157-30.277344h.011718 1.039063.011719c24.660156 0 51.683593 11.601563 70.535156 30.277344 5.882812 5.832031 5.929687 15.328125.097656 21.214844-2.933594 2.957031-6.796875 4.441406-10.65625 4.441406zm0 0"/></g>\n',c={tag:"g",class:"adaptor",attributes:{},style:{visibility:"visible"},children:[{tag:"path",attributes:{d:"M211.331,190.817c-1.885-1.885-4.396-2.922-7.071-2.922c-2.675,0-5.186,1.038-7.07,2.922l-32.129,32.129l-24.403-24.403   l32.129-32.129c3.897-3.899,3.897-10.243-0.001-14.142l-11.125-11.125c-1.885-1.885-4.396-2.922-7.071-2.922   c-2.675,0-5.187,1.038-7.07,2.923l-32.128,32.128l-18.256-18.256c-1.885-1.885-4.396-2.922-7.071-2.922   c-2.675,0-5.186,1.038-7.07,2.922L66.95,171.062c-3.899,3.899-3.899,10.243,0,14.143l3.802,3.802   c-1.596,1.086-3.103,2.325-4.496,3.718l-46.679,46.679c-5.836,5.835-9.049,13.62-9.049,21.92c0,8.301,3.214,16.086,9.049,21.92   l17.943,17.943L5.126,333.582c-6.835,6.835-6.835,17.915,0,24.749c3.417,3.417,7.896,5.125,12.374,5.125s8.957-1.708,12.374-5.125   l32.395-32.395l18.091,18.091c5.834,5.835,13.619,9.048,21.92,9.048s16.086-3.213,21.92-9.048l46.679-46.679   c1.394-1.393,2.633-2.901,3.719-4.497l3.802,3.802c1.885,1.885,4.396,2.923,7.07,2.923c2.675,0,5.186-1.038,7.072-2.923   l16.04-16.042c1.887-1.885,2.925-4.396,2.925-7.072c0-2.676-1.038-5.187-2.924-7.071l-18.255-18.255l32.129-32.129   c3.898-3.899,3.898-10.244-0.001-14.142L211.331,190.817z"}},{tag:"path",attributes:{d:"M358.33,5.126c-6.834-6.834-17.914-6.834-24.748,0l-32.686,32.686l-17.944-17.944c-5.834-5.835-13.619-9.048-21.92-9.048   c-8.301,0-16.086,3.213-21.92,9.048l-46.679,46.679c-1.393,1.393-2.632,2.9-3.719,4.497l-3.802-3.802   c-1.885-1.885-4.396-2.923-7.071-2.923c-2.675,0-5.187,1.038-7.071,2.923l-16.042,16.042c-1.886,1.885-2.924,4.396-2.924,7.072   c0,2.675,1.038,5.187,2.924,7.071l111.447,111.448c1.885,1.885,4.396,2.923,7.071,2.923c2.676,0,5.186-1.038,7.071-2.923   l16.043-16.043c3.899-3.899,3.899-10.243,0-14.142l-3.801-3.801c1.596-1.086,3.103-2.325,4.496-3.719l46.679-46.679   c5.835-5.834,9.049-13.62,9.049-21.92s-3.213-16.086-9.049-21.92l-18.09-18.09l32.686-32.686   C365.165,23.04,365.165,11.96,358.33,5.126z"}}]};function u(e){if(!e.data.adaptor){let t={tag:"g",attributes:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},children:{connection:{tag:"path",class:"connection-path",attributes:{d:`M${e.x1},${e.y1} C${.5*(e.x1+e.x2)},${e.y1} ${.5*(e.x1+e.x2)},${e.y2} ${e.x2},${e.y2}`}}}};return(0,n.createHTMLElement)({data:t,namespace:"svg"})}let t=Math.pow((e.x2-e.x1)*(e.x2-e.x1)+(e.y2-e.y1)*(e.y2-e.y1),.5),o=(e.x1-e.x2)/t,s=(e.y1-e.y2)/t,i=(2*Number(e.y2<e.y1)-1)*Math.acos((e.x1-e.x2)/t)*180/3.14,a=e.x1-50*o,r=e.y1-50*s,l=c;l.attributes={transform:`translate(${-(e.x2-e.x1)/2-50*o},${-(e.y2-e.y1)/2-50*s} ) rotate(${i+45})  translate(-0,-36) scale(0.1)`};let d={tag:"g",attributes:{x1:a,y1:r,x2:e.x2,y2:e.y2},children:{connection:{tag:"path",class:"connection-path",attributes:{d:`M${e.x2},${e.y2} C${.5*(a+e.x2)},${e.y2} ${.5*(a+e.x2)},${.5*(r+e.y2)} ${a},${r}`,x1:a,y1:r,x2:e.x2,y2:e.y2}},adaptor:l}};return(0,n.createHTMLElement)({data:d,namespace:"svg"})}function p(e){return e.connectionId}function m(e,t,o){let n=t[e];if(n)return n;let s=o.getParentGroup(e);return s?t[s.moduleId]:void 0}function h(e,t,o,s){let i=o.getAttribute("slotId")||o.getAttribute("slotid"),a=e.getSlot(i);if(a)return a;if(e instanceof n.GroupModules.Module&&i){let n=o.getAttribute("moduleId")||o.getAttribute("moduleid");return e.getAllChildren(t).find((e=>e.moduleId==n)).getSlot(i)}return console.warn("The builder plot should define the attribute 'slotId' of the slots elements",o),a="input"===s?e.inputSlots.find((e=>o.id==="input-slot_"+e.slotId+"_"+e.moduleId)):e.outputSlots.find((e=>o.id==="output-slot_"+e.slotId+"_"+e.moduleId)),a}function g(e,t){let o=e.parentElement,n=t.getModuleOrPlugin(o.getAttribute("moduleId")||o.getAttribute("id"));return n||(o=o.parentElement,n=t.getModuleOrPlugin(o.getAttribute("moduleId")||o.getAttribute("id"))),[n,o]}class f{constructor(e,t,o,n,s,i,a){this.mdle=e,this.workflow=t,this.domModuleElement=o,this.domPlugElement=n,this.plugType=s,this.isDrawing=i,this.isStarted=a,this.xOrigin=void 0,this.yOrigin=void 0,this.slot=void 0,this.xOrigin=Number(o.getAttribute("x"))+Number(n.getAttribute("cx")),this.yOrigin=Number(o.getAttribute("y"))+Number(n.getAttribute("cy")),this.slot=h(e,t,n,s)}}class w{constructor(e,t,o,c){this.drawingArea=e,this.plottersObservables=t,this.appObservables=o,this.appStore=c,this.debugSingleton=s.ST.getInstance(),this.connectionPlots=void 0,this.drawingConnection=void 0,this.connectionCreationEnabled=!0;let w=new i.Subject;this.connectUserInteractions(w),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create connections plotter",object:{drawingArea:e,plottersObservables:t}}),(0,i.combineLatest)(this.appObservables.connectionsUpdated$,this.plottersObservables.modulesDrawn$).subscribe((([e,t])=>{this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"connections updated",object:{connections:e,modulesGroup:t}}),function(e,t,o,n,s){let i=e.map((e=>function(e,t,o){let n=o.project.builderRendering.connectionsView.find((t=>t.connectionId==e.connectionId));return new l(p(e),["connection","mdle-color-stroke",(0,r.toCssName)(o.getModule(e.start.moduleId).Factory.uid)].concat(n&&n.wireless?["wireless"]:[]),m(e.end.moduleId,t,o),m(e.start.moduleId,t,o),e,e.adaptor)}(e,t,s))),a=new r.LinkPlot({plotId:"connectionsPlot",plotClasses:[],drawingArea:o,orderIndex:3});a.defaultElementDisplay=u,a.draw(i),a.entities$.subscribe((e=>n.next(e))),function(e,t){let o=e.svgCanvas.node().querySelectorAll(".wireless"),n=e.drawingGroup.node(),s=n.querySelector("#wireless-slots");s&&s.remove(),s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.id="wireless-slots",n.appendChild(s),o.forEach((e=>{let o=o=>{o.stopPropagation(),t.selectConnection(t.getConnection(e.id))},n=Number(e.getAttribute("x1")),i=Number(e.getAttribute("y1")),a=Number(e.getAttribute("x2")),r=Number(e.getAttribute("y2"));const l=document.createElementNS("http://www.w3.org/2000/svg","g"),c=document.createElementNS("http://www.w3.org/2000/svg","g");l.setAttribute("transform",e.getAttribute("transform")),c.setAttribute("transform",e.getAttribute("transform")),l.innerHTML=`<line class='' x1="${n}" y1="${i}" x2="${Number(n)-50}" y2="${i}"></line><g transform="translate(${n-50-50},${i-25}) scale(0.1)" > ${d}</g>`,c.innerHTML=`<line class='' x1="${a}" y1="${r}" x2="${a+50}" y2="${r}"></line><g transform="translate(${a+50},${r-25}) scale(0.1)" > ${d}</g>`,l.onclick=o,c.onclick=o,s.appendChild(l),s.appendChild(c)}))}(o,s)}(c.project.workflow.connections,t,this.drawingArea,w,c),this.plottersObservables.connectionsDrawn$.next()}));let b=(e,t)=>{e.pipe(a.filter((e=>null==this.drawingConnection&&this.connectionCreationEnabled))).subscribe((e=>{let[o,n]=g(e.event.target,c);this.drawingConnection=new f(o,c.project.workflow,n,e.event.target,t,!0,!1)}))},x=(e,t)=>{e.pipe(a.filter((e=>null!=this.drawingConnection&&this.drawingConnection.plugType==("input"==t?"output":"input")))).subscribe((e=>{let[o,s]=g(e.event.target,c),i="input"==t?new n.Connection(this.drawingConnection.slot,h(o,c.project.workflow,e.event.target,"input")):new n.Connection(h(o,c.project.workflow,e.event.target,"output"),this.drawingConnection.slot);this.appStore.addConnection(i),this.connectionCreationEnabled=!1,setTimeout((()=>this.connectionCreationEnabled=!0),500)}))};b(this.plottersObservables.plugInputClicked$,"input"),b(this.plottersObservables.plugOutputClicked$,"output"),x(this.plottersObservables.plugInputClicked$,"input"),x(this.plottersObservables.plugOutputClicked$,"output"),this.plottersObservables.mouseMoved$.pipe(a.filter((e=>void 0!==this.drawingConnection))).subscribe((e=>this.plotDrawingConnection(this.drawingConnection,e))),this.appObservables.connectionSelected$.subscribe((e=>document.getElementById(p(e)).classList.toggle("selected"))),this.appObservables.unselect$.subscribe((()=>{let e=document.getElementById("drawing-connection");e&&e.remove(),this.drawingConnection=void 0}))}plotDrawingConnection(e,t){e.isStarted=!0;let o=[(t[0]-1-this.drawingArea.overallTranform.translateX)/this.drawingArea.overallTranform.scale,(t[1]-1-this.drawingArea.overallTranform.translateY)/this.drawingArea.overallTranform.scale],n=this.drawingArea.drawingGroup.selectAll(".drawing-connection").data([{data:e.data,htmlPlug:e.domElement}]);n.exit().remove(),n.attr("x2",o[0]),n.attr("y2",o[1]),n.enter().append("line").attr("id","drawing-connection").attr("class","drawing-connection").attr("x1",e.xOrigin).attr("y1",e.yOrigin).attr("x2",o[0]).attr("y2",o[1])}connectUserInteractions(e){e.pipe(a.filter((e=>"click"===e.action))).subscribe((e=>this.appStore.selectConnection(e.data.data)))}}var b=o(137),x=o(578),v=o(979);function y(e,t,o){let n=(new e.Factory.BuilderView).render(e);n.onclick=t=>{t.stopPropagation(),o.selectModule(e.moduleId)};let s=t.querySelector("#"+e.moduleId);s&&s.remove(),n.id=e.moduleId,n.classList.add("module","plugin");let i=0,a=50;t.getBBox&&(i=t.getBBox().height-t.querySelector(".content").getBBox().height/2),t.appendChild(n),n.getBBox&&(a=n.getBBox().height/2);let r=i+a;return n.setAttribute("x",t.getAttribute("x")),n.setAttribute("y",Number(t.getAttribute("y"))+r),n.setAttribute("transform","translate(0,"+r+")"),n}class I{constructor(e,t,o,n){this.drawingArea=e,this.plottersObservables=t,this.appObservables=o,this.appStore=n,this.debugSingleton=s.ST.getInstance(),this.groups={},this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create plugins plotter",object:{drawingArea:e,plottersObservables:t}})}draw(e){Object.values(this.groups).forEach((e=>e.remove()));let t=this.appStore.project.workflow.plugins.filter((t=>e[t.parentModule.moduleId])).map((t=>[t,e[t.parentModule.moduleId]]));return this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"PluginsPlotter draw",object:{modulesDrawn:e,plugins:this.appStore.project.workflow.plugins,plugInsToPlot:t}}),this.groups=t.map((([e,t])=>[e.moduleId,y(e,t,this.appStore)])).reduce(((e,t)=>(e[t[0]]=t[1],e)),{}),this.groups}}function S(e,t,o){let n=e.map((e=>document.getElementById(e))).filter((e=>e)).map((e=>e.getBBox?function(e,t,o){var n=document.getElementById(o.svgCanvas.attr("id")).getBoundingClientRect();let s=o.overallTranform;return{xmin:(t.a*e.x+t.c*e.y+t.e-n.left-s.translateX)/s.scale,ymin:(t.b*e.x+t.d*e.y+t.f-n.top-s.translateY)/s.scale,xmax:(t.a*(e.x+e.width)+t.c*(e.y+e.height)+t.e-n.left-s.translateX)/s.scale,ymax:(t.b*(e.x+e.width)+t.d*(e.y+e.height)+t.f-n.top-s.translateY)/s.scale}}(e.getBBox(),e.getScreenCTM(),o):{xmin:e.getAttribute("x"),xmax:e.getAttribute("x"),ymin:e.getAttribute("y"),ymax:e.getAttribute("y")})).reduce(((e,t)=>({xmin:Math.min(e.xmin,t.xmin),xmax:Math.max(e.xmax,t.xmax),ymin:Math.min(e.ymin,t.ymin),ymax:Math.max(e.ymax,t.ymax)})),{xmin:1e6,xmax:-1e6,ymin:1e6,ymax:1e-6});return{x:n.xmin-t,y:n.ymin-t,width:n.xmax-n.xmin+2*t,height:n.ymax-n.ymin+2*t}}class j{constructor(e,t,o,a){this.drawingArea=e,this.plottersObservables=t,this.appObservables=o,this.appStore=a,this.plotsFactory={},this.debugSingleton=s.ST.getInstance(),this.modulePlots=[],this.previousActiveSeriesId=[],this.dragging=!1,this.dragTranslation=[0,0];let l=new i.Subject;this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create modules plotter",object:{drawingArea:e,plottersObservables:t}}),new r.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:e,entities:[]}).draw([]),this.pluginsPlotter=new I(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),(0,i.combineLatest)([o.packagesLoaded$,this.plottersObservables.modulesViewUpdated$]).subscribe((()=>{let{modulesDrawn:e,activeSeries:t}=function(e,t,o){let n,s=[],a=t.getDisplayedModulesView();if(t.activeGroupId!=t.rootComponentId&&a.currentLayer.modulesView.length>0){let e=function(e){let t=e.modulesView.map((e=>[e.xWorld,e.yWorld])),o=t.reduce(((e,t)=>e<t[0]?e:t[0]),1e10),n=t.reduce(((e,t)=>e>t[0]?e:t[0]),-1e10),s=t.reduce(((e,t)=>e<t[1]?e:t[1]),1e10);return[(n+o)/2,(t.reduce(((e,t)=>e>t[1]?e:t[1]),-1e10)+s)/2]}(a.currentLayer),t=function(e){let t=e.modulesView.map((e=>[e.xWorld,e.yWorld])),o=t.reduce(((e,t)=>e<t[0]?e:t[0]),1e10),n=t.reduce(((e,t)=>e>t[0]?e:t[0]),-1e10),s=t.reduce(((e,t)=>e<t[1]?e:t[1]),1e10);return[(n-o)/2,(t.reduce(((e,t)=>e>t[1]?e:t[1]),-1e10)-s)/2]}(a.currentLayer),o=a.parentLayer.currentGroupModuleView;n=(n,s)=>{let i=Math.pow((n-o.xWorld)*(n-o.xWorld)+(s-o.yWorld)*(s-o.yWorld),.5),a=(n-o.xWorld)/i,r=(s-o.yWorld)/i,l=(i+t[0])*a+a/Math.abs(a)*50,d=(i+t[1])*r+r/Math.abs(r)*75;return[e[0]+l,e[1]+d]}}let l=e=>({x:e.xWorld,y:e.yWorld,classes:["module"].concat(t.isSelected(e.moduleId)?["selected"]:[]),attributes:{moduleId:e.moduleId},id:e.moduleId,Factory:e.Factory,data:{module:t.getModule(e.moduleId),moduleView:e}}),d=a.currentLayer.modulesView.map(l),c=a.parentLayer.modulesView.map((e=>Object.assign({},l(e),{projection:n}))),u=b.groupBy([...d,...c],(e=>e.Factory.uid)),p={},m=[],h=e=>{e.filter((e=>e)).forEach((e=>{if(e.id.includes("group")){let o=t.getModule(e.id);o.inputSlots.map((e=>e.moduleId)).concat(o.outputSlots.map((e=>e.moduleId))).forEach((t=>{p[t]=e}))}p[e.id]=e}))};return Object.entries(u).map((([t,n])=>{let a=function(e,t){let o=e.Factory,n=new o.BuilderView,s=new i.Subject,a=(0,r.toCssName)(o.uid)+"_ModulesPlot",l=new r.CrossPlot({plotId:a,plotClasses:[a,o.packId],drawingArea:t,entities$:s});return l.defaultElementDisplay=e=>n.render(e.data.module),l}(n[0],e);m.push(a.plotId),s.push(a);let l=a.draw(n);return l.entered._groups.forEach((e=>h(e))),l.updated._groups.forEach((e=>h(e))),a.entities$.subscribe((e=>{o.next(e)})),a})),{modulesDrawn:p,activeSeries:m}}(this.drawingArea,this.appStore,l),o=this.pluginsPlotter.draw(e),s=function(e,t,o){if(!e||e===o.rootComponentId)return new r.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:t,entities:[]}).draw([]),{};let s=o.getGroup(e),i=o.project.workflow.modules.find((e=>e instanceof n.GroupModules.Module&&e.moduleId==s.moduleId));const a=o.getDisplayedModulesView(),l=a.currentLayer.modulesView.map((e=>e.moduleId));let d=l.length>0?S(l,50,t):{x:t.hScale(a.parentLayer.currentGroupModuleView.xWorld),y:t.vScale(a.parentLayer.currentGroupModuleView.yWorld),width:200,height:200},c=t.hScale.invert(d.x+d.width/2),u=t.vScale.invert(d.y+d.height/2),p=[{id:"expanded_"+i.moduleId,x:c,y:u,classes:["active-layer-box"],attributes:{layerId:e},data:{boundingBox:d}}],m=new r.CrossPlot({plotId:"activeLayerPlotter",plotClasses:[],drawingArea:t,entities:p});m.defaultElementDisplay=n.GroupModules.expandedGroupPlot(i);let h=m.draw(p),g=h.entered._groups.concat(h.updated._groups).reduce(((e,t)=>e.concat(t)),[]).filter((e=>e));return{[i.moduleId]:g[0]}}(this.appStore.activeGroupId,this.drawingArea,this.appStore);this.connectUserInteractions(Object.assign({},e,s)),this.emptyRemovedSeries(this.previousActiveSeriesId,t),this.previousActiveSeriesId=t,this.plottersObservables.modulesDrawn$.next({...e,...o,...s})})),this.appObservables.moduleSelected$.subscribe((e=>{let t=document.getElementById(e.moduleId);t&&!t.classList.contains("selected")&&t.classList.add("selected")})),this.appObservables.modulesUnselected$.subscribe((e=>{e.forEach((e=>{let t=document.getElementById(e.moduleId);t&&t.classList.contains("selected")&&t.classList.remove("selected")}))})),o.unselect$.subscribe((()=>{this.unselect()}))}highlight(e){e.map((e=>document.getElementById(e))).forEach((e=>{e&&e.classList.add("highlighted")}))}unselect(){let e=document.getElementsByClassName("selected");for(;e.length>0;)e[0].classList.remove("selected"),e=document.getElementsByClassName("selected");for(e=document.getElementsByClassName("highlighted");e.length>0;)e[0].classList.remove("highlighted"),e=document.getElementsByClassName("highlighted")}connectUserInteractions(e){Object.entries(e).forEach((([e,t])=>{let o=o=>{o.target.classList.contains("slot")?o.target.classList.contains("output")?this.plottersObservables.plugOutputClicked$.next({event:o,group:t,moduleId:e}):this.plottersObservables.plugInputClicked$.next({event:o,group:t,moduleId:e}):(o.stopPropagation(),this.appStore.selectModule(e))};if(t.onclick=o,t.onmousedown=o,!this.appStore.project.workflow.plugins.map((e=>e.moduleId)).includes(e)&&!t.classList.contains("active-layer-box")){var n=(0,x.Z)();n.on("start",(e=>{this.dragSelection(e,!1)})).on("drag",(e=>this.dragSelection(e,!1))).on("end",(e=>this.dragSelection(e,!0))),(0,v.Z)(t).call(n)}}))}emptyRemovedSeries(e,t){e.filter((e=>!t.includes(e))).forEach((e=>document.querySelector("g#"+e).remove()))}dragSelection(e,t){this.dragging=!0;let o=this.appStore.getModulesSelected().filter((e=>this.appStore.getActiveGroup().getModuleIds().includes(e.moduleId)||e.layerId)),n=[];return o.forEach((o=>{let s=document.getElementById(o.moduleId),i=s.querySelectorAll("g.plugin"),a=Number(s.getAttribute("x"))+e.dx,r=Number(s.getAttribute("y"))+e.dy;Array.from(i).forEach((t=>{t.setAttribute("x",Number(t.getAttribute("x"))+e.dx),t.setAttribute("y",Number(t.getAttribute("y"))+e.dy)})),this.dragTranslation[0]+=e.dx,this.dragTranslation[1]-=e.dy,s.setAttribute("x",a),s.setAttribute("y",r),s.style.transform="translate("+a+"px,"+r+"px)",s.setAttribute("transform","translate("+a+","+r+")"),t&&(n.push({moduleId:o.moduleId,x:this.drawingArea.hScale.invert(a),y:this.drawingArea.vScale.invert(r),translation:this.dragTranslation}),s.style.transform="")})),t&&(this.appStore.moveModules(n),this.dragging=!1,this.dragTranslation=[0,0]),n}}class k{constructor(e,t,o,n,i){this.drawingArea=e,this.plottersObservables=t,this.appObservables=o,this.appStore=n,this.modulesPlotter=i,this.debugSingleton=s.ST.getInstance(),this.start=void 0,this.rect=void 0}startSelection(e){e=this.convert(e),this.rect=this.drawingArea.drawingGroup.append("rect").attr("class","rectangle-selector").attr("x",e[0]).attr("y",e[1]).attr("height",0).attr("width",0),this.start=e}finishSelection(e){this.start=void 0;let t=k.getSelectedModules(this.appStore.getActiveModulesView(),this.drawingArea,this.rect);S(t,10,this.drawingArea),this.rect.remove(),this.appStore.select({modulesId:t,connectionsId:[]})}moveTo(e){if(!this.start)return;e=this.convert(e),this.rect.attr("width",Math.max(0,e[0]-+this.rect.attr("x"))).attr("height",Math.max(0,e[1]-+this.rect.attr("y")));let t=k.getSelectedModules(this.appStore.getActiveModulesView(),this.drawingArea,this.rect);this.modulesPlotter.highlight(t)}static getSelectedModules(e,t,o){let n=e.map((e=>[e.moduleId,t.hScale(e.xWorld),t.vScale(e.yWorld)])),s=Number(o.attr("x")),i=Number(o.attr("y")),a=s+Number(o.attr("width")),r=i+Number(o.attr("height"));return n.filter((([e,t,o])=>t>s&&t<a&&o>i&&o<r)).map((([e,t,o])=>e))}convert([e,t]){let o=this.drawingArea.overallTranform;return[(e-o.translateX)/o.scale,(t-o.translateY)/o.scale]}}function $(e,t,o){let n=e.map((e=>{let n=S(e.modulesId,10,t),s=t.hScale.invert(n.x+n.width/2),i=t.vScale.invert(n.y+n.height/2),a=o.descriptionBoxSelected&&o.descriptionBoxSelected.descriptionBoxId==e.descriptionBoxId;return{x:s,y:i,classes:["description-box"].concat(a?["selected"]:[]),attributes:{descriptionBoxId:e.descriptionBoxId},id:e.descriptionBoxId,data:{descriptionBox:e,boundingBox:n}}})),s=new r.CrossPlot({plotId:"descriptionsBoxPlotter",plotClasses:[],drawingArea:t,entities:n});s.defaultElementDisplay=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","g");let o=e.data.boundingBox.width,n=e.data.boundingBox.height;return t.innerHTML=`\n       <rect height="${n}" width="${o}" \n        class="description-box content"  x="${-o/2}" y="${-n/2}"\n        filter="url(#shadow)" ></rect>\n        <path d="M${-o/2},${0-n/2} v-15 q0,-10 10,-10 h${o-20} q10,0 10,10  v15 z" \n                class="description-box mdle-color-fill header " />\n        <path d="M${-o/2},${0-n/2} v-15 q0,-10 10,-10 h${o-20} q10,0 10,10  v15 " \n                class="description-box header outline" />\n\n        <text class="description-box title" x="${-o/2+10}" y="${-n/2-5}" >${e.data.descriptionBox.title}</text>\n        `,t};let i=s.draw(n);return i.entered._groups.concat(i.updated._groups).map((e=>e.filter((e=>e)).reduce(((e,t)=>e.concat(t)),[]))).reduce(((e,t)=>e.concat(t)),[])}class C{constructor(e,t,o,n){this.drawingArea=e,this.plottersObservables=t,this.appObservables=o,this.appStore=n,this.debugSingleton=s.ST.getInstance(),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create descriptions boxes plotter",object:{drawingArea:e,plottersObservables:t}}),$([],this.drawingArea,this.appStore),this.appObservables.descriptionsBoxesUpdated$.subscribe((e=>{let t=$(e,this.drawingArea,this.appStore);this.connectUserInteractions(t),this.plottersObservables.descriptionsBoxesDrawn$.next(t)}))}connectUserInteractions(e){e.forEach((e=>e.onclick=t=>this.appStore.selectDescriptionBox(e.id)))}}class M{static initialize(e){M.workflowPlotter=e}}class O{constructor(e,t,o,i,r={margin:50}){this.drawingArea=e,this.appObservables=t,this.plottersObservables=o,this.appStore=i,this.options=r,this.debugSingleton=s.ST.getInstance(),this.modulesPlotter=void 0,this.connectionsPlotters=void 0,this.boxSelectorPlotter=void 0,this.descriptionsBoxesPlotter=void 0,this.pluginsPlotter=void 0,this.descriptionsBoxesPlotter=new C(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.modulesPlotter=new j(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.connectionsPlotters=new w(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore),this.boxSelectorPlotter=new k(this.drawingArea,this.plottersObservables,this.appObservables,this.appStore,this.modulesPlotter),function(e,t,o){(function(e,t){return e.pipe((0,a.filter)((({fromLayerId:e,toLayerId:t})=>null!=e&&null!=t)),(0,a.map)((({fromLayerId:e,toLayerId:o})=>({fromLayer:t.getGroup(e),toLayer:t.getGroup(o)}))),(0,a.map)((({fromLayer:e,toLayer:o})=>{if(e.getAllChildren(t.project.workflow).includes(o))return document.getElementById("expanded_"+o.moduleId);if(o.getAllChildren(t.project.workflow).includes(e)){let s=o.getDirectChildren(t.project.workflow).find((t=>t instanceof n.GroupModules.Module&&(t==e||t.getModuleIds().includes(e.moduleId))));return document.getElementById(s.moduleId)}return document.getElementById("expanded_"+o.moduleId)})),(0,a.map)((e=>{let t=e.getBoundingClientRect();return[.5*(t.left+t.right),.5*(t.top+t.bottom)]})))})(e,t).subscribe((e=>o.lookAt(e[0],e[1])))}(this.appObservables.activeLayerUpdated$,this.appStore,this.drawingArea),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView({level:s.in.Info,message:"create WorkflowPlotter",object:{drawingArea:this.drawingArea,modulePlotter:this.modulesPlotter,connectionsPlotters:this.connectionsPlotters}}),this.appObservables.activeLayerUpdated$.subscribe((t=>{t.toLayerId!=i.rootComponentId?e.svgCanvas.select(".workspace-background").attr("class","workspace-background child-layer"):e.svgCanvas.select(".workspace-background").attr("class","workspace-background")}));let l=this.plottersObservables,d=this.boxSelectorPlotter,c=document.querySelector("svg"),u=e=>[e.offsetX||e.clientX,e.offsetY||e.clientY];c.onmousedown=e=>{d.startSelection(u(e))},c.onmousemove=e=>{e.ctrlKey?d.moveTo(u(e)):l.mouseMoved$.next(u(e))},c.onmouseup=e=>{e.ctrlKey&&d.finishSelection(u(e))},c.onclick=e=>{e.ctrlKey||i.unselect()},window.onkeydown=e=>{"Delete"==e.key&&"BODY"==document.activeElement.tagName&&this.appStore.deleteSelected()},this.loadExtensions()}loadExtensions(){n.FluxExtensionAPIs&&(M.initialize(this),n.FluxExtensionAPIs.registerAPI("BuilderRenderingAPI",M))}}},94:(e,t,o)=>{"use strict";var n;o.d(t,{Dw:()=>d,ST:()=>a,dk:()=>k,in:()=>n,CE:()=>j}),function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Error=2]="Error"}(n||(n={}));class s{constructor(e,t,o,n){this.topic=e,this.message=t,this.object=o,this.level=n,this.hours=0,this.minutes=0,this.seconds=0,this.miniseconds=0,this.date=new Date}}class i{log(e){e.level!=n.Info&&e.level!=n.Debug||console.log("#"+e.topic,{date:e.date.getHours()+"h"+e.date.getMinutes()+"mn"+e.date.getSeconds()+"s"+e.date.getMilliseconds(),level:e.level,message:e.message,object:e.object}),e.level==n.Error&&console.error("#"+e.topic,{date:e.date.getHours()+"h"+e.date.getMinutes()+"mn"+e.date.getSeconds()+"s"+e.date.getMilliseconds(),level:e.level,message:e.message,object:e.object})}}class a{constructor({WorkflowBuilder:e,workflowView:t,observable:o,UI:s,renderTopicLevel:a}){this.debugOn=!0,this.WorkflowBuilderEnabled=!0,this.WorkflowBuilderLevel=n.Info,this.workflowViewEnabled=!0,this.workflowViewLevel=n.Info,this.workflowView$Enabled=!0,this.workflowView$Level=n.Info,this.observableEnabled=!0,this.observableLevel=n.Info,this.renderTopicEnabled=!0,this.renderTopicLevel=n.Info,this.appTopicEnabled=!0,this.appTopicLevel=n.Info,this.workflowUIEnabled=!0,this.loger=new i,this.WorkflowBuilderLevel=e,this.observableLevel=o,this.renderTopicLevel=a}logWorkflowBuilder({level:e,message:t,object:o}){this.WorkflowBuilderEnabled&&e>=this.WorkflowBuilderLevel&&this.loger.log(new s("WorkflowBuilder",t,o,e))}logObservable({level:e,message:t,object:o}){this.observableEnabled&&e>=this.observableLevel&&this.loger.log(new s("Observables",t,o,e))}logWorkflowView({level:e,message:t,object:o}){this.workflowViewEnabled&&e>=this.workflowViewLevel&&this.loger.log(new s("WorkflowView",t,o,e))}logWorkflowView$({level:e,message:t,object:o}){this.workflowView$Enabled&&e>=this.workflowView$Level&&this.loger.log(new s("WorkflowView Observables",t,o,e))}logRenderTopic({level:e,message:t,object:o}){this.renderTopicEnabled&&e>=this.renderTopicLevel&&this.loger.log(new s("Render",t,o,e))}logAppTopic({level:e,message:t,object:o}){this.appTopicEnabled&&e>=this.appTopicLevel&&this.loger.log(new s("App",t,o,e))}static getInstance(){return a.instance||(a.instance=new a({WorkflowBuilder:n.Info,workflowView:n.Info,UI:n.Info,observable:n.Info,renderTopicLevel:n.Info,appTopicLevel:n.Info})),a.instance}}a.instance=void 0;var r=o(158);class l{constructor(){this.debugSingleton=a.getInstance(),this.projectUpdated$=new r.ReplaySubject(1),this.packagesObserver$=new r.ReplaySubject(1),this.packagesLoaded$=new r.ReplaySubject(1),this.uiStateUpdated$=new r.ReplaySubject(1),this.packagesUpdated$=new r.Subject,this.connectionsUpdated$=new r.Subject,this.modulesUpdated$=new r.Subject,this.moduleAdded$=new r.Subject,this.moduleSelected$=new r.Subject,this.modulesUnselected$=new r.Subject,this.moduleSettingsEdited$=new r.Subject,this.adaptorEdited$=new r.Subject,this.connectionSelected$=new r.Subject,this.unselect$=new r.Subject,this.renderingLoaded$=new r.Subject,this.cssUpdated$=new r.Subject,this.descriptionsBoxesUpdated$=new r.Subject,this.activeLayerUpdated$=new r.Subject,this.ready$=new r.ReplaySubject(1),this.flowReady$=new r.Subject,this.suggestions$=new r.Subject,this.notifications$=new r.Subject,this.debugSingleton.debugOn&&["projectUpdated$","packagesObserver$","packagesLoaded$","packagesUpdated$","connectionsUpdated$","unselect$","moduleSelected$","modulesUnselected$","moduleSettingsEdited$","connectionSelected$","renderingLoaded$","moduleAdded$","cssUpdated$","uiStateUpdated$","descriptionsBoxesUpdated$","activeLayerUpdated$","ready$","flowReady$","suggestions$","modulesUpdated$","notifications$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return l.instance||(l.instance=new l),l.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logObservable({level:n.Info,message:e,object:{args:t}})}}l.instance=void 0;class d{constructor(){this.debugSingleton=a.getInstance(),this.connectionsView$=new r.Subject,this.modulesViewUpdated$=new r.Subject,this.moduleViewSelected$=new r.Subject,this.modulesDrawn$=new r.ReplaySubject(1),this.connectionsDrawn$=new r.ReplaySubject(1),this.descriptionsBoxesDrawn$=new r.ReplaySubject(1),this.activeLayerDrawn$=new r.ReplaySubject(1),this.modulesViewCompleted$=new r.Subject,this.plugsViewCompleted$=new r.Subject,this.connectionsViewCompleted$=new r.Subject,this.moduleEvent$=new r.Subject,this.moduleSelected$=new r.Subject,this.plugInputClicked$=new r.Subject,this.plugOutputClicked$=new r.Subject,this.mouseMoved$=new r.Subject,this.notification$=new r.ReplaySubject(1),this.debugSingleton.debugOn&&["modulesViewUpdated$","moduleViewSelected$","moduleSelected$","moduleEvent$","modulesDrawn$","descriptionsBoxesDrawn$","activeLayerDrawn$","notification$","connectionsDrawn$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return d.instance||(d.instance=new d),d.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowView$({level:n.Info,message:e,object:{args:t}})}}d.instance=void 0;var c=o(935);class u extends c.ExtensionsObservables{constructor(){super(),this.debugSingleton=a.getInstance(),this.debugSingleton.debugOn&&["projectUpdated$"].forEach((e=>this[e].subscribe(((...t)=>this.log(e,...t)))))}static getInstance(){return u.instance||(u.instance=new u),u.instance}log(e,...t){this.debugSingleton.debugOn&&this.debugSingleton.logObservable({level:n.Info,message:e,object:{args:t}})}}u.instance=void 0;var p=o(519);function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function h(e,t,o,n){if(o.moduleId===n)return[o,t];let s,i=o.getDirectChildren(e).filter((e=>e instanceof c.GroupModules.Module));for(let t of i){let i=h(e,o,t,n);if(i){s=i;break}}return s}function g(e,t,o,s,i,r,l,d){let u=a.getInstance();u.debugOn&&u.logWorkflowBuilder({level:n.Info,message:"createLayer",object:{modules:t,title:e}});let p=t.map((e=>e.moduleId)),m=new i.Module({moduleId:i.id.replace("@","_")+"_"+(0,c.uuidv4)(),configuration:new c.ModuleConfiguration({title:e,description:"",data:new i.PersistentData({moduleIds:t.map((e=>e.moduleId))})}),Factory:i,workflow$:l,environment:d}),h=o.workflow.modules.find((e=>e.moduleId==s)),g=f(h,{moduleIds:h.getModuleIds().filter((e=>!p.includes(e))).concat(m.moduleId)}),w=new c.Workflow({modules:o.workflow.modules.filter((e=>e.moduleId!=h.moduleId)).concat(m,g),connections:o.workflow.connections,plugins:o.workflow.plugins}),b=o.builderRendering.modulesView.filter((e=>m.getModuleIds().includes(e.moduleId))),x=b.reduce(((e,t)=>e+t.xWorld),0)/b.length,v=b.reduce(((e,t)=>e+t.yWorld),0)/b.length,y=new c.ModuleView(m.moduleId,x,v,i),I=[...o.builderRendering.modulesView,y];return{project:new c.Project({...o,workflow:w,builderRendering:new c.BuilderRendering(I,o.builderRendering.connectionsView,o.builderRendering.descriptionsBoxes)})}}function f(e,t){let o=new e.Factory.PersistentData({...e.getPersistentData(),...t}),n=new c.ModuleConfiguration({...e.configuration,data:o});return new e.Factory.Module(Object.assign({},e,{configuration:n}))}function w(e,t){return f(e,t)}function b({mdle:e,ready$:t,configuration:o,parent:n,workflow:s}){let i=e.Factory;if(null==o){let t=new i.PersistentData(e.configuration.data);o=new i.Configuration({title:e.configuration.title,description:e.configuration.description,data:t})}return"parentModule"in e?new e.Factory.Module({parentModule:n||e.parentModule,moduleId:e.moduleId,configuration:o,ready$:t,Factory:i,cache:e.cache,environment:e.environment}):new e.Factory.Module(Object.assign({},e,{workflow:s,configuration:o,ready$:t,Factory:i}))}function x(e,t){return e.map((e=>[e,t.plugins.find((t=>t.parentModule.moduleId==e.moduleId))])).filter((([e,t])=>null!=t)).map((([e,t])=>new t.Factory.Module({...t,parentModule:e})))}var v,y=o(137);class I{static initialize(e){I.appStore=e}}function S(e,t){let o=t.requirements,n=e.lock.reduce(((e,t)=>({...e,[t.name]:t.version})),{}),s=e.lock.filter((e=>"flux-pack"==e.type)).map((e=>e.name)),i=new c.Requirements(o.fluxComponents,Array.from(s),n,e);return new c.Project({...t,requirements:i})}class j{constructor(e,t,o){this.mode=e,this.rendererEditorsVisible=t,this.isEditing=o}}class k{constructor(e,t,o){this.environment=e,this.appObservables=t,this.appBuildViewObservables=o,this.debugSingleton=a.getInstance(),this.builderViewsActions={configurationUpdated:e=>this.updateModule(e.module,e.configuration)},this.allSubscriptions=new Map,this.projectId=void 0,this.workflow$=new r.ReplaySubject(1),this.rootComponentId="Component_root-component",this.activeGroupId=this.rootComponentId,this.adaptors=[],this.indexHistory=0,this.uiState=new j("combined",!1,!1),this.packages=[],this.implicitModules=[],this.moduleSelected=void 0,this.modulesSelected=[],this.connectionSelected=void 0,this.descriptionBoxSelected=void 0,this.appExtensionsObservables=u.getInstance(),this.environment=e;let s=`<div id='${this.rootComponentId}' class='flux-element flux-component'></div>`;this.project=new c.Project({name:"new project",schemaVersion:"1.0",description:"",requirements:new c.Requirements([],[],{},{}),workflow:new c.Workflow({modules:[new c.Component.Module({workflow$:this.workflow$,staticStorage:{},moduleId:this.rootComponentId,configuration:new c.ModuleConfiguration({title:"root-component",description:"",data:new c.Component.PersistentData({html:s})}),Factory:c.Component,environment:e})],connections:[],plugins:[]}),builderRendering:new c.BuilderRendering([],[],[])}),this.history=new Array(this.project),this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"AppStore constructed",object:{appStore:this}}),c.GroupModules.BuilderView.notifier$.pipe((0,p.filter)((e=>"groupFocused"==e.type))).subscribe((e=>this.selectActiveGroup(e.data))),c.Component.BuilderView.notifier$.pipe((0,p.filter)((e=>"groupFocused"==e.type))).subscribe((e=>this.selectActiveGroup(e.data))),c.GroupModules.BuilderView.notifier$.pipe((0,p.filter)((e=>"closeLayer"==e.type))).subscribe((e=>this.selectActiveGroup(this.getParentGroup(e.data).moduleId))),c.Component.BuilderView.notifier$.pipe((0,p.filter)((e=>"closeLayer"==e.type))).subscribe((e=>this.selectActiveGroup(this.getParentGroup(e.data).moduleId))),this.appObservables.renderingLoaded$.next({style:"",layout:"",cssLinks:[]})}static getInstance(e){return k.instance||(k.instance=new k(e,l.getInstance(),d.getInstance())),k.instance}setUiState(e){this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"ui state updated",object:{state:e}}),this.uiState=e,this.appObservables.uiStateUpdated$.next(this.uiState)}loadProject(e,t,o){this.projectId=e;let n=(0,c.loadProjectDependencies$)(t,this.environment,o).pipe((0,p.map)((({project:e,packages:t})=>(0,c.createProject)(e,t,this.workflow$,this.allSubscriptions,this.environment))));this.initializeProject(n)}loadProjectId(e){this.projectId=e;let t=(0,c.loadProjectDatabase$)(e,this.workflow$,this.allSubscriptions,this.environment);this.initializeProject(t)}loadProjectURI(e){this.projectId=void 0;let t=(0,c.loadProjectURI$)(e,this.workflow$,this.allSubscriptions,this.environment);this.initializeProject(t)}initializeProject(e){e.subscribe((({project:e,packages:t})=>{this.appObservables.packagesUpdated$.next(t);let o=e.workflow.modules.find((e=>e.moduleId==this.rootComponentId));this.activeGroupId=o.moduleId,this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"project created",object:{project:this.project}}),this.updateProject(e),this.loadExtensions(),this.appObservables.ready$.next(!0),this.appObservables.packagesLoaded$.next(),this.appObservables.uiStateUpdated$.next(this.uiState);let s=o.getFullHTML(e.workflow),i=o.getFullCSS(e.workflow,{asString:!0});this.appObservables.renderingLoaded$.next({style:i,layout:s,cssLinks:[]}),this.unselect()}))}loadExtensions(){c.FluxExtensionAPIs&&(I.initialize(this),c.FluxExtensionAPIs.registerAPI("BuilderState",I))}addLibraries$(e,t){return function(e,t,o,n){let s=o.requirements.libraries;e.filter((e=>null!=s[e.name]&&s[e.name]!=e.version)).length>0&&console.error("You can not dynamically add libraries that are already used with different version");let i=e.filter((e=>null==s[e.name])).reduce(((e,t)=>({...e,[t.name]:t.version})),{}),a=o.requirements.fluxPacks;Array.from(new Set(t.map((e=>e.name)))).filter((e=>!a.includes(e))).filter((e=>(console.log(e,window[e]),window[e]&&(window[e].install||window[e].pack.install)))).forEach((e=>{let t=(window[e].install||window[e].pack.install)(n);t instanceof r.Observable&&t.subscribe(),t instanceof Promise&&t.then((()=>{}))}));let l={libraries:{...o.requirements.libraries,...i}};return n.getLoadingGraph(l).pipe((0,p.map)((e=>S(e,o))))}(e,t,this.project,this.environment).pipe((0,p.tap)((e=>{this.updateProject(e)})))}projectSchema$(){return function(e,t){let o=new Set([...e.workflow.modules.map((e=>e.Factory.packId)),...e.workflow.plugins.map((e=>e.Factory.packId))]),n=new Array(...o);if(n.length==e.requirements.fluxPacks.length)return(0,r.of)(e);let s={libraries:Object.entries(e.requirements.libraries).filter((([e,t])=>n.find((t=>e.includes(t))))).reduce(((e,[t,o])=>({...e,[t]:o})),{}),using:e.requirements.libraries};return t.getLoadingGraph(s).pipe((0,p.map)((t=>S(t,e))))}(this.project,this.environment).pipe((0,p.map)((e=>function(e){return{name:e.name,schemaVersion:e.schemaVersion,description:e.description,builderRendering:{descriptionsBoxes:e.builderRendering.descriptionsBoxes.map((e=>({descriptionBoxId:e.descriptionBoxId,descriptionHtml:e.descriptionHtml,modulesId:e.modulesId,title:e.title,properties:{color:e.properties.color}}))),modulesView:e.builderRendering.modulesView.map((e=>({moduleId:e.moduleId,xWorld:e.xWorld,yWorld:e.yWorld}))),connectionsView:e.builderRendering.connectionsView.map((e=>({connectionId:e.connectionId,wireless:e.wireless})))},requirements:e.requirements,workflow:(t=e.workflow,{modules:t.modules.map((e=>({moduleId:e.moduleId,factoryId:{module:e.Factory.id,pack:e.Factory.packId},configuration:{title:e.configuration.title,description:e.configuration.description,data:Object.assign({},e.configuration.data)}}))),connections:t.connections.map((e=>Object.assign({end:{moduleId:e.end.moduleId,slotId:e.end.slotId},start:{moduleId:e.start.moduleId,slotId:e.start.slotId}},e.adaptor?{adaptor:{adaptorId:e.adaptor.adaptorId,mappingFunction:e.adaptor.toString()}}:{}))),plugins:t.plugins.map((e=>({parentModuleId:e.parentModule.moduleId,moduleId:e.moduleId,factoryId:{module:e.Factory.id,pack:e.Factory.packId},configuration:{title:e.configuration.title,description:e.configuration.description,data:Object.assign({},e.configuration.data)}})))}),runnerRendering:{layout:"",style:""}};var t}(e))))}projectURI$(){return this.projectSchema$().pipe((0,p.map)((e=>{return`/ui/flux-builder/?uri=${t=e,encodeURIComponent(JSON.stringify(t))}`;var t})))}saveProject(){this.projectSchema$().pipe((0,p.mergeMap)((e=>this.environment.postProject(this.projectId,e).pipe((0,p.map)((()=>e)))))).subscribe((e=>{this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"project saved",object:{body:e,project:this.project}})}))}getModulesFactory(){return this.packages.map((e=>Object.entries(e.modules).map((([t,o])=>[`${o.id}@${e.id}`,o])))).reduce(((e,t)=>e.concat(t)),[]).reduce(((e,t)=>y.merge(e,{[t[0]]:t[1]})),{})}getAvailablePlugins(e){return function(e,t){let o=[];return Array.from(t.entries()).forEach((([t,n])=>{e.factory&&n.parentModule===e.factory.id&&o.push({factoryId:t,pluginFactory:n})})),o}(e,this.pluginsFactory)}getPlugins(e){return function(e,t){return t.workflow.plugins.filter((t=>t.parentModule.moduleId===e))}(e,this.project)}addPlugin(e,t){let o=function(e,t,o,s,i){let r=a.getInstance(),l=new e.Configuration,d=e.id+"_"+m(),u=new e.Module({parentModule:t,moduleId:d,configuration:l,Factory:e,ready$:s,environment:i});r.debugOn&&r.logWorkflowBuilder({level:n.Info,message:"add plugin",object:{plugin:u,pluginFactory:e}});let p=new c.Workflow({...o.workflow,plugins:o.workflow.plugins.concat([u])});return new c.Project({...o,workflow:p})}(e,t,this.project,this.appObservables.ready$,this.environment);return this.updateProject(o),o.workflow.plugins.slice(-1)[0]}addModule(e,t=[0,0]){let o=function(e,t,o,s,i,r){let l=a.getInstance(),d=new e.Configuration,u=e.id+"_"+m(),p=new e.Module({moduleId:u,configuration:d,Factory:e,ready$:i,environment:r}),h=new c.ModuleView(p.moduleId,t[0],t[1],e),g=o.workflow.modules.find((e=>e.moduleId==s)),f=new g.Factory.PersistentData({...g.getPersistentData(),moduleIds:g.getPersistentData().getModuleIds().concat(u)}),w=new c.ModuleConfiguration({...g.configuration,data:f}),b=new g.Factory.Module(Object.assign({},g,{configuration:w})),x=new c.Workflow({...o.workflow,modules:o.workflow.modules.filter((e=>e.moduleId!=g.moduleId)).concat(p,b),rootLayerTree:void 0}),v=new c.BuilderRendering(o.builderRendering.modulesView.concat(h),o.builderRendering.connectionsView,o.builderRendering.descriptionsBoxes),y=new c.Project({...o,workflow:x,builderRendering:v});return l.debugOn&&l.logWorkflowBuilder({level:n.Info,message:"add module",object:{factory:e,module:p,moduleView:h,project:y}}),y}(e,t,this.project,this.activeGroupId,this.appObservables.ready$,this.environment);this.updateProject(o)}updateModule(e,t,o=!0){let s=function(e,t,o,s,i){let r=a.getInstance(),l=e.Factory,d="parentModule"in e,u=b({mdle:e,ready$:i,configuration:t,workflow:o.workflow});c.GroupModules.Module;let p=e=>{let t=o.workflow.plugins.filter((t=>t.parentModule.moduleId==e.moduleId)),n=t.map((e=>p(e))).filter((e=>e.length>0));if(n.length>0)throw"UPDATE MODULE: IMPLEMENTATION NOT DONE IN CASE OF NESTED PLUGINS";return t.concat(n.reduce(((e,t)=>e.concat(t)),[]))},m=p(e),h=[e.moduleId].concat(m.map((e=>e.moduleId))),g=o.workflow.modules.filter((e=>!h.includes(e.moduleId))),f=o.workflow.plugins.filter((e=>!h.includes(e.moduleId))),w=d?o.workflow.modules:g.concat([u]),x=d?f.concat([u]):f;x=x.concat(m.map((e=>b({mdle:e,ready$:i,parent:u}))));let v=u.inputSlots.map((e=>e.slotId)),y=u.outputSlots.map((e=>e.slotId)),I=o.workflow.connections.filter((e=>!(e.start.moduleId==u.moduleId&&!y.includes(e.start.slotId)||e.end.moduleId==u.moduleId&&!v.includes(e.end.slotId)))),S=new c.Workflow({modules:w,connections:I,plugins:x}),j=new c.Project({...o,workflow:S});return r.debugOn&&r.logWorkflowBuilder({level:n.Info,message:"module updated",object:{factory:l,newModule:u,newConfiguration:t,plugins:m,project:j,newPlugins:x,toRemoveIds:h,newModules:w,otherModules:g,otherPlugins:f}}),j}(e,t,this.project,this.allSubscriptions,this.appObservables.ready$);o&&this.unselect(),this.updateProject(s)}duplicateModules(e){let t=function(e,t,o){let s=a.getInstance(),i=t.workflow,r=e.map((e=>{let t=new e.Factory.Configuration({title:e.configuration.title,description:e.configuration.description,data:_.cloneDeep(e.configuration.data)}),n=e.Factory.id+"_"+m();return new e.Factory.Module({moduleId:n,configuration:t,ready$:o,Factory:e.Factory,environment:e.environment})})),l=t.builderRendering.modulesView.filter((t=>e.map((e=>e.moduleId)).includes(t.moduleId))),d=Math.max(...l.map((e=>e.yWorld))),u=Math.max(...l.map((e=>e.xWorld))),p=e.map(((e,t)=>new c.ModuleView(r[t].moduleId,u+50*(t+1),d+50*(t+1),e.Factory))),h=e.map(((e,o)=>[t.workflow.modules.find((t=>t instanceof c.GroupModules.Module&&t.getModuleIds().includes(e.moduleId))).moduleId,r[o].moduleId])).reduce(((e,[t,o])=>(e[t]=e[t]?e[t].concat(o):[o],e)),{}),g=Object.entries(h).map((([e,o])=>{let n=t.workflow.modules.find((t=>t.moduleId==e)),s=n.getPersistentData();return f(n,{moduleIds:s.getModuleIds().concat(...o)})})),w=new c.BuilderRendering(t.builderRendering.modulesView.concat(p),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes),b=new c.Project({...t,workflow:new c.Workflow({modules:i.modules.filter((e=>!g.map((e=>e.moduleId)).includes(e.moduleId))).concat(...r,...g),connections:i.connections,plugins:i.plugins}),builderRendering:w});return s.debugOn&&s.logWorkflowBuilder({level:n.Info,message:"duplicateModules",object:{modules:e,newModules:r,newViews:p,projectNew:b}}),b}(e,this.project,this.appObservables.ready$);this.updateProject(t)}alignH(e){let t=function(e,t,o){let n=t.builderRendering.modulesView.filter((t=>e.includes(t.moduleId))),s=t.builderRendering.modulesView.filter((t=>!e.includes(t.moduleId))),i=n.reduce(((e,t)=>e+t.yWorld),0)/n.length,a=n.map((e=>new c.ModuleView(e.moduleId,e.xWorld,i,e.Factory)));return new c.Project({...t,builderRendering:new c.BuilderRendering(s.concat(a),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes)})}(e.map((e=>e.moduleId)),this.project,this.appObservables.ready$);this.updateProject(t)}alignV(e){let t=function(e,t,o){let n=t.builderRendering.modulesView.filter((t=>e.includes(t.moduleId))),s=t.builderRendering.modulesView.filter((t=>!e.includes(t.moduleId))),i=n.reduce(((e,t)=>e+t.xWorld),0)/n.length,a=n.map((e=>new c.ModuleView(e.moduleId,i,e.yWorld,e.Factory)));return new c.Project({...t,builderRendering:new c.BuilderRendering(s.concat(a),t.builderRendering.connectionsView,t.builderRendering.descriptionsBoxes)})}(e.map((e=>e.moduleId)),this.project,this.appObservables.ready$);this.updateProject(t)}moveModules(e){let t=function(e,t,o,s){let i=a.getInstance(),r=e.map((e=>[e])).reduce(((e,t)=>e.concat(t)),[]),l=t.filter((e=>!r.map((e=>e.moduleId)).includes(e.moduleId))),d=r.map((e=>[e,t.find((t=>t.moduleId==e.moduleId))])).filter((([e,t])=>Math.abs(t.xWorld-e.x)>3||Math.abs(t.yWorld-e.y)>3)).map((([e,t])=>new c.ModuleView(e.moduleId,e.x,e.y,t.Factory)));if(0==d.length)return;i.debugOn&&i.logWorkflowBuilder({level:n.Info,message:"move modules",object:{modulesPosition:e,modulesViewToKeep:l,modulesViewNew:d}});let u=o.builderRendering.descriptionsBoxes.find((e=>e.modulesId.length!==e.modulesId.filter((e=>d.map((e=>e.moduleId)).indexOf(e)>=0)).length))?o.builderRendering.descriptionsBoxes.map((e=>e.modulesId.find((e=>d.map((e=>e.moduleId)).indexOf(e)>=0))?new c.DescriptionBox(e.descriptionBoxId,e.title,e.modulesId,e.descriptionHtml,e.properties):e)):o.builderRendering.descriptionsBoxes;return new c.Project({...o,builderRendering:new c.BuilderRendering(l.concat(d),o.builderRendering.connectionsView,u)})}(e=e.filter((e=>this.getActiveGroup().getModuleIds().includes(e.moduleId))),this.project.builderRendering.modulesView,this.project,this.implicitModules);this.updateProject(t)}getModuleSelected(){return this.moduleSelected?this.moduleSelected:1==this.modulesSelected.length?this.modulesSelected[0]:void 0}getModulesSelected(){return this.moduleSelected?[this.moduleSelected]:this.modulesSelected.length>0?this.modulesSelected:[]}isSelected(e){return!(!this.moduleSelected||this.moduleSelected.moduleId!==e)||!(!this.modulesSelected||!this.modulesSelected.find((t=>t.moduleId===e)))}selectModule(e){this.modulesSelected.find((t=>t.moduleId==e))||this.moduleSelected&&this.moduleSelected.moduleId==e||(this.moduleSelected&&this.moduleSelected.moduleId!=e&&(this.appObservables.modulesUnselected$.next([this.moduleSelected]),this.moduleSelected=void 0),this.modulesSelected.find((t=>t.moduleId==e))||(this.appObservables.modulesUnselected$.next(this.modulesSelected),this.modulesSelected=[]),this.moduleSelected=this.getModule(e),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"module selected",object:{module:this.moduleSelected}}),this.appObservables.moduleSelected$.next(this.moduleSelected))}selectConnection(e){this.unselect(),this.connectionSelected=e instanceof c.Connection?e:this.getConnection(e),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"connection selected",object:{module:this.connectionSelected}}),this.appObservables.connectionSelected$.next(this.connectionSelected);let t=this.getModule(this.connectionSelected.start.moduleId),o=this.getModule(this.connectionSelected.end.moduleId),s=this.adaptors.filter((e=>e.fromModuleFactoryId===t.factoryId&&e.toModuleFactoryId===o.factoryId&&e.fromModuleSlotId===this.connectionSelected.start.slotId&&e.toModuleSlotId===this.connectionSelected.end.slotId));this.connectionSelected.adaptor||this.appObservables.suggestions$.next(s)}select({modulesId:e,connectionsId:t}){this.unselect(),this.modulesSelected=this.project.workflow.modules.filter((t=>e.includes(t.moduleId))),this.modulesSelected.forEach((e=>this.appObservables.moduleSelected$.next(e)))}getModuleOrPlugin(e){return this.getModulesAndPlugins().find((t=>t.moduleId===e))}getModule(e){let t=this.getModulesAndPlugins().find((t=>t.moduleId===e));return t||(t=this.implicitModules.find((t=>t.moduleId===e)),t)}deleteModules(e){this.unselect();let t=function(e,t){let o=a.getInstance();if(0===e.length)return;let s=e.map((e=>e.moduleId));o.debugOn&&o.logWorkflowBuilder({level:n.Info,message:"deleteModules",object:{modulesDeleted:e}});let i=e.filter((e=>e instanceof c.GroupModules.Module)),r=i.map((e=>e.getAllChildren(t.workflow))).flat(),l=t.workflow.modules.filter((e=>e instanceof c.GroupModules.Module)).filter((e=>!i.includes(e))).filter((e=>{let t=e.getModuleIds(),o=t.filter((e=>!s.includes(e)));return t.length!=o.length})),d=[...e.map((e=>e.moduleId)),...r.reduce(((e,t)=>e.concat(t.moduleId)),[])],u=t.workflow.plugins.filter((e=>d.includes(e.parentModule.moduleId))).map((e=>e.moduleId)),p=[...d,...u],m=l.map((e=>{let t=e.getModuleIds();return f(e,{moduleIds:t.filter((e=>!p.includes(e)))})})),h=x(m,t.workflow),g=[...d,...u,...l.map((e=>e.moduleId)),...h.map((e=>e.moduleId))],w=t.workflow.modules.filter((e=>!g.includes(e.moduleId))).concat(...m),b=t.workflow.plugins.filter((e=>!g.includes(e.moduleId))).concat(h),v=t.builderRendering.modulesView.filter((e=>!p.includes(e.moduleId))),y=t.workflow.connections.filter((e=>!p.includes(e.end.moduleId)&&!p.includes(e.start.moduleId))),I=new c.Workflow({modules:w,connections:y,plugins:b}),S=t.builderRendering.descriptionsBoxes.find((t=>t.modulesId.length!==t.modulesId.filter((t=>e.map((e=>e.moduleId)).indexOf(t)>=0)).length))?t.builderRendering.descriptionsBoxes.map((t=>{let o=t.modulesId.filter((t=>e.map((e=>e.moduleId)).indexOf(t)<0));return o.length==t.modulesId.length?t:(console.log("REMOVE MODULE FORM DBOX",o),new c.DescriptionBox(t.descriptionBoxId,t.title,o,t.descriptionHtml,t.properties))})):t.builderRendering.descriptionsBoxes;return new c.Project({...t,workflow:I,builderRendering:new c.BuilderRendering(v,t.builderRendering.connectionsView,S)})}(e,this.project);if(!t)return;let o=t.workflow.modules.find((e=>e.moduleId==this.rootComponentId));if(!h(t.workflow,o,o,this.activeGroupId)){let e=this.activeGroupId;return this.activeGroupId=this.rootComponentId,this.updateProject(t),void this.appObservables.activeLayerUpdated$.next({fromLayerId:e,toLayerId:this.activeGroupId})}this.updateProject(t)}deleteModule(e){e==this.moduleSelected&&this.unselect(),this.deleteModules([e])}getActiveGroup(){return h(this.project.workflow,void 0,this.getModule(this.rootComponentId),this.activeGroupId)[0]}getRootComponent(){return h(this.project.workflow,void 0,this.getModule(this.rootComponentId),this.rootComponentId)[0]}getGroup(e){let t=h(this.project.workflow,void 0,this.getModule(this.rootComponentId),e);if(null!=t)return t[0];console.error("Can not find group ",e)}selectActiveGroup(e){if(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"selectActiveLayer",object:{groupId:e}}),this.activeGroupId==e)return;let t=this.activeGroupId;this.activeGroupId=e,this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),this.appObservables.activeLayerUpdated$.next({fromLayerId:t,toLayerId:e})}getActiveModulesId(){return this.getGroup(this.activeGroupId).getModuleIds()}getActiveModulesView(){const e=this.getDisplayedModulesView();return[...e.currentLayer.modulesView,...e.parentLayer.modulesView]}getDisplayedModulesView(){let[e,t]=h(this.project.workflow,void 0,this.getModule(this.rootComponentId),this.activeGroupId);return function(e,t,o,n){let s=e.getModuleIds(),i=n.builderRendering.modulesView.filter((e=>s.includes(e.moduleId))),a=[];if(t){let e=t.getModuleIds();a=n.builderRendering.modulesView.filter((t=>e.includes(t.moduleId)))}return{parentLayer:{modulesView:a.filter((t=>!t.moduleId.includes(e.moduleId))),modules:a.map((e=>o.getModule(e.moduleId))),currentGroupModuleView:a.find((t=>t.moduleId.includes(e.moduleId)))},currentLayer:{modulesView:i,modules:i.map((e=>o.getModule(e.moduleId)))}}}(e,t,this,this.project)}getGroupModule(e){return this.project.workflow.modules.find((t=>t instanceof c.GroupModules.Module&&t.moduleId==e))}getParentGroup(e){let t=this.getModule(e);return this.project.workflow.plugins.map((e=>e.moduleId)).includes(t.moduleId)&&(t=t.parentModule),this.project.workflow.modules.filter((e=>e instanceof c.GroupModules.Module)).find((e=>e.getModuleIds().includes(t.moduleId)))}getModulesAndPlugins(){return this.project.workflow.modules.concat(this.project.workflow.plugins)}getConnection(e){return this.project.workflow.connections.find((t=>t.connectionId===e))}addConnection(e){let t=function(e,t,o){let s=a.getInstance();s.debugOn&&s.logWorkflowBuilder({level:n.Info,message:"connection added",object:{connection:e}});let i=t.workflow.modules,r=t.workflow.connections.concat(e),l=new c.Workflow({modules:i,connections:r,plugins:t.workflow.plugins});return l=new c.Workflow({modules:i,connections:r,plugins:t.workflow.plugins}),new c.Project({...t,workflow:l})}(e,this.project,this.allSubscriptions);this.updateProject(t),this.unselect(),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}setConnectionView(e,t,o=!0){let n=function(e,t,o){let n=o.builderRendering.connectionsView.filter((t=>t.connectionId!=e.connectionId)).concat([{connectionId:e.connectionId,wireless:t.wireless}]),s=new c.BuilderRendering(o.builderRendering.modulesView,n,o.builderRendering.descriptionsBoxes);return new c.Project({...o,builderRendering:s})}(e,t,this.project);this.updateProject(n),o&&this.unselect(),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}getConnectionSelected(){return this.connectionSelected}getConnectionView(e){return this.project.builderRendering.connectionsView.find((t=>t.connectionId==e))}deleteConnection(e){this.connectionSelected===e&&(this.connectionSelected=void 0,this.appObservables.unselect$.next());let t=function(e,t,o){let n=t.workflow.connections.filter((t=>t!=e)),s=new c.Workflow({...t.workflow,connections:n});return new c.Project({...t,workflow:s})}(e,this.project,this.allSubscriptions);this.updateProject(t),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}addAdaptor(e,t){let o=function(e,t,o,n){let s=o.workflow.connections.filter((t=>t!=e)),i=new c.Connection(e.start,e.end,t),a=new c.Workflow({...o.workflow,connections:s.concat(i)});return new c.Project({...o,workflow:a})}(t,e,this.project,this.allSubscriptions);this.updateProject(o),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}deleteAdaptor(e){let t=function(e,t,o){let n=t.workflow.connections.filter((t=>t!=e)),s=new c.Connection(e.start,e.end,void 0),i=new c.Workflow({...t.workflow,connections:n.concat(s)});return new c.Project({...t,workflow:i})}(e,this.project,this.allSubscriptions);this.updateProject(t),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}updateAdaptor(e,t){let o=function(e,t,o,n){let s=o.workflow.connections.filter((t=>t!==e)),i=e.adaptor?new c.Adaptor(e.adaptor.adaptorId,t):new c.Adaptor(m(),t),a=new c.Connection(e.start,e.end,i),r=new c.Workflow({...o.workflow,connections:s.concat(a)});return new c.Project({...o,workflow:r})}(e,t,this.project,this.allSubscriptions);this.updateProject(o),this.appObservables.connectionsUpdated$.next(this.project.workflow.connections)}unselect(){this.modulesSelected=[],this.moduleSelected=void 0,this.connectionSelected=void 0,this.descriptionBoxSelected=void 0,this.appObservables.unselect$.next(),this.appObservables.suggestions$.next([])}deleteSelected(){this.uiState.isEditing||(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"delete selected",object:{connectionSelected:this.connectionSelected,moduleSelected:this.moduleSelected,modulesSelected:this.modulesSelected,descriptionBoxSelected:this.descriptionBoxSelected}}),this.connectionSelected&&this.deleteConnection(this.connectionSelected),this.moduleSelected&&this.deleteModule(this.moduleSelected),this.modulesSelected&&this.modulesSelected.length>0&&this.deleteModules(this.modulesSelected),this.descriptionBoxSelected&&this.deleteDescriptionBox(this.descriptionBoxSelected),this.appObservables.suggestions$.next([]))}addGroup(e){let t=new c.DescriptionBox(m(),"grouped module",e,"",new c.DescriptionBoxProperties(void 0)),{project:o}=(new c.GroupModules.Configuration({title:t.title}),g(t.title,t.modulesId.map((e=>this.getModule(e))),this.project,this.activeGroupId,c.GroupModules,0,this.workflow$,this.environment));this.updateProject(o)}addComponent(e){let t=new c.DescriptionBox(m(),"component",e,"",new c.DescriptionBoxProperties(void 0)),{project:o}=(new c.Component.Configuration({title:t.title}),g(t.title,t.modulesId.map((e=>this.getModule(e))),this.project,this.activeGroupId,c.Component,0,this.workflow$,this.environment));this.updateProject(o)}publishComponent(e){let t=void this.project;sessionStorage.setItem(e.moduleId,JSON.stringify(t)),window.open("/ui/assets-publish-ui?kind=flux-component&related_id="+e.moduleId,"_blank")}setRenderingLayout(e,t=!0){let o=function(e,t){let o=a.getInstance();o.debugOn&&o.logWorkflowBuilder({level:n.Info,message:"set rendering layout",object:{layout:e}});let s=function(e,t){let o=a.getInstance(),s=(i=t,(r=document.createElement("div")).innerHTML=i.trim(),r);var i,r;if(!s)return e;let l=Array.from(s.querySelectorAll(".flux-component")).reduce(((e,t)=>({...e,[t.id]:t.cloneNode(!0)})),{}),d=Object.keys(l),u=d.map((t=>e.modules.find((e=>e.moduleId==t)))).map((t=>{let o=l[t.moduleId];if(!o)return;t.getDirectChildren(e).filter((e=>e instanceof c.Component.Module)).forEach((e=>{let t=o.querySelector(`#${e.moduleId}`);t&&(t.innerHTML="")}));let n=o.outerHTML;return n!=t.getPersistentData().html?w(t,{html:n}):void 0})).filter((e=>e));o.debugOn&&o.logWorkflowBuilder({level:n.Info,message:"apply html layout",object:{newComponents:u,eventualUpdateNeeded:d}});let p=x(u,e);return new c.Workflow({...e,modules:e.modules.filter((e=>!u.find((t=>t.moduleId==e.moduleId)))).concat(...u),plugins:e.plugins.filter((e=>!p.find((t=>t.moduleId==e.moduleId)))).concat(...p)})}(t.workflow,e);return new c.Project({...t,workflow:s})}(e,this.project);this.updateProject(o,t)}setRenderingStyle(e,t=!0){let o=function(e,t,o){let s=a.getInstance();s.debugOn&&s.logWorkflowBuilder({level:n.Info,message:"set rendering style",object:{style:t}});let i=function(e,t,o){let s=a.getInstance(),i=e=>{let t=document.createElement("div");return t.appendChild(e),t},r=(e=>{let t=new CSSStyleSheet;return e.split("}").filter((e=>""!=e)).map((e=>(e+"}").trim())).forEach((e=>{t.insertRule(e)})),t})(o),l=i(e.getFullHTML(t));if(!l)return t;let d=t.modules.filter((e=>e instanceof c.Component.Module)).filter((e=>null!=l.querySelector(`#${e.moduleId}`))).map((e=>{let o=e.getOuterHTML(),n=i(o),s=new Set;for(let o=0;o<r.rules.length;o++){let i=r.rules[o];Array.from(n.querySelectorAll(i.selectorText)).filter((o=>!e.getDirectChildren(t).filter((e=>e instanceof c.Component.Module)).map((e=>e.moduleId)).includes(o.id))).length>0&&s.add(i.cssText)}if(a=e.getPersistentData().css.split("\n"),l=[...s],a=a.filter((e=>""!=e)),l=l.filter((e=>""!=e)),a.length==l.length&&a.map((e=>l.includes(e))).reduce(((e,t)=>e&&t),!0))return;var a,l;let d=[...s].reduce(((e,t)=>e+"\n"+t),"");return w(e,{css:d})})).filter((e=>e));return 0==d.length?(s.debugOn&&s.logWorkflowBuilder({level:n.Info,message:"no changes in css",object:{}}),t):new c.Workflow({...t,modules:t.modules.filter((e=>!d.find((t=>t.moduleId==e.moduleId)))).concat(...d)})}(e,o.workflow,t);return i==o.workflow?o:new c.Project({...o,workflow:i})}(this.getGroup(this.rootComponentId),e,this.project);o!=this.project&&this.updateProject(o,t)}addDescriptionBox(e){let t=function(e,t){let o=t.builderRendering.descriptionsBoxes.concat(e);return new c.Project({...t,builderRendering:new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,o)})}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}selectDescriptionBox(e){this.unselect(),this.descriptionBoxSelected=this.project.builderRendering.descriptionsBoxes.find((t=>t.descriptionBoxId==e)),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}updateDescriptionBox(e){this.unselect();let t=function(e,t){let o=t.builderRendering.descriptionsBoxes.filter((t=>t.descriptionBoxId!=e.descriptionBoxId)).concat([e]);return new c.Project({...t,builderRendering:new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,o)})}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}deleteDescriptionBox(e){e==this.descriptionBoxSelected&&this.unselect();let t=function(e,t){let o=t.builderRendering.descriptionsBoxes.filter((t=>t.descriptionBoxId!=e.descriptionBoxId));return new c.Project({...t,builderRendering:new c.BuilderRendering(t.builderRendering.modulesView,t.builderRendering.connectionsView,o)})}(e,this.project);this.updateProject(t),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes)}updateProjectToIndexHistory(e,t){let o={modules:!1,modulesView:!1,connections:!1,activeLayer:!1,descriptionBox:!1};this.indexHistory=e,this.project=this.history[this.indexHistory];let s=this.history[t],i=(0,c.workflowDelta)(s.workflow,this.project.workflow);var a,r,l;if(i.modules.removedElements&&i.modules.removedElements.filter((e=>(0,c.instanceOfSideEffects)(e))).forEach((e=>e.dispose())),i.hasDiff&&this.workflow$.next(this.project.workflow),i.modules.createdElements&&(a=i.modules.createdElements,r=this.builderViewsActions,l=this.appBuildViewObservables.notification$,a.forEach((e=>{e.Factory.consumersData.FluxAppstore||(e.Factory.consumersData.FluxAppstore={notifiersPluged:!1}),e.Factory.BuilderView.notifier$&&!e.Factory.consumersData.FluxAppstore.notifiersPluged&&(e.Factory.BuilderView.notifier$.pipe((0,p.filter)((e=>"configurationUpdated"==e.type))).subscribe((e=>{r[e.type]&&r[e.type](e.data)})),e.Factory.BuilderView.notifier$.subscribe((e=>l.next(e))),e.Factory.consumersData.FluxAppstore.notifiersPluged=!0)})),i.modules.createdElements.filter((e=>(0,c.instanceOfSideEffects)(e))).forEach((e=>e.apply()))),!o.modules&&(i.modules.createdElements.length>0||i.modules.removedElements.length>0)&&(this.appObservables.modulesUpdated$.next(i.modules),this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),o.modules=!0,o.modulesView=!0),!o.connections&&(i.connections.createdElements.length>0||i.connections.removedElements.length>0)&&(this.appObservables.connectionsUpdated$.next(this.project.workflow.connections),o.connections=!0),!o.modulesView&&this.project.builderRendering.modulesView!==s.builderRendering.modulesView){let e=(0,c.getCollectionsDelta)(s.builderRendering.modulesView,this.project.builderRendering.modulesView),t=[...e.createdElements.filter((t=>null==e.removedElements.find((e=>e.moduleId==t.moduleId)))),...e.createdElements.filter((t=>null==e.removedElements.find((e=>e.moduleId==t.moduleId))))];t.length>0?this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()):this.appObservables.connectionsUpdated$.next(this.project.workflow.connections),t.length>0&&(o.modulesView=!0)}o.activeLayer||this.activeGroupId==this.rootComponentId&&this.project.workflow.modules.find((e=>e.moduleId==this.rootComponentId))==s.workflow.modules.find((e=>e.moduleId==this.rootComponentId))||(o.modulesView||this.appBuildViewObservables.modulesViewUpdated$.next(this.getActiveModulesView()),this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),this.appObservables.activeLayerUpdated$.next({fromLayerId:void 0,toLayerId:this.activeGroupId}),o.activeLayer=!0),o.descriptionBox||this.project.builderRendering.descriptionsBoxes===s.builderRendering.descriptionsBoxes||(this.appObservables.descriptionsBoxesUpdated$.next(this.project.builderRendering.descriptionsBoxes),o.descriptionBox=!0),function(e,t,o,n){let s=o.concat(n).reduce(((e,t)=>e.concat(t.inputSlots)),[]),i=o.concat(n).reduce(((e,t)=>e.concat(t.outputSlots)),[]);t.removedElements.forEach((t=>{e.get(t).unsubscribe(),e.delete(t)})),t.createdElements.forEach((t=>{let o=i.find((e=>e.slotId==t.start.slotId&&e.moduleId==t.start.moduleId)),n=s.find((e=>e.slotId==t.end.slotId&&e.moduleId==t.end.moduleId)),a=o.observable$.subscribe((e=>n.subscribeFct({connection:t,message:e})));e.set(t,a)}))}(this.allSubscriptions,i.connections,this.project.workflow.modules,this.project.workflow.plugins),this.appObservables.projectUpdated$.next(i),this.appExtensionsObservables.projectUpdated$.next(i),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"updateProjectToIndexHistory",object:{oldProject:s,delta:i,newProject:this.project,history:this.history,updatesDone:o}})}undo(){0!=this.indexHistory&&(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"undo",object:{history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory-1,this.indexHistory))}redo(){this.indexHistory!=this.history.length-1&&(this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"redo",object:{history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory+1,this.indexHistory))}updateProject(e,t=!0){if(!e)return;let o=this.indexHistory;t||(this.history=this.history.slice(0,-1),this.indexHistory--),this.indexHistory===this.history.length-1&&(this.history.push(e),this.indexHistory++),this.indexHistory<this.history.length-1&&(this.history=this.history.slice(0,this.indexHistory+1),this.history.push(e),this.indexHistory=this.history.length-1),this.debugSingleton.debugOn&&this.debugSingleton.logWorkflowBuilder({level:n.Info,message:"updateProject",object:{newProject:e,history:this.history}}),this.updateProjectToIndexHistory(this.indexHistory,o)}}k.instance=void 0,function(e){let t=new BroadcastChannel("out=>code-editor@BroadcastDrive"),o=new BroadcastChannel("code-editor@BroadcastDrive=>out");e.mountBroadcastDrive=function(e,n){let s,i=e.ownerId,a={action:"ping",channelResp:"code-editor=>flux",ownerId:i},l=!1,d=new r.BehaviorSubject(!1);(0,r.interval)(500).pipe((0,p.take)(1)).pipe((0,p.take)(1)).subscribe((()=>{l||(window.open(n,"_tab_code_editor"),(0,r.interval)(200).pipe((0,p.filter)((()=>!l))).subscribe((()=>t.postMessage(a))))})),t.postMessage(a),d.pipe((0,p.filter)((e=>1==e)),(0,p.mergeMap)((()=>e.mount$.pipe((0,p.map)((t=>e.drive(t))),(0,p.tap)((e=>s=e)))))).subscribe((o=>{let n={action:"mount",ownerId:i,codeEditor:{drive:{name:o.name,data:o.data},UI:e.UI}};t.postMessage(n)}));let c=e.unmount$.subscribe((()=>{t.postMessage({action:"unmount",ownerId:i}),c.unsubscribe()}));o.onmessage=({data:e})=>{if("ping-ack"==e.action&&e.ownerId==i&&(l=!0,d.next(!0)),"updateFile"==e.action&&e.ownerId==i){let o=()=>t.postMessage({action:"updateFile-ack",actionId:e.actionId,ownerId:i});s.onFileUpdated(e.data,o)}}}}(v||(v={}))},48:(e,t,o)=>{"use strict";o.d(t,{eD:()=>$.e,j3:()=>S,rj:()=>C.r});var n,s=o(888),i=o(396),a=o(158),r=o(519),l=o(222),d=o(327),c=o(735),u=o(97);!function(e){class t{constructor({ok$:e}){this.buffer$=new a.BehaviorSubject([]),this.ok$=e,this.explorerState=c.Q.singletonState,this.explorerState.selectionBuffer$=this.buffer$}}class o{constructor({state:e,options:t,...n}){Object.assign(this,n),this.options={...o.defaultOptions,...t||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.bufferColumnView(),this.explorerView()],this.connectedCallback=e=>{e.subscriptions.push(this.state.explorerState.selection$.pipe((0,r.scan)(((e,{node:t,selected:o})=>[...e.filter((e=>e!=t)),...o?[t]:[]]),[])).subscribe((e=>this.state.buffer$.next(e))))}}bufferColumnView(){let e=new d.Button.View({state:new d.Button.State(this.state.ok$),contentView:()=>({innerText:"Import"}),class:"fv-btn fv-btn-primary fv-bg-focus"});return{class:"px-2 d-flex flex-column w-25",style:{width:"200px"},children:[{class:"w-100 text-center",innerText:"selection buffer",style:{"font-family":"fantasy"}},(0,l.child$)(this.state.buffer$,(e=>e.length>0?{class:"d-flex flex-column flex-grow-1 overflow-auto",children:e.map((e=>({class:"d-flex align-items-center",children:[{innerText:e.name},{class:"fas fa-times px-2 yw-hover-opacity yw-pointer",onclick:()=>{this.state.explorerState.selection$.next({node:e,selected:!1})}}]})))}:{tag:"div",class:"py-2",innerText:"Pick one or more module(s) using the tabs on the right side to add them in your worksheet",style:{"font-style":"italic","text-align":"justify"}})),(0,l.child$)(this.state.buffer$,(t=>t.length>0?e:{}))]}}explorerView(){return{class:"h-100 overflow-auto w-75 border rounded",children:[new c.Q.View({state:this.state.explorerState,class:"h-100"})]}}}o.defaultOptions={containerClass:"h-100 w-100 p-3 rounded d-flex solid rounded",containerStyle:{}},e.View=o,e.popupModal=function(e,n){let s=new a.Subject,i=new t({ok$:s}),r=new o({state:i});u.R.popup({view:r,ok$:s,options:{displayOk:!1,displayCancel:!1}}).subscribe((()=>{n(i.buffer$.getValue())}))}}(n||(n={}));var p,m=o(313),h=o(230);!function(e){class t{constructor({module:e}){this.module=e}}e.State=t;class o{constructor({state:e,...t}){if(Object.assign(this,t),this.state=e,this.class=this.class||o.defaultOptions.containerClass,this.style=this.style||o.defaultOptions.containerStyle,0==this.state.module.journals.length)return void(this.children=[this.noJournalsAvailableView()]);if(1==this.state.module.journals.length)return void(this.children=[this.journalView(this.state.module.journals[0])]);let n=new a.BehaviorSubject(this.state.module.journals[0].title);this.children=[this.selectJournalView(n),(0,l.child$)(n.pipe((0,r.map)((e=>this.state.module.journals.find((t=>t.title==e))))),(e=>this.journalView(e)))]}noJournalsAvailableView(){return{innerText:"The module does not contains journals yet, it is likely that it did not run already."}}selectJournalView(e){let t=this.state.module.journals.map((e=>new m.Select.ItemData(e.title,e.title))),o=new m.Select.State(t,e);return{class:"d-flex align-items-center py-2",children:[{innerText:"Available reports:",class:"px-2"},new m.Select.View({state:o})]}}journalView(e){let t=new h.R.State({context:e.entryPoint,expandedNodes:[e.entryPoint.id]});return{class:"h-100 d-flex flex-column",children:[{class:"d-flex align-items-center justify-content-center",children:[{tag:"i",class:"fas fa-newspaper fa-2x px-3"},{class:"text-center py-2",style:{"font-family":"fantasy","font-size":"larger"},innerText:e.title}]},new h.R.View({state:t,options:{containerClass:"p-4 flex-grow-1 overflow-auto"}})]}}}o.defaultOptions={containerClass:"d-flex flex-column p-3",containerStyle:{"min-height":"0px"}},e.View=o,e.popupModal=function({module:e}){let n=new t({module:e}),s=new o({state:n});u.R.popup({view:s,style:{"max-height":"75vh",width:"75vw"},options:{displayCancel:!1,displayOk:!1}}).subscribe((()=>{}))}}(p||(p={}));class g extends s.ImmutableTree.Node{constructor({id:e,children:t,name:o,faIcon:n}){super({id:e,children:t}),this.name=o,this.faIcon=n}execute(e,{event:t}){}}class f extends g{constructor({children:e}){super({id:"root",children:e,name:"menu list",faIcon:""})}}class w extends g{constructor(){super({id:"new-modules",children:void 0,name:"new module(s)",faIcon:"fas fa-microchip"})}execute(e,{event:t}){let o=e.drawingArea.invert(t.clientX,t.clientY);n.popupModal(e.appState,(t=>{let n=t.map((e=>e.library)),s=t.flatMap((e=>e.fluxPacks.map((e=>e))));e.appState.addLibraries$(n,s).subscribe((()=>{t.forEach((t=>e.appState.addModule(t.factory,o)))}))}))}}class b extends g{constructor(){super({id:"add-plugins",children:void 0,name:"add plugin(s)",faIcon:"fas fa-microchip"})}execute(e,{event:t}){n.popupModal(e.appState,(t=>{let o=e.appState.getModuleSelected(),n=t.map((e=>e.library)),s=t.flatMap((e=>e.fluxPacks.map((e=>e))));e.appState.addLibraries$(n,s).subscribe((()=>{t.forEach((t=>e.appState.addPlugin(t.factory,o)))}))}))}}class x extends g{constructor(){super({id:"journals",children:void 0,name:"journals",faIcon:"fas fa-newspaper"})}execute(e){let t=e.appState.getModuleSelected();p.popupModal({module:t})}}class v extends g{static createChildren(e){let t=e.getModuleSelected().Factory.resources;return Object.entries(t).map((([e,t])=>new y({name:e,url:t})))}constructor(e){super({id:"documentation",children:v.createChildren(e),name:"documentation",faIcon:"fas fa-book"})}}class y extends g{constructor({name:e,url:t}){super({id:e,children:void 0,name:e,faIcon:"fas fa-book"}),this.url=t}execute(e){window.open(this.url,"_blank")}}let I={newModules:{createNode:e=>new w,applicable:e=>e.getModulesSelected().length>=0},addPlugins:{createNode:()=>new b,applicable:e=>1==e.getModulesSelected().length},journals:{createNode:e=>new x,applicable:e=>1==e.getModulesSelected().length&&e.getModuleSelected().journals.length>0},documentation:{createNode:e=>new v(e),applicable:e=>{if(1!=e.getModulesSelected().length)return!1;let t=e.getModuleSelected().Factory.resources;return t&&Object.entries(t).length>0}}};class S extends i.ContextMenu.State{constructor(e,t){super((0,a.fromEvent)(t.parentDiv,"contextmenu").pipe((0,r.tap)((e=>e.preventDefault())))),this.appState=e,this.drawingArea=t,this.htmlElement=t.parentDiv}dispatch(e){let t=Object.values(I).filter((e=>e.applicable(this.appState))).map((e=>e.createNode(this.appState))),o=new f({children:t}),n=new j(o),i=new s.ImmutableTree.View({state:n,headerView:k,class:"fv-bg-background fv-text-primary p-2 rounded"});return n.selectedNode$.next(o),n.selectedNode$.subscribe((t=>t.execute(this,{event:e}))),i}}class j extends s.ImmutableTree.State{constructor(e){super({rootNode:e,expandedNodes:[e.id]})}}function k(e,t){return{class:"d-flex w-100 align-items-baseline fv-pointer fv-hover-bg-background-alt px-1",children:[{tag:"i",class:t.faIcon},{tag:"span",class:"mx-2 w-100",innerText:t.name,style:{"user-select":"none"}}]}}o(182),o(825),o(350);var $=o(142),C=(o(991),o(910));o(143),o(700),o(864)},182:(e,t,o)=>{"use strict";o.d(t,{b:()=>n});var n,s=o(222),i=o(158),a=o(519),r=o(825),l=o(137),d=o(143),c=o(991),u=o(700),p=o(97);!function(e){class t{constructor(e,t,o){this.message=e,this.row=t,this.col=o}}class o{constructor({connection:e,initialCode:o,appStore:n}){this.appStore=n,this.connection=e;let s=new i.BehaviorSubject(o);this.codeEditorState=new r.a.State({content$:s}),this.mdleStart=this.appStore.getModule(e.start.moduleId),this.mdleEnd=this.appStore.getModule(e.end.moduleId),this.rawInput$=this.mdleStart.getOutputSlot(e.start.slotId).observable$,this.contract=this.mdleEnd.getInputSlot(this.connection.end.slotId).contract,this.adaptedInput$=(0,i.combineLatest)([s.pipe((0,a.debounceTime)(.5)),this.rawInput$]).pipe((0,a.map)((([e,o])=>{try{let t=new Function(e)()(o,this.mdleEnd.helpers);return t.configuration=l.merge({},this.mdleEnd.getPersistentData(),t.configuration),t}catch(e){return function(e){try{let o=e.split("\n"),n=o[0];if(o=o.filter((e=>e.includes("eval")&&2==e.split(",").length)),0==o.length)return new t(n,void 0,void 0);let s=o[0].split(",")[1].split("<anonymous>:")[1].split(")")[0],[i,a]=[Number(s.split(":")[0])-2,Number(s.split(":")[1])];return new t(n,i,a)}catch(e){return new t("Unidentified error",void 0,void 0)}}(e.stack)}})))}}e.State=o;class n{constructor({state:e,editorConfiguration:t,options:o,...s}){Object.assign(this,s),this.options={...n.defaultOptions,...o||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.dataColumnView(),{class:"d-flex flex-grow-1 flex-column h-100 w-100 mx-2",style:{"min-width":"0px"},children:[new r.a.View({state:e.codeEditorState,editorConfiguration:t,options:{containerClass:"w-100 h-50"}}),this.statusView()]}]}dataColumnView(){return{class:"d-flex flex-column h-100 fv-text-primary w-50",style:{"font-family":"monospace"},children:[this.rawInputView(),this.adaptedInputView()]}}statusView(){return{style:{height:"33%","font-family":"monospace"},class:"overflow-auto flex-grow-1 d-flex flex-column",children:[(0,d.Z)("Presented here is a blind test of the input that is reaching the module's implementation with respect to its internal validation rules. \n Make sure the trigger turn green before updating the adaptor."),(0,s.child$)(this.state.adaptedInput$,(e=>{if(e instanceof t||!e.data)return{class:"flex-grow-1 py-2",style:{"min-height":"0px","font-family":"monospace"},children:[{innerText:"error while executing the adaptor"},{innerText:`${(o=e).message}.`+(o.row?` Row:${o.row}, column:${o.col}`:"")}]};var o;let n=new u.Z.State({mdle:this.state.mdleEnd,adaptedInput:e,contract:this.state.contract});return new u.Z.View({state:n,options:{containerClass:"flex-grow-1 w-100 overflow-auto",containerStyle:{"min-height":"0px"}}})}))]}}rawInputView(){return{class:"h-50 d-flex flex-column overflow-auto py-1",children:[{innerText:"Adaptor's input data",class:"text-center fv-text-focus"},{class:"flex-grow-1 d-flex flex-column",style:{"min-height":"0"},children:[(0,d.Z)("Presented here is the latest input that have reached the adaptor, before any transformation. The input that is actually reaching the module's implementation is presented below."),this.dataTreeView(this.state.rawInput$,"input")]}]}}adaptedInputView(){return{class:"h-50 d-flex flex-column overflow-auto py-1",children:[{innerText:"Module's input data",class:"text-center  fv-text-focus"},{class:"flex-grow-1 d-flex flex-column",style:{"min-height":"0"},children:[(0,d.Z)("Presented here is the input that is actually reaching the module's implementation. Here, the configuration part of the input is merging the default one (defined in module's settings) with the one returned by the adaptor (as presented in the previous tab)."),this.dataTreeView(this.state.adaptedInput$,"input")]}]}}dataTreeView(e,t){let o=[t+"_0"];return{class:"cm-s-blackboard overflow-auto flex-grow-1",style:{"min-height":"0px"},children:[(0,s.child$)(e,(e=>{if(!e)return{innerText:"code not valid",class:"p-3"};let n=new c.g.State({title:t,data:e,expandedNodes:o});return new c.g.View({state:n,connectedCallback:e=>{e.subscriptions.push(n.expandedNodes$.subscribe((e=>o=e)))}})}),{untilFirst:this.options.untilFirst})]}}}n.defaultOptions={containerClass:"fv-bg-background p-3 fv-text-primary rounded d-flex h-100 w-100",containerStyle:{},untilFirst:{class:"d-flex flex-column fv-text-primary ",style:{"font-family":"monospace"},children:[{tag:"p",innerText:"No data available: the module has not played any scenario yet. Having data available may help to write your code."},{tag:"p",innerText:"Getting some data is usually as easy as connecting the input(s) of your module."}]}},e.View=n,e.popupModal=function({connection:e,initialCode:t,appStore:s,onUpdate:i}){let a=new o({connection:e,initialCode:t,appStore:s}),r=new n({state:a,options:{containerClass:"p-3 d-flex flex-grow-1 w-100",containerStyle:{"min-height":"0px"}}});p.R.popup({view:r,style:{height:"50vh",width:"90vw","max-width":"1500px"}}).subscribe((()=>{i(a.codeEditorState.content$.getValue())}))}}(n||(n={}))},735:(e,t,o)=>{"use strict";o.d(t,{Q:()=>n});var n,s=o(935),i=o(222),a=o(888),r=o(158),l=o(519),d=o(931);!function(e){class t extends a.ImmutableTree.State{constructor({appStore:e,selectionBuffer$:o}){super({rootNode:new p({favorites:t.favorites$.getValue()})}),this.favorites=new Array,this.appStore=e,this.selectionBuffer$=o||(0,r.of)([]),t.favorites$.subscribe((e=>{localStorage.setItem("flux-builder#favorites",JSON.stringify(e))})),this.selection$=new r.Subject}toggleFavorite(e){let o=y(),n=e instanceof x?e.favorite.id:e.id;if(o.find((e=>e.id==n)))return o=o.filter((e=>e.id!=n)),t.favorites$.next(o),void this.removeNode(e instanceof x?e.id:"favorite_"+n);let s=new v(n,e.name,e.type);o=o.concat([s]),t.favorites$.next(o),this.addChild("explorer",new x({favorite:s}))}}t.favorites$=new r.BehaviorSubject(y()),e.State=t;class o extends a.ImmutableTree.View{constructor({state:e,...t}){super({state:e,headerView:n,...t})}}function n(e,o){if(!(o instanceof b)){let n="fas fa-star fa-xs fv-hover-opacity fv-pointer ";return{class:"d-flex w-100 align-items-center fv-pointer",children:[{tag:"i",class:o.faIcon?o.faIcon:""},o instanceof x?{tag:"i",class:"fas fa-star fa-xs px-1 fv-text-focus fv-hover-opacity",onclick:t=>{t.stopPropagation(),e.toggleFavorite(o)}}:{},{tag:"span",class:"mx-2",innerText:o.name,style:{"user-select":"none"}},o instanceof g?{tag:"i",class:(0,i.attr$)(t.favorites$,(e=>e.find((e=>e.id==o.id))?n+"fv-text-focus":n+"fv-text-primary")),onclick:t=>{t.stopPropagation(),e.toggleFavorite(o)}}:{},(0,i.child$)(o.status$,(e=>e.find((e=>"request-pending"==e.type))?{tag:"i",class:"fas fa-spinner fa-spin"}:{}))]}}if(o instanceof b)return{class:"d-flex w-100 align-items-baseline fv-pointer",onclick:()=>e.selection$.next({node:o,selected:!0}),children:[{tag:"i",class:(0,i.attr$)(e.selectionBuffer$,(e=>e.includes(o)?"fv-text-focus":""),{wrapper:e=>"fas fa-cloud-download-alt fv-text-primary fv-hover-opacity "+e})},{tag:"span",class:"mx-2 w-100",innerText:o.name,style:{"user-select":"none"}}]}}e.View=o;class c extends a.ImmutableTree.Node{constructor({id:e,name:t,children:o,type:n,faIcon:s}){super({id:e,children:o}),this.status$=new r.BehaviorSubject([]),this.name=t,this.faIcon=s,this.type=n}addStatus({type:e,id:t}){t=t||this.id;let o=this.status$.getValue().concat({type:e,id:t});this.status$.next(o)}removeStatus({type:e,id:t}){t=t||this.id;let o=this.status$.getValue().filter((o=>o.type!=e&&o.id!=t));this.status$.next(o)}resolveChildren(){if(!this.children||Array.isArray(this.children))return;let e=(0,s.uuidv4)();return this.addStatus({type:"request-pending",id:e}),super.resolveChildren().pipe((0,l.tap)((()=>{this.removeStatus({type:"request-pending",id:e})})))}}class u extends c{constructor({id:e,name:t,type:o,children:n,faIcon:s}){super({id:e,name:t,type:o||"FolderNode",children:n,faIcon:s||"fas fa-folder"})}}class p extends u{constructor({favorites:e,children:t}){super({id:"explorer",name:"Explorer",type:"RootNode",children:t||I()}),this.favorites=e}}class m extends u{constructor({groupId:e,path:t,children:o}){super({id:e,name:t.split("/").slice(-1)[0],type:"GroupNode",children:o||S(t),faIcon:"fas fa-users"}),this.groupId=e,this.path=t}}class h extends u{constructor({driveId:e,name:t,children:o}){super({id:e,name:t,type:"DriveNode",children:o||j(e),faIcon:"fas fa-hdd"}),this.driveId=e}}class g extends u{constructor({folderId:e,name:t,children:o}){super({id:e,name:t,type:"AssetFolderNode",children:o||j(e)}),this.folderId=e}}class f extends c{constructor({id:e,name:t,type:o,children:n,faIcon:s}){super({id:e,name:t,type:o||"ItemNode",children:n,faIcon:s})}}class w extends f{constructor({assetId:e,name:t,rawId:o,children:n}){super({id:e,name:t,type:"AssetItemNode",children:n||k(o),faIcon:"fas fa-box"}),this.assetId=e}}class b extends f{constructor({factory:e,library:t,fluxPacks:o}){super({id:e.uid,name:e.displayName,type:"ModuleItemNode",faIcon:""}),this.factory=e,this.library=t,this.fluxPacks=o}}e.ModuleItemNode=b;class x extends f{constructor({favorite:e}){super({id:"favorite_"+e.id,name:e.name,type:"FavoriteNode",children:x.getChildrenFactory[e.type](e),faIcon:"fas fa-folder"}),this.favorite=e}}x.getChildrenFactory={AssetFolderNode:e=>j(e.id)};class v{constructor(e,t,o){this.id=e,this.name=t,this.type=o}}function y(){let e=localStorage.getItem("flux-builder#favorites");return e?JSON.parse(e):[]}function I(){let e=y();return S().pipe((0,l.map)((t=>[...t,...e.map((e=>new x({favorite:e})))])))}function S(e=""){return d.k.getGroupChildren$(e).pipe((0,l.map)((e=>[...e.groups.map((e=>new m({groupId:e.id,path:e.path}))),...e.drives.map((e=>new h({driveId:e.driveId,name:e.name})))])))}function j(e){return d.k.getFolderChildren$(e).pipe((0,l.map)((e=>[...e.folders.map((e=>new g({folderId:e.folderId,name:e.name}))),...e.items.filter((e=>"package"==e.kind)).map((e=>new w({assetId:e.assetId,name:e.name,rawId:e.rawId})))])))}function k(e){return d.k.getModules$(e).pipe((0,l.map)((({factories:e,library:t,loadingGraph:o})=>e.map((e=>new b({factory:e,library:{name:t.name,version:t.versions[0],namespace:t.namespace},fluxPacks:o.lock.flat().filter((e=>"flux-pack"==e.type))}))))))}}(n||(n={}))},825:(e,t,o)=>{"use strict";o.d(t,{a:()=>n});var n,s=o(222),i=o(158),a=o(519);!function(e){e.State=class{constructor({content$:e}){this.content$=e}};class t{constructor({state:e,editorConfiguration:n,options:i,...a}){Object.assign(this,a);let r={...t.defaultOptions,...i||{}};this.state=e,this.class=r.containerClass,this.style=r.containerStyle;let l={value:e.content$.getValue(),mode:"javascript",lineNumbers:!0,theme:"blackboard",extraKeys:{Tab:e=>e.replaceSelection("    ","end")},...n||{}};this.children=[(0,s.child$)(o(l.mode),(()=>({id:"code-mirror-editor",class:"w-100 h-100",connectedCallback:t=>{let o=window.CodeMirror(t,l);o.on("changes",(()=>{e.content$.next(o.getValue())}))}})))]}}function o(e){let t=window["@youwol/cdn-client"],o={javascript:"codemirror#5.52.0~mode/javascript.min.js",python:"codemirror#5.52.0~mode/python.min.js",css:"codemirror#5.52.0~mode/css.min.js",xml:"codemirror#5.52.0~mode/xml.min.js",html:"codemirror#5.52.0~mode/htmlmixed.min.js"};return(0,i.from)(t.fetchBundles({codemirror:{version:"5.52.0"}},window)).pipe((0,a.mergeMap)((()=>{let n=Array.isArray(o[e])?o[e]:[o[e]],s=t.fetchJavascriptAddOn(n,window);return(0,i.from)(s)})))}t.defaultOptions={containerClass:"h-100 w-100",containerStyle:{}},e.View=t}(n||(n={}))},350:(e,t,o)=>{"use strict";o.d(t,{s:()=>n});var n,s=o(158),i=o(825),a=o(97);!function(e){class t{constructor({mdle:e,initialCode:t}){this.mdle=e;let o=new s.BehaviorSubject(t);this.codeEditorState=new i.a.State({content$:o})}}e.State=t;class o{constructor({state:e,editorConfiguration:t,options:n,...s}){Object.assign(this,s),this.options={...o.defaultOptions,...n||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle,this.children=[this.moduleContextView(),{class:"d-flex flex-column h-100 w-100 mx-2",children:[new i.a.View({state:this.state.codeEditorState,editorConfiguration:t})]}]}moduleContextView(){return{}}}o.defaultOptions={containerClass:"fv-bg-background p-3 fv-text-primary rounded d-flex ",containerStyle:{height:"50vh",width:"90vw","max-width":"1500px"}},e.View=o,e.popupModal=function({mdle:e,initialCode:n,editorConfiguration:s,onUpdate:i}){let r=new t({mdle:e,initialCode:n}),l=new o({state:r,editorConfiguration:s,options:{containerClass:"p-2 d-flex flex-grow-1 w-100",containerStyle:{"min-height":"0px"}}});a.R.popup({view:l,style:{height:"50vh",width:"90vw","max-width":"1500px"}}).subscribe((()=>{i(r.codeEditorState.content$.getValue())}))}}(n||(n={}))},142:(e,t,o)=>{"use strict";o.d(t,{e:()=>n});var n,s=o(991);!function(e){e.State=class{constructor({status:e,stringLengthLimit:t}){this.status=e,this.stringLengthLimit=t||100;let o=e;(0!=o.intrus.length||o.typeErrors||o.missings)&&(o.typeErrors&&o.typeErrors.length>0&&(this.typingErrors=new s.g.State({title:"typing errors",data:o.typeErrors})),o.missings&&o.missings.length>0&&(this.missingFields=new s.g.State({title:"missing fields",data:o.missings})),o.intrus.length>0&&(this.unexpectedFields=new s.g.State({title:"unexpected fields",data:o.intrus})))}};class t{constructor({state:e,options:o,...n}){Object.assign(this,n);let i={...t.defaultOptions,...o||{}};this.state=e,this.class=i.containerClass,this.style=i.containerStyle;let a=[this.state.typingErrors,this.state.missingFields,this.state.unexpectedFields].filter((e=>e)).map((e=>new s.g.View({state:e})));this.children=0==a.length?[{innerText:"Your configuration is validated"}]:a}}t.defaultOptions={containerClass:"d-flex flex-column",containerStyle:{"min-height":"0px"}},e.View=t,e.journalWidget=function(t){let o=new s.g.State({title:"merged configuration",data:t.result}),n=new e.State({status:t});return{children:[{class:"d-flex justify-content-around w-100",style:{"white-space":"nowrap"},children:[new s.g.View({state:o}),{class:"px-4"},new e.View({state:n})]}]}}}(n||(n={}))},230:(e,t,o)=>{"use strict";o.d(t,{R:()=>n});var n,s=o(935),i=o(888),a=o(991),r=o(97);!function(e){function t(e){return e instanceof window["@youwol/flux-core"].Context?new n({context:e}):e instanceof window["@youwol/flux-core"].ErrorLog?new p({log:e}):e instanceof window["@youwol/flux-core"].WarningLog?new u({log:e}):e instanceof window["@youwol/flux-core"].InfoLog?new c({log:e}):void 0}class o extends i.ImmutableTree.Node{constructor({id:e,children:t}){super({id:e,children:t})}}class n extends o{constructor({context:e}){super({id:e.id,children:e.children.map((e=>t(e)))}),this.context=e}}class l extends o{constructor({data:e}){super({id:(0,s.uuidv4)()}),this.data=e}}class d extends o{constructor({log:e}){super({id:e.id,children:null!=e.data?[new l({data:e.data})]:void 0}),this.log=e}}class c extends d{constructor(e){super(e)}}class u extends d{constructor(e){super(e)}}class p extends d{constructor(e){super(e)}}function m(e){return e.parent?m(e.parent).concat([e.id]):[e.id]}class h extends i.ImmutableTree.State{constructor({context:e,expandedNodes:o,selectedNode:n}){super({rootNode:t(e.root()),expandedNodes:o}),this.rootCtx=e.root(),this.context=e,this.tStart=this.rootCtx.startTimestamp,this.tEnd=this.rootCtx.startTimestamp+this.rootCtx.elapsed(),n&&this.selectedNode$.next(this.getNode(n))}}e.State=h;class g{constructor({state:e,options:t,...o}){this.domId="contextView-view",Object.assign(this,o),this.state=e;let n={...g.defaultOptions,...t||{}};this.class=n.containerClass,this.style=n.containerStyle;let s=new i.ImmutableTree.View({state:e,headerView:f,class:n.treeViewClass,style:n.treeViewStyle,options:{classes:{header:"d-flex align-items-baseline fv-tree-header fv-hover-bg-background-alt "}}});this.children=[s]}}function f(e,t){let o="3px";if(t instanceof n){let n=100*(t.context.startTimestamp-e.rootCtx.startTimestamp)/(e.tEnd-e.tStart),i=100*t.context.elapsed()/(e.tEnd-e.tStart),a=Math.floor(100*t.context.elapsed())/100;return{class:"w-100 pb-2",children:[{class:"d-flex align-items-center",children:[{tag:"i",class:{[s.ContextStatus.FAILED]:"fas fa-times fv-text-error",[s.ContextStatus.SUCCESS]:"fas fa-check fv-text-success",[s.ContextStatus.RUNNING]:"fas fa-cog fa-spin"}[t.context.status()]},{innerText:t.context.title+`  - ${a} ms`,class:"fv-pointer px-2",style:{"font-family":"fantasy"}}]},{class:"fv-bg-success",style:{top:"0px",height:o,width:i+"%",position:"absolute",left:n+"%"}}]}}if(t instanceof d){let n=100*(t.log.timestamp-e.rootCtx.startTimestamp)/(e.tEnd-e.tStart),s="fv-text-primary fas fa-info";return t instanceof p&&(s="fv-text-error fas fa-times"),t instanceof u&&(s="fv-text-focus fas fa-exclamation"),{class:"pb-1 fv-pointer w-100",children:[{class:"d-flex align-items-center",children:[{class:s},{innerText:t.log.text,class:"px-2"}]},{class:"fv-bg-success rounded",style:{height:o,width:o,top:"0px",position:"absolute",left:`calc( ${n}% - 5px)`}}]}}if(t instanceof l){let e=s.Journal.getViews(t.data).map((e=>e.view));if(e.length>0)return{class:"d-flex flex-grow-1",style:{"white-space":"nowrap","min-width":"0px"},children:e};let o=new a.g.State({title:"",data:t.data,expandedNodes:["_0"]});return{children:[new a.g.View({state:o})]}}return{innerText:"unknown type"}}g.defaultOptions={containerClass:"p-4 fv-bg-background fv-text-primary",containerStyle:{width:"100%",height:"100%"},treeViewClass:"h-100 overflow-auto",treeViewStyle:{}},e.View=g,e.reportContext=function(e,t){let o=new h({context:e,expandedNodes:t?m(e).concat(t):m(e),selectedNode:t}),n=new g({state:o});r.R.popup({view:n,style:{"max-height":"75vh",width:"75vw"},options:{displayCancel:!1,displayOk:!1}})}}(n||(n={}))},991:(e,t,o)=>{"use strict";o.d(t,{g:()=>n});var n,s=o(888),i=o(158),a=o(519);!function(e){function t(e,t,o){return null==t?new n({name:e,nestedIndex:o}):"string"==typeof t?new c({name:e,data:t,nestedIndex:o}):"number"==typeof t?new d({name:e,data:t,nestedIndex:o}):"boolean"==typeof t?new u({name:e,data:t,nestedIndex:o}):"function"==typeof t?new m({name:e,data:t,nestedIndex:o}):Array.isArray(t)?new g({name:e,data:t,nestedIndex:o}):t instanceof ArrayBuffer?new p({name:e,data:t,nestedIndex:o}):"object"==typeof t?new h({name:e,data:t,nestedIndex:o}):new r({name:e,nestedIndex:o})}class o extends s.ImmutableTree.Node{constructor({id:e,name:t,children:o,classes:n,nestedIndex:s}){super({id:e||`${t}_${s}`,children:o}),this.name=t,this.classes=n,this.nestedIndex=s}}e.DataNode=o;class n extends o{constructor({name:e,nestedIndex:t,id:o}){super({id:o,name:e,classes:"fv-text-disabled",nestedIndex:t})}}e.UndefinedNode=n;class r extends o{constructor({name:e,nestedIndex:t,id:o}){super({id:o,name:e,classes:"",nestedIndex:t})}}e.UnknownNode=r;class l extends o{constructor({name:e,data:t,classes:o,nestedIndex:n,id:s}){super({id:s,name:e,classes:o,nestedIndex:n}),this.data=t}}e.ValueNode=l;class d extends l{constructor({name:e,data:t,nestedIndex:o,id:n}){super({id:n,name:e,data:t,classes:"cm-number",nestedIndex:o})}}e.NumberNode=d;class c extends l{constructor({name:e,data:t,nestedIndex:o,id:n}){super({id:n,name:e,data:t,classes:"cm-string",nestedIndex:o})}}e.StringNode=c;class u extends l{constructor({name:e,data:t,nestedIndex:o,id:n}){super({id:n,name:e,data:t,classes:"cm-atom",nestedIndex:o})}}e.BoolNode=u;class p extends l{constructor({name:e,data:t,nestedIndex:o,id:n}){super({id:n,name:e,data:t,classes:"cm-string",nestedIndex:o})}}e.ArrayBufferNode=p;class m extends o{constructor({name:e,data:t,nestedIndex:o,id:n}){super({id:n,name:e,classes:"cm-def",nestedIndex:o}),this.data=t}}e.FunctionNode=m;class h extends o{constructor({name:e,data:t,nestedIndex:o,id:n}){super({id:n,name:e,children:(0,i.of)(t).pipe((0,a.map)((e=>this.getChildrenNodes(e)))),classes:"",nestedIndex:o}),this.data=t}getChildrenNodes(e){let o=[];for(var n in e)o.push(t(n,e[n],this.nestedIndex+1));let s=[];try{s=Object.entries(e.__proto__).map((([e,t])=>new m({name:e,data:t,nestedIndex:this.nestedIndex+1})))}catch(e){}return[...o,...s]}}e.ObjectNode=h;class g extends o{constructor({name:e,data:o,nestedIndex:n,id:s}){super({id:s,name:e,children:(0,i.of)(o).pipe((0,a.map)((e=>Object.entries(e).map((([e,o])=>t(`${e}`,o,n+1)))))),classes:"",nestedIndex:n}),this.data=o}}e.ArrayNode=g;class f extends s.ImmutableTree.State{constructor({title:e,data:o,expandedNodes:n,...s}){super({rootNode:t(e,o,0),expandedNodes:n,...s})}}e.State=f;class w extends s.ImmutableTree.View{constructor({state:e,options:t,...o}){super({state:e,headerView:b,class:w.getStyling(t).containerClass,style:w.getStyling(t).containerStyle,...o})}static getStyling(e){return{...w.defaultOptions,...e||{}}}}function b(e,t){if(t instanceof r)return{class:"d-flex fv-text-disabled flex-wrap",innerText:t.name};let o="";return t instanceof l&&(o=String(t.data),"string"==typeof t.data&&(o="'"+o+"'")),t instanceof n&&(o="undefined"),t instanceof m&&(o=`f(${t.data.length} arg(s))`),t instanceof h&&(o="{...}"),t instanceof g&&(o="[...]"),t instanceof p&&(o=`Array Buffer (${t.data.byteLength} bytes)`),{class:"d-flex fv-pointer",children:[{innerText:t.name},{class:"px-2 w-100 "+t.classes,innerHTML:`<i>${o}</i>`,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}]}}w.defaultOptions={containerClass:"cm-s-blackboard",containerStyle:{"white-space":"nowrap"}},e.View=w,e.dataNodeHeaderView=b}(n||(n={}))},910:(e,t,o)=>{"use strict";o.d(t,{r:()=>n});var n,s=o(935),i=o(888),a=o(991);!function(e){class t extends i.ImmutableTree.Node{constructor({name:e,children:t,isRealized:o,evaluatedFrom:n}){super({id:(0,s.uuidv4)(),children:t}),this.name=e,this.isRealized=o,this.evaluatedFrom=n}}e.ExpectationNode=t;class o extends t{constructor({name:e,children:t,isRealized:o,evaluatedFrom:n}){super({name:e,children:t,isRealized:o,evaluatedFrom:n})}}e.AnyOfNode=o;class n extends t{constructor({name:e,children:t,isRealized:o,evaluatedFrom:n}){super({name:e,children:t,isRealized:o,evaluatedFrom:n})}}e.AllOfNode=n;class r extends t{constructor({name:e,children:t,isRealized:o,evaluatedFrom:n}){super({name:e,children:t,isRealized:o,evaluatedFrom:n})}}function l(e){let i=e=>{let l=e.children&&e.children.length>0?e.children.map((e=>i(e))):void 0,d=new a.g.ObjectNode({id:(0,s.uuidv4)(),name:"evaluated-with",data:e.fromValue,nestedIndex:0});return!l||null==e.succeeded||e.expectation instanceof s.Contract||(l=[d,...l]),e.expectation instanceof s.Contract?new t({name:e.expectation.description,children:l,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):e.expectation instanceof s.AnyOf?new o({name:e.expectation.description,children:l,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):e.expectation instanceof s.AllOf?new n({name:e.expectation.description,children:l,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):e.expectation instanceof s.Of?new r({name:e.expectation.description,children:l,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):e.expectation instanceof s.OptionalsOf?new o({name:e.expectation.description,children:l,isRealized:e.succeeded,evaluatedFrom:e.fromValue}):new t({name:e.expectation.description,children:l,isRealized:null!=e.succeeded?e.succeeded:void 0,evaluatedFrom:e.fromValue})};return i(e)}e.OfNode=r,e.parseReport=l;class d{constructor(e,t,o){this.message=e,this.row=t,this.col=o}}e.ExecutionError=d,e.parseError=function(e){try{let t=e.split("\n"),o=t[0];if(t=t.filter((e=>e.includes("eval")&&2==e.split(",").length)),0==t.length)return new d(o,void 0,void 0);let n=t[0].split(",")[1].split("<anonymous>:")[1].split(")")[0],[s,i]=[Number(n.split(":")[0])-2,Number(n.split(":")[1])];return new d(o,s,i)}catch(e){return new d("Unidentified error",void 0,void 0)}},e.State=class{constructor({status:e,expandedNodes$:o}){this.status=e;let n=l(this.status),s=n.children&&n.children.length>0?n.children[0]:new t({name:"No required conditions defined",children:void 0,isRealized:!0,evaluatedFrom:void 0});this.treeStateRequired=new i.ImmutableTree.State({rootNode:s,expandedNodes:o});let a=n.children&&n.children.length>1?n.children[1]:new t({name:"No optional conditions defined",children:void 0,isRealized:!0,evaluatedFrom:void 0});this.treeStateOptionals=new i.ImmutableTree.State({rootNode:a,expandedNodes:o})}};class c{constructor({state:e,options:t,...o}){Object.assign(this,o);let n={...c.defaultOptions,...t||{}};this.state=e,this.class=n.containerClass,this.style=n.containerStyle,this.children=[{class:"d-flex align-items-center",children:[{class:this.state.status.succeeded?"fas fa-check fv-text-success":"fas fa-times fv-text-error",style:{"min-width":"25px"}},{class:"px-2",innerText:this.state.status.expectation.description}]},{class:"pl-2 flex-grow-1 overflow-auto ",style:{"min-height":"0px"},children:[{class:"pl-2",children:[new i.ImmutableTree.View({state:this.state.treeStateRequired,headerView:u}),new i.ImmutableTree.View({state:this.state.treeStateOptionals,headerView:u})]}]}]}}function u(e,t){if(t instanceof a.g.DataNode)return a.g.dataNodeHeaderView(void 0,t);let s="";t.isRealized&&(s="fv-text-success"),null==t.isRealized&&(s="fv-text-disabled");let i="";return t.isRealized&&(i="fas fa-check fv-text-success px-1"),0==t.isRealized&&(i="fas fa-times fv-text-error px-1"),t instanceof n?{class:"d-flex align-items-center",children:[{class:s+" "+i},{innerText:t.name,class:"fv-text-primary px-2"},{tag:"i",class:"fv-text-primary",innerText:"All of the following:"}]}:t instanceof o?{class:"d-flex align-items-center",children:[{class:s+" "+i},{innerText:t.name,class:"fv-text-primary px-2"},{tag:"i",class:"fv-text-primary",innerText:"Any of the following:"}]}:{class:"d-flex flex-align-items-center ",children:[{class:i},{innerText:t.name,class:s}]}}c.defaultOptions={containerClass:"d-flex flex-column",containerStyle:{"min-height":"0px"}},e.View=c,e.journalWidget=function(t){let o=new a.g.State({title:"incoming data",data:t.fromValue,expandedNodes:["incoming data_0"]}),n=new e.State({status:t});return{children:[{class:"d-flex justify-content-around w-100",style:{"white-space":"nowrap"},children:[new a.g.View({state:o}),{class:"px-4"},new e.View({state:n})]}]}}}(n||(n={}))},143:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});var n=o(222),s=o(158);function i(e){let t=new s.BehaviorSubject(!1);return(0,n.child$)(t,(o=>({class:"p-1 d-flex",children:[{tag:"i",class:"fas fa-info fv-hover-bg-background-alt p-1 fv-pointer rounded "+(o?"fv-bg-background-alt":""),onclick:()=>t.next(!t.getValue())},o?{class:"p-1 px-2 fv-bg-background-alt rounded",style:{"text-align":"justify","font-style":"italic"},innerText:e}:{}]})))}},700:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});var n,s=o(935),i=o(690),a=o(158),r=o(142),l=o(910);!function(e){class t extends i.Tabs.TabData{constructor(){super("data","data")}}class o extends i.Tabs.TabData{constructor(){super("configuration","configuration")}}e.State=class{constructor({mdle:e,adaptedInput:n,contract:r,selectedTabId$:l}){this.selectedTabId$=l||new a.BehaviorSubject("data"),this.tabState=new i.Tabs.State([new t,new o],l),this.configStatus=(0,s.mergeConfiguration)(e.configuration.data,n.configuration);let d=new s.Context("",{});this.dataStatus=r.resolve(n.data,d)}};class n{constructor({state:e,options:d,...c}){Object.assign(this,c),this.options={...n.defaultOptions,...d||{}},this.state=e,this.class=this.options.containerClass,this.style=this.options.containerStyle;let u=new a.BehaviorSubject(["optional","required"]),p=new i.Tabs.View({state:this.state.tabState,contentView:(e,n)=>{if(n instanceof t){let e=new l.r.State({status:this.state.dataStatus,expandedNodes$:u});return new l.r.View({state:e})}if(n instanceof o){let e=new r.e.State({status:this.state.configStatus});return new r.e.View({state:e})}},headerView:(e,n)=>n instanceof t?function(e){let t="fas fa-check fv-text-success px-1";return e?e.succeeded||(t="fas fa-times fv-text-error px-1"):t="fas fa-question px-1",{class:"d-flex align-items-center px-2",children:[{class:t},{innerText:"data"}]}}(this.state.dataStatus):n instanceof o?function(e){let t={};return e instanceof s.InconsistentConfiguration&&(t={class:"fas fa-times fv-text-error px-1"}),e instanceof s.ConsistentConfiguration&&e.intrus.length>0&&(t={class:"fas fa-exclamation fv-text-danger px-1"}),e instanceof s.ConsistentConfiguration&&0==e.intrus.length&&(t={class:"fas fa-check fv-text-success px-1"}),{class:"d-flex align-items-center px-2",children:[t,{innerText:"configuration"}]}}(this.state.configStatus):{innerText:n.name,class:"px-2"},class:"h-100 d-flex flex-column",style:{"min-height":"0px"},options:{containerStyle:{"min-height":"0px"},containerClass:"p-2 border flex-grow-1 overflow-auto"}});this.children=[p]}}n.defaultOptions={containerClass:"h-100 w-100",containerStyle:{}},e.View=n}(n||(n={}))},97:(e,t,o)=>{"use strict";o.d(t,{R:()=>n});var n,s=o(222),i=o(327),a=o(337),r=o(158);!function(e){e.popup=function({view:e,style:t,ok$:o,options:n}){n=n||{displayOk:!0,displayCancel:!0};let l=new i.Button.View({state:new i.Button.State,contentView:()=>({innerText:"Ok"}),class:"fv-btn fv-btn-primary fv-bg-focus mr-2"}),d=i.Button.simpleTextButton("Cancel"),c=new a.Modal.State(o),u=(0,s.render)(new a.Modal.View({state:c,contentView:()=>({class:"border rounded fv-text-primary fv-bg-background d-flex flex-column",style:t||{height:"50vh",width:"50vw","max-width":"1500px"},children:[e,{class:"d-flex p-2",children:[n.displayOk?l:void 0,n.displayCancel?d:void 0].filter((e=>e))}]}),connectedCallback:e=>{let t=[l.state.click$.subscribe((()=>c.ok$.next())),d.state.click$.subscribe((()=>c.cancel$.next())),(0,r.merge)(c.cancel$,c.ok$).subscribe((()=>u.remove()))];e.subscriptions=[...e.subscriptions,...t]}}));return document.querySelector("body").appendChild(u),c.ok$}}(n||(n={}))},864:(e,t,o)=>{"use strict";o.d(t,{R:()=>n});var n,s=o(222),i=o(327),a=o(313),r=o(158),l=o(519),d=o(97);!function(e){class t{constructor({appStore:e}){let t=[new a.Select.ItemData("youwol-url","YouWol Platform URL"),new a.Select.ItemData("relative-url","Relative URL")];"localhost"==location.hostname&&t.push(new a.Select.ItemData("localhost-url","Localhost URL")),this.selectState=new a.Select.State(t,"youwol-url"),this.sourceURI$=(0,r.combineLatest)([e.projectURI$(),this.selectState.selectionId$])}toUrl(e,t){return"relative-url"==t?`${e}`:"localhost-url"==t?`${location.hostname}:${location.port}${e}`:`https://platform.youwol.com${e}`}}e.State=t;class o{constructor({state:e,...t}){Object.assign(this,t),this.state=e,this.class=this.class||o.defaultOptions.containerClass,this.style=this.style||o.defaultOptions.containerStyle;let n=new i.Button.View({state:new i.Button.State,contentView:()=>({innerText:""}),class:"fv-btn fv-btn-primary fv-bg-focus fas fa-copy ml-2"});this.connectedCallback=t=>{t.subscriptions.push(n.state.click$.pipe((0,l.mergeMap)((()=>e.sourceURI$)),(0,l.mergeMap)((([t,o])=>(0,r.from)(navigator.clipboard.writeText(e.toUrl(t,o)))))).subscribe((()=>{console.log("Copied:::!!!")})))},this.children=[{innerText:"The following url can be used to share your application:"},new a.Select.View({state:e.selectState}),{class:"d-flex align-items-center",children:[{style:{"text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden","font-family":"monospace"},innerText:(0,s.attr$)(e.sourceURI$,(([t,o])=>e.toUrl(t,o)))},n]},{class:"d-flex align-items-center fv-bg-background-alt rounded my-3",children:[{class:"fas fa-exclamation fv-text-focus px-2"},{innerText:"This feature is a work in progress, it is expected to work with 'relatively' small application for now. Also, the consumer of this link will need to have access to all packages/modules/resources included in your app."}]}]}}o.defaultOptions={containerClass:"d-flex flex-column p-3",containerStyle:{"min-height":"0px"}},e.View=o,e.popupModal=function(e){let n=new t({appStore:e}),s=new o({state:n});d.R.popup({view:s,style:{width:"75vw","max-width":"1000px"},options:{displayOk:!1,displayCancel:!1}})}}(n||(n={}))},931:(e,t,o)=>{"use strict";o.d(t,{k:()=>r});var n=o(935),s=o(158),i=o(519),a=o(995);class r{static setHeaders(e){r.headers=e}static getAsset$(e){let t=r.urlBaseAssets+`/${e}`,o=new Request(t,{headers:r.headers});return(0,n.createObservableFromFetch)(o)}static getFolderChildren$(e){let t=new Request(`/api/assets-gateway/tree/folders/${e}/children`,{headers:r.headers});return(0,n.createObservableFromFetch)(t)}static getGroupChildrenDrives$(e){let t=new Request(`/api/assets-gateway/tree/groups/${e}/drives`,{headers:r.headers});return(0,n.createObservableFromFetch)(t)}static getGroupChildren$(e=""){let t=new Request("/api/assets-gateway/groups",{headers:r.headers});return(this.allGroups?(0,s.of)(this.allGroups):(0,n.createObservableFromFetch)(t).pipe((0,i.tap)((({groups:e})=>this.allGroups=e)),(0,i.map)((({groups:e})=>e)))).pipe((0,i.mergeMap)((t=>{let o=t.filter((t=>""==e?"private"==t.path||"/youwol-users"==t.path:t.path!=e&&t.path.includes(e)&&1==t.path.slice(e.length).match(/\//g).length));if(""==e)return(0,s.of)({groups:o,drives:[],groupId:void 0});let n=t.find((t=>t.path==e)).id;return r.getGroupChildrenDrives$(n).pipe((0,i.map)((({drives:e})=>({groupId:n,groups:o,drives:e}))))})))}static getModules$(e){let t=new Request(`/api/assets-gateway/raw/package/metadata/${e}`,{headers:r.headers});return(0,n.createObservableFromFetch)(t).pipe((0,i.mergeMap)((e=>{if(window[e.name])return(0,s.of)({targetLibrary:e,loadingGraph:{lock:[],fluxPacks:[],libraries:{}}});let t={...r.appStore.project.requirements.libraries,[e.name]:e.versions[0]},o=(0,a.fetchBundles)(t,window);return(0,s.from)(o).pipe((0,i.map)((t=>({targetLibrary:e,loadingGraph:t}))))})),(0,i.map)((({targetLibrary:e,loadingGraph:t})=>{let o=window[e.name];return{factories:Object.values(o).filter((e=>e&&e.Module&&e.BuilderView)),library:e,loadingGraph:t}})))}}r.appStore=void 0,r.tmpLibraries=void 0,r.urlBase="/api/assets-gateway",r.urlBaseOrganisation="/api/assets-gateway/tree",r.urlBaseAssets="/api/assets-gateway/assets",r.urlBaseRaws="/api/assets-gateway/raw",r.allGroups=void 0,r.headers={}},568:(e,t,o)=>{"use strict";o.d(t,{D:()=>a,H:()=>r});var n=o(935),s=o(94),i=o(606);function a(e,t){let o=s.ST.getInstance(),n=(0,i.HZ)(t),a=e.getActiveGroup().getModuleIds(),l=e.project.workflow.plugins.filter((e=>a.includes(e.parentModule.moduleId))).map((e=>e.moduleId)),d=[...a,...l].filter((e=>!n[e])).map((t=>e.getModule(t))).filter((e=>e.Factory.RenderView)),c=t.BlockManager.getAll().filter((e=>"Components"==e.get("category").id));o.debugOn&&o.logRenderTopic({level:s.in.Info,message:"set dynamic components block",object:{modulesToRender:d,componentBlocks:c}}),c.forEach((e=>t.BlockManager.remove(e.id))),d.forEach((o=>t.BlockManager.add(o.moduleId,function(e,t,o){return{id:e.moduleId,label:e.configuration.title,name:e.configuration.title,content:r(e,t,o),activate:!0,category:"Components",render:({el:t})=>{let o=document.createElement("div");o.id=e.moduleId,t.appendChild(o);let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width","100px"),n.setAttribute("height","70px");let s=(new e.Factory.BuilderView).icon();const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.style.stroke="currentColor",i.classList.add("group-target"),i.innerHTML=s.content,n.appendChild(i),o.appendChild(n),document.body.appendChild(n),function(e){if(e.style.transform)return;let t=e.parentElement.getBoundingClientRect(),o=e.getBoundingClientRect(),n=t.top-o.top,s=t.left-o.left,i=Math.min(t.width/o.width,t.height/o.height);e.style.transform=`translate(${t.width/4}px,${t.height/4}px) scale(${.5*i}) translate(${s}px,${n}px)`}(i),n.remove(),o.appendChild(n)}}}(o,t,e.project.workflow))))}function r(e,t,o){let i=s.ST.getInstance();if(i.debugOn&&i.logRenderTopic({level:s.in.Info,message:"getDynamicBlockWrapperDiv",object:{mdle:e}}),e instanceof n.Component.Module){let t=e.getFullHTML(o);return t?t.outerHTML:`<div id="${e.moduleId}" class="flux-element flux-component"  data-gjs-name="${e.configuration.title}"></div>`}let a=e.Factory.RenderView.wrapperDivAttributes,r="flux-element"+(a&&a(e).class?" "+a(e).class:""),l=a&&a(e).style?a(e).style:{},d=Object.entries(l).reduce(((e,[t,o])=>e+t+":"+o+";"),"");return t.getStyle().add(`#${e.moduleId}{${d}}`),console.log("getFluxBlockContent",e),`<div id="${e.moduleId}" class="${r}"  data-gjs-name="${e.configuration.title}"></div>`}},595:(e,t,o)=>{"use strict";o.d(t,{tj:()=>r,Ni:()=>l,kH:()=>d,l3:()=>c,fr:()=>u});var n=o(935),s=o(94),i=o(568),a=o(606);function r(e,t){let o=(0,a.HZ)(t),n=e.filter((e=>e.Factory.RenderView)),i=s.ST.getInstance();i.debugOn&&i.logRenderTopic({level:s.in.Info,message:"removeTemplateElements",object:{modules:e,modulesToRemove:n}}),n.filter((e=>o[e.moduleId])).forEach((e=>o[e.moduleId].remove()))}function l(e,t,o){let i=s.ST.getInstance();if(0==e.length)return;i.debugOn&&i.logRenderTopic({level:s.in.Info,message:"replaceTemplateElements",object:{moduleIds:e,appStore:o}});let r=t.Canvas.getDocument().body.querySelector("div"),l=e.map((e=>o.getModule(e))).filter((e=>e.Factory.RenderView));(0,n.renderTemplate)(r,l.filter((e=>!(e instanceof n.Component.Module))),{applyWrapperAttributes:!1}),l.filter((e=>e instanceof n.Component.Module)).map((e=>[e,t.Canvas.getDocument().getElementById(e.moduleId)])).filter((([e,t])=>t)).forEach((([e,t])=>{e.renderedElementDisplayed$.next(t)}));let d=(0,a.HZ)(t);return l.filter((e=>null!=d[e.moduleId])).forEach((e=>{d[e.moduleId].attributes.name=e.configuration.title})),l}function d(e,t,o){let n=e.removedElements.map((e=>e.moduleId));l(e.createdElements.filter((e=>e.Factory.RenderView)).filter((e=>n.includes(e.moduleId))).map((e=>e.moduleId)),t,o)}function c(e,t,o){let s=(0,a.HZ)(t),r=e.removedElements.map((e=>e.moduleId));l(e.createdElements.filter((e=>e.Factory.RenderView)).filter((e=>!r.includes(e.moduleId))).filter((e=>o.getRootComponent().getModuleIds().includes(e.moduleId))).filter((e=>!(e instanceof n.Component.Module))).map((e=>{let n=(0,i.H)(e,t,o.project.workflow);return console.log(s[o.rootComponentId]),s[o.rootComponentId].append(n,{at:0}),e.moduleId})),t,o)}function u(e,t,o){let s=e.removedElements.map((e=>e.moduleId));r(e.createdElements.filter((e=>e instanceof n.Component.Module)).filter((e=>!s.includes(e.moduleId))).map((e=>e.getDirectChildren(o.project.workflow))).flat(),t)}},95:(e,t,o)=>{"use strict";o.d(t,{cw:()=>f,Af:()=>w});var n=o(595);function s(e,t){var o=e.CodeManager.getViewer("CodeMirror").clone();return o.set({codeName:"html"===t?"htmlmixed":"css",readOnly:!1,theme:"hopscotch",autoBeautify:!0,autoCloseTags:!0,autoCloseBrackets:!0,styleActiveLine:!0,smartIndent:!0}),o}var i=o(935),a=o(94),r=o(606),l=o(568);let d="",c="";var u=o(864);function p(e){return[{id:"app-basic-actions",el:"#panel__app-basic-actions",buttons:[{id:"save-project",className:"btn-save-project",label:'<i class="fas fa-save panel-action" data-toggle="tooltip" title="Save project" ></i>',command(t){e.saveProject()}},{id:"share-uri",className:"btn-share-uri",label:'<i class="fas fa-link panel-action" data-toggle="tooltip" title="share uri" ></i>',command(t){u.R.popupModal(e)}},{id:"undo",className:"btn-undo",label:'<i class="fas fa-undo panel-action" data-toggle="tooltip" title="Undo" ></i>',command(t){e.undo()}},{id:"redo",className:"btn-redo",label:'<i class="fas fa-redo panel-action" data-toggle="tooltip" title="Redo" ></i>',command(t){e.redo()}}]},{id:"app-layout-builder-actions",el:"#panel__app-layout-builder-actions",buttons:[{id:"toggle-builder-view",active:!0,className:"app-layout-builder-actions",label:'<i id="toggle-builder-view" class="fas fa-project-diagram  panel-action" data-toggle="tooltip" title="Toggle builder view"></i>',command:"toggle-builder-view"}]},{id:"app-layout-render-actions",el:"#panel__app-layout-render-actions",buttons:[{id:"toggle-render-view",className:"app-layout-render-actions",label:'<i id="toggle-render-view" class="fas fa-eye  panel-action" data-toggle="tooltip" title="Toggle builder view"></i>',command:"toggle-render-view"}]},{id:"app-layout-actions",el:"#panel__app-layout-actions",buttons:[{id:"toggle-full-screen",active:!1,className:"app-layout-actions",label:'<i id="toggle-render-view" class="fas fa-expand  panel-action" data-toggle="tooltip" title="Fullscreen mode"></i>',command:"toggle-fullscreen",toggable:!1}]},{id:"panel__app-selection-actions",el:"#panel__app-selection-actions",buttons:[{id:"duplicate-module",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-clone panel-action" data-toggle="tooltip" title="duplicate selected modules"></i>',command:"duplicate-module",toggable:!1},{id:"horizontal-align",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-ruler-vertical panel-action" data-toggle="tooltip" title="horizontal align selected modules"></i>',command:"horizontal-align",toggable:!1},{id:"vertical-align",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-ruler-horizontal panel-action" data-toggle="tooltip" title="vertical align selected modules"></i>',command:"vertical-align",toggable:!1},{id:"group-module",active:!1,className:"selection-actions",label:'<i id="toggle-render-view" class="fas fa-object-group panel-action" data-toggle="tooltip" title="group selected modules"></i>',command:"group-module",toggable:!1}]},{id:"panel__app-component-actions",el:"#panel__app-component-actions",buttons:[{id:"create-component",active:!1,className:"selection-actions",label:'<i id="create-component" class="fas fa-cube panel-action" data-toggle="tooltip" title="create a component from selected modules"></i>',command:"group-as-component",toggable:!1},{id:"publish-component",active:!1,className:"selection-actions",label:'<i id="publish-component" class="fas fa-upload panel-action" data-toggle="tooltip" title="publish selected component"></i>',command:"publish-component",toggable:!1}]},{id:"panel__app-tree-structure",el:"#panel__app-tree-structure",buttons:[{id:"display-tree-structure",active:!1,className:"tree-structure",label:'<label class="text-light border px-2" >active layer <i class="fas fa-caret-down pl-2"></i> </label>',command:"display-tree-structure",toggable:!1}]}]}var m=o(158),h=o(519),g=o(586);async function f(){localStorage.setItem("gjs-components",""),localStorage.setItem("gjs-html",""),localStorage.setItem("gjs-css",""),localStorage.setItem("gjs-styles","");let e=a.ST.getInstance();e.debugOn&&e.logRenderTopic({level:a.in.Info,message:"create layout editor",object:{}});let t=new m.Subject,o=g.init({autorender:!1,container:"#gjs",canvas:{styles:[],scripts:[]},height:"100%",width:"auto",panels:{defaults:[]},assetManager:{assets:[],autoAdd:1},keymaps:{defaults:{}},commands:{defaults:[]},selectorManager:{appendTo:"#styles"},blockManager:{appendTo:"#blocks",blocks:[{id:"section",label:"<b>Section</b>",category:"Basic",attributes:{class:"gjs-block-section"},content:"<section>\n        <h1>This is a simple title</h1>\n        <div>This is just a Lorem text: Lorem ipsum dolor sit amet</div>\n      </section>",render({el:e}){e.classList.add("gjs-fonts","gjs-f-h1p")}},{id:"text",label:"Text",category:"Basic",content:'<div data-gjs-type="text">Insert your text here</div>',render({el:e}){e.classList.add("gjs-fonts","gjs-f-text")}},{id:"image",label:"Image",category:"Basic",select:!0,content:{type:"image"},activate:!0,render({el:e}){e.classList.add("gjs-fonts","gjs-f-image")}},{id:"link",label:"Link",category:"Basic",select:!0,content:{type:"link",content:"Text for the link",attributes:{href:""}}},{id:"2-columns",label:"2 Columns",category:"Layouts",content:'\n            <div class="" style="display:flex; width:100%; height:100%; padding:5px" data-gjs-droppable=".fx-row-cell" data-gjs-custom-name="Row">\n              <div class="" style="min-width:50px; width:100%" data-gjs-draggable=".row" \n                data-gjs-resizable="resizerRight" data-gjs-name= "Cell"></div>\n              <div class="" style="min-width:50px; width:100%"  data-gjs-draggable=".row"\n                data-gjs-resizable="resizerRight" data-gjs-name= "Cell" ></div>\n            </div>\n          ',render({el:e}){e.classList.add("gjs-fonts","gjs-f-b2")}}]},styleManager:{appendTo:"#styles",sectors:[{name:"Dimension",open:!1,buildProps:["width","height","min-width","min-height","max-width","max-height","padding","margin"],properties:[{type:"integer",name:"The width",property:"width",units:["px","%"],defaults:"auto",min:0}]},{name:"Extra",open:!1,buildProps:["background-color","box-shadow","custom-prop"],properties:[{id:"custom-prop",name:"Custom Label",property:"font-size",type:"select",defaults:"32px",options:[{value:"12px",name:"Tiny"},{value:"18px",name:"Medium"},{value:"32px",name:"Big"}]}]},{name:"Typography",open:!1,buildProps:["font-family","font-size","font-weight","letter-spacing","color","line-height","text-align","text-decoration","text-shadow"],properties:[{name:"Font",property:"font-family"},{name:"Weight",property:"font-weight"},{name:"Font color",property:"color"},{property:"text-align",type:"radio",defaults:"left",list:[{value:"left",name:"Left",className:"fa fa-align-left"},{value:"center",name:"Center",className:"fa fa-align-center"},{value:"right",name:"Right",className:"fa fa-align-right"},{value:"justify",name:"Justify",className:"fa fa-align-justify"}]},{property:"text-decoration",type:"radio",defaults:"none",list:[{value:"none",name:"None",className:"fa fa-times"},{value:"underline",name:"underline",className:"fa fa-underline"},{value:"line-through",name:"Line-through",className:"fa fa-strikethrough"}]},{property:"text-shadow",properties:[{name:"X position",property:"text-shadow-h"},{name:"Y position",property:"text-shadow-v"},{name:"Blur",property:"text-shadow-blur"},{name:"Color",property:"text-shadow-color"}]}]},{name:"Decorations",open:!1,buildProps:["opacity","background-color","border-radius","border","box-shadow","background"],properties:[{type:"slider",property:"opacity",defaults:1,step:.01,max:1,min:0},{property:"border-radius",properties:[{name:"Top",property:"border-top-left-radius"},{name:"Right",property:"border-top-right-radius"},{name:"Bottom",property:"border-bottom-left-radius"},{name:"Left",property:"border-bottom-right-radius"}]},{property:"box-shadow",properties:[{name:"X position",property:"box-shadow-h"},{name:"Y position",property:"box-shadow-v"},{name:"Blur",property:"box-shadow-blur"},{name:"Spread",property:"box-shadow-spread"},{name:"Color",property:"box-shadow-color"},{name:"Shadow type",property:"box-shadow-type"}]},{property:"background",properties:[{name:"Image",property:"background-image"},{name:"Repeat",property:"background-repeat"},{name:"Position",property:"background-position"},{name:"Attachment",property:"background-attachment"},{name:"Size",property:"background-size"}]}]},{name:"Extra",open:!1,buildProps:["transition","perspective","transform"],properties:[{property:"transition",properties:[{name:"Property",property:"transition-property"},{name:"Duration",property:"transition-duration"},{name:"Easing",property:"transition-timing-function"}]},{property:"transform",properties:[{name:"Rotate X",property:"transform-rotate-x"},{name:"Rotate Y",property:"transform-rotate-y"},{name:"Rotate Z",property:"transform-rotate-z"},{name:"Scale X",property:"transform-scale-x"},{name:"Scale Y",property:"transform-scale-y"},{name:"Scale Z",property:"transform-scale-z"}]}]},{name:"Flex",open:!1,properties:[{name:"Flex Container",property:"display",type:"select",defaults:"block",list:[{value:"block",name:"Disable"},{value:"flex",name:"Enable"}]},{name:"Flex Parent",property:"label-parent-flex",type:"integer"},{name:"Direction",property:"flex-direction",type:"radio",defaults:"row",list:[{value:"row",name:"Row",className:"icons-flex icon-dir-row",title:"Row"},{value:"row-reverse",name:"Row reverse",className:"icons-flex icon-dir-row-rev",title:"Row reverse"},{value:"column",name:"Column",title:"Column",className:"icons-flex icon-dir-col"},{value:"column-reverse",name:"Column reverse",title:"Column reverse",className:"icons-flex icon-dir-col-rev"}]},{name:"Justify",property:"justify-content",type:"radio",defaults:"flex-start",list:[{value:"flex-start",className:"icons-flex icon-just-start",title:"Start"},{value:"flex-end",title:"End",className:"icons-flex icon-just-end"},{value:"space-between",title:"Space between",className:"icons-flex icon-just-sp-bet"},{value:"space-around",title:"Space around",className:"icons-flex icon-just-sp-ar"},{value:"center",title:"Center",className:"icons-flex icon-just-sp-cent"}]},{name:"Align",property:"align-items",type:"radio",defaults:"center",list:[{value:"flex-start",title:"Start",className:"icons-flex icon-al-start"},{value:"flex-end",title:"End",className:"icons-flex icon-al-end"},{value:"stretch",title:"Stretch",className:"icons-flex icon-al-str"},{value:"center",title:"Center",className:"icons-flex icon-al-center"}]},{name:"Flex Children",property:"label-parent-flex",type:"integer"},{name:"Order",property:"order",type:"integer",defaults:0,min:0},{name:"Flex",property:"flex",type:"composite",properties:[{name:"Grow",property:"flex-grow",type:"integer",defaults:0,min:0},{name:"Shrink",property:"flex-shrink",type:"integer",defaults:0,min:0},{name:"Basis",property:"flex-basis",type:"integer",units:["px","%",""],unit:"",defaults:"auto"}]},{name:"Align",property:"align-self",type:"radio",defaults:"auto",list:[{value:"auto",name:"Auto"},{value:"flex-start",title:"Start",className:"icons-flex icon-al-start"},{value:"flex-end",title:"End",className:"icons-flex icon-al-end"},{value:"stretch",title:"Stretch",className:"icons-flex icon-al-str"},{value:"center",title:"Center",className:"icons-flex icon-al-center"}]}]}]},layerManager:{appendTo:"#layers"},traitManager:{appendTo:"#traits"}});o.dynamicModulesId=[],o.fluxCache={};let n=document.getElementById("bootstrap-css");n||console.error("Bootstrap css needs to be included in host application with id 'bootstrap-css' ");let s=document.getElementById("fontawesome-css");s||console.error("Fontawesome css needs to be included in host application with id 'fontawesome-css' ");let i=document.getElementById("youwol-css");return i||console.error("Fontawesome css needs to be included in host application with id 'fontawesome-css' "),o.on("load",(function(){let e=o.Canvas.getDocument(),a=e.head;a.appendChild(n.cloneNode()),a.appendChild(s.cloneNode()),a.appendChild(i.cloneNode());var r=e.createElement("style");r.innerHTML=".mw-50px{ min-width:50px}.w-5{width:5%};.w-10{width:10%}.w-15{width:15%}.w-20{width:20%}.w-30{width:30%}.w-40{width:40%}.w-60{width:60%}.w-70{width:70%}.w-80{width:80%}.w-90{width:90%}.zindex-1{z-index:1}\n    .flux-component{min-height:50px;} .preview .gjs-hovered{outline:0px !important} .preview .gjs-selected{outline:0px !important} \n    .flux-builder-only{opacity:0.5} .flux-builder-only.preview{ display:none !important}\n    .flux-fill-parent{width:100%; height:100%}",e.body.appendChild(r),t.next(o)})),o.SelectorManager.getAll().each((e=>{console.log("Set privates class!!"),e.set("private",!0)})),o.render(),new Promise((e=>t.pipe((0,h.take)(1)).subscribe((t=>e(t)))))}function w(e,{layout:t,style:o},u){let m=a.ST.getInstance();m.debugOn&&m.logRenderTopic({level:a.in.Info,message:"initialize layout editor",object:{}}),function(e,t){let o=a.ST.getInstance();e.on("change",(e=>{let n=localStorage.getItem("gjs-html");n!=d&&""!=n&&(o.debugOn&&o.logRenderTopic({level:a.in.Info,message:"change => layout",object:{element:e,oldLayout:d,newLayout:n}}),t.setRenderingLayout(localStorage.getItem("gjs-html")),d=n);let s=(0,r.ar)(localStorage.getItem("gjs-css"));s!=c&&""!=s&&(o.debugOn&&o.logRenderTopic({level:a.in.Info,message:"change => style",object:{element:e,oldCss:c,newCss:s}}),t.setRenderingStyle(s),c=s)})),e.on("canvas:drop",((s,r)=>{o.debugOn&&o.logRenderTopic({level:a.in.Info,message:"canvas:drop",object:{dataTransfer:s,component:r.toJSON()}});let d=r.view.el,c=t.getModule(d.id);if(c){o.debugOn&&o.logRenderTopic({level:a.in.Info,message:"canvas:drop => flux-module",object:{module:c}});let s=[];c instanceof i.Component.Module&&(s=c.getAllChildren(t.project.workflow).map((e=>e.moduleId)),e.getStyle().add(c.getFullCSS(t.project.workflow,{asString:!0}))),d.id=c.moduleId,(0,n.Ni)([d.id,...s],e,t),(0,l.D)(t,e)}})),e.on("component:update:content",(e=>{o.debugOn&&o.logRenderTopic({level:a.in.Info,message:"component:update:content",object:{module:e}})})),e.on("component:update:style",(e=>{o.debugOn&&o.logRenderTopic({level:a.in.Info,message:"component:update:style",object:{module:e}})})),e.on("sorter:drag:end",(({modelToDrop:s,srcEl:r})=>{if(o.debugOn&&o.logRenderTopic({level:a.in.Info,message:"sorter:drag:end",object:{module:s}}),"string"==typeof s)return;let l=t.getModule(s.ccid);if(!l)return;let d=l instanceof i.Component.Module?l.getAllChildren(t.project.workflow).map((e=>e.moduleId)):[l.moduleId];(0,n.Ni)(d,e,t)})),e.on("component:remove",(o=>{t.getActiveGroup().getModuleIds().includes(o.ccid)&&(0,l.D)(t,e)})),e.on("selector:add",(e=>{e.set("active",!1),e.set("private",r.cV.includes(e.id))})),e.Commands.add("show-blocks",{getRowEl:e=>e.getContainer().closest("#editor-row"),getLayersEl:e=>e.querySelector("#blocks"),run(e,t){this.getLayersEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getLayersEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-styles",{getRowEl:e=>e.getContainer().closest("#editor-row"),getStyleEl:e=>e.querySelector("#styles"),run(e,t){this.getStyleEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getStyleEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-layers",{getRowEl:e=>e.getContainer().closest("#editor-row"),getLayersEl:e=>e.querySelector("#layers"),run(e,t){this.getLayersEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getLayersEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("show-traits",{getRowEl:e=>e.getContainer().closest("#editor-row"),getTraitsEl:e=>e.querySelector("#traits"),run(e,t){this.getTraitsEl(this.getRowEl(e)).style.display=""},stop(e,t){this.getTraitsEl(this.getRowEl(e)).style.display="none"}}),e.Commands.add("open-code",{getRowEl:e=>e.getContainer().closest("#editor-row"),getCodeEl:e=>e.querySelector("#codes"),run:function(e,o){const i=e.Panels,a="code",r=i.getPanel(a)||i.addPanel({id:a});let l=this.getCodeEl(this.getRowEl(e));console.log("Code elements",l),this.codePanel||(this.codePanel=function(e,t,o){const i=document.createElement("div");i.classList.add("code-panel");const a=document.createElement("section"),r=document.createElement("section");a.innerHTML="<div>HTML</div>",r.innerHTML="<div>CSS</div>";const l=s(t,"html"),d=s(t,"css"),c=document.createElement("textarea"),u=document.createElement("textarea");return a.appendChild(c),r.appendChild(u),i.appendChild(a),i.appendChild(r),o.set("appendContent",i).trigger("change:appendContent"),l.init(c),d.init(u),l.setContent(t.getHtml()),d.setContent(t.getCss({avoidProtected:!0})),function(e,t,o){function s(){const s=o.editor.getValue();if(!s)return;t.setComponents(s),(0,n.Ni)(e.project.workflow.modules.map((e=>e.moduleId)),t,e);let i=Object.values(t.fluxCache).reduce(((e,t)=>e+" "+t.styles),"");t.getStyle().add(i)}var i;o.editor.on("change",(function(){clearTimeout(i),i=setTimeout(s,300)})),o.editor.refresh()}(e,t,l),function(e,t){function o(){const o=t.editor.getValue();o&&e.setStyle(o)}var n;t.editor.on("change",(function(){clearTimeout(n),n=setTimeout(o,300)}))}(t,d),setTimeout((()=>{l.editor.refresh(),d.editor.refresh()}),320),i}(t,e,r)),console.log("Code Panel",this.codePanel),this.codePanel.style.display="block",l.appendChild(this.codePanel)},stop:function(e,t){this.codePanel&&(this.codePanel.style.display="none")}}),e.Commands.add("custom-preview",{run(e,t){document.querySelector("#gjs-cv-tools").classList.add("preview"),e.Canvas.getDocument().body.querySelector("div").classList.add("preview"),Array.from(e.Canvas.getDocument().querySelectorAll(".flux-builder-only")).forEach((e=>e.classList.add("preview"))),document.getElementById("panels-container-render").classList.add("collapsed");let o=document.getElementById("panel__right_render");o.classList.add("collapsed"),o.querySelectorAll(".flex-align-switch").forEach((e=>e.style.flexDirection="column")),o.querySelectorAll(".buttons-toolbox").forEach((e=>{let t=e.firstChild;t&&t.style&&(t.style.flexDirection="column")}))},stop(e,t){document.querySelector("#gjs-cv-tools").classList.remove("preview"),e.Canvas.getDocument().body.querySelector("div").classList.remove("preview"),Array.from(e.Canvas.getDocument().querySelectorAll(".flux-builder-only")).forEach((e=>e.classList.remove("preview"))),document.getElementById("panels-container-render").classList.remove("collapsed");let o=document.getElementById("panel__right_render");o.classList.remove("collapsed"),o.querySelectorAll(".flex-align-switch").forEach((e=>e.style.flexDirection="row")),o.querySelectorAll(".buttons-toolbox").forEach((e=>{let t=e.firstChild;t&&t.style&&(t.style.flexDirection="row")}))}}),e.Commands.add("set-device-tablet",{run(e,t){e.setDevice("Tablet")},stop(e,t){}}),e.Commands.add("set-device-desktop",{run(e,t){e.setDevice("Desktop")},stop(e,t){}}),e.Commands.add("set-device-mobile-landscape",{run(e,t){e.setDevice("Mobile landscape")},stop(e,t){}}),e.Commands.add("set-device-mobile-portrait",{run(e,t){e.setDevice("Mobile portrait")},stop(e,t){}}),e.on("run:preview:before",(({sender:e})=>{e.panelRight=document.getElementById("panel__right"),e.panelRight.remove()})),e.on("stop:preview:before",(({sender:e})=>{e&&e.panelRight&&document.getElementById("editor-row").appendChild(e.panelRight)}))}(e,u),e.BlockManager.getCategories().each((e=>e.set("open",!1))),[...p(u),{id:"layout-basic-actions",el:"#panel__layout-basic-actions",buttons:[{id:"visibility",active:!0,className:"btn-toggle-borders",label:'<i class="fas fa-border-none"></i>',command:"sw-visibility"}]},{id:"layout-show-actions",el:"#panel__render-show-actions",buttons:[{id:"preview",className:"btn-preview",label:'<i class="fas fa-eye"></i>',command:"custom-preview"}]},{id:"layout-devices-actions",el:"#panel__layout-devices-actions",buttons:[{id:"desktop",active:!0,className:"btn-set-device-desktop",label:'<i class="fas fa-desktop"></i>',command:"set-device-desktop"},{id:"tablet",active:!1,className:"btn-set-device-tablet",label:'<i class="fas fa-tablet-alt"></i>',command:"set-device-tablet"},{id:"mobile landscape",active:!1,className:"btn-set-device-phone",label:'<i class="fas fa-mobile-alt"></i>',command:"set-device-mobile-landscape"},{id:"mobile portrait",active:!1,className:"btn-set-device-phone",label:'<i class="fas fa-mobile-alt"></i>',command:"set-device-mobile-portrait"}]},{id:"layout-managers-actions",el:"#panel__render-panels-actions",buttons:[{id:"show-blocks",active:!0,label:'<i class="fas fa-th-large"></i>',command:"show-blocks",togglable:!1},{id:"show-style",active:!1,label:'<i class="fas fa-palette"></i>',command:"show-styles",togglable:!1},{id:"show-traits",active:!1,className:"fa fa-cog",command:"show-traits",attributes:{title:"Open Trait Manager"},togglable:!1},{id:"show-layers",active:!1,className:"fa fa-bars",command:"show-layers",attributes:{title:"Open Layer Manager"},togglable:!1},{id:"code",className:"btn-preview",label:'<i class="fas fa-code"></i>',command:"open-code"}]}].forEach((t=>e.Panels.addPanel(t))),function(e){let t=document.getElementById("gjs-tools").querySelector(".gjs-toolbar");new MutationObserver((function(e,o){t.children.length>0&&(t.querySelector(".fa-arrows").classList.add("fas","fa-arrows-alt"),t.querySelector(".fa-trash-o").classList.add("fas","fa-trash"))})).observe(t,{attributes:!0,childList:!0,subtree:!1});let o=e.Commands.get("tlb-move");e.Commands.add("tlb-move",{run(e,t,n={}){n&&n.event&&n.event.target||o.run(e,t,n)}}),e.Commands.run("show-attributes"),e.Commands.stop("show-attributes"),e.Commands.run("show-styles"),e.Commands.stop("show-styles"),e.Commands.run("show-traits"),e.Commands.stop("show-traits"),e.Commands.run("show-layers"),e.Commands.stop("show-layers"),document.getElementById("panel__layout-devices-actions").children[0].classList.add("d-flex","flex-wrap"),document.getElementById("panel__render-panels-actions").children[0].classList.add("d-flex","flex-wrap")}(e),console.log("INIT!!",{layout:t.outerHTML,style:o}),e.setComponents(t.outerHTML),e.setStyle(o)}},606:(e,t,o)=>{"use strict";o.d(t,{cV:()=>n,ar:()=>s,HZ:()=>i});let n=["flux-element","flux-component","flux-fill-parent","d-flex","flex-column"];function s(e){return[...new Set(e.split("}"))].filter((e=>e.length>0)).map((e=>e+"}")).reduce(((e,t)=>e+t),"")}function i(e,t){const o=(e,t=[])=>(t.push(e),e.components().each((e=>o(e,t))),t);return t=t||e.DomComponents.getWrapper(),o(t).reduce(((e,t)=>Object.assign({},e,{[t.ccid]:t})),{})}},345:(e,t,o)=>{"use strict";o.d(t,{o:()=>r});var n=o(935),s=o(222),i=o(519),a=o(230);function r(e,t){e.environment.errors$.pipe((0,i.filter)((e=>e.error instanceof n.ModuleError))).subscribe((o=>l.error({message:o.error.message,title:o.error.module.Factory.id,actions:[{name:"focus",exe:()=>function(e,t,o,s,i=5e3){t.getRootComponent();let a=t.project.workflow.modules.find((e=>e instanceof n.GroupModules.Module&&e.getModuleIds().includes(e.moduleId)));t.selectActiveGroup(a.moduleId),setTimeout((()=>{let t=document.getElementById(e.moduleId),n=t.getBoundingClientRect();o.drawingArea.lookAt(.5*(n.left+n.right),.5*(n.top+n.bottom)),t.classList.toggle(s),setTimeout((()=>t.classList.toggle(s)),i)}),0)}(o.error.module,e,t,"error")},{name:"report",exe:()=>a.R.reportContext(o.context,o.id)}]}))),e.environment.processes$.subscribe((e=>{let t={[n.ProcessMessageKind.Scheduled]:"fas fa-clock px-2",[n.ProcessMessageKind.Started]:"fas fa-cog fa-spin px-2",[n.ProcessMessageKind.Succeeded]:"fas fa-check fv-text-success px-2",[n.ProcessMessageKind.Failed]:"fas fa-times fv-text-error px-2",[n.ProcessMessageKind.Log]:"fas fa-cog fa-spin px-2"},o=[n.ProcessMessageKind.Succeeded,n.ProcessMessageKind.Failed],r=e.context?[{name:"report",exe:()=>a.R.reportContext(e.context)}]:[];l.notify({title:e.title,message:(0,s.attr$)(e.messages$,(e=>e.text)),classIcon:(0,s.attr$)(e.messages$,(e=>t[e.kind])),actions:r,timeout:e.messages$.pipe((0,i.filter)((e=>o.includes(e.kind))),(0,i.take)(1),(0,i.delay)(1e3))})}))}class l{constructor(e){this.appStore=e}static notify({message:e,title:t,classIcon:o,actions:n,timeout:s}){l.popup({message:e,title:t,actions:n,classIcon:o,timeout:s,classBorder:""})}static error({message:e,title:t,actions:o}){l.popup({message:e,title:t,actions:o,classIcon:l.classesIcon[4],classBorder:l.classesBorder[4]})}static warning({message:e,title:t,actions:o}){l.popup({message:e,title:t,actions:o,classIcon:l.classesIcon[3],classBorder:l.classesBorder[3]})}static popup({message:e,title:t,actions:o,classIcon:n,classBorder:i,timeout:a}){let r={class:"m-2 p-2 my-1 bg-white rounded "+i,style:{border:"solid"},children:[{class:"fas fa-times",style:{float:"right",cursor:"pointer"},onclick:e=>{e.target.parentElement.remove()}},{class:"d-flex py-2 align-items-center",children:[{tag:"i",class:n},{tag:"span",class:"d-block",innerText:t}]},e?{tag:"span",class:"d-block px-2",innerText:e}:{},{class:"d-flex align-space-around mt-2 fv-pointer",children:o.map((e=>({tag:"span",class:"mx-2 p-2 fv-bg-background-alt rounded fv-hover-bg-background fv-hover-text-focus fv-text-primary",innerText:e.name,onclick:()=>e.exe()})))}],connectedCallback:e=>{a&&a.subscribe((()=>e.remove()))}},l=(0,s.render)(r);document.getElementById("notifications-container").appendChild(l)}}l.classesIcon={4:"fas fa-2x fa-exclamation-circle text-danger px-2 mt-auto mb-auto",3:"fas fa-2x fa-exclamation text-warning px-2 mt-auto mb-auto"},l.classesBorder={4:"border-danger",3:"border-warning"}},600:(e,t,o)=>{"use strict";o.a(e,(async e=>{o.r(t),o.d(t,{connectStreams:()=>C,createDrawingArea:()=>M});var n=o(158),s=o(519),i=o(935),a=o(249),r=o(396),l=o(94),d=o(322),c=o(48),u=o(95),p=o(345),m=o(931),h=o(735),g=o(222),f=o(401),w=o(595),b=o(568),x=o(450);let v=!1,y=l.ST.getInstance();y.workflowUIEnabled=v,y.observableEnabled=v,y.workflowUIEnabled=v,y.workflowViewEnabled=v,y.WorkflowBuilderEnabled=v,y.renderTopicEnabled=v,y.workflowView$Enabled=v;let I=new i.Environment({console,renderingWindow:void 0,executingWindow:window});y.logWorkflowBuilder({level:l.in.Info,message:"Environment instantiated",object:{environment:I}});let S=l.dk.getInstance(I);!function(e){m.k.appStore=e,h.Q.singletonState=new h.Q.State({appStore:e}),i.Journal.registerView({name:"ConfigurationStatus",isCompatible:e=>e instanceof i.ConfigurationStatus,view:e=>(0,g.render)(c.eD.journalWidget(e))}),i.Journal.registerView({name:"ExpectationStatus",isCompatible:e=>e instanceof i.ExpectationStatus,view:e=>(0,g.render)(c.rj.journalWidget(e))})}(S),function(e){let t=(0,x.E)(e);document.body.appendChild((0,g.render)(t))}(S);let j=await(0,u.cw)();!function(e){I.renderingWindow=e.Canvas.getDocument().defaultView}(j);let k=M(S,S.appObservables);(0,p.o)(S,k);let $=new c.j3(S,k.drawingArea);async function C(e,t){let o=!0,i=e.appObservables;i.packagesLoaded$.subscribe((()=>document.getElementById("loading-screen").remove())),i.uiStateUpdated$.subscribe((e=>function(e){let t=document.getElementById("render-component"),o=document.getElementById("builder-component");o.classList.remove("combined","builder","render","none"),t.classList.remove("combined","builder","render","none"),o.classList.add(e.mode),t.classList.add(e.mode)}(e))),await i.renderingLoaded$.pipe((0,s.take)(1)).toPromise().then((({layout:o,style:n})=>{(0,u.Af)(t,{layout:o,style:n},e),(0,w.Ni)(e.getModulesAndPlugins().map((e=>e.moduleId)),t,e)})),i.modulesUpdated$.subscribe((n=>{let s=n.createdElements.map((e=>e.moduleId)),i=n.removedElements.filter((e=>!s.includes(e.moduleId)));(0,w.tj)(i,t),o&&(0,w.Ni)(s,t,e),o||((0,w.l3)(n,t,e),(0,w.kH)(n,t,e),(0,w.fr)(n,t,e)),(0,b.D)(e,t)})),i.activeLayerUpdated$.subscribe((()=>{(0,b.D)(e,t)})),i.unselect$.subscribe((()=>{t.Commands.stop("show-attributes")})),(0,n.merge)(i.moduleSelected$,i.connectionSelected$).subscribe((()=>{t.Commands.run("show-attributes")})),i.uiStateUpdated$.subscribe((()=>{t.refresh()})),o=!1}function M(e,t){let o=l.Dw.getInstance(),n=(0,a.createDrawingArea)({containerDivId:"wf-builder-view",width:1e3,height:1e3,xmin:-500,ymin:-500,xmax:500,ymax:500,margin:50,overflowDisplay:{left:1e8,right:1e8,top:1e8,bottom:1e8}});return new d.hb(n,t,o,e)}new r.ContextMenu.View({state:$,class:"fv-bg-background"}),C(S,j),function(e){let t=new URLSearchParams(window.location.search).get("id"),o=new URLSearchParams(window.location.search).get("uri");if(t){let o=document.getElementById("content-loading-screen"),n=(0,f.XF)(o);e.environment.getProject(t).subscribe((s=>{n.innerText="> project loaded",n.style.setProperty("color","green"),e.loadProject(t,s,(e=>{(0,f.Cu)(e,o)}))}))}else o&&e.loadProjectURI(encodeURI(o))}(S),e()}),1)},450:(e,t,o)=>{"use strict";o.d(t,{E:()=>C});var n,s=o(935),i=o(222),a=o(158),r=o(939),l=o(519),d=o(182),c=o(327),u=o(313),p=o(690),m=o(137);!function(e){function t(e,t,o,n){let s=t.reduce(((e,t)=>e[t]),o),i=n.elementsViewFactory.find((t=>t.test(e)));if(!i)return{id:"unkwnown-element-"+e.name+"-"+e.type};let r=new a.BehaviorSubject(s),d=i.view(r,e),c=r.pipe((0,l.map)((e=>({path:t,value:e}))));return n.outputValues$.push(c),d}function o(e,n,s=[],i){let a=e.filter((([e,t])=>!e.includes(".")&&function(e){return e.type&&["Number","String","Boolean","Object"].includes(e.type)}(t))),r=e.filter((e=>e[0].includes("."))).map((([e,t])=>{let o=e.split(".")[0];return[o,[e.split(".").slice(1).join("."),t],s.concat(o)]})).reduce(((e,[t,o,n])=>(e[t]||(e[t]={values:[],basePath:n}),e[t].values.push(o),e)),{}),l=Object.entries(r).map((([e,{values:t,basePath:s}])=>[e,o(t,n,s,i)])).reduce(((e,[t,o])=>Object.assign({},e,{[t]:o})),{}),d=function(e,o,n,s){let i=Object.keys(o.reduce(((e,t)=>e[t]),n));return 0==(e=e.sort(((e,t)=>i.indexOf(e[0])-i.indexOf(t[0])))).length?{}:{class:"row",style:{padding:"0px",margin:"0px"},children:e.map((e=>[{class:"col my-auto p-0",innerText:e[0]},{class:"col pl-0",style:{"align-self":"center"},children:[t(e[1],o.concat(e[0]),n,s)]},{class:"w-100 py-1"}])).reduce(((e,t)=>e.concat(t)))}}(a,s,n,i),c=Object.entries(l).map((([e,t])=>{let o=new p.Tabs.TabData(e,e);return o.view=t,o}));if(0==c.length)return{class:"p-2",children:[d]};let u=new p.Tabs.State(c);return{class:"p-2",children:[d,new p.Tabs.View({state:u,contentView:(e,t)=>t.view,headerView:(e,t)=>({innerText:t.name,class:"px-2"})})]}}e.State=class{constructor(t,o,n=e.viewFactory){this.schema=o,this.elementsViewFactory=n,this.outputValues$=new Array,this.inputValues$=t instanceof a.BehaviorSubject?t:new a.BehaviorSubject(t),this.currentValue$=new a.BehaviorSubject(this.inputValues$.getValue())}},e.viewFactory=[{test:e=>"Boolean"==e.type,view:e=>(c.Switch.View.defaultRadius=10,new c.Switch.View({state:new c.Switch.State(e)}))},{test:e=>"color"==e.metadata.type,view:(e,t)=>new u.ColorPicker.View({state:new u.ColorPicker.State(e)})},{test:e=>e.metadata.enum,view:(e,t)=>{let o=t.metadata.enum.map((e=>new u.Select.ItemData(e,e)));return new u.Select.View({state:new u.Select.State(o,e),class:"w-100 ",style:{fontSize:"larger"}})}},{test:e=>"String"==e.type,view:e=>({tag:"input",type:"text",value:e.getValue(),onchange:t=>e.next(t.target.value)})},{test:e=>"Number"==e.type&&null!=e.metadata.min&&null!=e.metadata.max,view:(e,t)=>{let o=new a.BehaviorSubject(!1),n=new u.Slider.State({min:t.metadata.min,max:t.metadata.max,value:e,count:1e3});return{class:"d-flex",children:[{tag:"input",class:(0,i.attr$)(o,(e=>e?"w-100":"w-25")),type:"number",value:(0,i.attr$)(e,(e=>e)),onchange:t=>e.next(Number(t.target.value)),onmouseenter:()=>o.next(!0),onmouseleave:()=>o.next(!1)},new u.Slider.View({state:n,class:"w-75"})]}}},{test:e=>"Number"==e.type,view:e=>({tag:"input",type:"number",value:e.getValue(),onchange:t=>e.next(Number(t.target.value))})}],e.View=class{constructor({state:e,...t}){Object.assign(this,t),this.state=e,this.children=[(0,i.child$)(e.inputValues$,(t=>o(Object.entries(e.schema),t,[],e)),{sideEffects:(t,o)=>{let n=(0,a.combineLatest)(this.state.outputValues$).subscribe((t=>{let o=(0,m.cloneDeep)(e.inputValues$.getValue());t.forEach((({path:e,value:t})=>{let n=e.slice(-1)[0];e.slice(0,-1).reduce(((e,t)=>e[t]),o)[n]=t})),e.currentValue$.next(o)}));o.ownSubscriptions(n)}})]}}}(n||(n={}));let h=class{constructor(e={}){this.wireless=!1,this.adaptor="\n    return ({data,configuration,context}) => ({\n        data: data,\n        context:{},\n        configuration: configuration\n    })",Object.assign(this,e)}};(0,r.gn)([(0,s.Property)({description:"wireless"}),(0,r.w6)("design:type",Boolean)],h.prototype,"wireless",void 0),(0,r.gn)([(0,s.Property)({description:"adaptor",type:"code"}),(0,r.w6)("design:type",String)],h.prototype,"adaptor",void 0),h=(0,r.gn)([(0,s.Schema)({pack:{}}),(0,r.w6)("design:paramtypes",[Object])],h);class g{constructor(e,t){this.appStore=t;let o=t.getConnectionView(e.connectionId),i=new h({...o?{wireless:o.wireless}:{},...e.adaptor?{adaptor:e.adaptor.toString()}:{}}),r=(0,s.flattenSchemaWithValue)(i);Object.keys(r).forEach((e=>r[e]=r[e][0]));let c=new a.BehaviorSubject(i);this.autoFormState=new n.State(c,r,((e,t)=>[{test:e=>e.metadata&&"code"==e.metadata.type,view:o=>({class:"fab fa-js-square fv-pointer fa-2x fv-hover-bg-background",onclick:()=>{d.b.popupModal({connection:e,initialCode:o.getValue(),appStore:t,onUpdate:e=>o.next(e)})}})},...n.viewFactory])(e,t)),this.initialSettings$=new a.BehaviorSubject(i);let u=this.autoFormState.currentValue$.pipe((0,l.filter)((e=>e.wireless!=this.initialSettings$.getValue().wireless))).subscribe((t=>{this.initialSettings$.next(t),this.appStore.setConnectionView(e,{wireless:t.wireless},!0),this.appStore.selectConnection(e.connectionId)})),p=this.autoFormState.currentValue$.pipe((0,l.filter)((e=>e.adaptor!=this.initialSettings$.getValue().adaptor))).subscribe((o=>{this.initialSettings$.next(o);let n=new s.Adaptor((0,s.uuidv4)(),o.adaptor);t.addAdaptor(n,e),this.appStore.selectConnection(e.connectionId)}));this.subscriptions=[u,p]}}class f{constructor(e){this.state=e,this.class="h-100 d-flex flex-column",this.style={fontSize:"smaller"},this.children=[new n.View({state:e.autoFormState,class:"flex-grow-1 overflow-auto my-1",style:{"min-height":"0px"}})],this.connectedCallback=t=>{t.ownSubscriptions(...e.subscriptions)}}}var w=o(350);function b(e,t,o,n){let s=n.metadata.editorConfiguration||{};return{class:`${e} fv-pointer fa-2x fv-hover-bg-background`,onclick:()=>w.s.popupModal({mdle:t,initialCode:o.getValue(),editorConfiguration:s,onUpdate:e=>o.next(e)})}}class x{constructor(e,t){this.mdle=e,this.appStore=t,this.onTheFlyUpdates$=new a.BehaviorSubject(!0);let o=(0,s.flattenSchemaWithValue)(e.configuration.data);Object.keys(o).forEach((e=>o[e]=o[e][0]));let i=new a.BehaviorSubject(e.configuration.data);this.initialSettings$=new a.BehaviorSubject(e.configuration.data),this.autoFormState=new n.State(i,o,(e=>[{test:e=>e.metadata&&"code"==e.metadata.type&&(!e.metadata.editorConfiguration||"javascript"==e.metadata.editorConfiguration.mode),view:(t,o)=>b("fab fa-js-square",e,t,o)},{test:e=>e.metadata&&"code"==e.metadata.type&&"css"==e.metadata.editorConfiguration.mode,view:(t,o)=>b("fab fa-css3-alt",e,t,o)},{test:e=>e.metadata&&"code"==e.metadata.type&&("html"==e.metadata.editorConfiguration.mode||"htmlmixed"==e.metadata.editorConfiguration.mode||"xml"==e.metadata.editorConfiguration.mode),view:(t,o)=>b("fab fa-html5",e,t,o)},...n.viewFactory])(e));let r=this.autoFormState.currentValue$.pipe((0,l.withLatestFrom)(this.onTheFlyUpdates$),(0,l.filter)((([e,t])=>t)),(0,l.filter)((([e])=>JSON.stringify(e)!=JSON.stringify(this.initialSettings$.getValue())))).subscribe((()=>this.applySettings()));this.subscriptions=[r]}toggleUpdatePolicy(){this.onTheFlyUpdates$.next(!this.onTheFlyUpdates$.getValue())}applySettings(e){let t=this.autoFormState.currentValue$.getValue(),o=new this.mdle.Factory.PersistentData(t),n=new s.ModuleConfiguration({title:e||this.mdle.configuration.title,description:this.mdle.configuration.description,data:o});this.initialSettings$.next(t),this.appStore.updateModule(this.mdle,n,!1)}}class v{constructor(e){this.state=e,this.class="h-100 d-flex flex-column",this.style={fontSize:"smaller"},this.applyChangesButton={children:[{class:"fas fa-sync fv-text-focus fv-hover-bg-background p-1 border rounded fv-pointer"}],onclick:()=>this.state.applySettings()},this.children=[this.header(),new n.View({state:e.autoFormState,class:"flex-grow-1 overflow-auto my-1",style:{"min-height":"0px"}})],this.connectedCallback=t=>{t.ownSubscriptions(...e.subscriptions)}}header(){return{class:"border rounded p-1",children:[(0,i.child$)(this.state.onTheFlyUpdates$,(e=>this.updatePolicyView(e))),{class:"d-flex align-items-center py-2 justify-content-around",children:[{innerText:"Module's title",class:"my-auto"},{tag:"input",type:"text",value:this.state.mdle.configuration.title,onchange:e=>{this.state.applySettings(e.target.value)}}]}]}}updatePolicyView(e){return{class:"d-flex align-items-center",children:[{tag:"input",type:"checkbox",checked:e,onclick:()=>this.state.toggleUpdatePolicy()},{class:"px-2",innerText:"auto apply changes"},e?{}:this.applyChangesButton]}}}function y(e){let t={combined:"h-50 d-flex",builder:"h-100 d-flex",render:"d-none"};return{id:"builder-component",class:(0,i.attr$)(e.appObservables.uiStateUpdated$,(e=>t[e.mode])),children:[{id:"wf-builder-view",class:"h-100 flex-grow-1"},I(e)]}}function I(e){let t=e.appObservables,o=[{when:e=>e instanceof s.ModuleFlux,mapTo:t=>{let o=new x(t,e);return new v(o)}},{when:e=>e instanceof s.Connection,mapTo:t=>{let o=new g(t,e);return new f(o)}}];return{id:"panel__right_builder",class:"d-flex flex-column grapes-bg-color fv-color-primary p-1 border border-dark text-left fv-text-primary",style:{width:"300px",minHeight:"0px",fontSize:"small"},children:[(0,i.child$)((0,a.merge)(t.unselect$,t.moduleSelected$,t.connectionSelected$),(e=>{let t=o.find((t=>t.when(e)));return t?t.mapTo(e):{}}))]}}function S(e){let t={combined:"h-50",builder:"d-none",render:"h-100"};return{id:"render-component",class:(0,i.attr$)(e.appObservables.uiStateUpdated$,(e=>t[e.mode])),children:[{id:"editor-row",class:"d-flex h-100",children:[{id:"gjs"},{id:"panel__right_render",class:"grapes-bg-color fv-color-primary border-top fv-color-primary controls-panel",children:[{class:"d-flex justify-content-between  flex-align-switch",children:[{id:"panel__layout-basic-actions",class:"d-block position-relative flex-align-switch buttons-toolbox"},{id:"panel__layout-devices-actions",class:"d-block position-relative flex-align-switch buttons-toolbox"}]},{id:"panel__layout-managers-actions",class:"d-flex position-relative  flex-align-switch justify-content-between ",children:[{id:"panel__render-panels-actions",class:"d-block position-relative buttons-toolbox "},{id:"panel__render-show-actions",class:"d-block position-relative buttons-toolbox "}]},{id:"panels-container-render",class:"overflow-auto  p-1 border border-dark panels-container",style:{height:"calc(100% - 80px)",width:"300px"},children:[{id:"blocks"},{id:"styles"},{id:"traits"},{id:"layers"},{id:"codes"}]}]}]}]}}var j=o(94);function k(e){let t=function(e){let t=e.appObservables;return{main:[{name:"save",class:"fas fa-save",visible:(0,a.of)(!0),enabled:(0,a.of)(!0),onTriggered:()=>e.saveProject()},{name:"undo",class:"fas fa-undo",visible:new a.BehaviorSubject(!0),enabled:t.projectUpdated$.pipe((0,l.map)((()=>e.indexHistory>1))),onTriggered:()=>e.undo()},{name:"redo",class:"fas fa-redo",visible:new a.BehaviorSubject(!0),enabled:t.projectUpdated$.pipe((0,l.map)((()=>e.indexHistory<e.history.length-1))),onTriggered:()=>e.redo()}],layout:[{name:"builder-view",class:"fas fa-project-diagram",visible:(0,a.of)(!0),enabled:t.uiStateUpdated$.pipe((0,l.map)((e=>"render"==e.mode||"combined"==e.mode))),onTriggered:()=>e.setUiState(new j.CE("builder",!1,!1))},{name:"render-view",class:"fas fa-eye",visible:(0,a.of)(!0),enabled:t.uiStateUpdated$.pipe((0,l.map)((e=>"builder"==e.mode||"combined"==e.mode))),onTriggered:()=>e.setUiState(new j.CE("render",!1,!1))},{name:"builder-view",class:"fas fa-columns fa-rotate-90",visible:(0,a.of)(!0),enabled:t.uiStateUpdated$.pipe((0,l.map)((e=>"render"==e.mode||"builder"==e.mode))),onTriggered:()=>e.setUiState(new j.CE("combined",!1,!1))},{name:"builder-view",class:"fas fa-expand  ",visible:(0,a.of)(!0),enabled:(0,a.of)(!0),onTriggered:()=>document.documentElement.requestFullscreen()}],modules:[{name:"duplicate",class:"fas fa-clone",visible:(0,a.of)(!0),enabled:(0,a.merge)(t.unselect$,t.moduleSelected$).pipe((0,l.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{let t=e.getModulesSelected();e.duplicateModules(t)}},{name:"horizontal align",class:"fas fa-ruler-vertical",visible:(0,a.of)(!0),enabled:(0,a.merge)(t.unselect$,t.moduleSelected$).pipe((0,l.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{let t=e.getModulesSelected();e.alignH(t)}},{name:"horizontal align",class:"fas fa-ruler-horizontal",visible:(0,a.of)(!0),enabled:(0,a.merge)(t.unselect$,t.moduleSelected$).pipe((0,l.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{let t=e.getModulesSelected();e.alignV(t)}}],groups:[{name:"group",class:"fas fa-object-group",visible:(0,a.of)(!0),enabled:(0,a.merge)(t.unselect$,t.moduleSelected$).pipe((0,l.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{e.addGroup(e.getModulesSelected().map((e=>e.moduleId)))}},{name:"component",class:"fas fa-cube",visible:(0,a.of)(!0),enabled:(0,a.merge)(t.unselect$,t.moduleSelected$).pipe((0,l.map)((e=>e instanceof s.ModuleFlux))),onTriggered:()=>{e.addComponent(e.getModulesSelected().map((e=>e.moduleId)))}}]}}(e);return{class:"d-flex grapes-bg-color py-1  fv-color-primary justify-content-around",children:[$(t.main),$(t.layout),$(t.modules),$(t.groups)]}}function $(e,t){return{class:"d-flex ",children:e.map((e=>function(e){let t=e.visible instanceof a.Observable?e.visible:(0,a.of)(e.visible),o=e.enabled instanceof a.Observable?e.enabled:(0,a.of)(e.enabled);return{tag:"button",type:"button",disabled:(0,i.attr$)(o,(e=>!e)),class:(0,i.attr$)(t,(e=>e?"d-block":"d-none"),{wrapper:e=>e+" fv-btn fv-btn-secondary mx-1 fv-pointer"}),style:(0,i.attr$)(o,(e=>e?{opacity:1}:{opacity:.5})),children:[{tag:"i",class:e.class+""}],onclick:()=>e.onTriggered()}}(e)))}}function C(e){return{id:"main-container",class:"h-100 w-100 d-flex flex-column",children:[k(e),{class:"flex-grow-1",style:{minHeight:"0px"},children:[y(e),S(e)]},{id:"notifications-container"}]}}}}]);
//# sourceMappingURL=600.2dae311d43a0adaca0aa.js.map